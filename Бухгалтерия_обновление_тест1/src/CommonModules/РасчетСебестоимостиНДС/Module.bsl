#Область ПрограммныйИнтерфейс

#Область ЭтапыРасчета

// Этап "ПодготовкаДанныхДляУчетаНДС"
//
// Параметры:
//	ПараметрыРасчета - Структура - параметры расчета себестоимости
//
Процедура ПодготовкаДанныхДляУчетаНДС(ПараметрыРасчета) Экспорт
	
    РасчетСебестоимостиПротоколРасчета.НачалоЭтапаРасчета(ПараметрыРасчета, "ПодготовкаДанныхДляУчетаНДС");
	
	// 1. Инициализация структуры данных для расчета
	//	- формирует структуру ПараметрыРасчета.РаспределениеПартий.
	РасчетСебестоимостиПрикладныеАлгоритмы.ИнициализироватьРаспределениеПартий(
		ПараметрыРасчета,
		ТаблицаДляРаспределенияПартийНДС(ПараметрыРасчета),
		ОписаниеЦепочекПартийНДС(ПараметрыРасчета),
		ОписаниеДвиженийПартийНДС(ПараметрыРасчета),
		ОписаниеНезаписываемыхПартийНДС(ПараметрыРасчета));
		
	// 2. Получение исходных данных для расчета
	// 	- формирует временную таблицу Данные.
	ПолучитьДанныеДляПартийНДС(ПараметрыРасчета);
	Если ПараметрыРасчета.РежимОтладки Тогда
		ПриходыТоваров                                      = ОбщегоНазначенияУТ.ПоказатьВременнуюТаблицу(ПараметрыРасчета.МенеджерВременныхТаблиц, "ПриходыТоваров");
		ВТКэшРасчетныеОборотыСебестоимостьТоваров           = ОбщегоНазначенияУТ.ПоказатьВременнуюТаблицу(ПараметрыРасчета.МенеджерВременныхТаблиц, "ВТКэшРасчетныеОборотыСебестоимостьТоваров");
		ПриходыСборокТоваров                                = ОбщегоНазначенияУТ.ПоказатьВременнуюТаблицу(ПараметрыРасчета.МенеджерВременныхТаблиц, "ПриходыСборокТоваров");
		СписаниеОтклоненийВСтоимости                        = ОбщегоНазначенияУТ.ПоказатьВременнуюТаблицу(ПараметрыРасчета.МенеджерВременныхТаблиц, "СписаниеОтклоненийВСтоимости");
		ОстаткиТоваров                                      = ОбщегоНазначенияУТ.ПоказатьВременнуюТаблицу(ПараметрыРасчета.МенеджерВременныхТаблиц, "ОстаткиТоваров");
		ПрошлыеРеализацииПартийНДС                          = ОбщегоНазначенияУТ.ПоказатьВременнуюТаблицу(ПараметрыРасчета.МенеджерВременныхТаблиц, "ПрошлыеРеализацииПартийНДС");
		ПриходыТоваровНДС                                   = ОбщегоНазначенияУТ.ПоказатьВременнуюТаблицу(ПараметрыРасчета.МенеджерВременныхТаблиц, "ПриходыТоваровНДС");
		ВТКэшРасчетныеОборотыДетализацияПартийТоваровДляНДС = ОбщегоНазначенияУТ.ПоказатьВременнуюТаблицу(ПараметрыРасчета.МенеджерВременныхТаблиц, "ВТКэшРасчетныеОборотыДетализацияПартийТоваровДляНДС");
		ОстаткиСебестоимостиТоваров                         = ОбщегоНазначенияУТ.ПоказатьВременнуюТаблицу(ПараметрыРасчета.МенеджерВременныхТаблиц, "ОстаткиСебестоимостиТоваров");
		ВТНачальныеОстаткиПартийНДС                         = ОбщегоНазначенияУТ.ПоказатьВременнуюТаблицу(ПараметрыРасчета.МенеджерВременныхТаблиц, "ВТНачальныеОстаткиПартийНДС");
		
	    Данные 												= ОбщегоНазначенияУТ.ПоказатьВременнуюТаблицу(ПараметрыРасчета.МенеджерВременныхТаблиц, "Данные"); 
	КонецЕсли;
    
	// 3. Получение цепочек из исходных данных
	// 	- формирует временные таблицы Источники и Приемники.
	РасчетСебестоимостиПрикладныеАлгоритмы.ПостроитьЦепочкиДвижений(ПараметрыРасчета);
	Если ПараметрыРасчета.РежимОтладки Тогда
		Данные    = ОбщегоНазначенияУТ.ПоказатьВременнуюТаблицу(ПараметрыРасчета.МенеджерВременныхТаблиц, "Данные");
		Источники = ОбщегоНазначенияУТ.ПоказатьВременнуюТаблицу(ПараметрыРасчета.МенеджерВременныхТаблиц, "Источники");
		Приемники = ОбщегоНазначенияУТ.ПоказатьВременнуюТаблицу(ПараметрыРасчета.МенеджерВременныхТаблиц, "Приемники");
    КонецЕсли;
	
	// 4. Заполнение партий в цепочках
	// 	- заполняет таблицу ПараметрыРасчета.РаспределениеПартий.РасчетныеПартии.
	РасчетСебестоимостиПрикладныеАлгоритмы.РассчитатьПартииПоЦепочкам(ПараметрыРасчета);
	
	// 5. Помещение данных в таблицу-приемник и очистка вспомогательных временных таблиц.
    // 	- формирует движения по регистру ДетализацияПартийТоваровДляНДС.
	РасчетСебестоимостиПрикладныеАлгоритмы.ЗавершитьРаспределениеПартий(ПараметрыРасчета);
	Если ПараметрыРасчета.РежимОтладки Тогда
		ВТКэшДетализацияПартийТоваровДляНДС = ОбщегоНазначенияУТ.ПоказатьВременнуюТаблицу(ПараметрыРасчета.МенеджерВременныхТаблиц, "ВТКэшДетализацияПартийТоваровДляНДС");
	КонецЕсли;
	
КонецПроцедуры

// Этап "ПодготовкаДанныхДляУчетаНДС2_4"
//
// Параметры:
//	ПараметрыРасчета - Структура - параметры расчета себестоимости
//
Процедура ПодготовкаДанныхДляУчетаНДС2_4(ПараметрыРасчета) Экспорт
	
    РасчетСебестоимостиПротоколРасчета.НачалоЭтапаРасчета(ПараметрыРасчета, "ПодготовкаДанныхДляУчетаНДС2_4");
	
	// 1. Инициализация структуры данных для расчета
	//	- формирует структуру ПараметрыРасчета.РаспределениеПартий
	РасчетСебестоимостиПрикладныеАлгоритмы.ИнициализироватьРаспределениеПартий(
		ПараметрыРасчета,
		ТаблицаДляРаспределенияПартийНДС2_4(ПараметрыРасчета),
		ОписаниеЦепочекПартийНДС2_4(ПараметрыРасчета),
		ОписаниеДвиженийПартийНДС2_4(ПараметрыРасчета),
		ОписаниеНезаписываемыхПартийНДС2_4(ПараметрыРасчета));
		
	// 2. Получение исходных данных для расчета
	// 	- формирует временную таблицу Данные
	ПолучитьДанныеДляПартийНДС2_4(ПараметрыРасчета);
    
	Если ПараметрыРасчета.РежимОтладки Тогда   
		ВТЗнаменателиПоНоменклатуре               = ОбщегоНазначенияУТ.ПоказатьВременнуюТаблицу(ПараметрыРасчета.МенеджерВременныхТаблиц, "ВТЗнаменателиПоНоменклатуре");
		ОстаткиСебестоимостиТоваровДетально2_4    = ОбщегоНазначенияУТ.ПоказатьВременнуюТаблицу(ПараметрыРасчета.МенеджерВременныхТаблиц, "ОстаткиСебестоимостиТоваровДетально2_4");
		ОстаткиСебестоимостиТоваров2_4            = ОбщегоНазначенияУТ.ПоказатьВременнуюТаблицу(ПараметрыРасчета.МенеджерВременныхТаблиц, "ОстаткиСебестоимостиТоваров2_4");
		ВТСтоимостьПартийТоваров    			  = ОбщегоНазначенияУТ.ПоказатьВременнуюТаблицу(ПараметрыРасчета.МенеджерВременныхТаблиц, "ВТСтоимостьПартийТоваров");
		СписаниеОтклоненийВСтоимости2_4    		  = ОбщегоНазначенияУТ.ПоказатьВременнуюТаблицу(ПараметрыРасчета.МенеджерВременныхТаблиц, "СписаниеОтклоненийВСтоимости2_4");
		ПрошлыеРеализацииПартийНДС2_2    		  = ОбщегоНазначенияУТ.ПоказатьВременнуюТаблицу(ПараметрыРасчета.МенеджерВременныхТаблиц, "ПрошлыеРеализацииПартийНДС2_2");
		КоличествоПрошлыеРеализацииПартийНДС2_2   = ОбщегоНазначенияУТ.ПоказатьВременнуюТаблицу(ПараметрыРасчета.МенеджерВременныхТаблиц, "КоличествоПрошлыеРеализацииПартийНДС2_2");
		ПрошлыеРеализацииПартийНДС2_4    		  = ОбщегоНазначенияУТ.ПоказатьВременнуюТаблицу(ПараметрыРасчета.МенеджерВременныхТаблиц, "ПрошлыеРеализацииПартийНДС2_4");
		ПриходыТоваровНДС2_4    			  	  = ОбщегоНазначенияУТ.ПоказатьВременнуюТаблицу(ПараметрыРасчета.МенеджерВременныхТаблиц, "ПриходыТоваровНДС2_4");
		ВТНачальныеОстаткиПартийНДС    			  = ОбщегоНазначенияУТ.ПоказатьВременнуюТаблицу(ПараметрыРасчета.МенеджерВременныхТаблиц, "ВТНачальныеОстаткиПартийНДС");
		ВТКэшРасчетныеОборотыСебестоимостьТоваров = ОбщегоНазначенияУТ.ПоказатьВременнуюТаблицу(ПараметрыРасчета.МенеджерВременныхТаблиц, "ВТКэшРасчетныеОборотыСебестоимостьТоваров");
		ЗнаменателиПриходов                       = ОбщегоНазначенияУТ.ПоказатьВременнуюТаблицу(ПараметрыРасчета.МенеджерВременныхТаблиц, "ЗнаменателиПриходов");
		ВТРасчетныеЦены                           = ОбщегоНазначенияУТ.ПоказатьВременнуюТаблицу(ПараметрыРасчета.МенеджерВременныхТаблиц, "ВТРасчетныеЦены");
		ВТПлановыеЦены                            = ОбщегоНазначенияУТ.ПоказатьВременнуюТаблицу(ПараметрыРасчета.МенеджерВременныхТаблиц, "ВТПлановыеЦены");
		ВТОтборАналитикиУчетаПартийНДС2_4         = ОбщегоНазначенияУТ.ПоказатьВременнуюТаблицу(ПараметрыРасчета.МенеджерВременныхТаблиц, "ВТОтборАналитикиУчетаПартийНДС2_4");
		ДвиженияСебестоимостиНДС2_4               = ОбщегоНазначенияУТ.ПоказатьВременнуюТаблицу(ПараметрыРасчета.МенеджерВременныхТаблиц, "ДвиженияСебестоимостиНДС2_4");
		Данные                                    = ОбщегоНазначенияУТ.ПоказатьВременнуюТаблицу(ПараметрыРасчета.МенеджерВременныхТаблиц, "Данные");
	КонецЕсли;
    
	// 3. Получение цепочек из исходных данных
	// 	- формирует временные таблицы Источники и Приемники
	РасчетСебестоимостиПрикладныеАлгоритмы.ПостроитьЦепочкиДвижений(ПараметрыРасчета);
	Если ПараметрыРасчета.РежимОтладки Тогда
		Данные    = ОбщегоНазначенияУТ.ПоказатьВременнуюТаблицу(ПараметрыРасчета.МенеджерВременныхТаблиц, "Данные");
		Источники = ОбщегоНазначенияУТ.ПоказатьВременнуюТаблицу(ПараметрыРасчета.МенеджерВременныхТаблиц, "Источники");
		Приемники = ОбщегоНазначенияУТ.ПоказатьВременнуюТаблицу(ПараметрыРасчета.МенеджерВременныхТаблиц, "Приемники");
    КонецЕсли;
	
	// 4. Заполнение партий в цепочках
	// 	- заполняет таблицу ПараметрыРасчета.РаспределениеПартий.РасчетныеПартии
	РасчетСебестоимостиПрикладныеАлгоритмы.РассчитатьПартииПоЦепочкам(ПараметрыРасчета);
	
	// 5. Помещение данных в таблицу-приемник и очистка вспомогательных временных таблиц.
    // 	- формирует движения по регистру ДетализацияПартийТоваровДляНДС2_4
	РасчетСебестоимостиПрикладныеАлгоритмы.ЗавершитьРаспределениеПартий(ПараметрыРасчета);
	Если ПараметрыРасчета.РежимОтладки Тогда
		ВТКэшДетализацияПартийТоваровДляНДС2_4 = ОбщегоНазначенияУТ.ПоказатьВременнуюТаблицу(ПараметрыРасчета.МенеджерВременныхТаблиц, "ВТКэшДетализацияПартийТоваровДляНДС2_4");
	КонецЕсли;
	
КонецПроцедуры

//++ НЕ УТ
		
// Этап "ПодготовкаДанныхДляУчетаНДС2_4ПоПартиямПрочихРасходов"
//
// Параметры:
//	ПараметрыРасчета - Структура - параметры расчета себестоимости
//
Процедура ПодготовкаДанныхДляУчетаНДС2_4ПоПартиямПрочихРасходов(ПараметрыРасчета) Экспорт
	
    РасчетСебестоимостиПротоколРасчета.НачалоЭтапаРасчета(ПараметрыРасчета, "ПодготовкаДанныхДляУчетаНДС2_4ПоПартиямПрочихРасходов");
	
	// 1. Инициализация структуры данных для расчета
	//	- формирует структуру ПараметрыРасчета.РаспределениеПартий
	РасчетСебестоимостиПрикладныеАлгоритмы.ИнициализироватьРаспределениеПартий(
		ПараметрыРасчета,
        ТаблицаДляРаспределенияПартийПрочихРасходовНДС2_4(ПараметрыРасчета),
		ОписаниеЦепочекПартийНДС2_4ПоПартиямПрочихРасходов(ПараметрыРасчета),
		ОписаниеДвиженийПартийНДС2_4ПоПартиямПрочихРасходов(ПараметрыРасчета),
		ОписаниеНезаписываемыхПартийНДС2_4ПоПартиямПрочихРасходов(ПараметрыРасчета));
		
	// 2. Получение исходных данных для расчета
	// 	- формирует временную таблицу Данные
	ПолучитьДанныеДляПартийНДС2_4ПоПартиямПрочихРасходов(ПараметрыРасчета);
    
	Если ПараметрыРасчета.РежимОтладки Тогда
		ВТСтоимостьПартийТоваров                    = ОбщегоНазначенияУТ.ПоказатьВременнуюТаблицу(ПараметрыРасчета.МенеджерВременныхТаблиц, "ВТСтоимостьПартийТоваров");
		ЗнаменателиПриходов 						= ОбщегоНазначенияУТ.ПоказатьВременнуюТаблицу(ПараметрыРасчета.МенеджерВременныхТаблиц, "ЗнаменателиПриходов");
		ЗнаменателиРегистраторов 					= ОбщегоНазначенияУТ.ПоказатьВременнуюТаблицу(ПараметрыРасчета.МенеджерВременныхТаблиц, "ЗнаменателиРегистраторов");
		ЗнаменателиПартий 							= ОбщегоНазначенияУТ.ПоказатьВременнуюТаблицу(ПараметрыРасчета.МенеджерВременныхТаблиц, "ЗнаменателиПартий");
		ВТСтатьиПроизводственныхЗатрат 				= ОбщегоНазначенияУТ.ПоказатьВременнуюТаблицу(ПараметрыРасчета.МенеджерВременныхТаблиц, "ВТСтатьиПроизводственныхЗатрат");
		ВТАналитикиРаспределенияПартийПрочих2_4 	= ОбщегоНазначенияУТ.ПоказатьВременнуюТаблицу(ПараметрыРасчета.МенеджерВременныхТаблиц, "ВТАналитикиРаспределенияПартийПрочих2_4");
		ЗнаменателиБазы 							= ОбщегоНазначенияУТ.ПоказатьВременнуюТаблицу(ПараметрыРасчета.МенеджерВременныхТаблиц, "ЗнаменателиБазы");
		ВТОтборАналитикиУчетаПартийНДС2_4 			= ОбщегоНазначенияУТ.ПоказатьВременнуюТаблицу(ПараметрыРасчета.МенеджерВременныхТаблиц, "ВТОтборАналитикиУчетаПартийНДС2_4");
		ВТКэшРасчетныеОборотыПартииПрочихРасходов 	= ОбщегоНазначенияУТ.ПоказатьВременнуюТаблицу(ПараметрыРасчета.МенеджерВременныхТаблиц, "ВТКэшРасчетныеОборотыПартииПрочихРасходов");
		ВТКэшРасчетныеОборотыПартииПрочихРасходов 	= ОбщегоНазначенияУТ.ПоказатьВременнуюТаблицу(ПараметрыРасчета.МенеджерВременныхТаблиц, "ВТКэшРасчетныеОборотыПартииПрочихРасходов");
		ВТКэшРасчетныеОборотыПартииПрочихРасходов 	= ОбщегоНазначенияУТ.ПоказатьВременнуюТаблицу(ПараметрыРасчета.МенеджерВременныхТаблиц, "ВТКэшРасчетныеОборотыПартииПрочихРасходов");
		ДолиПроизводственныхРасходов              	= ОбщегоНазначенияУТ.ПоказатьВременнуюТаблицу(ПараметрыРасчета.МенеджерВременныхТаблиц, "ДолиПроизводственныхРасходов");
		ВТБазаРаспределенияПрочиеРасходыНЗП2_4    	= ОбщегоНазначенияУТ.ПоказатьВременнуюТаблицу(ПараметрыРасчета.МенеджерВременныхТаблиц, "ВТБазаРаспределенияПрочиеРасходыНЗП2_4");
		втПрочиеРасходыНезавершенногоПроизводства 	= ОбщегоНазначенияУТ.ПоказатьВременнуюТаблицу(ПараметрыРасчета.МенеджерВременныхТаблиц, "втПрочиеРасходыНезавершенногоПроизводства");
		ВТПартииПрочихДляРаспределения2_4         	= ОбщегоНазначенияУТ.ПоказатьВременнуюТаблицу(ПараметрыРасчета.МенеджерВременныхТаблиц, "ВТПартииПрочихДляРаспределения2_4");
		ВТНачальныеОстаткиПартийНДС               	= ОбщегоНазначенияУТ.ПоказатьВременнуюТаблицу(ПараметрыРасчета.МенеджерВременныхТаблиц, "ВТНачальныеОстаткиПартийНДС");
		ПриходыТоваровНДС2_4                      	= ОбщегоНазначенияУТ.ПоказатьВременнуюТаблицу(ПараметрыРасчета.МенеджерВременныхТаблиц, "ПриходыТоваровНДС2_4");
		ДвиженияСебестоимостиНДС2_4               	= ОбщегоНазначенияУТ.ПоказатьВременнуюТаблицу(ПараметрыРасчета.МенеджерВременныхТаблиц, "ДвиженияСебестоимостиНДС2_4");
		ДанныеДоПостроенияЦепочек 					= ОбщегоНазначенияУТ.ПоказатьВременнуюТаблицу(ПараметрыРасчета.МенеджерВременныхТаблиц, "Данные");
	КонецЕсли;
	
	// 3. Получение цепочек из исходных данных
	// 	- формирует временные таблицы Источники и Приемники
	РасчетСебестоимостиПрикладныеАлгоритмы.ПостроитьЦепочкиДвижений(ПараметрыРасчета);
	Если ПараметрыРасчета.РежимОтладки Тогда
		Данные    = ОбщегоНазначенияУТ.ПоказатьВременнуюТаблицу(ПараметрыРасчета.МенеджерВременныхТаблиц, "Данные");
		Источники = ОбщегоНазначенияУТ.ПоказатьВременнуюТаблицу(ПараметрыРасчета.МенеджерВременныхТаблиц, "Источники");
		Приемники = ОбщегоНазначенияУТ.ПоказатьВременнуюТаблицу(ПараметрыРасчета.МенеджерВременныхТаблиц, "Приемники");
    КонецЕсли;
	
	// 4. Заполнение партий в цепочках 
    // 	- формирует временную таблицу ВТСписаниеПостатейныхЗатрат
    Если НЕ РасчетСебестоимостиПрикладныеАлгоритмы.ВременнаяТаблицаСуществует(ПараметрыРасчета, "ВТСписаниеПостатейныхЗатрат") Тогда
        
        Запрос = Новый Запрос;
	    РасчетСебестоимостиПрикладныеАлгоритмы.ИнициализироватьСвойстваЗапроса(Запрос, ПараметрыРасчета);
        Запрос.Текст = РасчетСебестоимостиНДС.ТекстОписаниеДанныхДляПартийПрочихРасходовНДС2_4();
    	Запрос.Текст = РасчетСебестоимостиПрикладныеАлгоритмы.ИзменитьПриемникЗапросаОписанияДанных(Запрос.Текст, "ВТСписаниеПостатейныхЗатрат");
    	Запрос.Выполнить();
    	
    КонецЕсли;
	// 	- заполняет таблицу ПараметрыРасчета.РаспределениеПартий.РасчетныеПартии
	РасчетСебестоимостиПрикладныеАлгоритмы.РассчитатьПартииПоЦепочкам(ПараметрыРасчета);
    
	// 5. Помещение данных в таблицу-приемник и очистка вспомогательных временных таблиц.
    
	РасчетСебестоимостиПрикладныеАлгоритмы.ЗавершитьРаспределениеПартий(ПараметрыРасчета);
	
	Если ПараметрыРасчета.РежимОтладки Тогда
		ВТСписаниеПостатейныхЗатрат = ОбщегоНазначенияУТ.ПоказатьВременнуюТаблицу(ПараметрыРасчета.МенеджерВременныхТаблиц, "ВТСписаниеПостатейныхЗатрат");
	КонецЕсли;

	Запрос = Новый Запрос;
	РасчетСебестоимостиПрикладныеАлгоритмы.ИнициализироватьСвойстваЗапроса(Запрос, ПараметрыРасчета);
	
	Запрос.Текст = "
		|ВЫБРАТЬ 
		|	ДД.ЗапросИсточник,
		|	ДД.ТипЗаписи,
		|	ДД.Сторно,
		|	ДД.Знаменатель,
		|	НЕ ДД.РасчетЗавершен КАК РасчетНеЗавершен,
        |   &ИдетРасчетПартий КАК РасчетПартий,
        |   НЕ &ИдетРасчетПартий КАК РасчетСебестоимости,
		|	ДД.Номенклатура,
		|	ДД.Характеристика,
		|	
		|	ДД.Период,
		|	ДД.ПериодПоступления,
		|	ДД.Регистратор,
		|	ВЫБОР КОГДА ДД.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход) ТОГДА ИСТИНА ИНАЧЕ ЛОЖЬ КОНЕЦ КАК СлужебноеВидДвиженияПриход,
		|	ДД.Организация,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.ВидЗапасов,
		|	ДД.КорАналитикаУчетаНоменклатуры,
		|	ДД.КорВидЗапасов,
		|	ДД.Партия,
		|	ДД.АналитикаУчетаПартий,
        |	ДД.НалоговоеНазначение,
		|	ДД.ДокументПоступления,
		|	ДД.АналитикаУчетаДокументаПоступления,
		|	ДД.НаправлениеДеятельности,
        |
		|
		|	СУММА(ДД.СтоимостьБезНДС) КАК СтоимостьБезНДС,
		|	СУММА(ДД.НДС) КАК НДС,
		|	СУММА(ДД.СтоимостьБезНДСУпр) КАК СтоимостьБезНДСУпр,
		|	СУММА(ДД.НДСУпр) КАК НДСУпр,
		|
		|	ДД.ХозяйственнаяОперация,
        |	ДД.КорНалоговоеНазначение,
		|	ДД.КорОрганизация,
		|	ДД.КорПартия,
		|	ДД.КорАналитикаУчетаПартий,
		|	ДД.КорНаправлениеДеятельности,
		|	ДД.Подразделение,
		|	ДД.КорПодразделение,
        |	ДД.ГруппаПродукции КАК КорАналитикаФинансовогоУчета,
		|	ДД.СтатьяРасходовАктивов,
		|	ДД.АналитикаРасходов,
		|	ДД.АналитикаАктивов,
		|	ДД.ДокументИсточник,
		|	ДД.СтатьяСписанияНДС,
		|	ДД.АналитикаСписанияНДС
		|ПОМЕСТИТЬ ВТСписаниеПостатейныхЗатратСвернутая
		|ИЗ
        |	ВТСписаниеПостатейныхЗатрат КАК ДД
		|ГДЕ  
		|	ДД.НалоговоеНазначение <> ЗНАЧЕНИЕ(Справочник.НалоговыеНазначенияАктивовИЗатрат.ПустаяСсылка)
		|СГРУППИРОВАТЬ ПО
		|	ДД.ЗапросИсточник,
		|	ДД.ТипЗаписи,
		|	ДД.Сторно,
		|	ДД.Знаменатель,
		|	НЕ ДД.РасчетЗавершен,
		|	ДД.Номенклатура,
		|	ДД.Характеристика,
		|	
		|	ДД.Период,
		|	ДД.ПериодПоступления,
		|	ДД.Регистратор,
		|	ВЫБОР КОГДА ДД.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход) ТОГДА ИСТИНА ИНАЧЕ ЛОЖЬ КОНЕЦ,
		|	ДД.Организация,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.ВидЗапасов,
		|	ДД.КорАналитикаУчетаНоменклатуры,
		|	ДД.КорВидЗапасов,
		|	ДД.Партия,
		|	ДД.АналитикаУчетаПартий,
        |	ДД.НалоговоеНазначение,
		|	ДД.ДокументПоступления,
		|	ДД.АналитикаУчетаДокументаПоступления,
		|	ДД.НаправлениеДеятельности,
        |
		|	ДД.ХозяйственнаяОперация,
        |	ДД.КорНалоговоеНазначение,
		|	ДД.КорОрганизация,
		|	ДД.КорПартия,
		|	ДД.КорАналитикаУчетаПартий,
		|	ДД.КорНаправлениеДеятельности,
		|	ДД.Подразделение,
		|	ДД.КорПодразделение,
        |	ДД.ГруппаПродукции,
        |	ДД.КорАналитикаФинансовогоУчета,
		|	ДД.СтатьяРасходовАктивов,
		|	ДД.АналитикаРасходов,
		|	ДД.АналитикаАктивов,
		|	ДД.ДокументИсточник,
		|	ДД.СтатьяСписанияНДС,
		|	ДД.АналитикаСписанияНДС
        |
		|";
        
    Запрос.УстановитьПараметр("ИдетРасчетПартий", ПараметрыРасчета.ИдетРасчетПартий); 
	РасчетСебестоимостиПрикладныеАлгоритмы.ВыполнитьЗапросСЗамеромДляПротокола(ПараметрыРасчета, Запрос);
	Если ПараметрыРасчета.РежимОтладки Тогда
    	ВТСписаниеПостатейныхЗатратСвернутая = ОбщегоНазначенияУТ.ПоказатьВременнуюТаблицу(ПараметрыРасчета.МенеджерВременныхТаблиц, "ВТСписаниеПостатейныхЗатратСвернутая");
	КонецЕсли;
    
	// 6. Помещение данных в таблицу-приемник и очистка вспомогательных временных таблиц.
    // 	- формирует движения из ВТСписаниеПостатейныхЗатратСвернутая по регистру ДетализацияПартийТоваровДляНДС2_4
	СоответствиеВременныхТаблицДвижений = Новый Соответствие;
	СоответствиеВременныхТаблицДвижений.Вставить("ВТСписаниеПостатейныхЗатратСвернутая", РасчетСебестоимостиПовтИсп.ИмяРегистраНакопленияДетализацияПартийТоваровДляНДС2_4());
    
	РасчетСебестоимостиПрикладныеАлгоритмы.КэшироватьСформированныеДвиженияИзВременныхТаблиц(ПараметрыРасчета, СоответствиеВременныхТаблицДвижений);
	Если ПараметрыРасчета.РежимОтладки Тогда
		ВТКэшДетализацияПартийТоваровДляНДС2_4 = ОбщегоНазначенияУТ.ПоказатьВременнуюТаблицу(ПараметрыРасчета.МенеджерВременныхТаблиц, "ВТКэшДетализацияПартийТоваровДляНДС2_4");
	КонецЕсли;
КонецПроцедуры

//-- НЕ УТ
		
// Этап "ПодготовкаДанныхДляПартийПрочихРасходов"
//
// Параметры:
//	ПараметрыРасчета - Структура - параметры расчета себестоимости
//
Процедура ПодготовкаДанныхДляПартийПрочихРасходов(ПараметрыРасчета) Экспорт
	
	РасчетСебестоимостиПротоколРасчета.НачалоЭтапаРасчета(ПараметрыРасчета, "ПодготовкаДанныхДляПартийПрочихРасходов");
	
	// 1. Инициализация структуры данных для расчета
	//	- формирует структуру ПараметрыРасчета.РаспределениеПартий.
	РасчетСебестоимостиПрикладныеАлгоритмы.ИнициализироватьТрансляциюПартий(
		ПараметрыРасчета,
		Неопределено,
		Метаданные.РегистрыНакопления.ПартииПрочихРасходов.Имя);
	
	// 2. Получение исходных данных для трансляции
	// 	- формирует временную таблицу Данные.
	ПолучитьДанныеДляПартийПрочихРасходов(ПараметрыРасчета);
	
	Если ПараметрыРасчета.РежимОтладки Тогда
		ВТКэшРасчетныеОборотыДетализацияПартийТоваровДляНДС    = ОбщегоНазначенияУТ.ПоказатьВременнуюТаблицу(ПараметрыРасчета.МенеджерВременныхТаблиц, "ВТКэшРасчетныеОборотыДетализацияПартийТоваровДляНДС");
		ПриходыТоваровНДС                                      = ОбщегоНазначенияУТ.ПоказатьВременнуюТаблицу(ПараметрыРасчета.МенеджерВременныхТаблиц, "ПриходыТоваровНДС");
		ВТКэшРасчетныеОборотыДетализацияПартийТоваровДляНДС2_4 = ОбщегоНазначенияУТ.ПоказатьВременнуюТаблицу(ПараметрыРасчета.МенеджерВременныхТаблиц, "ВТКэшРасчетныеОборотыДетализацияПартийТоваровДляНДС2_4");
		ПриходыТоваровНДС2_4                                   = ОбщегоНазначенияУТ.ПоказатьВременнуюТаблицу(ПараметрыРасчета.МенеджерВременныхТаблиц, "ПриходыТоваровНДС2_4");
		Данные                                                 = ОбщегоНазначенияУТ.ПоказатьВременнуюТаблицу(ПараметрыРасчета.МенеджерВременныхТаблиц, "Данные"); 
	КонецЕсли;
	
	// 3. Помещение данных в таблицу-приемник и очистка вспомогательных временных таблиц.
	// 	- формирует движения по регистру ПартииПрочихРасходов.
	РасчетСебестоимостиПрикладныеАлгоритмы.ЗавершитьРаспределениеПартий(ПараметрыРасчета);
	Если ПараметрыРасчета.РежимОтладки Тогда
		ВТКэшПартииПрочихРасходов = ОбщегоНазначенияУТ.ПоказатьВременнуюТаблицу(ПараметрыРасчета.МенеджерВременныхТаблиц, "ВТКэшПартииПрочихРасходов");
	КонецЕсли;
КонецПроцедуры

//++ НЕ УТ
// Этап формирования документов КорректировкаНалоговогоНазначенияКапитальныхИнвестиций
//
// Параметры:
//	ПараметрыРасчета - Структура - параметры расчета себестоимости
//
Процедура КорректировкаНалоговогоНазначенияКапитальныхИнвестиций(ПараметрыРасчета) Экспорт
	
	РасчетСебестоимостиПротоколРасчета.НачалоЭтапаРасчета(ПараметрыРасчета, "КорректировкаНалоговогоНазначенияКапитальныхИнвестиций");
	
	Запрос = Новый Запрос;
	РасчетСебестоимостиПрикладныеАлгоритмы.ИнициализироватьСвойстваЗапроса(Запрос, ПараметрыРасчета);
	
	// Сохраним движения документа КорректировкаНалоговогоНазначенияКапитальныхИнвестиций по регистру ПрочиеРасходы до расчета.
	// Эти движения не имеют признаков "расчетные", т.к. формируются самим документом, а не механикой расчета себестоимости.
	// При окончании расчета механизм расчета не имеет возможности определить наличие изменений в таких движения.
	Запрос.Текст =
	"ВЫБРАТЬ
	|	*
	|ПОМЕСТИТЬ ВТДвиженияКорректировкаНалоговогоНазначенияКапитальныхИнвестицийПоПрочиеРасходыДоРасчета
	|ИЗ
	|	РегистрНакопления.ПрочиеРасходы КАК Т
	|ГДЕ
	|	Т.Период МЕЖДУ &НачалоПериода И &КонецПериода
	|	И Т.Организация В(&МассивОрганизаций)
	|	И Т.Регистратор ССЫЛКА Документ.КорректировкаНалоговогоНазначенияКапитальныхИнвестиций
	|	И НЕ Т.РасчетПартий
	|	И НЕ Т.РасчетСебестоимости
	|	И Т.Активность";
	
	Запрос.Выполнить();
	
	// Вызовем "внешнюю" логику перепроведения документов КорректировкаНалоговогоНазначенияКапитальныхИнвестиций.
	// При этом будут переформированы "первичные" движения этих документов.
	РезультатКорректировкиНалоговогоНазначенияКапитальныхИнвестиций = Документы.КорректировкаНалоговогоНазначенияКапитальныхИнвестиций.КорректироватьНалоговыеНазначенияКапитальныхИнвестиций(
		ПараметрыРасчета.РасчетныйПериод.НачалоПериода,
		ПараметрыРасчета.МассивОрганизаций,
		РасчетСебестоимостиПрикладныеАлгоритмы.ИмяСобытияОшибкиДляЖурналаРегистрации(ПараметрыРасчета),
		ПараметрыРасчета.МенеджерВременныхТаблиц,
		Истина);
	
	РасчетСебестоимостиПротоколРасчета.УвеличитьКоличествоОбработанныхДанныхДляЗамера(
		ПараметрыРасчета,
		ПараметрыРасчета.МассивОрганизаций.Количество());
	
	// Сохраним движения документа КорректировкаНалоговогоНазначенияКапитальныхИнвестиций по регистру ПрочиеРасходы после расчета.
	Запрос.Текст =
	"ВЫБРАТЬ
	|	*
	|ПОМЕСТИТЬ ВТДвиженияКорректировкаНалоговогоНазначенияКапитальныхИнвестицийПоПрочиеРасходыПослеРасчета
	|ИЗ
	|	РегистрНакопления.ПрочиеРасходы КАК Т
	|ГДЕ
	|	Т.Период МЕЖДУ &НачалоПериода И &КонецПериода
	|	И Т.Организация В(&МассивОрганизаций)
	|	И Т.Регистратор ССЫЛКА Документ.КорректировкаНалоговогоНазначенияКапитальныхИнвестиций
	|	И НЕ Т.РасчетПартий
	|	И НЕ Т.РасчетСебестоимости
	|	И Т.Активность";
	
	Запрос.Выполнить();
	
	Если ЗначениеЗаполнено(РезультатКорректировкиНалоговогоНазначенияКапитальныхИнвестиций.ТекстОшибки) Тогда
		
		ТекстДляПротокола = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(
			НСтр("ru='Операция ""Корректировка налоговых назначений капитальных инвестиций"" не была выполнена по причине:
|%1'
|;uk='Операція ""Коригування податкових призначень капітальних інвестицій"" не була виконана по причині:
|%1'",ОбщегоНазначения.КодОсновногоЯзыка()),
			РезультатКорректировкиНалоговогоНазначенияКапитальныхИнвестиций.ТекстОшибки);
			
		// В механизме закрытия месяца ошибка зарегистрирована из механизма корректировки налоговых назначений капитальных инвестиций.
		РасчетСебестоимостиПротоколРасчета.ЗафиксироватьОшибкуРасчета(
			ПараметрыРасчета,
			Перечисления.ТипыОшибокПартионногоУчетаИСебестоимости.ОшибкаКорректировкиНалоговогоНазначенияКапитальныхИнвестиций,
			ТекстДляПротокола);
		
	КонецЕсли;
		
	// Если документ КорректировкаНалоговогоНазначенияКапитальныхИнвестиций может делать движения по регистру,
	// обслуживаемому механизмом партионного учета и себестоимости,
	// то по этому регистру надо обновить расчетные кэши остатков и оборотов.
	// Иначе получится ситуация, что данные ИБ при проведении этих документов изменились,
	// а следующие этапы расчета "не увидят" этого во временных таблицах кэшей регистров.
	Если РезультатКорректировкиНалоговогоНазначенияКапитальныхИнвестиций.МассивДокументов.Количество() > 0 Тогда
		
		ВозможныеДвиженияДокументов = Метаданные.Документы.КорректировкаНалоговогоНазначенияКапитальныхИнвестиций.Движения;
		
		Для Каждого КлючИЗначение Из ПараметрыРасчета.Движения Цикл
			
			ОписаниеРегистра = КлючИЗначение.Значение;
			
			Если ВозможныеДвиженияДокументов.Содержит(ОписаниеРегистра.МетаданныеРегистра) Тогда
				ОписаниеРегистра.НадоОбновитьРасчетныйКэш = Истина;
			КонецЕсли;
			
		КонецЦикла;
		
	КонецЕсли;
	
	РасчетСебестоимостиПрикладныеАлгоритмы.ОбновитьРасчетныеКэшиРегистров(ПараметрыРасчета, Истина);
	
	РасчетСебестоимостиПротоколРасчета.ДополнительнаяИнформация(
		ПараметрыРасчета,
		СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(
			НСтр("ru='Обработано документов ""Корректировка налоговых назначений капитальных инвестиций"": %1';uk='Опрацьовано документів ""Коригування податкових призначень капітальних інвестицій"": %1'",ОбщегоНазначения.КодОсновногоЯзыка()),
			РасчетСебестоимостиПротоколРасчета.ПредставлениеЗначения(
				РезультатКорректировкиНалоговогоНазначенияКапитальныхИнвестиций.МассивДокументов.Количество())));
	
КонецПроцедуры
//-- НЕ УТ


// Этап "ПодготовкаДанныхДляНДСУсловныеПродажи"
//
// Параметры:
//	ПараметрыРасчета - Структура - параметры расчета себестоимости
//
Процедура ПодготовкаДанныхДляНДСУсловныеПродажи(ПараметрыРасчета) Экспорт
	
	РасчетСебестоимостиПротоколРасчета.НачалоЭтапаРасчета(ПараметрыРасчета, "ПодготовкаДанныхДляНДСУсловныеПродажи");
	
	// 1. Инициализация структуры данных для расчета
	//	- формирует структуру ПараметрыРасчета.РаспределениеПартий.
	РасчетСебестоимостиПрикладныеАлгоритмы.ИнициализироватьТрансляциюПартий(
		ПараметрыРасчета,
		Неопределено,
		Метаданные.РегистрыНакопления.НДСУсловныеПродажи.Имя);
	
	// 2. Получение исходных данных для трансляции
	// 	- формирует временную таблицу Данные.
	ПолучитьДанныеДляНДСУсловныеПродажи(ПараметрыРасчета);
	Если ПараметрыРасчета.РежимОтладки Тогда	
		Данные = ОбщегоНазначенияУТ.ПоказатьВременнуюТаблицу(ПараметрыРасчета.МенеджерВременныхТаблиц, "Данные");
	КонецЕсли;
	
	// 3. Помещение данных в таблицу-приемник и очистка вспомогательных временных таблиц.
	// 	- формирует движения по регистру НДСУсловныеПродажи.
	РасчетСебестоимостиПрикладныеАлгоритмы.ЗавершитьРаспределениеПартий(ПараметрыРасчета);
	
КонецПроцедуры


#КонецОбласти

#Область Инициализация

// Инициализирует общие параметры расчета, описывающие обслуживаемые механизмом расчета регистры.
//
// Параметры:
//	ПараметрыРасчета - Структура - параметры расчета себестоимости
//
Процедура ИнициализироватьОбслуживаемыеРегистры(ПараметрыРасчета) Экспорт
	
    ПараметрыРасчета.РегистрыСРасчетнымиОборотами.Вставить(Метаданные.РегистрыНакопления.ДетализацияПартийТоваровДляНДС.Имя, Истина);
    ПараметрыРасчета.РегистрыСРасчетнымиОборотами.Вставить(Метаданные.РегистрыНакопления.ДетализацияПартийТоваровДляНДС2_4.Имя, Истина);
	
    ПараметрыРасчета.РегистрыСРасчетнымиОстатками.Вставить(Метаданные.РегистрыНакопления.ДетализацияПартийТоваровДляНДС2_4.Имя, Истина);
	
КонецПроцедуры

// Дополняет перечень документов, которые могут иметь движения в разных месяцах или по нескольким организациям.
//
// Параметры:
//	РазныеПериоды - Булево - добавлять в результат документы с движениями в разных периодах
//	РазныеОрганизации - Булево - добавлять в результат документы с движениями по нескольким организациям
//	ИмяРегистра - Строка - имя регистра накопления, для которого нужно получить перечень документов;
//		пустое значение - перечень документов для всех регистров.
//	ОписаниеДокументов - Соответствие - Ключ - ОбъектМетаданных.
//
Процедура ДополнитьДокументыСРазнымиПериодамиИлиОрганизациямиВДвижениях(РазныеПериоды, РазныеОрганизации, ИмяРегистра, ОписаниеДокументов) Экспорт
	
	// Для движений в других периодах Значение = Истина означает
	// - наличие первичных+расчетных движений,
	// - расчетные движения формируются при расчете их периода.
	// Если указано значение Ложь, то это означает, что
	// - расчетные движения могут быть без первичных движений,
	// - расчетные движения любых периодов формируются при расчете периода документа.
	// Для движений других организаций Значение должно быть только Истина.
	
	Значение = Истина;
	
	Если ИмяРегистра = ""
	 ИЛИ ИмяРегистра = Метаданные.РегистрыНакопления.СебестоимостьТоваров.Имя Тогда
		Если РазныеПериоды Тогда
		КонецЕсли;
	КонецЕсли;
	
	Если ИмяРегистра = ""
     ИЛИ ИмяРегистра = Метаданные.РегистрыНакопления.ДетализацияПартийТоваровДляНДС.Имя
     ИЛИ ИмяРегистра = Метаданные.РегистрыНакопления.ДетализацияПартийТоваровДляНДС2_4.Имя Тогда
		
		Если РазныеПериоды Тогда
			ОписаниеДокументов.Вставить(Метаданные.Документы.РеализацияТоваровУслуг, 	 Значение); // операция РеализацияБезПереходаПраваСобственности
		КонецЕсли;
		
	КонецЕсли;

	
КонецПроцедуры

// Формирует общие временные таблицы для отбора данных в запросах.
//
Процедура ИнициализироватьВременныеТаблицыДляОтборов(ПараметрыРасчета) Экспорт
	
	РасчетСебестоимостиПротоколРасчета.НачалоФормированиеВременнойТаблицы(ПараметрыРасчета, "ВТОтборАналитикиУчетаПартийНДС2_4");
	
	ИнициализироватьТаблицуДляОтбораАналитикУчетаПартийНДС2_4(ПараметрыРасчета.МенеджерВременныхТаблиц);
	
	РасчетСебестоимостиПротоколРасчета.ОкончаниеФормированиеВременнойТаблицы(ПараметрыРасчета, Истина);
	
КонецПроцедуры

#КонецОбласти

#КонецОбласти

#Область СлужебныеПроцедурыИФункции

#Область Инициализация

Процедура ИнициализироватьТаблицуДляОтбораАналитикУчетаПартийНДС2_4(МенеджерВременныхТаблиц) Экспорт
	
	РасчетСебестоимостиПрикладныеАлгоритмы.УничтожитьВременныеТаблицы(МенеджерВременныхТаблиц, "ВТОтборАналитикиУчетаПартийНДС2_4");
	
	Запрос = Новый Запрос;
	Запрос.МенеджерВременныхТаблиц = МенеджерВременныхТаблиц;
	
	Запрос.Текст = ТекстЗапросаТаблицыДляОтбораАналитикУчетаПартийНДС2_4();
	Запрос.Выполнить();
	
КонецПроцедуры

Функция ТекстЗапросаТаблицыДляОтбораАналитикУчетаПартийНДС2_4() Экспорт
	
	Возврат 
		"ВЫБРАТЬ
		|	Т.Ссылка КАК Ссылка,
		|	ВЫБОР
		|		КОГДА НЕ Т.Контрагент В (ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка), ЗНАЧЕНИЕ(Справочник.Контрагенты.ПустаяСсылка), НЕОПРЕДЕЛЕНО)
		|			ТОГДА ИСТИНА
		|		ИНАЧЕ ЛОЖЬ
		|	КОНЕЦ КАК ВнешнийКонтрагент,
		|	ВЫБОР
		|		КОГДА Т.КодСтроки <> 0
		|			ТОГДА ИСТИНА
		|		ИНАЧЕ ЛОЖЬ
		|	КОНЕЦ КАК ЗаполненКодСтроки
		|ПОМЕСТИТЬ ВТОтборАналитикиУчетаПартийНДС2_4
		|ИЗ
		|	Справочник.КлючиАналитикиУчетаПартий КАК Т
		|ГДЕ
		|	НЕ Т.Контрагент В (ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка), ЗНАЧЕНИЕ(Справочник.Контрагенты.ПустаяСсылка), НЕОПРЕДЕЛЕНО)
		|	ИЛИ Т.КодСтроки <> 0
		|";
	
КонецФункции

#КонецОбласти

#Область ПроцедурыЭтапа_РасчетПартийНДС

// Инициализация данных

Функция ПоляПотребленийПартииНДС(ПараметрыРасчета)
	
    Возврат "АналитикаУчетаНоменклатуры, Организация, РазделУчета, ВидЗапасов, АналитикаФинансовогоУчета, НалоговоеНазначение";
	
КонецФункции

Функция ОписаниеЦепочекПартийНДС(ПараметрыРасчета) Экспорт
	
	ОписаниеЦепочек = Новый Соответствие;
	ПоляПотреблений	= ПоляПотребленийПартииНДС(ПараметрыРасчета);
	
    // ОстатокСгруппированный <- Остаток, ДопРасходы, ДопРасходыСПартией, КорректировкаСтоимости, ОтклонениеВСтоимости, ОстатокДляРаспределения 
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеПриемника(ОписаниеЦепочек,
		Перечисления.ТипыЗаписейПартий.ОстатокСгруппированный, ПоляПотреблений + ", Партия");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.ОстатокСгруппированный,
		Перечисления.ТипыЗаписейПартий.Остаток, ПоляПотреблений + ", Партия");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.ОстатокСгруппированный,
		Перечисления.ТипыЗаписейПартий.ДопРасходы, ПоляПотреблений + ", Партия");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.ОстатокСгруппированный,
		Перечисления.ТипыЗаписейПартий.ДопРасходыСПартией, ПоляПотреблений + ", Партия");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.ОстатокСгруппированный,
		Перечисления.ТипыЗаписейПартий.КорректировкаСтоимости, ПоляПотреблений + ", Партия");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.ОстатокСгруппированный,
		Перечисления.ТипыЗаписейПартий.ОтклонениеВСтоимости, ПоляПотреблений + ", Партия");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.ОстатокСгруппированный,
		Перечисления.ТипыЗаписейПартий.ОстатокДляРаспределения, ПоляПотреблений + ", Партия");
    
    // ОстатокДляРаспределения <- ДопРасходыБезПартии
    РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеПриемника(ОписаниеЦепочек,
    	Перечисления.ТипыЗаписейПартий.ОстатокДляРаспределения, ПоляПотреблений + ", Регистратор");
    РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.ОстатокДляРаспределения,
    	Перечисления.ТипыЗаписейПартий.ДопРасходыБезПартии, ПоляПотреблений + ", ДокументИсточник");
    
    // ПартияСгруппированная <- Партия, ДопРасходы, ДопРасходыБезПартии, ДопРасходыСПартией, КорректировкаСтоимости, ОтклонениеВСтоимости, Перемещение
    РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеПриемника(ОписаниеЦепочек,
    	Перечисления.ТипыЗаписейПартий.ПартияСгруппированная, ПоляПотреблений + ", Регистратор");
    РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.ПартияСгруппированная,
    	Перечисления.ТипыЗаписейПартий.Партия, ПоляПотреблений + ", Регистратор");
    РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.ПартияСгруппированная,
    	Перечисления.ТипыЗаписейПартий.ДопРасходы, ПоляПотреблений + ", ДокументИсточник");
    РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.ПартияСгруппированная,
    	Перечисления.ТипыЗаписейПартий.ДопРасходыБезПартии, ПоляПотреблений + ", ДокументИсточник");
    РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.ПартияСгруппированная,
    	Перечисления.ТипыЗаписейПартий.ДопРасходыСПартией, ПоляПотреблений + ", ДокументИсточник");
    РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.ПартияСгруппированная,
    	Перечисления.ТипыЗаписейПартий.КорректировкаСтоимости, ПоляПотреблений + ", ДокументИсточник");
    РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.ПартияСгруппированная,
    	Перечисления.ТипыЗаписейПартий.ОтклонениеВСтоимости, ПоляПотреблений + ", ДокументИсточник");
    РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.ПартияСгруппированная,
    	Перечисления.ТипыЗаписейПартий.Перемещение, ПоляПотреблений + ", Регистратор");
	
	// Потребление <- (ОстатокСгруппированный, ПартияСгруппированная,
	// КорректировкаПриобретенияПрошлогоПериода, Перемещение, ПеремещениеОбособленно, Сторно, ВозвратПрошлыхПериодов, Выпуск,
	// ВозвратБезДокументаИсточника).
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеПриемника(ОписаниеЦепочек,
		Перечисления.ТипыЗаписейПартий.Потребление, ПоляПотреблений + ", ДокументИсточник");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.Потребление,
		Перечисления.ТипыЗаписейПартий.ОстатокСгруппированный,		ПоляПотреблений + ", Регистратор");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.Потребление,
		Перечисления.ТипыЗаписейПартий.ПартияСгруппированная,		ПоляПотреблений + ", Регистратор");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.Потребление,
		Перечисления.ТипыЗаписейПартий.КорректировкаПриобретенияПрошлогоПериода, ПоляПотреблений + ", ДокументИсточник");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.Потребление,
		Перечисления.ТипыЗаписейПартий.Перемещение, ПоляПотреблений + ", Регистратор");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.Потребление,
		Перечисления.ТипыЗаписейПартий.ПеремещениеОбособленно, ПоляПотреблений + ", Регистратор");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.Потребление,
		Перечисления.ТипыЗаписейПартий.Сторно, 		ПоляПотреблений + ", Регистратор");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.Потребление,
		Перечисления.ТипыЗаписейПартий.ВозвратПрошлыхПериодов, ПоляПотреблений + ", Регистратор");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.Потребление,
		Перечисления.ТипыЗаписейПартий.Выпуск, 		ПоляПотреблений + ", Регистратор");
        
	// ПотреблениеАвто <- (ОстатокСгруппированный, ПартияСгруппированная, Перемещение, ПеремещениеОбособленно, Сторно).
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеПриемника(ОписаниеЦепочек,
		Перечисления.ТипыЗаписейПартий.ПотреблениеАвто, 		ПоляПотреблений + ", ДокументИсточник");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.ПотреблениеАвто,
		Перечисления.ТипыЗаписейПартий.ОстатокСгруппированный,				ПоляПотреблений + ", Регистратор");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.ПотреблениеАвто,
		Перечисления.ТипыЗаписейПартий.ПартияСгруппированная,		ПоляПотреблений + ", Регистратор");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.ПотреблениеАвто,
		Перечисления.ТипыЗаписейПартий.Перемещение, 		ПоляПотреблений + ", Регистратор");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.ПотреблениеАвто,
		Перечисления.ТипыЗаписейПартий.ПеремещениеОбособленно, 		ПоляПотреблений + ", Регистратор");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.ПотреблениеАвто,
		Перечисления.ТипыЗаписейПартий.Сторно, 				ПоляПотреблений + ", Регистратор");
    	
	// КорректировкаПриобретения <- (ОстатокСгруппированный, ПартияСгруппированная, ВозвратПрошлыхПериодов)	
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеПриемника(ОписаниеЦепочек,
		Перечисления.ТипыЗаписейПартий.КорректировкаПриобретения, ПоляПотреблений);
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.КорректировкаПриобретения,
		Перечисления.ТипыЗаписейПартий.ОстатокСгруппированный, 				 ПоляПотреблений);
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.КорректировкаПриобретения,
		Перечисления.ТипыЗаписейПартий.ПартияСгруппированная, 				 ПоляПотреблений);
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.КорректировкаПриобретения,
		Перечисления.ТипыЗаписейПартий.ВозвратПрошлыхПериодов,	 ПоляПотреблений);	
		
	// Сторно <- (Потребление, ПотреблениеАвто, Прошлое)
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеПриемника(ОписаниеЦепочек,
		Перечисления.ТипыЗаписейПартий.Сторно, 		"ДокументИсточник, КорАналитикаУчетаНоменклатуры, КорВидЗапасов");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.Сторно,
		Перечисления.ТипыЗаписейПартий.Потребление, "Регистратор, АналитикаУчетаНоменклатуры, ВидЗапасов");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.Сторно,
		Перечисления.ТипыЗаписейПартий.ПотреблениеАвто, "Регистратор, АналитикаУчетаНоменклатуры, ВидЗапасов");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.Сторно,
		Перечисления.ТипыЗаписейПартий.Прошлое, 	"Регистратор, АналитикаУчетаНоменклатуры, ВидЗапасов");
		
	// СторноВозвратНаДругойСклад <- (Потребление, ПотреблениеАвто, Прошлое)
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеПриемника(ОписаниеЦепочек,
		Перечисления.ТипыЗаписейПартий.СторноВозвратНаДругойСклад,	"ДокументИсточник, КорАналитикаУчетаНоменклатуры, КорВидЗапасов");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.СторноВозвратНаДругойСклад,
		Перечисления.ТипыЗаписейПартий.Потребление,					"Регистратор, АналитикаУчетаНоменклатуры, ВидЗапасов");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.СторноВозвратНаДругойСклад,
		Перечисления.ТипыЗаписейПартий.ПотреблениеАвто,				"Регистратор, АналитикаУчетаНоменклатуры, ВидЗапасов");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.СторноВозвратНаДругойСклад,
		Перечисления.ТипыЗаписейПартий.Прошлое,						"Регистратор, АналитикаУчетаНоменклатуры, ВидЗапасов");
		
	// ВозвратНаДругойСклад <- (СторноВозвратНаДругойСклад)
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеПриемника(ОписаниеЦепочек,
		Перечисления.ТипыЗаписейПартий.ВозвратНаДругойСклад,
        "Регистратор, АналитикаУчетаНоменклатуры, Организация, РазделУчета, ВидЗапасов, АналитикаФинансовогоУчета, НалоговоеНазначение");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.ВозвратНаДругойСклад,
		Перечисления.ТипыЗаписейПартий.СторноВозвратНаДругойСклад,
        "Регистратор, АналитикаУчетаНоменклатуры, Организация, РазделУчета, ВидЗапасов, АналитикаФинансовогоУчета, НалоговоеНазначение");
		
    // Распределение <- (Перемещение, ПеремещениеОбособленно, ОстатокСгруппированный, ПартияСгруппированная, Выпуск, ВозвратПрошлыхПериодов, Распределение)
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеПриемника(ОписаниеЦепочек,
		Перечисления.ТипыЗаписейПартий.Распределение,
        "АналитикаУчетаНоменклатуры, Организация, РазделУчета, ВидЗапасов, АналитикаФинансовогоУчета, НалоговоеНазначение, ДокументИсточник");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.Распределение,
		Перечисления.ТипыЗаписейПартий.Перемещение,
        "АналитикаУчетаНоменклатуры, Организация, РазделУчета, ВидЗапасов, АналитикаФинансовогоУчета, НалоговоеНазначение, Регистратор");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.Распределение,
		Перечисления.ТипыЗаписейПартий.ПеремещениеОбособленно,
        "АналитикаУчетаНоменклатуры, Организация, РазделУчета, ВидЗапасов, АналитикаФинансовогоУчета, НалоговоеНазначение, Регистратор");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.Распределение,
		Перечисления.ТипыЗаписейПартий.ОстатокСгруппированный,
        "АналитикаУчетаНоменклатуры, Организация, РазделУчета, ВидЗапасов, АналитикаФинансовогоУчета, НалоговоеНазначение, Регистратор");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.Распределение,
		Перечисления.ТипыЗаписейПартий.ПартияСгруппированная,
        "АналитикаУчетаНоменклатуры, Организация, РазделУчета, ВидЗапасов, АналитикаФинансовогоУчета, НалоговоеНазначение, Регистратор");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.Распределение,
		Перечисления.ТипыЗаписейПартий.Выпуск,
        "АналитикаУчетаНоменклатуры, Организация, РазделУчета, ВидЗапасов, АналитикаФинансовогоУчета, НалоговоеНазначение, Регистратор");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.Распределение,
		Перечисления.ТипыЗаписейПартий.ВозвратПрошлыхПериодов,
        "АналитикаУчетаНоменклатуры, Организация, РазделУчета, ВидЗапасов, АналитикаФинансовогоУчета, НалоговоеНазначение, Регистратор");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.Распределение,
		Перечисления.ТипыЗаписейПартий.Распределение,
        "АналитикаУчетаНоменклатуры, Организация, РазделУчета, ВидЗапасов, АналитикаФинансовогоУчета, НалоговоеНазначение, Регистратор");
 	
	// Перемещение <- (Потребление, ПотреблениеАвто, ПотреблениеПроизводство, ВозвратНаДругойСклад).
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеПриемника(ОписаниеЦепочек,
		Перечисления.ТипыЗаписейПартий.Перемещение,
        "ДокументИсточник, Партия, АналитикаУчетаНоменклатуры, РазделУчета, ВидЗапасов, АналитикаФинансовогоУчета, НалоговоеНазначение, Организация");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.Перемещение,
		Перечисления.ТипыЗаписейПартий.Потребление,
        "Регистратор, КорПартия, КорАналитикаУчетаНоменклатуры, КорРазделУчета, КорВидЗапасов, КорАналитикаФинансовогоУчета, КорНалоговоеНазначение, Организация");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.Перемещение,
		Перечисления.ТипыЗаписейПартий.ПотреблениеАвто,
        "Регистратор, КорПартия, КорАналитикаУчетаНоменклатуры, КорРазделУчета, КорВидЗапасов, КорАналитикаФинансовогоУчета, КорНалоговоеНазначение, Организация");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.Перемещение,
		Перечисления.ТипыЗаписейПартий.ПотреблениеПроизводство,
        "Регистратор, КорПартия, КорАналитикаУчетаНоменклатуры, КорРазделУчета, КорВидЗапасов, КорАналитикаФинансовогоУчета, КорНалоговоеНазначение, Организация");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.Перемещение,
		Перечисления.ТипыЗаписейПартий.ВозвратНаДругойСклад,
        "Регистратор, КорПартия, КорАналитикаУчетаНоменклатуры, КорРазделУчета, КорВидЗапасов, КорАналитикаФинансовогоУчета, КорНалоговоеНазначение, Организация");
		
	// ПеремещениеОбособленно <- (Потребление)
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеПриемника(ОписаниеЦепочек,
		Перечисления.ТипыЗаписейПартий.ПеремещениеОбособленно,
        "ДокументИсточник, Партия, АналитикаУчетаНоменклатуры, РазделУчета, ВидЗапасов, АналитикаФинансовогоУчета, НалоговоеНазначение, Организация");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.ПеремещениеОбособленно,
		Перечисления.ТипыЗаписейПартий.Потребление,
        "Регистратор, КорПартия, КорАналитикаУчетаНоменклатуры, КорРазделУчета, КорВидЗапасов, КорАналитикаФинансовогоУчета, КорНалоговоеНазначение, КорОрганизация");
		
	// ПеремещениеАвто <- (Потребление, ПотреблениеПроизводство, ПотреблениеАвто, Распределение).
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеПриемника(ОписаниеЦепочек,
		Перечисления.ТипыЗаписейПартий.ПеремещениеАвто,
        "ДокументИсточник, Партия, АналитикаУчетаНоменклатуры, РазделУчета, ВидЗапасов, АналитикаФинансовогоУчета, НалоговоеНазначение");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.ПеремещениеАвто,
		Перечисления.ТипыЗаписейПартий.Потребление,
        "Регистратор, КорПартия, КорАналитикаУчетаНоменклатуры, КорРазделУчета, КорВидЗапасов, КорАналитикаФинансовогоУчета, КорНалоговоеНазначение");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.ПеремещениеАвто,
		Перечисления.ТипыЗаписейПартий.ПотреблениеПроизводство,
        "Регистратор, КорПартия, КорАналитикаУчетаНоменклатуры, КорРазделУчета, КорВидЗапасов, КорАналитикаФинансовогоУчета, КорНалоговоеНазначение");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.ПеремещениеАвто,
		Перечисления.ТипыЗаписейПартий.ПотреблениеАвто,
        "Регистратор, КорПартия, КорАналитикаУчетаНоменклатуры, КорРазделУчета, КорВидЗапасов, КорАналитикаФинансовогоУчета, КорНалоговоеНазначение");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.ПеремещениеАвто,
		Перечисления.ТипыЗаписейПартий.Распределение,
        "Регистратор, КорПартия, КорАналитикаУчетаНоменклатуры, КорРазделУчета, КорВидЗапасов, КорАналитикаФинансовогоУчета, КорНалоговоеНазначение");
		
	// СписанияНаВыпуск <- (Перемещение, ПеремещениеОбособленно, ПеремещениеАвто, ПартияСгруппированная, ОстатокСгруппированный, Выпуск).
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеПриемника(ОписаниеЦепочек,
		Перечисления.ТипыЗаписейПартий.СписанияНаВыпуск, ПоляПотреблений + ",Партия");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.СписанияНаВыпуск,
		Перечисления.ТипыЗаписейПартий.Перемещение, ПоляПотреблений + ",Партия");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.СписанияНаВыпуск,
		Перечисления.ТипыЗаписейПартий.ПеремещениеОбособленно, ПоляПотреблений + ",Партия");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.СписанияНаВыпуск,
		Перечисления.ТипыЗаписейПартий.ПеремещениеАвто, ПоляПотреблений + ",Партия");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.СписанияНаВыпуск,
		Перечисления.ТипыЗаписейПартий.ПартияСгруппированная, ПоляПотреблений + ",Партия");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.СписанияНаВыпуск,
		Перечисления.ТипыЗаписейПартий.ОстатокСгруппированный, ПоляПотреблений + ",Партия");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.СписанияНаВыпуск,
		Перечисления.ТипыЗаписейПартий.Выпуск, ПоляПотреблений + ",Партия");
		
	// Выпуск <- (СписанияНаВыпуск, Потребление)
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеПриемника(ОписаниеЦепочек,
		Перечисления.ТипыЗаписейПартий.Выпуск,
        "Регистратор, Партия, АналитикаУчетаНоменклатуры, РазделУчета, ВидЗапасов, АналитикаФинансовогоУчета, НалоговоеНазначение");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.Выпуск,
		Перечисления.ТипыЗаписейПартий.СписанияНаВыпуск,
        "Регистратор, КорПартия, КорАналитикаУчетаНоменклатуры, КорРазделУчета, КорВидЗапасов, КорАналитикаФинансовогоУчета, КорНалоговоеНазначение");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.Выпуск,
		Перечисления.ТипыЗаписейПартий.Потребление,
        "Регистратор, КорПартия, КорАналитикаУчетаНоменклатуры, КорРазделУчета, КорВидЗапасов, КорАналитикаФинансовогоУчета, КорНалоговоеНазначение");
	// Также эта связь используется в ТекстДвиженияСебестоимостиТоваров()
		
	// ПотреблениеПроизводство <- (ПартияСгруппированная, Перемещение, ПеремещениеОбособленно, ОстатокСгруппированный)
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеПриемника(ОписаниеЦепочек,
		Перечисления.ТипыЗаписейПартий.ПотреблениеПроизводство, "АналитикаУчетаНоменклатуры, Организация, РазделУчета, ДокументИсточник");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.ПотреблениеПроизводство,
		Перечисления.ТипыЗаписейПартий.ПартияСгруппированная,   "АналитикаУчетаНоменклатуры, Организация, РазделУчета, Регистратор");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.ПотреблениеПроизводство,
		Перечисления.ТипыЗаписейПартий.Перемещение, 		"АналитикаУчетаНоменклатуры, Организация, РазделУчета, Регистратор");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.ПотреблениеПроизводство,
		Перечисления.ТипыЗаписейПартий.ПеремещениеОбособленно, "АналитикаУчетаНоменклатуры, Организация, РазделУчета, Регистратор");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.ПотреблениеПроизводство,
		Перечисления.ТипыЗаписейПартий.ОстатокСгруппированный, "АналитикаУчетаНоменклатуры, Организация, РазделУчета, Регистратор");
		
	// СписаниеНаРасходы <- (ПартияСгруппированная, Выпуск)
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеПриемника(ОписаниеЦепочек,
		Перечисления.ТипыЗаписейПартий.СписаниеНаРасходы, ПоляПотреблений + ", ДокументИсточник");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.СписаниеНаРасходы,
		Перечисления.ТипыЗаписейПартий.ПартияСгруппированная, ПоляПотреблений + ", Регистратор");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.СписаниеНаРасходы,
		Перечисления.ТипыЗаписейПартий.Выпуск, ПоляПотреблений + ", Регистратор");
		
	// ВозвратПрошлыхПериодов <- (Прошлое)
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеПриемника(ОписаниеЦепочек,
		Перечисления.ТипыЗаписейПартий.ВозвратПрошлыхПериодов, "ДокументИсточник, КорАналитикаУчетаНоменклатуры, КорВидЗапасов, Организация, РазделУчета");
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеИсточника(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.ВозвратПрошлыхПериодов,
		Перечисления.ТипыЗаписейПартий.Прошлое, 			   "Регистратор, АналитикаУчетаНоменклатуры, ВидЗапасов, Организация, РазделУчета");	
		
	// Дополнение, ОтклонениеВСтоимости, РаспределениеПоВыбывшимТоварам, ПеремещениеУпр <- (<без источников - для формирования записей по
	// данным запроса>).
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеДополнения(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.Дополнение);
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеДополнения(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.ВключениеИсключениеНДСВСтоимости);
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеДополнения(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.ОтклонениеВСтоимости);
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеДополнения(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.РаспределениеПоВыбывшимТоварам);
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеДополнения(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.ПеремещениеУпр);
	
	Возврат ОписаниеЦепочек;
	
КонецФункции

Функция ОписаниеДвиженийПартийНДС(ПараметрыРасчета)
	
	КолонкиТаблицыРаспределения = ТаблицаДляРаспределенияПартийНДС(ПараметрыРасчета).Колонки;
	
	ОписаниеДвижений = РасчетСебестоимостиПрикладныеАлгоритмы.ОписаниеДвижений();
    ОписаниеДвижений.Вставить("Контекст", "ПодготовкаДанныхДляУчетаНДС");
    ОписаниеДвижений.Вставить("ИмяРегистра", Метаданные.РегистрыНакопления.ДетализацияПартийТоваровДляНДС.Имя);
	ОписаниеДвижений.Вставить("ПоляРасчета", РасчетСебестоимостиПрикладныеАлгоритмы.ПереченьПолей(КолонкиТаблицыРаспределения));
	ОписаниеДвижений.Вставить("КлючиСравнения",	ПоляПотребленийПартииНДС(ПараметрыРасчета));
	ОписаниеДвижений.Вставить("Показатели", "Знаменатель, ЗнаменательДляИсточников, Количество, СтоимостьБезНДС, НДС, НДСУпр");
	ОписаниеДвижений.Вставить("БазисПрихода", "Знаменатель");
	ОписаниеДвижений.Вставить("БазисРасхода", "Знаменатель");
	ОписаниеДвижений.Вставить("КлючРасхода", "ДокументИсточник");
	ОписаниеДвижений.Вставить("ПолеПорядка", "Период");
	ОписаниеДвижений.Вставить("ПоляСортировки", "Партия");
	ОписаниеДвижений.Вставить("СортировкаПоУсловию", Истина);

	ОписаниеДвижений.Вставить("ПоляСуммирования", "Количество, СтоимостьБезНДС, НДС, НДСУпр");
	ОписаниеДвижений.Вставить("ПоляГруппировки", 
		РасчетСебестоимостиПрикладныеАлгоритмы.ПереченьПолей(КолонкиТаблицыРаспределения, ОписаниеДвижений.ПоляСуммирования));
	ОписаниеДвижений.Вставить("ЕстьСторно", Истина);
	ОписаниеДвижений.Вставить("УменьшатьБазис", Истина);
	ОписаниеДвижений.Вставить("УдалятьСтрокиБезИсточников", Истина);
	
	ОписаниеДвижений.Вставить("ВременныеТаблицыДляСледующихЭтапов", "ПриходыТоваровНДС");
	
	Возврат ОписаниеДвижений;
	
КонецФункции

Функция ОписаниеНезаписываемыхПартийНДС(ПараметрыРасчета)
	
	НезаписываемыеТипыЗаписей = Новый Соответствие;
	НезаписываемыеТипыЗаписей.Вставить(Перечисления.ТипыЗаписейПартий.Остаток,   Истина);
	НезаписываемыеТипыЗаписей.Вставить(Перечисления.ТипыЗаписейПартий.Прошлое,   Истина);
	НезаписываемыеТипыЗаписей.Вставить(Перечисления.ТипыЗаписейПартий.ОстатокСгруппированный, Истина);
	НезаписываемыеТипыЗаписей.Вставить(Перечисления.ТипыЗаписейПартий.ПартияСгруппированная, Истина);
	
	НезаписываемыеРазделы = Новый Соответствие;
	НезаписываемыеРазделы.Вставить(Перечисления.РазделыУчетаСебестоимостиТоваров.ПустаяСсылка(), Истина);
	
	Возврат РасчетСебестоимостиПрикладныеАлгоритмы.ОписаниеНезаписываемыхДанных(Ложь, НезаписываемыеТипыЗаписей, НезаписываемыеРазделы);
	
КонецФункции

Функция ТаблицаДляРаспределенияПартийНДС(ПараметрыРасчета)
	
    Возврат РасчетСебестоимостиПрикладныеАлгоритмы.ТаблицаДляРаспределенияПартий(ПараметрыРасчета,	ТекстОписаниеДанныхДляПартийНДС());
	
КонецФункции

// Выборка данных

Процедура ПолучитьДанныеДляПартийНДС(ПараметрыРасчета)
	
	ПараметрыНумерации = РасчетСебестоимостиПрикладныеАлгоритмы.СформироватьПараметрыНумерацииСтрокВременнойТаблицы(
		"АналитикаУчетаНоменклатуры", // разделитель
		"Знаменатель, Количество, СтоимостьБезНДС, НДС, НДСУпр", // ресурсы
		"АналитикаУчетаНоменклатуры, Период, Приоритет ВОЗР, РазделУчета, Организация, АналитикаУчетаНоменклатуры, Партия, Регистратор"); // порядок
	
	РасчетСебестоимостиПрикладныеАлгоритмы.ПолучитьДанныеЭтапаРасчета(
		ПараметрыРасчета,
		ТекстЗапросаДляПартийНДС(ПараметрыРасчета),
		ПараметрыНумерации);
	
	СкорректироватьАналитикиУчетаПартийДляПартийНДС(ПараметрыРасчета);
	
КонецПроцедуры

Процедура СкорректироватьАналитикиУчетаПартийДляПартийНДС(ПараметрыРасчета)
	
	ТекстЗапроса = 
	"ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	Т.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
	|	Т.АналитикаУчетаПартий КАК АналитикаУчетаПартий
	|ИЗ
	|	Данные КАК Т";
	
	РасчетСебестоимостиПрикладныеАлгоритмы.СкорректироватьАналитикиУчетаПартийПриРасчете(ПараметрыРасчета, ТекстЗапроса);
	
КонецПроцедуры

// Тексты запросов

// ... общий

Функция ТекстЗапросаДляПартийНДС(ПараметрыРасчета = Неопределено) Экспорт
	
	ТекстЗапроса = ""
		// подготовка временных таблиц
		+ ТекстИнициализацияПартийНДС() // вт ПриходыТоваров, СписаниеОтклоненийВСтоимости, ОстаткиТоваров, ПрошлыеРеализацииПартийНДС, ПриходыТоваровНДС
		+ ОбщегоНазначенияУТ.РазделительЗапросовВПакете()
		+ ТекстДвиженияСебестоимостиНДС() // вт ДвиженияСебестоимостиНДС
		+ ОбщегоНазначенияУТ.РазделительЗапросовВПакете()
		// выборка данных
        + ТекстОписаниеДанныхДляПартийНДС() //вт Данные
		+ ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстДетальныеНачальныеОстаткиПартийНДС()
		+ ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстНачальныеОстаткиПартийНДС() // использует ОстаткиТоваров
        + ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстНачальныеОстаткиПартийДляДопРасходов() // использует ВТНачальныеОстаткиПартийНДС
        + ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстДетальныеПриходыСебестоимостиТоваров() // использует ПриходыТоваровНДС
		+ ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстПриходыСебестоимостиТоваров() // использует ПриходыТоваровНДС
		+ ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстДвиженияСебестоимостиТоваров()
		+ ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстДвиженияСебестоимостиТоваровСборка()
		+ ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстВозвратыПрошлыхПериодов()
		+ ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстРеализацииПрошлыхМесяцевПартииНДС() // использует ПрошлыеРеализации
		+ ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстРеализацииПрошлыхМесяцевПартииНДС21() // использует ПрошлыеРеализации
		+ ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстТаможенныеДекларацииИзменениеВидыДеятельностиНДС()
		+ "";
	
	Возврат ТекстЗапроса;
	
КонецФункции

// ... описания данных

Функция ТекстОписаниеДанныхДляПартийНДС()
	Возврат
		"ВЫБРАТЬ ПЕРВЫЕ 0
		|	ВЫРАЗИТЬ("""" КАК СТРОКА(80)) 					КАК ЗапросИсточник,
		|	ДД.ТипЗаписи 									КАК ТипЗаписи,
		|	ЛОЖЬ											КАК Сторно,
		|	0 												КАК Приоритет,
		|	0 												КАК Знаменатель,
		|	0 												КАК ЗнаменательДляИсточников,
		|	ЛОЖЬ 											КАК РасчетЗавершен,
		|	ЗНАЧЕНИЕ(Справочник.Номенклатура.ПустаяСсылка) 	КАК Номенклатура,
        |	ДД.АналитикаУчетаПартий.НалоговоеНазначение 		КАК НалоговоеНазначениеПартии,
		|	
		|	ДД.Период,
		|	ДД.Регистратор,
		|	ДД.ВидДвижения,
		|	ДД.Организация,
		|	ДД.РазделУчета,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.ВидЗапасов,
		|	ДД.Партия,
		|	ДД.АналитикаФинансовогоУчета,
        |	ДД.НалоговоеНазначение,
		|	ДД.АналитикаУчетаПартий,
		|	ДД.ДокументПоступления,
		|
		|	ДД.Количество,
		|	ДД.СтоимостьБезНДС,
		|	ДД.НДС,
		|	ДД.НДСУпр,
		|
		|	ДД.ХозяйственнаяОперация,
        |	ДД.КорНалоговоеНазначение,
		|	ДД.РазделУчета КАК КорРазделУчета,
		|	ДД.АналитикаУчетаНоменклатуры КАК КорАналитикаУчетаНоменклатуры,
		|	ДД.ВидЗапасов КАК КорВидЗапасов,
		|	ДД.Организация КАК КорОрганизация,
		|	ДД.Партия КАК КорПартия,
		|	ДД.КорАналитикаФинансовогоУчета,
		|	ДД.Подразделение,
		|	ДД.СтатьяРасходовАктивов,
		|	ДД.АналитикаРасходов,
		|	ДД.АналитикаАктивов,
		|	ДД.ДокументИсточник,
		|	ДД.СтатьяСписанияНДС,
		|	ДД.АналитикаСписанияНДС,
		|	ДД.КорНаправлениеДеятельности
		|//ВоВременнуюТаблицу
		|ИЗ
        |	РегистрНакопления.ДетализацияПартийТоваровДляНДС КАК ДД
		|";
КонецФункции

// ... формирования временные таблиц

Функция ТекстИнициализацияПартийНДС() // вт ПриходыТоваров, СписаниеОтклоненийВСтоимости, ОстаткиТоваров, ПрошлыеРеализацииПартийНДС, ПриходыТоваровНДС, ДвиженияСебестоимостиНДС
	Возврат
		"ВЫБРАТЬ
		|	ДД.Организация,
		|	ДД.РазделУчета,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.ВидЗапасов,
		|	(ВЫБОР
		|		КОГДА ДД.Организация В (&ОрганизацииСФИФОСкользящая)
		|			ТОГДА ДД.Партия
		|		КОГДА НЕ Корректировка.ДокументОснование ЕСТЬ NULL
		|			ТОГДА Корректировка.ДокументОснование
		|		КОГДА НЕ ВводОстатковТоваров.Партия ЕСТЬ NULL
		|			ТОГДА ВводОстатковТоваров.Партия
		|		КОГДА НЕ ВводОстатков.Партия ЕСТЬ NULL
		|			ТОГДА ВводОстатков.Партия
		|		ИНАЧЕ ДД.Регистратор КОНЕЦ) КАК Партия,
		|	ДД.АналитикаФинансовогоУчета,
        |	ДД.НалоговоеНазначение,
		|	СУММА(ДД.Количество) КАК Количество
		|ПОМЕСТИТЬ ПриходыТоваров
		|ИЗ
		|	ВТКэшРасчетныеОборотыСебестоимостьТоваров КАК ДД
		|	ЛЕВОЕ СОЕДИНЕНИЕ Документ.КорректировкаПриобретения КАК Корректировка
		|		ПО Корректировка.Ссылка = ДД.Регистратор
		|	ЛЕВОЕ СОЕДИНЕНИЕ Документ.ВводОстатков КАК ВводОстатков
		|		ПО ВводОстатков.Ссылка = ДД.Регистратор
		|	ЛЕВОЕ СОЕДИНЕНИЕ Документ.ВводОстатковТоваров КАК ВводОстатковТоваров
		|		ПО ВводОстатковТоваров.Ссылка = ДД.Регистратор
		|ГДЕ
		|	ДД.Организация В (&ОрганизацииСУчетомПартийНДСВерсии22)
		|	И ДД.Количество > 0
		|	И ДД.СлужебноеВидДвиженияПриход
		|	И ДД.ТипЗаписи <> ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Перемещение)
		|СГРУППИРОВАТЬ ПО
		|	ДД.Организация,
		|	ДД.РазделУчета,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.ВидЗапасов,
		|	(ВЫБОР
		|		КОГДА ДД.Организация В (&ОрганизацииСФИФОСкользящая)
		|			ТОГДА ДД.Партия
		|		КОГДА НЕ Корректировка.ДокументОснование ЕСТЬ NULL
		|			ТОГДА Корректировка.ДокументОснование
		|		КОГДА НЕ ВводОстатковТоваров.Партия ЕСТЬ NULL
		|			ТОГДА ВводОстатковТоваров.Партия
		|		КОГДА НЕ ВводОстатков.Партия ЕСТЬ NULL
		|			ТОГДА ВводОстатков.Партия
		|		ИНАЧЕ ДД.Регистратор КОНЕЦ),
		|	ДД.АналитикаФинансовогоУчета,
        |	ДД.НалоговоеНазначение
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ДД.Организация,
		|	ДД.РазделУчета,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.ВидЗапасов,
		|	ДД.Партия,
		|	ДД.АналитикаФинансовогоУчета,
        |	ДД.НалоговоеНазначение,
		|	ДД.Регистратор,
		|	СУММА(ДД.Количество) КАК Количество
		|ПОМЕСТИТЬ ПриходыСборокТоваров
		|ИЗ
		|	ВТКэшРасчетныеОборотыСебестоимостьТоваров КАК ДД
		|ГДЕ
		|	ДД.Организация В (&ОрганизацииСУчетомПартийНДСВерсии22)
		|	И ДД.Количество > 0
		|	И ДД.СлужебноеВидДвиженияПриход
		|СГРУППИРОВАТЬ ПО
		|	ДД.Организация,
		|	ДД.РазделУчета,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.ВидЗапасов,
		|	ДД.Партия,
		|	ДД.АналитикаФинансовогоУчета,
        |	ДД.НалоговоеНазначение,
		|	ДД.Регистратор
		|;
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ДД.Организация,
		|	ДД.РазделУчета,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.ВидЗапасов,
		|	ДД.Партия,
		|	ДД.АналитикаФинансовогоУчета,
        |	ДД.НалоговоеНазначение,
		|	СУММА(ДД.ДопРасходыРегл)	КАК ДопРасходыРегл,
        |	СУММА(ДД.НДСРеглРеквизит)	КАК НДСРеглРеквизит,
		|	СУММА(ДД.НДСУпр)			КАК НДСУпр
		|ПОМЕСТИТЬ СписаниеОтклоненийВСтоимости
		|ИЗ
		|	ВТКэшРасчетныеОборотыСебестоимостьТоваров КАК ДД
		|ГДЕ
		|	ДД.Организация В (&ОрганизацииСУчетомПартийНДСВерсии22)
		|	И ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ОтклонениеВСтоимости)
		|	И НЕ ДД.СлужебноеВидДвиженияПриход
		|СГРУППИРОВАТЬ ПО
		|	ДД.Организация,
		|	ДД.РазделУчета,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.ВидЗапасов,
		|	ДД.Партия,
		|	ДД.АналитикаФинансовогоУчета,
        |	ДД.НалоговоеНазначение
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ДД.Организация,
		|	ДД.РазделУчета,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.ВидЗапасов,
		|	ДД.Партия,
		|	ДД.АналитикаФинансовогоУчета,
        |	ДД.НалоговоеНазначение,
		|	ДД.КоличествоОстаток КАК Количество
		|ПОМЕСТИТЬ ОстаткиТоваров
		|ИЗ
        |	РегистрНакопления.ДетализацияПартийТоваровДляНДС.Остатки(&ГраницаКонецПредыдущегоПериода,
		|		Организация В (&ОрганизацииСУчетомПартийНДСВерсии22)) КАК ДД
		|ГДЕ
		|	ДД.КоличествоОстаток > 0
		|ИНДЕКСИРОВАТЬ ПО
		|	АналитикаУчетаНоменклатуры
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ДД.ДокументИсточник,
		|	ДД.Организация,
		|	ДД.РазделУчета,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.ВидЗапасов,
		|	ДД.Партия,
		|	ДД.АналитикаФинансовогоУчета,
        |	ВЫБОР
        |		КОГДА ДД.КорНалоговоеНазначение = ЗНАЧЕНИЕ(Справочник.НалоговыеНазначенияАктивовИЗатрат.ПустаяСсылка)
        |			ТОГДА ДД.НалоговоеНазначение
        |		ИНАЧЕ ДД.КорНалоговоеНазначение
        |	КОНЕЦ КАК НалоговоеНазначение,
		|	СУММА(ДД.Количество) КАК Количество
		|ПОМЕСТИТЬ ПрошлыеРеализацииПартийНДС
		|ИЗ
		|	ВТКэшРасчетныеОборотыСебестоимостьТоваров КАК ДД
		|ГДЕ
		|	ДД.Организация В (&ОрганизацииСУчетомПартийНДСВерсии22)
		|	И ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ВозвратПрошлыхПериодов)
		|	И ДД.Количество <> 0
		|СГРУППИРОВАТЬ ПО
		|	ДД.ДокументИсточник,
		|	ДД.Организация,
		|	ДД.РазделУчета,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.ВидЗапасов,
		|	ДД.Партия,
		|	ДД.АналитикаФинансовогоУчета,
        |	ВЫБОР
        |		КОГДА ДД.КорНалоговоеНазначение = ЗНАЧЕНИЕ(Справочник.НалоговыеНазначенияАктивовИЗатрат.ПустаяСсылка)
        |			ТОГДА ДД.НалоговоеНазначение
        |		ИНАЧЕ ДД.КорНалоговоеНазначение
        |	КОНЕЦ
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	(ВЫБОР
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Партия)
		|		КОГДА НЕ ДД.СлужебноеВидДвиженияПриход
		|			И ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ОтклонениеВСтоимости)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение)
		|		ИНАЧЕ ДД.ТипЗаписи КОНЕЦ) КАК ТипЗаписи,
		|	ЛОЖЬ КАК Сторно,
		|	СУММА(ДД.Количество) КАК Знаменатель,
		|	ДД.АналитикаУчетаНоменклатуры.Номенклатура КАК Номенклатура,
        |	ДД.АналитикаУчетаПартий.НалоговоеНазначение КАК НалоговоеНазначениеПартии,
		|	
		|	ДД.Период,
		|	ДД.Регистратор,
		|	ВЫБОР КОГДА ДД.СлужебноеВидДвиженияПриход
		|		 ТОГДА ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|		ИНАЧЕ ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
		|	КОНЕЦ КАК ВидДвижения,
		|	ДД.Организация,
		|	ДД.РазделУчета,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.ВидЗапасов,
		|	(ВЫБОР
		|		КОГДА ДД.Организация В (&ОрганизацииСФИФОСкользящая)
		|			ТОГДА ДД.Партия
		|		КОГДА ДД.ТипЗаписи В (
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходы),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыСПартией),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыБезПартии),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаСтоимости),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ОтклонениеВСтоимости))
		|			ТОГДА ВЫБОР
		|				КОГДА ТИПЗНАЧЕНИЯ(ДД.ДокументИсточник) = ТИП(Документ.ВводОстатковТоваров)
		|					ТОГДА ЕСТЬNULL(ВводОстатковТоваров.Партия,
		|						ЕСТЬNULL(ДопРасходыКорректировка.ДокументОснование, ДД.ДокументИсточник))
		|				ИНАЧЕ ЕСТЬNULL(ВводОстатков.Партия,
		|					ЕСТЬNULL(ДопРасходыКорректировка.ДокументОснование, ДД.ДокументИсточник))
		|			КОНЕЦ
		|		КОГДА НЕ Корректировка.ДокументОснование ЕСТЬ NULL
		|			ТОГДА Корректировка.ДокументОснование
		|		ИНАЧЕ ДД.Регистратор КОНЕЦ) КАК Партия,
		|	ДД.АналитикаФинансовогоУчета,
        |	ДД.НалоговоеНазначение,
		|
		|	(ВЫБОР
		|		КОГДА ДД.ТипЗаписи В (
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходы),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыСПартией),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыБезПартии),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.РаспределениеПоВыбывшимТоварам))
		|		И ДД.СлужебноеВидДвиженияПриход
		|			ТОГДА ДД.КорАналитикаУчетаПартий
		|		КОГДА ДД.АналитикаУчетаПартий = ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка)
		|			ТОГДА ДД.КорАналитикаУчетаПартий
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Партия) И ДД.Количество = 0
		|		 И ДД.КорАналитикаУчетаПартий <> ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка)
		|			ТОГДА ДД.КорАналитикаУчетаПартий
		|		ИНАЧЕ ДД.АналитикаУчетаПартий КОНЕЦ) КАК АналитикаУчетаПартий,
		|	(ВЫБОР
		|		КОГДА НЕ Корректировка.ВидКорректировки ЕСТЬ NULL
		|		 И Корректировка.ВидКорректировки <> ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.КорректировкаПоСогласованиюСторон)
		|			ТОГДА Корректировка.ДокументОснование
		|		ИНАЧЕ ДД.Регистратор КОНЕЦ) КАК ДокументПоступления,
		|
		|	СУММА(ДД.Количество) КАК Количество,
		|	СУММА(
		|		ВЫБОР КОГДА ДД.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукции)
        |		 И ДД.НДСРеглРеквизит = 0
		|			ТОГДА 0
		|			ИНАЧЕ ДД.СтоимостьРегл + ДД.ДопРасходыРегл КОНЕЦ
		|		+ ВЫБОР
        |			КОГДА ДД.НалоговоеНазначение.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ВидыДеятельностиНДС.Необлагаемая) 
        |				ТОГДА -ДД.НДСРеглРеквизит
		|			ИНАЧЕ 0
		|	КОНЕЦ - ЕСТЬNULL(СписаниеОтклонений.ДопРасходыРегл, 0)) КАК СтоимостьБезНДС,
        |	СУММА(ДД.НДСРеглРеквизит - ЕСТЬNULL(СписаниеОтклонений.НДСРеглРеквизит, 0)) КАК НДС,
		|	СУММА(ВЫБОР
		|		КОГДА &УправленческийУчетОрганизаций
		|			ТОГДА ДД.НДСУпр - ЕСТЬNULL(СписаниеОтклонений.НДСУпр, 0)
		|		ИНАЧЕ 0
		|	КОНЕЦ) КАК НДСУпр,
		|
		|	ДД.ХозяйственнаяОперация,
        |	ДД.КорНалоговоеНазначение,
		|	ДД.КорРазделУчета,
		|	ДД.КорАналитикаУчетаНоменклатуры,
		|	ДД.КорВидЗапасов,
		|	ДД.КорОрганизация,
		|	ДД.КорПартия,
		|	ДД.КорАналитикаФинансовогоУчета,
		|	ДД.Подразделение,
		|	(ВЫБОР
		|		КОГДА ДД.СтатьяРасходовСписания <> ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиРасходов.ПустаяСсылка)
		|		 И ДД.СтатьяРасходовСписания <> НЕОПРЕДЕЛЕНО
		|			ТОГДА ДД.СтатьяРасходовСписания
		|		КОГДА ДД.СтатьяАктивовПассивов <> ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиАктивовПассивов.ПустаяСсылка)
		|			ТОГДА ДД.СтатьяАктивовПассивов
		|		ИНАЧЕ НЕОПРЕДЕЛЕНО КОНЕЦ) КАК СтатьяРасходовАктивов,
		|	ДД.АналитикаРасходов,
		|	ДД.АналитикаАктивовПассивов КАК АналитикаАктивов,
		|	(ВЫБОР
		|		КОГДА НЕ ДД.Организация В (&ОрганизацииСФИФОСкользящая)
		|		 И Реестр.ДатаДокументаИБ < &НачалоПериода
		|			ТОГДА НЕОПРЕДЕЛЕНО
		|		КОГДА ДД.Партия <> НЕОПРЕДЕЛЕНО
		|		 И ДД.ТипЗаписи В (
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходы),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыСПартией),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыБезПартии),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ОтклонениеВСтоимости))
		|			ТОГДА ДД.Партия
		|		ИНАЧЕ ДД.ДокументИсточник КОНЕЦ) КАК ДокументИсточник
		|ПОМЕСТИТЬ ПриходыТоваровНДС
		|ИЗ
		|	ВТКэшРасчетныеОборотыСебестоимостьТоваров КАК ДД
		|	ЛЕВОЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаПоПартнерам КАК АналитикаРасчетов
		|		ПО АналитикаРасчетов.Ссылка = ДД.АналитикаУчетаПоПартнерам
		|	ЛЕВОЕ СОЕДИНЕНИЕ Справочник.ДоговорыКонтрагентов КАК Договоры
		|		ПО Договоры.Ссылка = АналитикаРасчетов.Договор
		|	ЛЕВОЕ СОЕДИНЕНИЕ Документ.КорректировкаПриобретения КАК Корректировка
		|		ПО Корректировка.Ссылка = ДД.Регистратор
		|	ЛЕВОЕ СОЕДИНЕНИЕ Документ.КорректировкаПриобретения КАК ДопРасходыКорректировка
		|		ПО ДопРасходыКорректировка.Ссылка = ДД.ДокументИсточник
		|	ЛЕВОЕ СОЕДИНЕНИЕ Документ.ВводОстатков КАК ВводОстатков
		|		ПО ВводОстатков.Ссылка = ДД.ДокументИсточник
		|	ЛЕВОЕ СОЕДИНЕНИЕ Документ.ВводОстатковТоваров КАК ВводОстатковТоваров
		|		ПО ВводОстатковТоваров.Ссылка = ДД.ДокументИсточник
		|	ЛЕВОЕ СОЕДИНЕНИЕ СписаниеОтклоненийВСтоимости КАК СписаниеОтклонений
		|		ПО СписаниеОтклонений.Организация = ДД.Организация
		|		И СписаниеОтклонений.РазделУчета = ДД.РазделУчета
		|		И СписаниеОтклонений.АналитикаУчетаНоменклатуры = ДД.АналитикаУчетаНоменклатуры
		|		И СписаниеОтклонений.ВидЗапасов = ДД.ВидЗапасов
		|		И СписаниеОтклонений.Партия = ДД.Партия
		|		И СписаниеОтклонений.АналитикаФинансовогоУчета = ДД.АналитикаФинансовогоУчета
        |		И СписаниеОтклонений.НалоговоеНазначение = ДД.НалоговоеНазначение
		|		И ДД.СлужебноеВидДвиженияПриход
		|	ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.РеестрДокументов КАК Реестр
		|		ПО Реестр.Ссылка = ДД.ДокументИсточник
		|		И НЕ Реестр.ДополнительнаяЗапись
		|		И Реестр.Ссылка <> НЕОПРЕДЕЛЕНО
		|ГДЕ
		|	ДД.Организация В (&ОрганизацииСУчетомПартийНДСВерсии22)
		|	И (ДД.СлужебноеВидДвиженияПриход
		|		ИЛИ ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ОтклонениеВСтоимости)
		|		ИЛИ ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.РаспределениеПоВыбывшимТоварам)
		|		ИЛИ ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаПриобретенияПрошлогоПериода))
		|	И НЕ ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ВключениеИсключениеНДСВСтоимости)
		// Исключаем суммовую корректировку приобретения, если корректируемый документ относится к периоду с выключенным партионным учетом.
		|	И НЕ (
		|		ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаПриобретенияПрошлогоПериода)
		|   	И ДД.СлужебноеВидДвиженияПриход
		|		И ДД.Количество = 0
		|		И Реестр.ДатаДокументаИБ < &ДатаПереходаНаПартионныйУчетВерсии22
		|		И &ИспользовалсяПартионныйУчетДоПереходаНаВерсию22 = ЛОЖЬ)
		// Ограничиваем выборку данных:
		// - выбираем партии с НДС
		// - также выбираем партии без НДС, но с количеством, т.к. в дальнейшем на них могут быть отнесены затраты с НДС
        |	И (ДД.НДСРеглРеквизит <> 0
		|		ИЛИ ДД.НДСУпр <> 0
		|		ИЛИ ДД.Регистратор ССЫЛКА Документ.СборкаТоваров
		|		ИЛИ ДД.Регистратор ССЫЛКА Документ.ТаможеннаяДекларацияИмпорт
		|		ИЛИ ДД.Регистратор ССЫЛКА Документ.ПорчаТоваров
		|		ИЛИ ДД.Регистратор ССЫЛКА Документ.ПересортицаТоваров
		|		ИЛИ ДД.Регистратор ССЫЛКА Документ.ОприходованиеИзлишковТоваров
		|		ИЛИ ДД.ХозяйственнаяОперация В (
		|			ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаПоИмпорту),
		|			ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаПоИмпортуТоварыВПути))
		//++ НЕ УТ
		|		ИЛИ ТИПЗНАЧЕНИЯ(ДД.Регистратор) = ТИП(Документ.ВыпускПродукции)
		|		ИЛИ ТИПЗНАЧЕНИЯ(ДД.Регистратор) = ТИП(Документ.ОтчетПереработчика)
		|		ИЛИ ДД.Регистратор ССЫЛКА Документ.ПроизводствоБезЗаказа
		//-- НЕ УТ
		|		ИЛИ ТИПЗНАЧЕНИЯ(ДД.Регистратор) = ТИП(Документ.ПоступлениеТоваровНаСклад)
		|		)
		|	И НЕ (ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Партия)
		|			И ДД.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПередачаПродукцииИзПроизводства))
		|	И ДД.ТипЗаписи В (
		|		ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Партия),
		|		ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходы),
		|		ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыСПартией),
		|		ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыБезПартии),
		|		ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.РаспределениеПоВыбывшимТоварам),
		|		ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ОтклонениеВСтоимости),
		|		ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаПриобретенияПрошлогоПериода),
		|		ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаСтоимости),
		|		ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение))
        |	И ДД.НалоговоеНазначение <> ЗНАЧЕНИЕ(Справочник.НалоговыеНазначенияАктивовИЗатрат.ПустаяСсылка)
		|	И (ДД.РазделУчета <> ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НезавершенноеПроизводство)
		//++ НЕ УТ
		|		ИЛИ ДД.Регистратор ССЫЛКА Документ.ОтчетПереработчика
		|			И ДД.ТипЗаписи <> ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение)
		//-- НЕ УТ
		|		)
		|	И НЕ ДД.РазделУчета В (
		|		ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПринятыеНаКомиссию),
		|		ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.МатериалыПринятыеВПереработку),
		|		ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПринятыеНаОтветхранение),
		|		ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыНаХраненииСПравомПродажи),
		|		ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыНаХраненииСПравомПродажиПереданныеПартнерам),
		|		ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыНаХраненииСПравомПродажиКОформлениюСписания),
		|		ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НеотфактурованныеПоставки))
		|	И (ВЫБОР
		|		КОГДА ДД.ТипЗаписи В (
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходы),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыСПартией),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыБезПартии),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.РаспределениеПоВыбывшимТоварам))
		|		И ДД.СлужебноеВидДвиженияПриход
		|			ТОГДА ДД.КорАналитикаУчетаПартий
		|		КОГДА ДД.АналитикаУчетаПартий = ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка)
		|			ТОГДА ДД.КорАналитикаУчетаПартий
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Партия) И ДД.Количество = 0
		|		 И ДД.КорАналитикаУчетаПартий <> ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка)
		|			ТОГДА ДД.КорАналитикаУчетаПартий
		|		ИНАЧЕ ДД.АналитикаУчетаПартий КОНЕЦ) <> ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка)
		|	И НЕ ДД.Регистратор ССЫЛКА Документ.ОтчетКомитентуОСписании
		|	И НЕ ((ДД.Регистратор ССЫЛКА Документ.ВводОстатков
		|				И НЕ ВЫРАЗИТЬ(ДД.Регистратор КАК Документ.ВводОстатков).ВводОстатков22)
		|			ИЛИ ДД.Регистратор ССЫЛКА Документ.ВводОстатковТоваров)
		|	И НЕ (НЕ Корректировка.ВидКорректировки ЕСТЬ NULL
		|			И Корректировка.ВидКорректировки = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.КорректировкаПоСогласованиюСторон)
		|			И ДД.Количество = 0
		|			И (ДД.СтоимостьРегл < 0 ИЛИ ДД.ДопРасходыРегл < 0))
		|СГРУППИРОВАТЬ ПО
		|	(ВЫБОР
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Партия)
		|		КОГДА НЕ ДД.СлужебноеВидДвиженияПриход
		|			И ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ОтклонениеВСтоимости)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение)
		|		ИНАЧЕ ДД.ТипЗаписи КОНЕЦ),
		|	ДД.АналитикаУчетаНоменклатуры.Номенклатура,
        |	ДД.АналитикаУчетаПартий.НалоговоеНазначение,
		|	ДД.Период,
		|	ДД.Регистратор,
		|	ВЫБОР КОГДА ДД.СлужебноеВидДвиженияПриход
		|		 ТОГДА ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|		ИНАЧЕ ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
		|	КОНЕЦ,
		|	ДД.Организация,
		|	ДД.РазделУчета,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.ВидЗапасов,
		|	(ВЫБОР
		|		КОГДА ДД.Организация В (&ОрганизацииСФИФОСкользящая)
		|			ТОГДА ДД.Партия
		|		КОГДА ДД.ТипЗаписи В (
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходы),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыСПартией),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыБезПартии),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаСтоимости),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ОтклонениеВСтоимости))
		|			ТОГДА ВЫБОР
		|				КОГДА ТИПЗНАЧЕНИЯ(ДД.ДокументИсточник) = ТИП(Документ.ВводОстатковТоваров)
		|					ТОГДА ЕСТЬNULL(ВводОстатковТоваров.Партия,
		|						ЕСТЬNULL(ДопРасходыКорректировка.ДокументОснование, ДД.ДокументИсточник))
		|				ИНАЧЕ ЕСТЬNULL(ВводОстатков.Партия,
		|					ЕСТЬNULL(ДопРасходыКорректировка.ДокументОснование, ДД.ДокументИсточник))
		|			КОНЕЦ
		|		КОГДА НЕ Корректировка.ДокументОснование ЕСТЬ NULL
		|			ТОГДА Корректировка.ДокументОснование
		|		ИНАЧЕ ДД.Регистратор КОНЕЦ),
		|	ДД.АналитикаФинансовогоУчета,
        |	ДД.НалоговоеНазначение,
		|	(ВЫБОР
		|		КОГДА ДД.ТипЗаписи В (
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходы),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыСПартией),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыБезПартии),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.РаспределениеПоВыбывшимТоварам))
		|		И ДД.СлужебноеВидДвиженияПриход
		|			ТОГДА ДД.КорАналитикаУчетаПартий
		|		КОГДА ДД.АналитикаУчетаПартий = ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка)
		|			ТОГДА ДД.КорАналитикаУчетаПартий
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Партия) И ДД.Количество = 0
		|		 И ДД.КорАналитикаУчетаПартий <> ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка)
		|			ТОГДА ДД.КорАналитикаУчетаПартий
		|		ИНАЧЕ ДД.АналитикаУчетаПартий КОНЕЦ),
		|	(ВЫБОР
		|		КОГДА НЕ Корректировка.ВидКорректировки ЕСТЬ NULL
		|		 И Корректировка.ВидКорректировки <> ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.КорректировкаПоСогласованиюСторон)
		|			ТОГДА Корректировка.ДокументОснование
		|		ИНАЧЕ ДД.Регистратор КОНЕЦ),
		|	ДД.ХозяйственнаяОперация,
        |	ДД.КорНалоговоеНазначение,
		|	ДД.КорРазделУчета,
		|	ДД.КорАналитикаУчетаНоменклатуры,
		|	ДД.КорВидЗапасов,
		|	ДД.КорОрганизация,
		|	ДД.КорПартия,
		|	ДД.КорАналитикаФинансовогоУчета,
		|	ДД.Подразделение,
		|	(ВЫБОР
		|		КОГДА ДД.СтатьяРасходовСписания <> ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиРасходов.ПустаяСсылка)
		|		 И ДД.СтатьяРасходовСписания <> НЕОПРЕДЕЛЕНО
		|			ТОГДА ДД.СтатьяРасходовСписания
		|		КОГДА ДД.СтатьяАктивовПассивов <> ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиАктивовПассивов.ПустаяСсылка)
		|			ТОГДА ДД.СтатьяАктивовПассивов
		|		ИНАЧЕ НЕОПРЕДЕЛЕНО КОНЕЦ),
		|	ДД.АналитикаРасходов,
		|	ДД.АналитикаАктивовПассивов,
		|	(ВЫБОР
		|		КОГДА НЕ ДД.Организация В (&ОрганизацииСФИФОСкользящая)
		|		 И Реестр.ДатаДокументаИБ < &НачалоПериода
		|			ТОГДА НЕОПРЕДЕЛЕНО
		|		КОГДА ДД.Партия <> НЕОПРЕДЕЛЕНО
		|		 И ДД.ТипЗаписи В (
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходы),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыСПартией),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыБезПартии),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ОтклонениеВСтоимости))
		|			ТОГДА ДД.Партия
		|		ИНАЧЕ ДД.ДокументИсточник КОНЕЦ)
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение) КАК ТипЗаписи,
		|	ЛОЖЬ КАК Сторно,
		|	СУММА(ДД.Количество) КАК Знаменатель,
		|	ДД.АналитикаУчетаНоменклатуры.Номенклатура КАК Номенклатура,
        |	ДД.АналитикаУчетаПартий.НалоговоеНазначение КАК НалоговоеНазначениеПартии,
		|	
		|	ДД.Период,
		|	ДД.Регистратор,
		|	ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход) КАК ВидДвижения,
		|	ДД.Организация,
		|	ДД.РазделУчета,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.ВидЗапасов,
		|	ДД.Партия,
		|	ДД.АналитикаФинансовогоУчета,
        |	ДД.НалоговоеНазначение,
		|
		|	(ВЫБОР
		|		КОГДА ДД.АналитикаУчетаПартий = ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка)
		|			ТОГДА ДД.КорАналитикаУчетаПартий
		|		ИНАЧЕ ДД.АналитикаУчетаПартий КОНЕЦ) КАК АналитикаУчетаПартий,
		|	ДД.Регистратор КАК ДокументПоступления,
		|
		|	СУММА(ДД.Количество) КАК Количество,
		|	СУММА(СписаниеОтклонений.ДопРасходыРегл
		|		+ ВЫБОР
        |			КОГДА ДД.НалоговоеНазначение.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ВидыДеятельностиНДС.Необлагаемая) 
        |				ТОГДА -СписаниеОтклонений.НДСРеглРеквизит
		|			ИНАЧЕ 0
		|	КОНЕЦ) КАК СтоимостьБезНДС,
        |	СУММА(СписаниеОтклонений.НДСРеглРеквизит) КАК НДС,
		|	СУММА(ВЫБОР
		|		КОГДА &УправленческийУчетОрганизаций
		|			ТОГДА СписаниеОтклонений.НДСУпр
		|		ИНАЧЕ 0
		|	КОНЕЦ) КАК НДСУпр,
		|
		|	ДД.ХозяйственнаяОперация,
        |	ДД.КорНалоговоеНазначение,
		|	ДД.КорРазделУчета,
		|	ДД.КорАналитикаУчетаНоменклатуры,
		|	ДД.КорВидЗапасов,
		|	ДД.КорОрганизация,
		|	ДД.КорПартия,
		|	ДД.КорАналитикаФинансовогоУчета,
		|	ДД.Подразделение,
		|	НЕОПРЕДЕЛЕНО КАК СтатьяРасходовАктивов,
		|	ДД.АналитикаРасходов,
		|	ДД.АналитикаАктивовПассивов КАК АналитикаАктивов,
		|	(ВЫБОР
		|		КОГДА ДД.Партия <> НЕОПРЕДЕЛЕНО
		|			ТОГДА ДД.Партия
		|		ИНАЧЕ ДД.ДокументИсточник КОНЕЦ) КАК ДокументИсточник
		|ИЗ
		|	ВТКэшРасчетныеОборотыСебестоимостьТоваров КАК ДД
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ СписаниеОтклоненийВСтоимости КАК СписаниеОтклонений
		|		ПО СписаниеОтклонений.Организация = ДД.Организация
		|		И СписаниеОтклонений.РазделУчета = ДД.РазделУчета
		|		И СписаниеОтклонений.АналитикаУчетаНоменклатуры = ДД.АналитикаУчетаНоменклатуры
		|		И СписаниеОтклонений.ВидЗапасов = ДД.ВидЗапасов
		|		И СписаниеОтклонений.Партия = ДД.Партия
		|		И СписаниеОтклонений.АналитикаФинансовогоУчета = ДД.АналитикаФинансовогоУчета
        |		И СписаниеОтклонений.НалоговоеНазначение = ДД.НалоговоеНазначение
		|		И ДД.СлужебноеВидДвиженияПриход
		|ГДЕ
		|	ДД.Организация В (&ОрганизацииСУчетомПартийНДСВерсии22)
		|	И ДД.СлужебноеВидДвиженияПриход
		|	И ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ОтклонениеВСтоимости)
        |	И ДД.НалоговоеНазначение <> ЗНАЧЕНИЕ(Справочник.НалоговыеНазначенияАктивовИЗатрат.ПустаяСсылка)
		|	И ДД.РазделУчета <> ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НеотфактурованныеПоставки)
		|	И (ВЫБОР
		|		КОГДА ДД.АналитикаУчетаПартий = ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка)
		|			ТОГДА ДД.КорАналитикаУчетаПартий
		|		ИНАЧЕ ДД.АналитикаУчетаПартий КОНЕЦ) <> ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка)
		|СГРУППИРОВАТЬ ПО
		|	ДД.АналитикаУчетаНоменклатуры.Номенклатура,
        |	ДД.АналитикаУчетаПартий.НалоговоеНазначение,
		|	ДД.Период,
		|	ДД.Регистратор,
		|	ДД.Организация,
		|	ДД.РазделУчета,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.ВидЗапасов,
		|	ДД.Партия,
		|	ДД.АналитикаФинансовогоУчета,
        |	ДД.НалоговоеНазначение,
		|	(ВЫБОР
		|		КОГДА ДД.АналитикаУчетаПартий = ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка)
		|			ТОГДА ДД.КорАналитикаУчетаПартий
		|		ИНАЧЕ ДД.АналитикаУчетаПартий КОНЕЦ),
		|	ДД.ХозяйственнаяОперация,
        |	ДД.КорНалоговоеНазначение,
		|	ДД.КорРазделУчета,
		|	ДД.КорАналитикаУчетаНоменклатуры,
		|	ДД.КорВидЗапасов,
		|	ДД.КорОрганизация,
		|	ДД.КорПартия,
		|	ДД.КорАналитикаФинансовогоУчета,
		|	ДД.Подразделение,
		|	ДД.АналитикаРасходов,
		|	ДД.АналитикаАктивовПассивов,
		|	(ВЫБОР
		|		КОГДА ДД.Партия <> НЕОПРЕДЕЛЕНО
		|			ТОГДА ДД.Партия
		|		ИНАЧЕ ДД.ДокументИсточник КОНЕЦ)
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ОстатокСгруппированный) КАК ТипЗаписи,
		|	ЛОЖЬ КАК Сторно,
		|	СУММА(ДД.Количество) КАК Знаменатель,
		|	ДД.АналитикаУчетаНоменклатуры.Номенклатура КАК Номенклатура,
        |	ДД.АналитикаУчетаПартий.НалоговоеНазначение КАК НалоговоеНазначениеПартии,
		|	
		|	ДД.Период,
		|	ДД.Регистратор,
		|	ВЫБОР КОГДА ДД.СлужебноеВидДвиженияПриход
		|		 ТОГДА ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|		ИНАЧЕ ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
		|	КОНЕЦ КАК ВидДвижения,
		|	ДД.Организация,
		|	ДД.РазделУчета,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.ВидЗапасов,
		|	ДД.Партия,
		|	ДД.АналитикаФинансовогоУчета,
        |	ДД.НалоговоеНазначение,
		|
		|	ДД.АналитикаУчетаПартий,
		|	ДД.ДокументПоступления,
		|
		|	СУММА(ДД.Количество) КАК Количество,
		|	СУММА(ДД.СтоимостьБезНДС) КАК СтоимостьБезНДС,
		|	СУММА(ДД.НДС) КАК НДС,
		|	СУММА(ДД.НДСУпр) КАК НДСУпр,
		|
		|	ДД.ХозяйственнаяОперация,
        |	ДД.КорНалоговоеНазначение,
		|	НЕОПРЕДЕЛЕНО КАК КорРазделУчета,
		|	ДД.КорАналитикаУчетаНоменклатуры,
		|	ДД.КорВидЗапасов,
		|	НЕОПРЕДЕЛЕНО КАК КорОрганизация,
		|	НЕОПРЕДЕЛЕНО КАК КорПартия,
		|	ДД.КорАналитикаФинансовогоУчета,
		|	ДД.Подразделение,
		|	НЕОПРЕДЕЛЕНО КАК СтатьяРасходовАктивов,
		|	ДД.АналитикаРасходов,
		|	ДД.АналитикаАктивов КАК АналитикаАктивов,
		|	ДД.Регистратор КАК ДокументИсточник
		|ИЗ
        |	ВТКэшРасчетныеОборотыДетализацияПартийТоваровДляНДС КАК ДД
		|ГДЕ
		|	((ДД.Регистратор ССЫЛКА Документ.ВводОстатков
		|			И НЕ ВЫРАЗИТЬ(Регистратор КАК Документ.ВводОстатков).ВводОстатков22)
		|		ИЛИ ДД.Регистратор ССЫЛКА Документ.ВводОстатковТоваров)
		|	И ДД.Организация В (&ОрганизацииСУчетомПартийНДСВерсии22)
		|
		|СГРУППИРОВАТЬ ПО
		|	ДД.ТипЗаписи,
		|	ДД.АналитикаУчетаНоменклатуры.Номенклатура,
        |	ДД.АналитикаУчетаПартий.НалоговоеНазначение,
		|	ДД.Период,
		|	ДД.Регистратор,
		|	ВЫБОР КОГДА ДД.СлужебноеВидДвиженияПриход
		|		 ТОГДА ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|		ИНАЧЕ ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
		|	КОНЕЦ,
		|	ДД.Организация,
		|	ДД.РазделУчета,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.ВидЗапасов,
		|	ДД.Партия,
		|	ДД.АналитикаФинансовогоУчета,
        |	ДД.НалоговоеНазначение,
		|	ДД.АналитикаУчетаПартий,
		|	ДД.ДокументПоступления,
		|	ДД.ХозяйственнаяОперация,
        |	ДД.КорНалоговоеНазначение,
		|	ДД.КорАналитикаУчетаНоменклатуры,
		|	ДД.КорВидЗапасов,
		|	ДД.КорАналитикаФинансовогоУчета,
		|	ДД.Подразделение,
		|	ДД.АналитикаРасходов,
		|	ДД.АналитикаАктивов
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ДД.Организация,
		|	ДД.РазделУчета,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.ВидЗапасов,
		|	ДД.Партия,
		|	ДД.АналитикаФинансовогоУчета,
        |	ДД.НалоговоеНазначение,
		|	ДД.КоличествоОстаток КАК Количество
		|ПОМЕСТИТЬ ОстаткиСебестоимостиТоваров
		|ИЗ
		|	РегистрНакопления.СебестоимостьТоваров.Остатки(&ГраницаКонецПредыдущегоПериода,
		|		Организация В (&ОрганизацииСУчетомПартийНДСВерсии22)) КАК ДД
		|ГДЕ
		|	ДД.КоличествоОстаток > 0
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ВЫБОР КОГДА ЕСТЬNULL(Остатки.Количество, ДД.КоличествоОстаток) < 0
		|		ТОГДА ИСТИНА
		|		ИНАЧЕ ЛОЖЬ
		|	КОНЕЦ КАК Сторно,
		|	ЕСТЬNULL(Остатки.Количество, ДД.КоличествоОстаток) КАК Знаменатель,
		|	ДД.АналитикаУчетаНоменклатуры.Номенклатура 	КАК Номенклатура,
        |	ДД.АналитикаУчетаПартий.НалоговоеНазначение 	КАК НалоговоеНазначениеПартии,
		|	
		| ЕСТЬNULL(ПериодикаПартии.ДатаРегистратора, &КонецПредыдущегоПериода) КАК Период,
		|	(ВЫБОР
		|		КОГДА ДД.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыВПути)
		|			ТОГДА ДД.Партия
		|		КОГДА ОстаткиСебестоимостиТоваров.Партия ЕСТЬ NULL
		|			ТОГДА НЕОПРЕДЕЛЕНО
		|		КОГДА ДД.РазделУчета <> ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НезавершенноеПроизводство)
		|			ТОГДА ДД.Партия
		|		ИНАЧЕ ДД.Партия КОНЕЦ) КАК Регистратор,
		|	ДД.Организация,
		|	ДД.РазделУчета,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.ВидЗапасов,
		|	ДД.Партия,
		|	ДД.АналитикаФинансовогоУчета,
        |	ДД.НалоговоеНазначение,
		|	ДД.АналитикаУчетаПартий,
		|	ДД.ДокументПоступления,
		|
		|	ДД.КоличествоОстаток КАК Количество,
		|	ДД.СтоимостьБезНДСОстаток КАК СтоимостьБезНДС,
		|	ДД.НДСОстаток КАК НДС,
		|	ДД.НДСУпрОстаток КАК НДСУпр
		|ПОМЕСТИТЬ ВТНачальныеОстаткиПартийНДС
		|ИЗ
        |	РегистрНакопления.ДетализацияПартийТоваровДляНДС.Остатки(&ГраницаКонецПредыдущегоПериода,
		|		Организация В (&ОрганизацииСУчетомПартийНДСВерсии22)) КАК ДД
		|
		|	ЛЕВОЕ СОЕДИНЕНИЕ ОстаткиТоваров КАК Остатки
		|		ПО Остатки.Организация = ДД.Организация
		|		И Остатки.РазделУчета = ДД.РазделУчета
		|		И Остатки.АналитикаУчетаНоменклатуры = ДД.АналитикаУчетаНоменклатуры
		|		И Остатки.ВидЗапасов = ДД.ВидЗапасов
		|		И Остатки.Партия = ДД.Партия
		|		И Остатки.АналитикаФинансовогоУчета = ДД.АналитикаФинансовогоУчета
        |		И Остатки.НалоговоеНазначение = ДД.НалоговоеНазначение
		|
		|	ЛЕВОЕ СОЕДИНЕНИЕ ОстаткиСебестоимостиТоваров КАК ОстаткиСебестоимостиТоваров
		|		ПО ОстаткиСебестоимостиТоваров.Организация = ДД.Организация
		|		И ОстаткиСебестоимостиТоваров.РазделУчета = ДД.РазделУчета
		|		И ОстаткиСебестоимостиТоваров.АналитикаУчетаНоменклатуры = ДД.АналитикаУчетаНоменклатуры
		|		И ОстаткиСебестоимостиТоваров.ВидЗапасов = ДД.ВидЗапасов
		|		И ОстаткиСебестоимостиТоваров.Партия = ДД.Партия
		|		И ОстаткиСебестоимостиТоваров.АналитикаФинансовогоУчета = ДД.АналитикаФинансовогоУчета
        |		И ОстаткиСебестоимостиТоваров.НалоговоеНазначение = ДД.НалоговоеНазначение
		|
		|	ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ДанныеПервичныхДокументов КАК ПериодикаПартии
		|		ПО ПериодикаПартии.Организация = ДД.Организация
		|		И ПериодикаПартии.Документ = ДД.Партия
		|";
КонецФункции
	
Функция ТекстДвиженияСебестоимостиНДС() // вт ДвиженияСебестоимостиНДС 	
	Возврат "
		|ВЫБРАТЬ
		|	ВЫБОР
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Партия)
		|		 И ДД.ХозяйственнаяОперация В (
		|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПоступлениеОтПереработчика),
		|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПередачаПродукцииИзПроизводства))
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Перемещение)
		|
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Партия)
		|		 И ДД.ХозяйственнаяОперация <> ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПередачаПродукцииИзПроизводства)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Выпуск)
		|
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Выпуск) И НЕ ДД.СлужебноеВидДвиженияПриход
		|		 И ДД.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Потребление)
		|
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Выпуск) И НЕ ДД.СлужебноеВидДвиженияПриход
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.СписанияНаВыпуск)
		|
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Потребление) И НЕ ДД.СлужебноеВидДвиженияПриход
		|		 И ДД.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукции)
		//++ НЕ УТ
		|		 И НЕ ДД.Регистратор ССЫЛКА Документ.ПоступлениеОтПереработчика
		//-- НЕ УТ
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.СписанияНаВыпуск)
		|
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение) И НЕ ДД.СлужебноеВидДвиженияПриход
		|		 И ДД.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукции)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.СписанияНаВыпуск)
		|
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение) И НЕ ДД.СлужебноеВидДвиженияПриход
		|		 И ДД.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаУПоставщика)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.СписанияНаВыпуск)
		|
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение) И ДД.СлужебноеВидДвиженияПриход
		|		 И ДД.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукции)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Выпуск)
		|
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение) И ДД.СлужебноеВидДвиженияПриход
		|		 И ДД.ХозяйственнаяОперация В (
		|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СписаниеРасходовНаПартииПроизводства),
		|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РаспределениеРасходовНаПартииПроизводства))
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ПеремещениеАвто)
		|
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение) И НЕ ДД.СлужебноеВидДвиженияПриход
		|		 И ДД.ХозяйственнаяОперация В (
		|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПередачаПродукцииИзПроизводства),
		|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СписаниеТоваровПоТребованию))
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Потребление)
		|
		|		ИНАЧЕ ДД.ТипЗаписи
		|	КОНЕЦ КАК ТипЗаписи,
		|	(ВЫБОР
		|		КОГДА ДД.Количество < 0 ТОГДА ИСТИНА
		|		ИНАЧЕ ЛОЖЬ КОНЕЦ) КАК Сторно,
		|	СУММА(ДД.Количество) КАК Знаменатель,
		|	ДД.АналитикаУчетаНоменклатуры.Номенклатура КАК Номенклатура,
		|	
		|	ДД.Период,
		|	ДД.Регистратор,
		|	ВЫБОР КОГДА ДД.СлужебноеВидДвиженияПриход
		|		 ТОГДА ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|		ИНАЧЕ ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
		|	КОНЕЦ КАК ВидДвижения,
		|	ДД.Организация,
		|	ДД.РазделУчета,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.ВидЗапасов,
		|	ДД.Партия,
		|	ДД.АналитикаФинансовогоУчета,
        |	ДД.НалоговоеНазначение,
		|
		|	СУММА(ДД.Количество) КАК Количество,
		|
		|	ДД.ХозяйственнаяОперация,
        |	ДД.КорНалоговоеНазначение КАК КорНалоговоеНазначение,
		|	ДД.КорРазделУчета,
		|	ДД.КорАналитикаУчетаНоменклатуры,
		|	ДД.КорВидЗапасов,
		|	ДД.КорОрганизация,
		|	ДД.КорПартия,
		|	ДД.КорАналитикаФинансовогоУчета,
		|	ДД.Подразделение,
		|	(ВЫБОР
		|		КОГДА ДД.СтатьяРасходовСписания <> ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиРасходов.ПустаяСсылка)
		|		 И ДД.СтатьяРасходовСписания <> НЕОПРЕДЕЛЕНО
		|			ТОГДА ДД.СтатьяРасходовСписания
		|		КОГДА ДД.СтатьяАктивовПассивов <> ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиАктивовПассивов.ПустаяСсылка)
		|			ТОГДА ДД.СтатьяАктивовПассивов
		|		ИНАЧЕ НЕОПРЕДЕЛЕНО КОНЕЦ) КАК СтатьяРасходовАктивов,
		|	ДД.АналитикаРасходов,
		|	ДД.АналитикаАктивовПассивов КАК АналитикаАктивов,
		|	ДД.КорНаправлениеДеятельности,
		|	(ВЫБОР
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Партия)
		|		 И ДД.ХозяйственнаяОперация В (
		|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПоступлениеОтПереработчика),
		|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПередачаПродукцииИзПроизводства))
		|			ТОГДА ДД.Регистратор
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Перемещение)
		|		 И ДД.ДокументИсточник = НЕОПРЕДЕЛЕНО
		|			ТОГДА ДД.Регистратор
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение)
		|		 И ДД.ХозяйственнаяОперация В (
		|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СписаниеРасходовНаПартииПроизводства),
		|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РаспределениеРасходовНаПартииПроизводства))
		|		 И ДД.ДокументИсточник = НЕОПРЕДЕЛЕНО
		|			ТОГДА ДД.Регистратор
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение) И НЕ ДД.СлужебноеВидДвиженияПриход
		|		 И ДД.ХозяйственнаяОперация В (
		|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукции),
		|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукцииНаСклад),
		|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукцииВПодразделение))
		|		 И ДД.ДокументИсточник = НЕОПРЕДЕЛЕНО
		|			ТОГДА ДД.Регистратор
		//++ НЕ УТ
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Потребление) И НЕ ДД.СлужебноеВидДвиженияПриход
		|		 И ДД.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукции)
		|		 И НЕ ДД.Регистратор ССЫЛКА Документ.ПоступлениеОтПереработчика
		|		 И ДД.ДокументИсточник = НЕОПРЕДЕЛЕНО
		|			ТОГДА ДД.Регистратор
		|
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение) И НЕ ДД.СлужебноеВидДвиженияПриход
		|		 И ДД.ХозяйственнаяОперация В (
		|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПередачаПродукцииИзПроизводства),
		|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СписаниеТоваровПоТребованию))
		|			ТОГДА ДД.Регистратор
		//-- НЕ УТ
		|		ИНАЧЕ ДД.ДокументИсточник КОНЕЦ) КАК ДокументИсточник
		|ПОМЕСТИТЬ ДвиженияСебестоимостиНДС
		|ИЗ
		|	ВТКэшРасчетныеОборотыСебестоимостьТоваров КАК ДД
		|	ЛЕВОЕ СОЕДИНЕНИЕ Документ.ПередачаТоваровМеждуОрганизациями КАК Передача
		|		ПО Передача.Ссылка = ДД.Регистратор
		|ГДЕ
		|	ДД.Организация В (&ОрганизацииСУчетомПартийНДСВерсии22)
		|	И ДД.Количество <> 0
        |	И ДД.НалоговоеНазначение <> ЗНАЧЕНИЕ(Справочник.НалоговыеНазначенияАктивовИЗатрат.ПустаяСсылка)
		|	И НЕ ДД.РазделУчета В (
		|		ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПринятыеНаКомиссию),
		|		ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.МатериалыПринятыеВПереработку),
		|		ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПринятыеНаОтветхранение),
		|		ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыНаХраненииСПравомПродажи),
		|		ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыНаХраненииСПравомПродажиПереданныеПартнерам),
		|		ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыНаХраненииСПравомПродажиКОформлениюСписания),
		|		ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НеотфактурованныеПоставки))
		|	И (НЕ ДД.ТипЗаписи В (
		|		ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Партия),
		|		ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ВключениеИсключениеНДСвСтоимости),
		|		ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходы),
		|		ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ВозвратПрошлыхПериодов))
		//++ НЕ УТ
		|	ИЛИ ДД.Регистратор ССЫЛКА Документ.ВыпускПродукции
		|	ИЛИ ДД.Регистратор ССЫЛКА Документ.ПоступлениеОтПереработчика
		|	ИЛИ (ДД.Регистратор ССЫЛКА Документ.ОтчетПереработчика
		|			И ДД.ТипЗаписи <> ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение))
		|	ИЛИ ДД.Регистратор ССЫЛКА Документ.ПроизводствоБезЗаказа
		//-- НЕ УТ
		|	)                              
		|	И НЕ (ДД.Регистратор ССЫЛКА Документ.ПорчаТоваров И ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Перемещение))
		|	И НЕ (ДД.Регистратор ССЫЛКА Документ.ПересортицаТоваров И ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Перемещение))
		|
		|СГРУППИРОВАТЬ ПО
		|	ВЫБОР
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Партия)
		|		 И ДД.ХозяйственнаяОперация В (
		|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПоступлениеОтПереработчика),
		|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПередачаПродукцииИзПроизводства))
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Перемещение)
		|
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Партия)
		|		 И ДД.ХозяйственнаяОперация <> ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПередачаПродукцииИзПроизводства)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Выпуск)
		|
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Выпуск) И НЕ ДД.СлужебноеВидДвиженияПриход
		|		 И ДД.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Потребление)
		|
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Выпуск) И НЕ ДД.СлужебноеВидДвиженияПриход
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.СписанияНаВыпуск)
		|
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Потребление) И НЕ ДД.СлужебноеВидДвиженияПриход
		|		 И ДД.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукции)
		//++ НЕ УТ
		|		 И НЕ ДД.Регистратор ССЫЛКА Документ.ПоступлениеОтПереработчика
		//-- НЕ УТ
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.СписанияНаВыпуск)
		|
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение) И НЕ ДД.СлужебноеВидДвиженияПриход
		|		 И ДД.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукции)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.СписанияНаВыпуск)
		|
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение) И НЕ ДД.СлужебноеВидДвиженияПриход
		|		 И ДД.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаУПоставщика)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.СписанияНаВыпуск)
		|
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение) И ДД.СлужебноеВидДвиженияПриход
		|		 И ДД.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукции)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Выпуск)
		|
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение) И ДД.СлужебноеВидДвиженияПриход
		|		 И ДД.ХозяйственнаяОперация В (
		|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СписаниеРасходовНаПартииПроизводства),
		|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РаспределениеРасходовНаПартииПроизводства))
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ПеремещениеАвто)
		|
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение) И НЕ ДД.СлужебноеВидДвиженияПриход
		|		 И ДД.ХозяйственнаяОперация В (
		|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПередачаПродукцииИзПроизводства),
		|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СписаниеТоваровПоТребованию))
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Потребление)
		|
		|		ИНАЧЕ ДД.ТипЗаписи
		|	КОНЕЦ, // ТипЗаписи
		|	(ВЫБОР
		|		КОГДА ДД.Количество < 0 ТОГДА ИСТИНА
		|		ИНАЧЕ ЛОЖЬ КОНЕЦ), // Сторно
		|	ДД.АналитикаУчетаНоменклатуры.Номенклатура,
		|	
		|	ДД.Период,
		|	ДД.Регистратор,
		|	ВЫБОР КОГДА ДД.СлужебноеВидДвиженияПриход
		|		 ТОГДА ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|		ИНАЧЕ ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
		|	КОНЕЦ, // ВидДвижения,
		|	ДД.Организация,
		|	ДД.РазделУчета,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.ВидЗапасов,
		|	ДД.Партия,
		|	ДД.АналитикаФинансовогоУчета,
        |	ДД.НалоговоеНазначение,
		|
		|	ДД.ХозяйственнаяОперация,
        |	ДД.КорНалоговоеНазначение, // КорНалоговоеНазначение
		|	ДД.КорРазделУчета,
		|	ДД.КорАналитикаУчетаНоменклатуры,
		|	ДД.КорВидЗапасов,
		|	ДД.КорОрганизация,
		|	ДД.КорПартия,
		|	ДД.КорАналитикаФинансовогоУчета,
		|	ДД.Подразделение,
		|	(ВЫБОР
		|		КОГДА ДД.СтатьяРасходовСписания <> ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиРасходов.ПустаяСсылка)
		|		 И ДД.СтатьяРасходовСписания <> НЕОПРЕДЕЛЕНО
		|			ТОГДА ДД.СтатьяРасходовСписания
		|		КОГДА ДД.СтатьяАктивовПассивов <> ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиАктивовПассивов.ПустаяСсылка)
		|			ТОГДА ДД.СтатьяАктивовПассивов
		|		ИНАЧЕ НЕОПРЕДЕЛЕНО КОНЕЦ), // СтатьяРасходовАктивов
		|	ДД.АналитикаРасходов,
		|	ДД.АналитикаАктивовПассивов,
		|	ДД.КорНаправлениеДеятельности,
		|	(ВЫБОР
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Партия)
		|		 И ДД.ХозяйственнаяОперация В (
		|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПоступлениеОтПереработчика),
		|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПередачаПродукцииИзПроизводства))
		|			ТОГДА ДД.Регистратор
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Перемещение)
		|		 И ДД.ДокументИсточник = НЕОПРЕДЕЛЕНО
		|			ТОГДА ДД.Регистратор
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение)
		|		 И ДД.ХозяйственнаяОперация В (
		|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СписаниеРасходовНаПартииПроизводства),
		|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РаспределениеРасходовНаПартииПроизводства))
		|		 И ДД.ДокументИсточник = НЕОПРЕДЕЛЕНО
		|			ТОГДА ДД.Регистратор
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение) И НЕ ДД.СлужебноеВидДвиженияПриход
		|		 И ДД.ХозяйственнаяОперация В (
		|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукции),
		|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукцииНаСклад),
		|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукцииВПодразделение))
		|		 И ДД.ДокументИсточник = НЕОПРЕДЕЛЕНО
		|			ТОГДА ДД.Регистратор
		//++ НЕ УТ
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Потребление) И НЕ ДД.СлужебноеВидДвиженияПриход
		|		 И ДД.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукции)
		|		 И НЕ ДД.Регистратор ССЫЛКА Документ.ПоступлениеОтПереработчика
		|		 И ДД.ДокументИсточник = НЕОПРЕДЕЛЕНО
		|			ТОГДА ДД.Регистратор
		|
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение) И НЕ ДД.СлужебноеВидДвиженияПриход
		|		 И ДД.ХозяйственнаяОперация В (
		|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПередачаПродукцииИзПроизводства),
		|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СписаниеТоваровПоТребованию))
		|			ТОГДА ДД.Регистратор
		//-- НЕ УТ
		|		ИНАЧЕ ДД.ДокументИсточник КОНЕЦ) // ДокументИсточник
		|
		|ИНДЕКСИРОВАТЬ ПО
		|	Регистратор
		|";
КонецФункции

// ... выборки данных

Функция ТекстДетальныеНачальныеОстаткиПартийНДС() // использует ОстаткиТоваров, ОстаткиСебестоимостиТоваров
	Возврат
		"ВЫБРАТЬ
		|	""ТекстДетальныеНачальныеОстаткиПартийНДС"" 	 КАК ЗапросИсточник,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Остаток) КАК ТипЗаписи,
		|	ВЫБОР
		|		КОГДА ДД.Знаменатель < 0 ТОГДА ИСТИНА
		|		ИНАЧЕ ЛОЖЬ
		|	КОНЕЦ КАК Сторно,
		|	0 КАК Приоритет,
		|	ДД.Знаменатель,
		|	0 КАК ЗнаменательДляИсточников,
		|	ИСТИНА КАК РасчетЗавершен,
		|	ДД.Номенклатура,
        |	ДД.НалоговоеНазначениеПартии,
		|	
		|	ДД.Период,
		|	ДД.Регистратор,
		|	НЕОПРЕДЕЛЕНО КАК ВидДвижения,
		|	ДД.Организация,
		|	ДД.РазделУчета,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.ВидЗапасов,
		|	ДД.Партия,
		|	ДД.АналитикаФинансовогоУчета,
        |	ДД.НалоговоеНазначение,
		|	ДД.АналитикаУчетаПартий,
		|	ДД.ДокументПоступления,
		|
		|	ДД.Количество,
		|	ДД.СтоимостьБезНДС,
		|	ДД.НДС,
		|	ДД.НДСУпр,
		|
		|	ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПустаяСсылка) КАК ХозяйственнаяОперация,
        |	ЗНАЧЕНИЕ(Справочник.НалоговыеНазначенияАктивовИЗатрат.ПустаяСсылка) КАК КорНалоговоеНазначение,
		|	НЕОПРЕДЕЛЕНО КАК КорРазделУчета,
		|	ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаНоменклатуры.ПустаяСсылка) КАК КорАналитикаУчетаНоменклатуры,
		|	ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка) КАК КорВидЗапасов,
		|	ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка) КАК КорОрганизация,
		|	НЕОПРЕДЕЛЕНО КАК КорПартия,
		|	НЕОПРЕДЕЛЕНО КАК КорАналитикаФинансовогоУчета,
		|	НЕОПРЕДЕЛЕНО КАК Подразделение,
		|	ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиРасходов.ПустаяСсылка) КАК СтатьяРасходовАктивов,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаРасходов,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаАктивов,
		|	НЕОПРЕДЕЛЕНО КАК ДокументИсточник,
		|	НЕОПРЕДЕЛЕНО КАК СтатьяСписанияНДС,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаСписанияНДС,
		|	НЕОПРЕДЕЛЕНО КАК КорНаправлениеДеятельности
		|ИЗ
		|	ВТНачальныеОстаткиПартийНДС КАК ДД
		|";
КонецФункции

Функция ТекстНачальныеОстаткиПартийНДС() // использует ОстаткиТоваров, ОстаткиСебестоимостиТоваров
	Возврат
		"ВЫБРАТЬ
		|	""ТекстНачальныеОстаткиПартийНДС"" КАК ЗапросИсточник,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ОстатокСгруппированный) КАК ТипЗаписи,
		|	ВЫБОР
		|		КОГДА МАКСИМУМ(ДД.Знаменатель) < 0 ТОГДА ИСТИНА
		|		ИНАЧЕ ЛОЖЬ
		|	КОНЕЦ КАК Сторно,
		|	0 КАК Приоритет,
		|	МАКСИМУМ(ДД.Знаменатель),
		|	СУММА(ДД.Знаменатель) КАК ЗнаменательДляИсточников,
		|	ЛОЖЬ КАК РасчетЗавершен,
		|	ДД.Номенклатура,
        |	НЕОПРЕДЕЛЕНО КАК НалоговоеНазначениеПартии,
		|	
		|	ВЫБОР КОГДА СУММА(ДД.Знаменатель) < 0 ТОГДА &КонецПериода ИНАЧЕ ДД.Период КОНЕЦ КАК Период,
		|	ДД.Регистратор,
		|	НЕОПРЕДЕЛЕНО КАК ВидДвижения,
		|	ДД.Организация,
		|	ДД.РазделУчета,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.ВидЗапасов,
		|	ДД.Партия КАК Партия,
		|	ДД.АналитикаФинансовогоУчета,
        |	ДД.НалоговоеНазначение,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаУчетаПартий,
		|	НЕОПРЕДЕЛЕНО КАК ДокументПоступления,
		|
		|	0,
		|	0,
		|	0,
		|	0,
		|
		|	ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПустаяСсылка) КАК ХозяйственнаяОперация,
        |	ЗНАЧЕНИЕ(Справочник.НалоговыеНазначенияАктивовИЗатрат.ПустаяСсылка) КАК КорНалоговоеНазначение,
		|	НЕОПРЕДЕЛЕНО КАК КорРазделУчета,
		|	ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаНоменклатуры.ПустаяСсылка) КАК КорАналитикаУчетаНоменклатуры,
		|	ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка) КАК КорВидЗапасов,
		|	ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка) КАК КорОрганизация,
		|	НЕОПРЕДЕЛЕНО КАК КорПартия,
		|	НЕОПРЕДЕЛЕНО КАК КорАналитикаФинансовогоУчета,
		|	НЕОПРЕДЕЛЕНО КАК Подразделение,
		|	ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиРасходов.ПустаяСсылка) КАК СтатьяРасходовАктивов,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаРасходов,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаАктивов,
		|	НЕОПРЕДЕЛЕНО КАК ДокументИсточник,
		|	НЕОПРЕДЕЛЕНО КАК СтатьяСписанияНДС,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаСписанияНДС,
		|	НЕОПРЕДЕЛЕНО КАК КорНаправлениеДеятельности
		|ИЗ
		|	ВТНачальныеОстаткиПартийНДС КАК ДД
		|СГРУППИРОВАТЬ ПО
		|	ДД.Сторно,
		|	ДД.Номенклатура,
		|	ДД.Период,
		|	ДД.Регистратор,
		|	ДД.Организация,
		|	ДД.РазделУчета,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.ВидЗапасов,     
		|	ДД.Партия,
		|	ДД.АналитикаФинансовогоУчета,
        |	ДД.НалоговоеНазначение
		|";
КонецФункции


Функция ТекстНачальныеОстаткиПартийДляДопРасходов() // использует ВТНачальныеОстаткиПартийНДС
	Возврат
		"ВЫБРАТЬ
		|	""ТекстНачальныеОстаткиПартийДляДопРасходов"" КАК ЗапросИсточник,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ОстатокДляРаспределения) КАК ТипЗаписи,
		|	ВЫБОР
		|		КОГДА МАКСИМУМ(ДД.Знаменатель) < 0 ТОГДА ИСТИНА
		|		ИНАЧЕ ЛОЖЬ
        |	КОНЕЦ КАК Сторно,
		|	0 КАК Приоритет,
		|	МАКСИМУМ(ДД.Знаменатель),
		|	СУММА(ДД.Знаменатель) КАК ЗнаменательДляИсточников,
		|	ЛОЖЬ КАК РасчетЗавершен,
		|	ДД.Номенклатура,
        |	НЕОПРЕДЕЛЕНО КАК НалоговоеНазначениеПартии,
		|	
		|	ДД.Период,
		|	НЕОПРЕДЕЛЕНО КАК Регистратор,
		|	НЕОПРЕДЕЛЕНО КАК ВидДвижения,
		|	ДД.Организация,
		|	ДД.РазделУчета,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.ВидЗапасов,
		|	ДД.Партия,
		|	ДД.АналитикаФинансовогоУчета,
        |	ДД.НалоговоеНазначение,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаУчетаПартий,
		|	НЕОПРЕДЕЛЕНО КАК ДокументПоступления,
		|
		|	0 КАК Количество,
		|	0 КАК СтоимостьБезНДС,
		|	0 КАК НДС,
		|	0 КАК НДСУпр,
		|
		|	ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПустаяСсылка) КАК ХозяйственнаяОперация,
        |	ЗНАЧЕНИЕ(Справочник.НалоговыеНазначенияАктивовИЗатрат.ПустаяСсылка) КАК КорНалоговоеНазначение,
		|	НЕОПРЕДЕЛЕНО КАК КорРазделУчета,
		|	ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаНоменклатуры.ПустаяСсылка) КАК КорАналитикаУчетаНоменклатуры,
		|	ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка) КАК КорВидЗапасов,
		|	ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка) КАК КорОрганизация,
		|	НЕОПРЕДЕЛЕНО КАК КорПартия,
		|	НЕОПРЕДЕЛЕНО КАК КорАналитикаФинансовогоУчета,
		|	НЕОПРЕДЕЛЕНО КАК Подразделение,
		|	ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиРасходов.ПустаяСсылка) КАК СтатьяРасходовАктивов,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаРасходов,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаАктивов,
		|	НЕОПРЕДЕЛЕНО КАК ДокументИсточник,
		|	НЕОПРЕДЕЛЕНО КАК СтатьяСписанияНДС,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаСписанияНДС,
		|	НЕОПРЕДЕЛЕНО КАК КорНаправлениеДеятельности
		|ИЗ
		|	ВТНачальныеОстаткиПартийНДС КАК ДД
		|ГДЕ
		|	ДД.Количество <> 0
		|СГРУППИРОВАТЬ ПО
		|	ДД.Номенклатура,
		|	ДД.Период,
		|	ДД.Организация,
		|	ДД.РазделУчета,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.ВидЗапасов,
		|	ДД.Партия,
		|	ДД.АналитикаФинансовогоУчета,
        |	ДД.НалоговоеНазначение
		|";
КонецФункции

Функция ТекстДетальныеПриходыСебестоимостиТоваров() // использует ПриходыТоваровНДС
	Возврат
		"ВЫБРАТЬ
		|	""ТекстДетальныеПриходыСебестоимостиТоваров"" КАК ЗапросИсточник,
		|	(ВЫБОР
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходы)
		|		 И ДД.Партия = НЕОПРЕДЕЛЕНО
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыБезПартии)
		|		ИНАЧЕ ДД.ТипЗаписи КОНЕЦ) КАК ТипЗаписи,
		|	(ВЫБОР
		|		КОГДА НЕ Приходы.Количество ЕСТЬ NULL И Приходы.Количество < 0 ТОГДА ИСТИНА
		|		КОГДА НЕ Остатки.Количество ЕСТЬ NULL И Остатки.Количество < 0 ТОГДА ИСТИНА
		|		КОГДА НЕ ОстаткиСебестоимостиТоваров.Количество ЕСТЬ NULL И ОстаткиСебестоимостиТоваров.Количество < 0
		|			ТОГДА ИСТИНА
		|		КОГДА ДД.Количество < 0 ТОГДА ИСТИНА
        |		ИНАЧЕ ЛОЖЬ КОНЕЦ) КАК Сторно,
		|	0 КАК Приоритет,
		|	(ВЫБОР
		|		КОГДА НЕ Приходы.Количество ЕСТЬ NULL ТОГДА Приходы.Количество
		|		КОГДА НЕ Остатки.Количество ЕСТЬ NULL ТОГДА Остатки.Количество
		|		КОГДА НЕ ОстаткиСебестоимостиТоваров.Количество ЕСТЬ NULL ТОГДА ОстаткиСебестоимостиТоваров.Количество
		|		ИНАЧЕ ДД.Количество КОНЕЦ) КАК Знаменатель,
		|	0 КАК ЗнаменательДляИсточников,
		|	ИСТИНА КАК РасчетЗавершен,
		|	ДД.Номенклатура,
        |	ДД.НалоговоеНазначениеПартии,
		|	
		|	ДД.Период,
		|	ДД.Регистратор,
		|	ДД.ВидДвижения,
		|	ДД.Организация,
		|	ДД.РазделУчета,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.ВидЗапасов,
		|	ДД.Партия,
		|	ДД.АналитикаФинансовогоУчета,
        |	ДД.НалоговоеНазначение,
		|
		|	ДД.АналитикаУчетаПартий,
		|	ДД.ДокументПоступления,
		|
		|	ДД.Количество,
		|	ДД.СтоимостьБезНДС,
		|	ДД.НДС,
		|	ДД.НДСУпр,
		|
		|	ДД.ХозяйственнаяОперация,
        |	ДД.КорНалоговоеНазначение,
		|	ДД.КорРазделУчета,
		|	ДД.КорАналитикаУчетаНоменклатуры,
		|	ДД.КорВидЗапасов,
		|	ДД.КорОрганизация,
		|	ДД.КорПартия,
		|	ДД.КорАналитикаФинансовогоУчета,
		|	ДД.Подразделение,
		|	ДД.СтатьяРасходовАктивов,
		|	ДД.АналитикаРасходов,
		|	ДД.АналитикаАктивов,
		|	ДД.ДокументИсточник,
		|	НЕОПРЕДЕЛЕНО КАК СтатьяСписанияНДС,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаСписанияНДС,
		|	НЕОПРЕДЕЛЕНО КАК КорНаправлениеДеятельности
		|ИЗ
		|	ПриходыТоваровНДС КАК ДД
		|	ЛЕВОЕ СОЕДИНЕНИЕ ОстаткиТоваров КАК Остатки
		|		ПО ДД.ТипЗаписи В (
		|			ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Партия),
		|			ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаСтоимости),
		|			ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходы),
		|			ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыБезПартии),
		|			ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыСПартией),
		|			ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ОтклонениеВСтоимости))
		|		И ДД.Количество = 0
		|		И Остатки.Организация = ДД.Организация
		|		И Остатки.РазделУчета = ДД.РазделУчета
		|		И Остатки.АналитикаУчетаНоменклатуры = ДД.АналитикаУчетаНоменклатуры
		|		И Остатки.ВидЗапасов = ДД.ВидЗапасов
		|		И Остатки.Партия = ДД.Партия
		|		И Остатки.АналитикаФинансовогоУчета = ДД.АналитикаФинансовогоУчета
        |		И Остатки.НалоговоеНазначение = ДД.НалоговоеНазначение
		|	ЛЕВОЕ СОЕДИНЕНИЕ ОстаткиСебестоимостиТоваров КАК ОстаткиСебестоимостиТоваров
		|		ПО ОстаткиСебестоимостиТоваров.Организация = ДД.Организация
		|		И ОстаткиСебестоимостиТоваров.РазделУчета = ДД.РазделУчета
		|		И ОстаткиСебестоимостиТоваров.АналитикаУчетаНоменклатуры = ДД.АналитикаУчетаНоменклатуры
		|		И ОстаткиСебестоимостиТоваров.ВидЗапасов = ДД.ВидЗапасов
		|		И ОстаткиСебестоимостиТоваров.Партия = ДД.Партия
		|		И ОстаткиСебестоимостиТоваров.АналитикаФинансовогоУчета = ДД.АналитикаФинансовогоУчета
        |		И ОстаткиСебестоимостиТоваров.НалоговоеНазначение = ДД.НалоговоеНазначение
		|	ЛЕВОЕ СОЕДИНЕНИЕ ПриходыТоваров КАК Приходы
		|		ПО ДД.ТипЗаписи В (
		|			ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Партия),
		|			ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаСтоимости),
		|			ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходы),
		|			ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыБезПартии),
		|			ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыСПартией),
		|			ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ОтклонениеВСтоимости))
		|		И ДД.Количество = 0
		|		И Приходы.Организация = ДД.Организация
		|		И Приходы.РазделУчета = ДД.РазделУчета
		|		И Приходы.АналитикаУчетаНоменклатуры = ДД.АналитикаУчетаНоменклатуры
		|		И Приходы.ВидЗапасов = ДД.ВидЗапасов
		|		И Приходы.Партия = ДД.Партия
		|		И Приходы.АналитикаФинансовогоУчета = ДД.АналитикаФинансовогоУчета
        |		И Приходы.НалоговоеНазначение = ДД.НалоговоеНазначение
		|ГДЕ
        |	(ДД.Количество <> 0
        |		ИЛИ ДД.СтоимостьБезНДС <> 0
        |		ИЛИ ДД.НДС <> 0
        |		ИЛИ ДД.НДСУпр <> 0)
		|";
КонецФункции


Функция ТекстПриходыСебестоимостиТоваров() // использует ПриходыТоваровНДС
	Возврат
		"ВЫБРАТЬ
		|	""ТекстПриходыСебестоимостиТоваров"" КАК ЗапросИсточник,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ПартияСгруппированная) КАК ТипЗаписи,
		|	МАКСИМУМ(ВЫБОР
		|		КОГДА НЕ Приходы.Количество ЕСТЬ NULL И Приходы.Количество < 0 ТОГДА ИСТИНА
		|		КОГДА НЕ Остатки.Количество ЕСТЬ NULL И Остатки.Количество < 0 ТОГДА ИСТИНА
		|		КОГДА НЕ ОстаткиСебестоимостиТоваров.Количество ЕСТЬ NULL И ОстаткиСебестоимостиТоваров.Количество < 0
		|			ТОГДА ИСТИНА
		|		КОГДА ДД.Количество < 0 ТОГДА ИСТИНА
		|		ИНАЧЕ ЛОЖЬ КОНЕЦ) КАК Сторно,
		|	0 КАК Приоритет,
		|	МАКСИМУМ(ВЫБОР
		|		КОГДА НЕ Приходы.Количество ЕСТЬ NULL ТОГДА Приходы.Количество
		|		КОГДА НЕ Остатки.Количество ЕСТЬ NULL ТОГДА Остатки.Количество
		|		КОГДА НЕ ОстаткиСебестоимостиТоваров.Количество ЕСТЬ NULL ТОГДА ОстаткиСебестоимостиТоваров.Количество
		|		ИНАЧЕ ДД.Количество КОНЕЦ) КАК Знаменатель,
		|	0 КАК ЗнаменательДляИсточников,
		|	ЛОЖЬ КАК РасчетЗавершен,
		|	ДД.Номенклатура,
		|	НЕОПРЕДЕЛЕНО КАК НалоговоеНазначениеПартии,
		|	
		|	ЕСТЬNULL(ПериодикаПартии.ДатаРегистратора, &КонецПредыдущегоПериода) КАК Период,
		|	ДД.Партия КАК Регистратор,
		|	ДД.ВидДвижения,
		|	ДД.Организация,
		|	ДД.РазделУчета,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.ВидЗапасов,
		|	ДД.Партия,
		|	ДД.АналитикаФинансовогоУчета,
        |	ДД.НалоговоеНазначение,
		|
		|	НЕОПРЕДЕЛЕНО КАК АналитикаУчетаПартий,
		|	НЕОПРЕДЕЛЕНО КАК ДокументПоступления,
		|
		|	0 КАК Количество,
		|	0 КАК СтоимостьБезНДС,
		|	0 КАК НДС,
		|	0 КАК НДСУпр,
		|
		|	НЕОПРЕДЕЛЕНО КАК ХозяйственнаяОперация,
        |	НЕОПРЕДЕЛЕНО КАК КорНалоговоеНазначение,
		|	НЕОПРЕДЕЛЕНО КАК КорРазделУчета,
		|	НЕОПРЕДЕЛЕНО КАК КорАналитикаУчетаНоменклатуры,
		|	НЕОПРЕДЕЛЕНО КАК КорВидЗапасов,
		|	НЕОПРЕДЕЛЕНО КАК КорОрганизация,
		|	НЕОПРЕДЕЛЕНО КАК КорПартия,
		|	НЕОПРЕДЕЛЕНО КАК КорАналитикаФинансовогоУчета,
		|	НЕОПРЕДЕЛЕНО КАК Подразделение,
		|	НЕОПРЕДЕЛЕНО КАК СтатьяРасходовАктивов,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаРасходов,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаАктивов,
		|	НЕОПРЕДЕЛЕНО КАК ДокументИсточник,
		|	НЕОПРЕДЕЛЕНО КАК СтатьяСписанияНДС,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаСписанияНДС,
		|	НЕОПРЕДЕЛЕНО КАК КорНаправлениеДеятельности
		|ИЗ
		|	ПриходыТоваровНДС КАК ДД
		|	ЛЕВОЕ СОЕДИНЕНИЕ ОстаткиТоваров КАК Остатки
		|		ПО ДД.ТипЗаписи В (
		|			ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Партия),
		|			ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаСтоимости),
		|			ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходы),
		|			ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыБезПартии),
		|			ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыСПартией),
		|			ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ОтклонениеВСтоимости))
		|		И ДД.Количество = 0
		|		И Остатки.Организация = ДД.Организация
		|		И Остатки.РазделУчета = ДД.РазделУчета
		|		И Остатки.АналитикаУчетаНоменклатуры = ДД.АналитикаУчетаНоменклатуры
		|		И Остатки.ВидЗапасов = ДД.ВидЗапасов
		|		И Остатки.Партия = ДД.Партия
		|		И Остатки.АналитикаФинансовогоУчета = ДД.АналитикаФинансовогоУчета
        |		И Остатки.НалоговоеНазначение = ДД.НалоговоеНазначение
		|	ЛЕВОЕ СОЕДИНЕНИЕ ОстаткиСебестоимостиТоваров КАК ОстаткиСебестоимостиТоваров
		|		ПО ОстаткиСебестоимостиТоваров.Организация = ДД.Организация
		|		И ОстаткиСебестоимостиТоваров.РазделУчета = ДД.РазделУчета
		|		И ОстаткиСебестоимостиТоваров.АналитикаУчетаНоменклатуры = ДД.АналитикаУчетаНоменклатуры
		|		И ОстаткиСебестоимостиТоваров.ВидЗапасов = ДД.ВидЗапасов
		|		И ОстаткиСебестоимостиТоваров.Партия = ДД.Партия
		|		И ОстаткиСебестоимостиТоваров.АналитикаФинансовогоУчета = ДД.АналитикаФинансовогоУчета
        |		И ОстаткиСебестоимостиТоваров.НалоговоеНазначение = ДД.НалоговоеНазначение
		|	ЛЕВОЕ СОЕДИНЕНИЕ ПриходыТоваров КАК Приходы
		|		ПО ДД.ТипЗаписи В (
		|			ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Партия),
		|			ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаСтоимости),
		|			ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходы),
		|			ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыБезПартии),
		|			ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыСПартией),
		|			ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ОтклонениеВСтоимости))
		|		И ДД.Количество = 0
		|		И Приходы.Организация = ДД.Организация
		|		И Приходы.РазделУчета = ДД.РазделУчета
		|		И Приходы.АналитикаУчетаНоменклатуры = ДД.АналитикаУчетаНоменклатуры
		|		И Приходы.ВидЗапасов = ДД.ВидЗапасов
		|		И Приходы.Партия = ДД.Партия
		|		И Приходы.АналитикаФинансовогоУчета = ДД.АналитикаФинансовогоУчета
        |		И Приходы.НалоговоеНазначение = ДД.НалоговоеНазначение
        
		|	ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ДанныеПервичныхДокументов КАК ПериодикаПартии
		|		ПО ПериодикаПартии.Организация = ДД.Организация
		|		И ПериодикаПартии.Документ = ДД.Партия
        |
		|ГДЕ
        |	(ДД.Количество <> 0
        |		ИЛИ ДД.СтоимостьБезНДС <> 0
        |		ИЛИ ДД.НДС <> 0
        |		ИЛИ ДД.НДСУпр <> 0)
        |
		|СГРУППИРОВАТЬ ПО
		|	ДД.Номенклатура,
		|	ЕСТЬNULL(ПериодикаПартии.ДатаРегистратора, &КонецПредыдущегоПериода),
		|	ДД.ВидДвижения,
		|	ДД.Организация,
		|	ДД.РазделУчета,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.ВидЗапасов,
		|	ДД.Партия,
		|	ДД.АналитикаФинансовогоУчета,
        |	ДД.НалоговоеНазначение
		|";
КонецФункции

Функция ТекстДвиженияСебестоимостиТоваров()
	Возврат
		"ВЫБРАТЬ
		|	""ТекстДвиженияСебестоимостиТоваров"" КАК ЗапросИсточник,
		|	ДД.ТипЗаписи,
		|	(ВЫБОР
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.СписанияНаВыпуск)
		|		 И Выпуски.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Выпуск)
		|			ТОГДА ЛОЖЬ
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Потребление)
		|		 И Выпуски.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Выпуск)
		|			ТОГДА ЛОЖЬ
		|			ИНАЧЕ ДД.Сторно
		|		КОНЕЦ) КАК Сторно,
		|	0 КАК Приоритет,
		|	СУММА(ДД.Знаменатель) КАК Знаменатель,
		|	СУММА(ВЫБОР
		|			КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.СписанияНаВыпуск)
		|			 И Выпуски.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Выпуск)
		|				ТОГДА Выпуски.Знаменатель
		|			КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Потребление)
		|			 И Выпуски.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Выпуск)
		|				ТОГДА Выпуски.Знаменатель
		|			КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.СписанияНаВыпуск)
		|			 И РаботыДляДавальца.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Выпуск)
		|				ТОГДА РаботыДляДавальца.Знаменатель
		|			КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Потребление)
		|			 И РаботыДляДавальца.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Выпуск)
		|				ТОГДА РаботыДляДавальца.Знаменатель
		|			ИНАЧЕ 0
		|		КОНЕЦ) КАК ЗнаменательДляИсточников,
		|	ЛОЖЬ КАК РасчетЗавершен,
		|	ДД.Номенклатура,
        |	НЕОПРЕДЕЛЕНО КАК НалоговоеНазначениеПартии,
		|	ДД.Период,
		|	ДД.Регистратор,
		|	ДД.ВидДвижения,
		|	ДД.Организация,
		|	ДД.РазделУчета,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.ВидЗапасов,
		|	(ВЫБОР
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Выпуск)
		|		 И ДД.Партия = НЕОПРЕДЕЛЕНО
		|			ТОГДА ДД.Регистратор
		|		КОГДА ДД.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыВПути)
		|		 И ДД.Партия = НЕОПРЕДЕЛЕНО
		|			ТОГДА ДД.Регистратор
		|		ИНАЧЕ ДД.Партия КОНЕЦ) КАК Партия,
		|	ДД.АналитикаФинансовогоУчета,
        |	ДД.НалоговоеНазначение,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаУчетаПартий,
		|	НЕОПРЕДЕЛЕНО КАК ДокументПоступления,
		|	СУММА(ДД.Количество) КАК Количество,
		|	0 КАК СтоимостьБезНДС,
		|	0 КАК НДС,
		|	0 КАК НДСУпр,
		|	ДД.ХозяйственнаяОперация,
		|	(ВЫБОР
		|		КОГДА РаботыДляДавальца.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты)
		|		 И РаботыДляДавальца.КорАналитикаУчетаНоменклатуры <> ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаНоменклатуры.ПустаяСсылка)
        |			ТОГДА РаботыДляДавальца.НалоговоеНазначение
        |		ИНАЧЕ ДД.КорНалоговоеНазначение КОНЕЦ) КАК КорНалоговоеНазначение,
		|	(ВЫБОР
		|		КОГДА РаботыДляДавальца.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты)
		|		 И РаботыДляДавальца.КорАналитикаУчетаНоменклатуры <> ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаНоменклатуры.ПустаяСсылка)
		|			ТОГДА РаботыДляДавальца.РазделУчета
		|		ИНАЧЕ ДД.КорРазделУчета КОНЕЦ) КАК КорРазделУчета,
		|	(ВЫБОР
		|		КОГДА РаботыДляДавальца.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты)
		|		 И РаботыДляДавальца.КорАналитикаУчетаНоменклатуры <> ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаНоменклатуры.ПустаяСсылка)
		|			ТОГДА РаботыДляДавальца.АналитикаУчетаНоменклатуры
		|		ИНАЧЕ ДД.КорАналитикаУчетаНоменклатуры КОНЕЦ) КАК КорАналитикаУчетаНоменклатуры,
		|	(ВЫБОР
		|		КОГДА РаботыДляДавальца.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты)
		|		 И РаботыДляДавальца.КорАналитикаУчетаНоменклатуры <> ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаНоменклатуры.ПустаяСсылка)
		|			ТОГДА РаботыДляДавальца.ВидЗапасов
		|		ИНАЧЕ ДД.КорВидЗапасов КОНЕЦ) КАК КорВидЗапасов,
		|	ДД.КорОрганизация,
		|	(ВЫБОР
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.СписанияНаВыпуск)
		|		 И ДД.КорПартия = НЕОПРЕДЕЛЕНО
		|			ТОГДА ДД.Регистратор
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Потребление)
		|		 И ДД.КорПартия = НЕОПРЕДЕЛЕНО
		|		 И Выпуски.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Выпуск)
		|			ТОГДА ДД.Регистратор
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Потребление)
		|		 И ДД.КорПартия = НЕОПРЕДЕЛЕНО
		|		 И ДД.Регистратор ССЫЛКА Документ.СборкаТоваров
		|			ТОГДА ДД.Регистратор
		|		КОГДА ДД.КорРазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыВПути)
		|		 И ДД.КорПартия = НЕОПРЕДЕЛЕНО
		|			ТОГДА ДД.Регистратор
		|		ИНАЧЕ ДД.КорПартия КОНЕЦ) КАК КорПартия,
		|	(ВЫБОР
		|		КОГДА РаботыДляДавальца.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты)
		|		 И РаботыДляДавальца.КорАналитикаУчетаНоменклатуры <> ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаНоменклатуры.ПустаяСсылка)
		|			ТОГДА РаботыДляДавальца.АналитикаФинансовогоУчета
		|		ИНАЧЕ ДД.КорАналитикаФинансовогоУчета КОНЕЦ) КАК КорАналитикаФинансовогоУчета,
		|	ДД.Подразделение,
		|	ДД.СтатьяРасходовАктивов,
		|	ДД.АналитикаРасходов,
		|	ДД.АналитикаАктивов,
		|	ДД.ДокументИсточник,
		|	НЕОПРЕДЕЛЕНО КАК СтатьяСписанияНДС,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаСписанияНДС,
		|	ДД.КорНаправлениеДеятельности
		|ИЗ
		|	ДвиженияСебестоимостиНДС КАК ДД
		|		ЛЕВОЕ СОЕДИНЕНИЕ ДвиженияСебестоимостиНДС КАК Выпуски
		|		ПО ДД.Регистратор = Выпуски.Регистратор
		|			И ДД.КорПартия = Выпуски.Партия
		|			И ДД.КорАналитикаУчетаНоменклатуры = Выпуски.АналитикаУчетаНоменклатуры
		|			И ДД.КорРазделУчета = Выпуски.РазделУчета
		|			И ДД.КорВидЗапасов = Выпуски.ВидЗапасов
		|			И ДД.КорАналитикаФинансовогоУчета = Выпуски.АналитикаФинансовогоУчета
        |			И ДД.КорНалоговоеНазначение = Выпуски.НалоговоеНазначение
		|			И (ДД.ТипЗаписи В (
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Потребление),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.СписанияНаВыпуск)))
		|			И (Выпуски.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Выпуск))
		|
		|		ЛЕВОЕ СОЕДИНЕНИЕ ДвиженияСебестоимостиНДС КАК РаботыДляДавальца
		|		ПО ДД.Регистратор = РаботыДляДавальца.Регистратор
		|			И ДД.КорПартия = РаботыДляДавальца.Партия
		|			И ДД.КорАналитикаУчетаНоменклатуры = РаботыДляДавальца.КорАналитикаУчетаНоменклатуры
		|			И ДД.КорВидЗапасов = РаботыДляДавальца.КорВидЗапасов
		|			И (ДД.ТипЗаписи В (
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Потребление),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.СписанияНаВыпуск)))
		|			И (РаботыДляДавальца.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Выпуск))
		|
		|СГРУППИРОВАТЬ ПО
		|	ДД.ТипЗаписи,
		|	(ВЫБОР
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.СписанияНаВыпуск)
		|		 И Выпуски.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Выпуск)
		|			ТОГДА ЛОЖЬ
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Потребление)
		|		 И Выпуски.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Выпуск)
		|			ТОГДА ЛОЖЬ
		|			ИНАЧЕ ДД.Сторно
		|		КОНЕЦ),
		|	ДД.Номенклатура,
		|	ДД.Период,
		|	ДД.Регистратор,
		|	ДД.ВидДвижения,
		|	ДД.Организация,
		|	ДД.РазделУчета,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.ВидЗапасов,
		|	(ВЫБОР
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Выпуск)
		|		 И ДД.Партия = НЕОПРЕДЕЛЕНО
		|			ТОГДА ДД.Регистратор
		|		КОГДА ДД.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыВПути)
		|		 И ДД.Партия = НЕОПРЕДЕЛЕНО
		|			ТОГДА ДД.Регистратор
		|		ИНАЧЕ ДД.Партия КОНЕЦ),
		|	ДД.АналитикаФинансовогоУчета,
        |	ДД.НалоговоеНазначение,
		|	ДД.ХозяйственнаяОперация,
		|	(ВЫБОР
		|		КОГДА РаботыДляДавальца.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты)
		|		 И РаботыДляДавальца.КорАналитикаУчетаНоменклатуры <> ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаНоменклатуры.ПустаяСсылка)
        |			ТОГДА РаботыДляДавальца.НалоговоеНазначение
        |		ИНАЧЕ ДД.КорНалоговоеНазначение КОНЕЦ),
		|	(ВЫБОР
		|		КОГДА РаботыДляДавальца.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты)
		|		 И РаботыДляДавальца.КорАналитикаУчетаНоменклатуры <> ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаНоменклатуры.ПустаяСсылка)
		|			ТОГДА РаботыДляДавальца.РазделУчета
		|		ИНАЧЕ ДД.КорРазделУчета КОНЕЦ),
		|	(ВЫБОР
		|		КОГДА РаботыДляДавальца.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты)
		|		 И РаботыДляДавальца.КорАналитикаУчетаНоменклатуры <> ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаНоменклатуры.ПустаяСсылка)
		|			ТОГДА РаботыДляДавальца.АналитикаУчетаНоменклатуры
		|		ИНАЧЕ ДД.КорАналитикаУчетаНоменклатуры КОНЕЦ),
		|	(ВЫБОР
		|		КОГДА РаботыДляДавальца.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты)
		|		 И РаботыДляДавальца.КорАналитикаУчетаНоменклатуры <> ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаНоменклатуры.ПустаяСсылка)
		|			ТОГДА РаботыДляДавальца.ВидЗапасов
		|		ИНАЧЕ ДД.КорВидЗапасов КОНЕЦ),
		|	ДД.КорОрганизация,
		|	(ВЫБОР
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.СписанияНаВыпуск)
		|		 И ДД.КорПартия = НЕОПРЕДЕЛЕНО
		|			ТОГДА ДД.Регистратор
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Потребление)
		|		 И ДД.КорПартия = НЕОПРЕДЕЛЕНО
		|		 И Выпуски.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Выпуск)
		|			ТОГДА ДД.Регистратор
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Потребление)
		|		 И ДД.КорПартия = НЕОПРЕДЕЛЕНО
		|		 И ДД.Регистратор ССЫЛКА Документ.СборкаТоваров
		|			ТОГДА ДД.Регистратор
		|		КОГДА ДД.КорРазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыВПути)
		|		 И ДД.КорПартия = НЕОПРЕДЕЛЕНО
		|			ТОГДА ДД.Регистратор
		|		ИНАЧЕ ДД.КорПартия КОНЕЦ),
		|	(ВЫБОР
		|		КОГДА РаботыДляДавальца.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты)
		|		 И РаботыДляДавальца.КорАналитикаУчетаНоменклатуры <> ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаНоменклатуры.ПустаяСсылка)
		|			ТОГДА РаботыДляДавальца.АналитикаФинансовогоУчета
		|		ИНАЧЕ ДД.КорАналитикаФинансовогоУчета КОНЕЦ),
		|	ДД.Подразделение,
		|	ДД.СтатьяРасходовАктивов,
		|	ДД.АналитикаРасходов,
		|	ДД.АналитикаАктивов,
		|	ДД.КорНаправлениеДеятельности,
		|	ДД.ДокументИсточник";
КонецФункции

Функция ТекстДвиженияСебестоимостиТоваровСборка()
	Возврат
		"ВЫБРАТЬ
		|	""ТекстДвиженияСебестоимостиТоваровСборка"" КАК ЗапросИсточник,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Перемещение) КАК ТипЗаписи,
		|	(ВЫБОР
		|		КОГДА ДД.Количество < 0 ТОГДА ИСТИНА
		|		ИНАЧЕ ЛОЖЬ КОНЕЦ) КАК Сторно,
		|	0 КАК Приоритет,
		|	МАКСИМУМ(Приходы.Количество) КАК Знаменатель,
		|	0 КАК ЗнаменательДляИсточников,
		|	ЛОЖЬ КАК РасчетЗавершен,
		|	ДД.КорАналитикаУчетаНоменклатуры.Номенклатура КАК Номенклатура,
        |	НЕОПРЕДЕЛЕНО КАК НалоговоеНазначениеПартии,
		|	
		|	ДД.Период,
		|	ДД.Регистратор,
		|	ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход) КАК ВидДвижения,
		|	ДД.Организация,
		|	ДД.КорРазделУчета КАК РазделУчета,
		|	ДД.КорАналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
		|	ДД.КорВидЗапасов КАК ВидЗапасов,
		|	ДД.Регистратор КАК Партия,
		|	ДД.КорАналитикаФинансовогоУчета КАК АналитикаФинансовогоУчета,
        |	ДД.КорНалоговоеНазначение КАК НалоговоеНазначение,
		|
		|	НЕОПРЕДЕЛЕНО КАК АналитикаУчетаПартий,
		|	НЕОПРЕДЕЛЕНО КАК ДокументПоступления,
		|
		|	СУММА(ДД.Количество) КАК Количество,
		|	0 КАК СтоимостьБезНДС,
		|	0 КАК НДС,
		|	0 КАК НДСУпр,
		|
		|	ДД.ХозяйственнаяОперация,
        |	НЕОПРЕДЕЛЕНО КАК КорНалоговоеНазначение,
		|	НЕОПРЕДЕЛЕНО КАК КорРазделУчета,
		|	НЕОПРЕДЕЛЕНО КАК КорАналитикаУчетаНоменклатуры,
		|	НЕОПРЕДЕЛЕНО КАК КорВидЗапасов,
		|	НЕОПРЕДЕЛЕНО КАК КорОрганизация,
		|	НЕОПРЕДЕЛЕНО КАК КорПартия,
		|	НЕОПРЕДЕЛЕНО КАК КорАналитикаФинансовогоУчета,
		|	НЕОПРЕДЕЛЕНО КАК Подразделение,
		|	НЕОПРЕДЕЛЕНО КАК СтатьяРасходовАктивов,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаРасходов,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаАктивов,
		|	ДД.Регистратор КАК ДокументИсточник,
		|	НЕОПРЕДЕЛЕНО КАК СтатьяСписанияНДС,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаСписанияНДС,
		|	ДД.КорНаправлениеДеятельности
		|ИЗ
		|	ВТКэшРасчетныеОборотыСебестоимостьТоваров КАК ДД
		|	ЛЕВОЕ СОЕДИНЕНИЕ ПриходыСборокТоваров КАК Приходы
		|		ПО Приходы.Организация = ДД.Организация
		|		И Приходы.РазделУчета = ДД.КорРазделУчета
		|		И Приходы.АналитикаУчетаНоменклатуры = ДД.КорАналитикаУчетаНоменклатуры
		|		И Приходы.Партия = ДД.КорПартия
		|		И Приходы.АналитикаФинансовогоУчета = ДД.КорАналитикаФинансовогоУчета
        |		И Приходы.НалоговоеНазначение = ДД.КорНалоговоеНазначение
		|		И Приходы.Регистратор = ДД.Регистратор
		|ГДЕ
		|	ДД.Организация В (&ОрганизацииСУчетомПартийНДСВерсии22)
		|	И ДД.Количество <> 0
		|	И ДД.Регистратор ССЫЛКА Документ.СборкаТоваров
		|	И ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Потребление)
		|СГРУППИРОВАТЬ ПО
		|	(ВЫБОР
		|		КОГДА ДД.Количество < 0 ТОГДА ИСТИНА
		|		ИНАЧЕ ЛОЖЬ КОНЕЦ),
		|	ДД.КорАналитикаУчетаНоменклатуры.Номенклатура,
		|	ДД.Период,
		|	ДД.Регистратор,
		|	ДД.Организация,
		|	ДД.КорРазделУчета,
		|	ДД.КорАналитикаУчетаНоменклатуры,
		|	ДД.КорВидЗапасов,
		|	ДД.КорПартия,
		|	ДД.КорАналитикаФинансовогоУчета,
        |	ДД.КорНалоговоеНазначение,
		|	ДД.КорНаправлениеДеятельности,
		|	ДД.ХозяйственнаяОперация
		|";
КонецФункции

Функция ТекстВозвратыПрошлыхПериодов()
	Возврат
		"ВЫБРАТЬ
		|	""ТекстВозвратыПрошлыхПериодов"" КАК ЗапросИсточник,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ВозвратПрошлыхПериодов) КАК ТипЗаписи,
		|	ИСТИНА КАК Сторно,
		|	0 КАК Приоритет,
		|	-ДД.Количество КАК Знаменатель,
		|	0 КАК ЗнаменательДляИсточников,
		|	ЛОЖЬ КАК РасчетЗавершен,
		|	ДД.АналитикаУчетаНоменклатуры.Номенклатура КАК Номенклатура,
        |	НЕОПРЕДЕЛЕНО КАК НалоговоеНазначениеПартии,
		|	
		|	ДД.Период,
		|	ДД.Регистратор,
		|	ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход) КАК ВидДвижения,
		|	ДД.Организация,
		|	ДД.РазделУчета,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.ВидЗапасов,
		|	ДД.Партия,
		|	ДД.АналитикаФинансовогоУчета,
        |	ДД.НалоговоеНазначение,
		|
		|	НЕОПРЕДЕЛЕНО КАК АналитикаУчетаПартий,
		|	НЕОПРЕДЕЛЕНО КАК ДокументПоступления,
		|
		|	-ДД.Количество,
		|	0 КАК СтоимостьБезНДС,
		|	0 КАК НДС,
		|	0 КАК НДСУпр,
		|
		|	ДД.ХозяйственнаяОперация,
        |	ДД.КорНалоговоеНазначение,
		|	ДД.РазделУчета КАК КорРазделУчета,
		|	ДД.АналитикаУчетаНоменклатуры КАК КорАналитикаУчетаНоменклатуры,
		|	ДД.ВидЗапасов КАК КорВидЗапасов,
		|	ДД.Организация КАК КорОрганизация,
		|	ДД.Партия КАК КорПартия,
		|	ДД.КорАналитикаФинансовогоУчета,
		|	НЕОПРЕДЕЛЕНО КАК Подразделение,
		|	НЕОПРЕДЕЛЕНО КАК СтатьяРасходовАктивов,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаРасходов,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаАктивов,
		|	ДД.ДокументИсточник,
		|	НЕОПРЕДЕЛЕНО КАК СтатьяСписанияНДС,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаСписанияНДС,
		|	ДД.КорНаправлениеДеятельности
		|ИЗ
		|	ВТКэшРасчетныеОборотыСебестоимостьТоваров КАК ДД
		|ГДЕ
		|	ДД.Организация В (&ОрганизацииСУчетомПартийНДСВерсии22)
		|	И ДД.Количество <> 0
        |	И ДД.НалоговоеНазначение <> ЗНАЧЕНИЕ(Справочник.НалоговыеНазначенияАктивовИЗатрат.ПустаяСсылка)
		|	И ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ВозвратПрошлыхПериодов)
		|";
КонецФункции

Функция ТекстРеализацииПрошлыхМесяцевПартииНДС() // использует ПрошлыеРеализации 
	Возврат
		"ВЫБРАТЬ
		|	""ТекстРеализацииПрошлыхМесяцевПартииНДС"" КАК ЗапросИсточник,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Прошлое) КАК ТипЗаписи,
		|	ЛОЖЬ КАК Сторно,
		|	0 КАК Приоритет,
		|	ДД.Знаменатель 								КАК Знаменатель,
		|	0 											КАК ЗнаменательДляИсточников,
		|	ИСТИНА КАК РасчетЗавершен,
		|	ДД.АналитикаУчетаНоменклатуры.Номенклатура 	КАК Номенклатура,
        |	ДД.КорНалоговоеНазначение 					КАК НалоговоеНазначениеПартии,
		|	
		|	ДД.Период,
		|	ДД.Регистратор,
		|	ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход) КАК ВидДвижения,
		|	ДД.Организация,
		|	ДД.РазделУчета,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.ВидЗапасов,
		|	ДД.Партия,
		|	ДД.АналитикаФинансовогоУчета,
        |	ДД.КорНалоговоеНазначение КАК НалоговоеНазначение,
		|	ДД.АналитикаУчетаПартий,
		|	ДД.ДокументПоступления,
		|
		|	ДД.Количество,
		|	ДД.СтоимостьБезНДС,
		|	ДД.НДС,
		|	ДД.НДСУпр,
		|
		|	НЕОПРЕДЕЛЕНО КАК ХозяйственнаяОперация,
        |	НЕОПРЕДЕЛЕНО КАК КорНалоговоеНазначение,
		|	НЕОПРЕДЕЛЕНО КАК КорРазделУчета,
		|	НЕОПРЕДЕЛЕНО КАК КорАналитикаУчетаНоменклатуры,
		|	НЕОПРЕДЕЛЕНО КАК КорВидЗапасов,
		|	НЕОПРЕДЕЛЕНО КАК КорОрганизация,
		|	НЕОПРЕДЕЛЕНО КАК КорПартия,
		|	НЕОПРЕДЕЛЕНО КАК КорАналитикаФинансовогоУчета,
		|	НЕОПРЕДЕЛЕНО КАК Подразделение,
		|	НЕОПРЕДЕЛЕНО КАК СтатьяРасходовАктивов,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаРасходов,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаАктивов,
		|	НЕОПРЕДЕЛЕНО КАК ДокументИсточник,
		|	НЕОПРЕДЕЛЕНО КАК СтатьяСписанияНДС,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаСписанияНДС,
		|	НЕОПРЕДЕЛЕНО КАК КорНаправлениеДеятельности
		|ИЗ
        |	РегистрНакопления.ДетализацияПартийТоваровДляНДС КАК ДД
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ ПрошлыеРеализацииПартийНДС КАК Прошлые
		|		ПО ДД.Регистратор = Прошлые.ДокументИсточник
		|		И ДД.Организация = Прошлые.Организация
		|		И ДД.РазделУчета = Прошлые.РазделУчета
		|		И ДД.АналитикаУчетаНоменклатуры = Прошлые.АналитикаУчетаНоменклатуры
		|		И ДД.ВидЗапасов = Прошлые.ВидЗапасов
		|		И ДД.АналитикаФинансовогоУчета = Прошлые.АналитикаФинансовогоУчета
        |		И ДД.КорНалоговоеНазначение = Прошлые.НалоговоеНазначение
		|ГДЕ
		|	ДД.Организация В (&ОрганизацииСУчетомПартийНДСВерсии22)
		|	И ДД.Активность
		|";
КонецФункции

Функция ТекстРеализацииПрошлыхМесяцевПартииНДС21() // использует ПрошлыеРеализации 
	Возврат
		"ВЫБРАТЬ
		|	""ТекстРеализацииПрошлыхМесяцевПартииНДС21"" КАК ЗапросИсточник,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Прошлое) КАК ТипЗаписи,
		|	ЛОЖЬ КАК Сторно,
		|	0 КАК Приоритет,
		|	Прошлые.Количество							КАК Знаменатель,
		|	0 											КАК ЗнаменательДляИсточников,
		|	ИСТИНА КАК РасчетЗавершен,
		|	ДД.Номенклатура								КАК Номенклатура,
        |	ДД.НалоговоеНазначение						КАК НалоговоеНазначениеПартии,
		|	
		|	ДД.Период,
		|	ДД.Регистратор,
		|	ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход) КАК ВидДвижения,
		|	ДД.Организация,
		|	Прошлые.РазделУчета,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.ВидЗапасов,
		|	Прошлые.Партия,
		|	Прошлые.АналитикаФинансовогоУчета,
        |	ДД.НалоговоеНазначение КАК НалоговоеНазначение,
		|	ДД.АналитикаУчетаПартий,
		|	ДД.ДокументПоступления,
		|
		|	ДД.Количество,
		|	ДД.СтоимостьБезНДС,
		|	ДД.НДСРегл,
		|	0 КАК НДСУпр,
		|
		|	НЕОПРЕДЕЛЕНО КАК ХозяйственнаяОперация,
        |	НЕОПРЕДЕЛЕНО КАК КорНалоговоеНазначение,
		|	НЕОПРЕДЕЛЕНО КАК КорРазделУчета,
		|	НЕОПРЕДЕЛЕНО КАК КорАналитикаУчетаНоменклатуры,
		|	НЕОПРЕДЕЛЕНО КАК КорВидЗапасов,
		|	НЕОПРЕДЕЛЕНО КАК КорОрганизация,
		|	НЕОПРЕДЕЛЕНО КАК КорПартия,
		|	НЕОПРЕДЕЛЕНО КАК КорАналитикаФинансовогоУчета,
		|	НЕОПРЕДЕЛЕНО КАК Подразделение,
		|	НЕОПРЕДЕЛЕНО КАК СтатьяРасходовАктивов,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаРасходов,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаАктивов,
		|	НЕОПРЕДЕЛЕНО КАК ДокументИсточник,
		|	НЕОПРЕДЕЛЕНО КАК СтатьяСписанияНДС,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаСписанияНДС,
		|	НЕОПРЕДЕЛЕНО КАК КорНаправлениеДеятельности
		|ИЗ
		|	РегистрНакопления.ПартииТоваровОрганизаций КАК ДД
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ ПрошлыеРеализацииПартийНДС КАК Прошлые
		|		ПО ДД.Регистратор = Прошлые.ДокументИсточник
		|		И ДД.Организация = Прошлые.Организация
		|		И ДД.АналитикаУчетаНоменклатуры = Прошлые.АналитикаУчетаНоменклатуры
		|		И ДД.ВидЗапасов = Прошлые.ВидЗапасов
		|		И (ДД.ДокументПоступления = Прошлые.Партия
		|			ИЛИ Прошлые.Партия = НЕОПРЕДЕЛЕНО)
		|ГДЕ
		|	ДД.Организация В (&ОрганизацииСУчетомПартийНДСВерсии22)
		|	И ДД.Активность
		|";
КонецФункции

Функция ТекстТаможенныеДекларацииИзменениеВидыДеятельностиНДС()
	Возврат
		"ВЫБРАТЬ
		|	""ТекстТаможенныеДекларацииИзменениеВидыДеятельностиНДС"" КАК ЗапросИсточник,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ВключениеИсключениеНДСВСтоимости) КАК ТипЗаписи,
		|	ЛОЖЬ КАК Сторно,
		|	0 КАК Приоритет,
		|	0 КАК Знаменатель,
		|	0 КАК ЗнаменательДляИсточников,
		|	ИСТИНА КАК РасчетЗавершен,
		|	ДД.АналитикаУчетаНоменклатуры.Номенклатура КАК Номенклатура,
        |	НЕОПРЕДЕЛЕНО КАК НалоговоеНазначениеПартии,
		|	
		|	ДД.Период,
		|	ДД.Регистратор,
		|	ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход) КАК ВидДвижения,
		|	ДД.Организация,
		|	ДД.РазделУчета,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.ВидЗапасов,
		|	(ВЫБОР
		|		КОГДА ДД.Организация В (&ОрганизацииСФИФОСкользящая)
		|			ТОГДА ДД.Партия
		|		ИНАЧЕ ДД.ДокументИсточник КОНЕЦ) КАК Партия,
		|	ДД.АналитикаФинансовогоУчета,
        |	ДД.КорНалоговоеНазначение КАК НалоговоеНазначение,
		|
		|	ДД.КорАналитикаУчетаПартий КАК АналитикаУчетаПартий,
		|	ДД.Регистратор КАК ДокументПоступления,
		|
		|	0 КАК Количество,
		|	0 КАК СтоимостьБезНДС,
        |	ДД.НДСРеглРеквизит КАК НДС,
		|	(ВЫБОР
		|		КОГДА &УправленческийУчетОрганизаций ТОГДА ДД.НДСУпр
		|		ИНАЧЕ 0 КОНЕЦ) КАК НДСУпр,
		|
		|	ДД.ХозяйственнаяОперация,
        |	НЕОПРЕДЕЛЕНО КАК КорНалоговоеНазначение,
		|	НЕОПРЕДЕЛЕНО КАК КорРазделУчета,
		|	НЕОПРЕДЕЛЕНО КАК КорАналитикаУчетаНоменклатуры,
		|	НЕОПРЕДЕЛЕНО КАК КорВидЗапасов,
		|	НЕОПРЕДЕЛЕНО КАК КорОрганизация,
		|	НЕОПРЕДЕЛЕНО КАК КорПартия,
		|	НЕОПРЕДЕЛЕНО КАК КорАналитикаФинансовогоУчета,
		|	НЕОПРЕДЕЛЕНО КАК Подразделение,
		|	НЕОПРЕДЕЛЕНО КАК СтатьяРасходовАктивов,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаРасходов,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаАктивов,
		|	ДД.ДокументИсточник,
		|	НЕОПРЕДЕЛЕНО КАК СтатьяСписанияНДС,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаСписанияНДС,
		|	НЕОПРЕДЕЛЕНО КАК КорНаправлениеДеятельности
		|ИЗ
		|	ВТКэшРасчетныеОборотыСебестоимостьТоваров КАК ДД
		|ГДЕ
		|	ДД.Организация В (&ОрганизацииСУчетомПартийНДСВерсии22)
        |	И ДД.НалоговоеНазначение <> ДД.КорНалоговоеНазначение
        |	И ДД.КорНалоговоеНазначение <> ЗНАЧЕНИЕ(Справочник.НалоговыеНазначенияАктивовИЗатрат.ПустаяСсылка)
        |	И (ДД.НДСРеглРеквизит <> 0 ИЛИ ДД.НДСУпр <> 0)
		|	И ДД.ТипЗаписи В (
		|		ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыСПартией),
		|		ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыБезПартии))
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	""ТекстТаможенныеДекларацииИзменениеВидыДеятельностиНДС"" КАК ЗапросИсточник,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ВключениеИсключениеНДСВСтоимости) КАК ТипЗаписи,
		|	ЛОЖЬ КАК Сторно,
		|	0 КАК Приоритет,
		|	0 КАК Знаменатель,
		|	0 КАК ЗнаменательДляИсточников,
		|	ИСТИНА КАК РасчетЗавершен,
		|	ДД.АналитикаУчетаНоменклатуры.Номенклатура КАК Номенклатура,
        |	НЕОПРЕДЕЛЕНО КАК НалоговоеНазначениеПартии,
		|	
		|	ДД.Период,
		|	ДД.Регистратор,
		|	ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход) КАК ВидДвижения,
		|	ДД.Организация,
		|	ДД.РазделУчета,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.ВидЗапасов,
		|	(ВЫБОР
		|		КОГДА ДД.Организация В (&ОрганизацииСФИФОСкользящая)
		|			ТОГДА ДД.Партия
		|		ИНАЧЕ ДД.ДокументИсточник КОНЕЦ) КАК Партия,
		|	ДД.АналитикаФинансовогоУчета,
        |	ДД.КорНалоговоеНазначение КАК НалоговоеНазначение,
		|
		|	ДД.КорАналитикаУчетаПартий КАК АналитикаУчетаПартий,
		|	ДД.Регистратор КАК ДокументПоступления,
		|
		|	0 КАК Количество,
		|	0 КАК СтоимостьБезНДС,
        |	ДД.НДСРеглРеквизит КАК НДС,
		|	(ВЫБОР
		|		КОГДА &УправленческийУчетОрганизаций ТОГДА ДД.НДСУпр
		|		ИНАЧЕ 0 КОНЕЦ) КАК НДСУпр,
		|
		|	ДД.ХозяйственнаяОперация,
        |	ДД.НалоговоеНазначение КАК КорНалоговоеНазначение,
		|	ДД.РазделУчета КАК КорРазделУчета,
		|	ДД.АналитикаУчетаНоменклатуры КАК КорАналитикаУчетаНоменклатуры,
		|	ДД.ВидЗапасов КАК КорВидЗапасов,
		|	ДД.Организация КАК КорОрганизация,
		|	ДД.Партия КАК КорПартия,
		|	ДД.КорАналитикаФинансовогоУчета,
		|	НЕОПРЕДЕЛЕНО КАК Подразделение,
		|	НЕОПРЕДЕЛЕНО КАК СтатьяРасходовАктивов,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаРасходов,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаАктивов,
		|	ДД.ДокументИсточник,
		|	НЕОПРЕДЕЛЕНО КАК СтатьяСписанияНДС,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаСписанияНДС,
		|	ДД.КорНаправлениеДеятельности
		|ИЗ
		|	ВТКэшРасчетныеОборотыСебестоимостьТоваров КАК ДД
		|ГДЕ
		|	ДД.Организация В (&ОрганизацииСУчетомПартийНДСВерсии22)
        |	И ДД.НалоговоеНазначение <> ДД.КорНалоговоеНазначение
        |	И ДД.КорНалоговоеНазначение <> ЗНАЧЕНИЕ(Справочник.НалоговыеНазначенияАктивовИЗатрат.ПустаяСсылка)
        |	И (ДД.НДСРеглРеквизит <> 0 ИЛИ ДД.НДСУпр <> 0)
		|	И ДД.ТипЗаписи В (
		|		ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыСПартией),
		|		ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыБезПартии))
		|";
КонецФункции

// Заполнение расчетной партии

Процедура ЗаполнитьРасчетнуюПартиюНДС(ПараметрыРасчета, РасчетнаяПартия, Расход, Приход)
	
	СуммовыеРесурсы = Новый Структура("СтоимостьБезНДС, НДС, НДСУпр");
	
	// Заполняем расчетную партию по расходной партии-основании
	ЗаполнитьЗначенияСвойств(РасчетнаяПартия, Расход);
	
	//	Заполняем партионную идентификацию в расчетной партии
    ЗаполнитьЗначенияСвойств(РасчетнаяПартия, Приход, "ДокументПоступления, АналитикаУчетаПартий, НалоговоеНазначениеПартии");
	РасчетнаяПартия.ДокументИсточник = Неопределено;
	Если Не ЗначениеЗаполнено(РасчетнаяПартия.Партия) Тогда
		РасчетнаяПартия.Партия = Приход.Партия;
	КонецЕсли;
	
	// Заменим старые аналитики учета партий на новые.
	Если ПараметрыРасчета.РаспределениеПартий.ДополнительныеСвойства.Свойство("АналитикиУчетаПартий") Тогда
		
		НоваяАналитикаУчетаПартий = ПараметрыРасчета.РаспределениеПартий.ДополнительныеСвойства.АналитикиУчетаПартий.Получить(РасчетнаяПартия.АналитикаУчетаПартий);
		
		Если ЗначениеЗаполнено(НоваяАналитикаУчетаПартий) Тогда
			РасчетнаяПартия.АналитикаУчетаПартий = НоваяАналитикаУчетаПартий;
		КонецЕсли;
		
	КонецЕсли;
	
	КорректироватьБазуВРасходе = Ложь;
	
	// Расчетная партия заполняется на наибольшее общее вычитаемое
	Если ((РасчетнаяПартия.ТипЗаписи = Перечисления.ТипыЗаписейПартий.Перемещение
	 	  И ТипЗнч(РасчетнаяПартия.Регистратор) = Тип("ДокументСсылка.СборкаТоваров"))
	 ИЛИ РасчетнаяПартия.ТипЗаписи = Перечисления.ТипыЗаписейПартий.СписанияНаВыпуск) Тогда
		КоличествоСписания = Мин(Расход.Количество, Приход.Знаменатель);
		ЗнаменательСписания = КоличествоСписания;
		ПриходБазис = ?(Приход.Знаменатель <> 0, КоличествоСписания / Приход.Знаменатель, 0);
	ИначеЕсли РасчетнаяПартия.ТипЗаписи = Перечисления.ТипыЗаписейПартий.Выпуск Тогда
		КоличествоСписания = Мин(Расход.Знаменатель, Приход.ЗнаменательДляИсточников);
		ЗнаменательСписания = КоличествоСписания;
		ПриходБазис = ?(Приход.Знаменатель <> 0, КоличествоСписания / Приход.ЗнаменательДляИсточников, 0);
	ИначеЕсли РасчетнаяПартия.ТипЗаписи = Перечисления.ТипыЗаписейПартий.ОстатокСгруппированный
	 ИЛИ РасчетнаяПартия.ТипЗаписи = Перечисления.ТипыЗаписейПартий.ПартияСгруппированная Тогда
		КоличествоСписания = Мин(Расход.Знаменатель, Приход.Знаменатель);
		ЗнаменательСписания = КоличествоСписания;
		ПриходБазис = 1;
	ИначеЕсли Приход.Количество <> 0 Тогда
		КорректироватьБазуВРасходе = Истина;
		КоличествоСписания = Мин(Расход.Количество, Приход.Количество);
		ПриходБазис = ?(Приход.Количество <> 0, КоличествоСписания / Приход.Количество, 0);
		ЗнаменательСписания = Мин(Расход.Знаменатель, ПриходБазис * Приход.Знаменатель);
	Иначе
		КоличествоСписания = Мин(Расход.Знаменатель, Приход.Знаменатель);
		ЗнаменательСписания = КоличествоСписания;
		ПриходБазис = ?(Приход.Знаменатель <> 0, КоличествоСписания / Приход.Знаменатель, 0);
	КонецЕсли;
	Если ПриходБазис = 0 Тогда
		Возврат;
	КонецЕсли;
	
	// Заполняем показатели расчетной партии
	Если РасчетнаяПартия.ТипЗаписи = Перечисления.ТипыЗаписейПартий.Выпуск Тогда
		РасчетнаяПартия.Количество = 0;
	ИначеЕсли РасчетнаяПартия.ТипЗаписи = Перечисления.ТипыЗаписейПартий.Перемещение
	 И ТипЗнч(РасчетнаяПартия.Регистратор) = Тип("ДокументСсылка.СборкаТоваров") Тогда
		РасчетнаяПартия.Количество = 0;
	ИначеЕсли РасчетнаяПартия.ТипЗаписи = Перечисления.ТипыЗаписейПартий.СписанияНаВыпуск Тогда
		РасчетнаяПартия.Количество = Окр(ПриходБазис * Приход.Количество, 3);
	ИначеЕсли РасчетнаяПартия.ТипЗаписи = Перечисления.ТипыЗаписейПартий.ОстатокСгруппированный
	 ИЛИ РасчетнаяПартия.ТипЗаписи = Перечисления.ТипыЗаписейПартий.ПартияСгруппированная Тогда
		РасчетнаяПартия.Количество = Приход.Количество;
	Иначе
		РасчетнаяПартия.Количество = Мин(Расход.Количество, Приход.Количество);
	КонецЕсли;
	РасчетнаяПартия.Знаменатель = 0;
	
	Если РасчетнаяПартия.ТипЗаписи = Перечисления.ТипыЗаписейПартий.ОстатокСгруппированный
	 ИЛИ РасчетнаяПартия.ТипЗаписи = Перечисления.ТипыЗаписейПартий.ПартияСгруппированная Тогда
		РасчетнаяПартия.Знаменатель = Приход.Знаменатель;
	Иначе
		РасчетнаяПартия.Знаменатель = 0;
	КонецЕсли;
	
	Для Каждого ИмяРесурса Из СуммовыеРесурсы Цикл
		РасчетнаяПартия[ИмяРесурса.Ключ] = Окр(ПриходБазис * Приход[ИмяРесурса.Ключ], 2);
	КонецЦикла;
	
	// Корректируем базу расчета в приходе
	Если НЕ (Приход.ХозяйственнаяОперация = Перечисления.ХозяйственныеОперации.РеализацияКлиентуРеглУчет
		И Приход.ТипЗаписи = Перечисления.ТипыЗаписейПартий.Потребление)
	И НЕ (Приход.ХозяйственнаяОперация = Перечисления.ХозяйственныеОперации.РаспределениеРасходовНаПартииПроизводства
		И Приход.ТипЗаписи = Перечисления.ТипыЗаписейПартий.Распределение) Тогда
	 
	 	Если НЕ Приход.Сторно И РасчетнаяПартия.Сторно
		 И РасчетнаяПартия.ТипЗаписи = Перечисления.ТипыЗаписейПартий.Потребление Тогда
			Знак = -1;
		Иначе
			Знак = 1;
		КонецЕсли;
	 
	    Если РасчетнаяПартия.ТипЗаписи = Перечисления.ТипыЗаписейПартий.Выпуск Тогда
			Приход.Знаменатель = Приход.Знаменатель - Знак * Окр(ПриходБазис * Приход.Знаменатель, 3);
			Приход.Количество = Приход.Количество - Знак * РасчетнаяПартия.Количество;
			Приход.ЗнаменательДляИсточников = Приход.ЗнаменательДляИсточников - Знак * ЗнаменательСписания;
		Иначе
			Приход.Знаменатель = Приход.Знаменатель - Знак * ЗнаменательСписания;
			Приход.Количество = Приход.Количество - Знак * РасчетнаяПартия.Количество;
		КонецЕсли;
		
		Для Каждого ИмяРесурса Из СуммовыеРесурсы Цикл
			Приход[ИмяРесурса.Ключ] = Приход[ИмяРесурса.Ключ] - Знак * РасчетнаяПартия[ИмяРесурса.Ключ];
		КонецЦикла;
	 	
	КонецЕсли;
	
	// Корректируем базу расчета в расходе
	Если КорректироватьБазуВРасходе Тогда
		
		Расход.Количество = Расход.Количество - РасчетнаяПартия.Количество;
		
		Для Каждого ИмяРесурса Из СуммовыеРесурсы Цикл
			Расход[ИмяРесурса.Ключ] = Расход[ИмяРесурса.Ключ] - РасчетнаяПартия[ИмяРесурса.Ключ];
		КонецЦикла;
		
	КонецЕсли;
	
	ЗаполнитьСтатьюИАналитикуСписанияНДС(ПараметрыРасчета, РасчетнаяПартия, Расход, Приход);
    
    Если РасчетнаяПартия.ТипЗаписи = Перечисления.ТипыЗаписейПартий.ОстатокДляРаспределения Тогда
    	 	РасчетнаяПартия.Период = Приход.Период;
    	 	РасчетнаяПартия.Регистратор = Приход.Регистратор;
    КонецЕсли;
	
	// По результатам партионной идентификации определяем завершенность расчета
	Если РасчетнаяПартия.Количество = 0
	 И РасчетнаяПартия.СтоимостьБезНДС = 0
	 И РасчетнаяПартия.НДС = 0
	 И РасчетнаяПартия.НДСУпр = 0 Тогда
		РасчетнаяПартия.РасчетЗавершен = Ложь;
		
	ИначеЕсли ТипЗнч(Приход.Регистратор) = Тип("ДокументСсылка.ВводОстатков") 
		Или ТипЗнч(Приход.Регистратор) = Тип("ДокументСсылка.ВводОстатковТоваров") Тогда
		// Для документов ВводОстатков с реквизитом ВводОстатков22 = Ложь в таблице Данные
		// установлен признак РасчетЗавершен = Ложь для того, чтобы движения этого документа не записывались в ИБ,
		// т.к. они уже сформированы самим документом.
		РасчетнаяПартия.РасчетЗавершен = Истина;
	Иначе
		РасчетнаяПартия.РасчетЗавершен = Приход.РасчетЗавершен;
    КонецЕсли;
    
    Если РасчетнаяПартия.ТипЗаписи = Перечисления.ТипыЗаписейПартий.ОстатокДляРаспределения Тогда
     
        РасчетнаяПартияРасход = РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьРасчетнуюПартию(ПараметрыРасчета, РасчетнаяПартия, Ложь);
        РасчетнаяПартияРасход.ВидДвижения = ВидДвиженияНакопления.Расход;
        РасчетнаяПартияРасход.Партия = Неопределено;
     
    КонецЕсли;
	
КонецПроцедуры

Процедура ЗаполнитьСтатьюИАналитикуСписанияНДС(ПараметрыРасчета, РасчетнаяПартия, Расход, Приход)
    
    Возврат;
    
	
КонецПроцедуры

#КонецОбласти

#Область ПроцедурыЭтапа_РасчетПартийНДС2_4

// Инициализация данных

Функция ПоляПотребленийПартииНДС2_4(ПараметрыРасчета)
	
    Возврат "Организация, НалоговоеНазначение, НаправлениеДеятельности, Партия, АналитикаУчетаПартий";
	
КонецФункции

Функция ОписаниеЦепочекПартийНДС2_4(ПараметрыРасчета, ОписаниеЦепочек = Неопределено, РасчетПоПартиямПрочихРасходов = Ложь) Экспорт
	
	Если ОписаниеЦепочек = Неопределено Тогда
		ОписаниеЦепочек = Новый Соответствие;
		РасчетПоПартиямПрочихРасходов = Ложь;
	Иначе
		РасчетПоПартиямПрочихРасходов = Истина;
	КонецЕсли;
	
	ПоляСвязи 							  = ПоляПотребленийПартииНДС2_4(ПараметрыРасчета);
	ПоляСвязиСРегистратором 			  = ПоляСвязи + ", Регистратор";
	ПоляСвязиСДокументомИсточником 		  = ПоляСвязи + ", ДокументИсточник";
    КорПоляСвязиСРегистратором 			  = "Организация,    КорНалоговоеНазначение, КорНаправлениеДеятельности, КорПартия, КорАналитикаУчетаПартий, Регистратор"; // порядок как в ПоляПотребленийПартииНДС2_4()
    КорПоляСвязиСДокументомИсточником 	  = "Организация,    КорНалоговоеНазначение, КорНаправлениеДеятельности, КорПартия, КорАналитикаУчетаПартий, ДокументИсточник"; // порядок как в ПоляПотребленийПартииНДС2_4()
    КорПоляСвязиОбособленноСРегистратором = "КорОрганизация, КорНалоговоеНазначение, КорНаправлениеДеятельности, КорПартия, КорАналитикаУчетаПартий, Регистратор"; // порядок как в ПоляПотребленийПартииНДС2_4()
	ПоляСвязиСторно						  = "Организация, Партия, АналитикаУчетаПартий, ДокументИсточник";
	КорПоляСвязиСторно					  = "Организация, Партия, АналитикаУчетаПартий, Регистратор";
	
	#Область ОстатокСгруппированный
	
	Источники = Новый Соответствие;
	Источники.Вставить(Перечисления.ТипыЗаписейПартий.Остаток);
	
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеПриемника(
		ОписаниеЦепочек,
		Перечисления.ТипыЗаписейПартий.ОстатокСгруппированный,
		ПоляСвязиСРегистратором + ", Период",
		Источники);
	
	#КонецОбласти
	
	#Область Потребление
	
	Источники = Новый Соответствие;
	Источники.Вставить(Перечисления.ТипыЗаписейПартий.ОстатокСгруппированный);
	Источники.Вставить(Перечисления.ТипыЗаписейПартий.Партия);
	Источники.Вставить(Перечисления.ТипыЗаписейПартий.ДопРасходы);
	Источники.Вставить(Перечисления.ТипыЗаписейПартий.ДопРасходыБезПартии);
	Источники.Вставить(Перечисления.ТипыЗаписейПартий.ДопРасходыСПартией);
	Источники.Вставить(Перечисления.ТипыЗаписейПартий.КорректировкаСтоимости);
	Источники.Вставить(Перечисления.ТипыЗаписейПартий.ОтклонениеВСтоимости);
	Источники.Вставить(Перечисления.ТипыЗаписейПартий.КорректировкаПриобретенияПрошлогоПериода);
	Источники.Вставить(Перечисления.ТипыЗаписейПартий.Перемещение);
	Источники.Вставить(Перечисления.ТипыЗаписейПартий.ПеремещениеАвто);
	Источники.Вставить(Перечисления.ТипыЗаписейПартий.ПеремещениеОбособленно);
	Источники.Вставить(Перечисления.ТипыЗаписейПартий.Сторно);
	Источники.Вставить(Перечисления.ТипыЗаписейПартий.ВозвратПрошлыхПериодов);
	Источники.Вставить(Перечисления.ТипыЗаписейПартий.Выпуск);
	Источники.Вставить(Перечисления.ТипыЗаписейПартий.БазаРегл);
	Источники.Вставить(Перечисления.ТипыЗаписейПартий.БазаУпр);
	
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеПриемника(
		ОписаниеЦепочек,
		Перечисления.ТипыЗаписейПартий.Потребление,
		ПоляСвязи,
		Источники);

	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьДополнительнуюСвязь(
		ОписаниеЦепочек,
		Перечисления.ТипыЗаписейПартий.Потребление,
		"АналитикаУчетаНоменклатуры",
		Перечисления.ТипыЗаписейПартий.ПеремещениеАвто,
		"КорАналитикаУчетаНоменклатуры"
	);
	
	Если РасчетПоПартиямПрочихРасходов Тогда
		
		РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьДополнительнуюСвязь(
			ОписаниеЦепочек,
			Перечисления.ТипыЗаписейПартий.Потребление,
			"КорПодразделение, СтатьяРасходовАктивов, АналитикаРасходов, СтатьяКалькуляции, ГруппаПродукции, ПравилоОтнесенияНаВыпуск",
			Перечисления.ТипыЗаписейПартий.БазаРегл,
			"КорПодразделение, СтатьяРасходовАктивов, АналитикаРасходов, СтатьяКалькуляции, ГруппаПродукции, ПравилоОтнесенияНаВыпуск"
		);
		
		РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьДополнительнуюСвязь(
			ОписаниеЦепочек,
			Перечисления.ТипыЗаписейПартий.Потребление,
			"КорПодразделение, СтатьяРасходовАктивов, АналитикаРасходов, СтатьяКалькуляции, ГруппаПродукции, ПравилоОтнесенияНаВыпуск",
			Перечисления.ТипыЗаписейПартий.БазаУпр,
			"КорПодразделение, СтатьяРасходовАктивов, АналитикаРасходов, СтатьяКалькуляции, ГруппаПродукции, ПравилоОтнесенияНаВыпуск"
		);
		
		РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьДополнительнуюСвязь(
			ОписаниеЦепочек,
			Перечисления.ТипыЗаписейПартий.Потребление,
			"КодСтрокиПродукция",
			Перечисления.ТипыЗаписейПартий.Перемещение,
			"КодСтрокиПродукция"
		);
		
	КонецЕсли;
		
	#КонецОбласти
	
	#Область ПотреблениеАвто
	
	Источники = Новый Соответствие;
	Источники.Вставить(Перечисления.ТипыЗаписейПартий.ОстатокСгруппированный);
	Источники.Вставить(Перечисления.ТипыЗаписейПартий.Партия);
	Источники.Вставить(Перечисления.ТипыЗаписейПартий.Перемещение);
	Источники.Вставить(Перечисления.ТипыЗаписейПартий.ПеремещениеОбособленно);
	Источники.Вставить(Перечисления.ТипыЗаписейПартий.Сторно);
	Источники.Вставить(Перечисления.ТипыЗаписейПартий.ДопРасходы);
	Источники.Вставить(Перечисления.ТипыЗаписейПартий.БазаРегл);
	Источники.Вставить(Перечисления.ТипыЗаписейПартий.БазаУпр);
	
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеПриемника(
		ОписаниеЦепочек,
		Перечисления.ТипыЗаписейПартий.ПотреблениеАвто,
		ПоляСвязи,
		Источники);
		
	#КонецОбласти
	
	#Область КорректировкаПриобретения
	
	Источники = Новый Соответствие;
	Источники.Вставить(Перечисления.ТипыЗаписейПартий.ОстатокСгруппированный);
	Источники.Вставить(Перечисления.ТипыЗаписейПартий.Партия);
	Источники.Вставить(Перечисления.ТипыЗаписейПартий.ВозвратПрошлыхПериодов);
	
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеПриемника(
		ОписаниеЦепочек,
		Перечисления.ТипыЗаписейПартий.КорректировкаПриобретения,
		ПоляСвязи,
		Источники);
	
	#КонецОбласти
	
	#Область ВозвратНаДругойСклад
	
	Источники = Новый Соответствие;
	Источники.Вставить(Перечисления.ТипыЗаписейПартий.СторноВозвратНаДругойСклад);
	
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеПриемника(
		ОписаниеЦепочек,
		Перечисления.ТипыЗаписейПартий.ВозвратНаДругойСклад,
		ПоляСвязиСРегистратором,
		Источники);
	
	#КонецОбласти
	
	#Область Распределение
	
	Источники = Новый Соответствие;
	Источники.Вставить(Перечисления.ТипыЗаписейПартий.Перемещение);
	Источники.Вставить(Перечисления.ТипыЗаписейПартий.ПеремещениеОбособленно);
	Источники.Вставить(Перечисления.ТипыЗаписейПартий.ОстатокСгруппированный);
	Источники.Вставить(Перечисления.ТипыЗаписейПартий.ВозвратПрошлыхПериодов);
	Источники.Вставить(Перечисления.ТипыЗаписейПартий.Партия);
	Источники.Вставить(Перечисления.ТипыЗаписейПартий.Выпуск);
	Источники.Вставить(Перечисления.ТипыЗаписейПартий.БазаРегл);
	Источники.Вставить(Перечисления.ТипыЗаписейПартий.БазаУпр);
	
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеПриемника(
		ОписаниеЦепочек,
		Перечисления.ТипыЗаписейПартий.Распределение,
		ПоляСвязи,
		Источники);
	
	Если РасчетПоПартиямПрочихРасходов Тогда
		
		РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьДополнительнуюСвязь(
			ОписаниеЦепочек,
			Перечисления.ТипыЗаписейПартий.Распределение,
			"КодСтрокиПродукция",
			Перечисления.ТипыЗаписейПартий.БазаРегл,
			"КодСтрокиПродукция"
		);
		
		РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьДополнительнуюСвязь(
			ОписаниеЦепочек,
			Перечисления.ТипыЗаписейПартий.Распределение,
			"КодСтрокиПродукция",
			Перечисления.ТипыЗаписейПартий.БазаУпр,
			"КодСтрокиПродукция"
		);
		
	КонецЕсли;
	
	#КонецОбласти
	
	#Область Перемещение
	
	Источники = Новый Соответствие;
	Источники.Вставить(Перечисления.ТипыЗаписейПартий.Потребление);
	Источники.Вставить(Перечисления.ТипыЗаписейПартий.ПотреблениеАвто);
	Источники.Вставить(Перечисления.ТипыЗаписейПартий.ПотреблениеПроизводство);
	Источники.Вставить(Перечисления.ТипыЗаписейПартий.ВозвратНаДругойСклад);
    Если РасчетПоПартиямПрочихРасходов Тогда
		Источники.Вставить(Перечисления.ТипыЗаписейПартий.СписанияНаВыпускПостатейные);
	КонецЕсли;
	
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеПриемника(
		ОписаниеЦепочек,
		Перечисления.ТипыЗаписейПартий.Перемещение,
		ПоляСвязиСРегистратором,
		Источники,
		КорПоляСвязиСРегистратором);
	
	Если РасчетПоПартиямПрочихРасходов Тогда
		
		РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьДополнительнуюСвязь(
			ОписаниеЦепочек,
			Перечисления.ТипыЗаписейПартий.Перемещение,
			"КодСтрокиПродукция",
			Перечисления.ТипыЗаписейПартий.СписанияНаВыпускПостатейные,
			"КодСтрокиПродукция"
		);
		
	КонецЕсли;
	
	#КонецОбласти
	
	#Область ПеремещениеОбособленно
	
	Источники = Новый Соответствие;
	Источники.Вставить(Перечисления.ТипыЗаписейПартий.Потребление);
	
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеПриемника(
		ОписаниеЦепочек,
		Перечисления.ТипыЗаписейПартий.ПеремещениеОбособленно,
		ПоляСвязиСРегистратором,
		Источники,
		КорПоляСвязиОбособленноСРегистратором);
	
	#КонецОбласти
	
	#Область ПеремещениеАвто
	
	Источники = Новый Соответствие;
	Источники.Вставить(Перечисления.ТипыЗаписейПартий.Потребление);
	Источники.Вставить(Перечисления.ТипыЗаписейПартий.ПотреблениеПроизводство);
	Источники.Вставить(Перечисления.ТипыЗаписейПартий.ПотреблениеАвто);
	Источники.Вставить(Перечисления.ТипыЗаписейПартий.Распределение);
	
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеПриемника(
		ОписаниеЦепочек,
		Перечисления.ТипыЗаписейПартий.ПеремещениеАвто,
		ПоляСвязиСРегистратором,
		Источники,
		КорПоляСвязиСРегистратором);
		
	
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьДополнительнуюСвязь(
		ОписаниеЦепочек,
		Перечисления.ТипыЗаписейПартий.ПеремещениеАвто,
		"КорПартия",
		Перечисления.ТипыЗаписейПартий.Распределение,
		"Партия"
	);
	
	#КонецОбласти
	
	#Область СписанияНаВыпуск
	
	Источники = Новый Соответствие;
	Источники.Вставить(Перечисления.ТипыЗаписейПартий.Перемещение);
	Источники.Вставить(Перечисления.ТипыЗаписейПартий.ПеремещениеОбособленно);
	Источники.Вставить(Перечисления.ТипыЗаписейПартий.ПеремещениеАвто);
	Источники.Вставить(Перечисления.ТипыЗаписейПартий.Партия);
	Источники.Вставить(Перечисления.ТипыЗаписейПартий.ОстатокСгруппированный);
	Источники.Вставить(Перечисления.ТипыЗаписейПартий.Выпуск);
	
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеПриемника(
		ОписаниеЦепочек,
		Перечисления.ТипыЗаписейПартий.СписанияНаВыпуск,
		ПоляСвязи,
		Источники);
	
	#КонецОбласти
	
	#Область СписанияНаВыпускПостатейные
	
	Источники = Новый Соответствие;
	Источники.Вставить(Перечисления.ТипыЗаписейПартий.БазаРегл);
	Источники.Вставить(Перечисления.ТипыЗаписейПартий.БазаУпр);
	
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеПриемника(
		ОписаниеЦепочек,
		Перечисления.ТипыЗаписейПартий.СписанияНаВыпускПостатейные,
		ПоляСвязи + ", СтатьяРасходовАктивов" + ?(РасчетПоПартиямПрочихРасходов, ", КодСтрокиПродукция", ""),
		Источники);
	
	#КонецОбласти
	
	#Область Выпуск
	
	Источники = Новый Соответствие;
	Источники.Вставить(Перечисления.ТипыЗаписейПартий.СписанияНаВыпуск);
	Источники.Вставить(Перечисления.ТипыЗаписейПартий.СписанияНаВыпускПостатейные);
	
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеПриемника(
		ОписаниеЦепочек,
		Перечисления.ТипыЗаписейПартий.Выпуск,
		ПоляСвязиСРегистратором,
		Источники,
		КорПоляСвязиСРегистратором);
	
	#КонецОбласти
	
	#Область СписаниеНаРасходы
	
	Источники = Новый Соответствие;
	Источники.Вставить(Перечисления.ТипыЗаписейПартий.Партия);
	
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеПриемника(
		ОписаниеЦепочек,
		Перечисления.ТипыЗаписейПартий.СписаниеНаРасходы,
		ПоляСвязиСРегистратором,
		Источники);
	
	#КонецОбласти
	
	#Область ПотреблениеПроизводство
	
	Источники = Новый Соответствие;
	Источники.Вставить(Перечисления.ТипыЗаписейПартий.Партия);
	Источники.Вставить(Перечисления.ТипыЗаписейПартий.Перемещение);
	Источники.Вставить(Перечисления.ТипыЗаписейПартий.ПеремещениеОбособленно);
	Источники.Вставить(Перечисления.ТипыЗаписейПартий.ОстатокСгруппированный);
	Источники.Вставить(Перечисления.ТипыЗаписейПартий.БазаРегл);
	Источники.Вставить(Перечисления.ТипыЗаписейПартий.БазаУпр);
	
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеПриемника(
		ОписаниеЦепочек,
		Перечисления.ТипыЗаписейПартий.ПотреблениеПроизводство,
		ПоляСвязи,
		Источники);
	
	#КонецОбласти
	
	#Область ВозвратПрошлыхПериодов
	
	Источники = Новый Соответствие;
	Источники.Вставить(Перечисления.ТипыЗаписейПартий.Прошлое);
	
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеПриемника(
		ОписаниеЦепочек,
		Перечисления.ТипыЗаписейПартий.ВозвратПрошлыхПериодов,
		КорПоляСвязиСДокументомИсточником,
		Источники,
		ПоляСвязиСРегистратором);
	
	#КонецОбласти

	#Область Сторно
	
	Источники = Новый Соответствие;
	Источники.Вставить(Перечисления.ТипыЗаписейПартий.Потребление);
	Источники.Вставить(Перечисления.ТипыЗаписейПартий.ПотреблениеАвто);
	Источники.Вставить(Перечисления.ТипыЗаписейПартий.Прошлое);
	
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеПриемника(
		ОписаниеЦепочек,
		Перечисления.ТипыЗаписейПартий.Сторно,
		ПоляСвязиСторно,
		Источники,
		КорПоляСвязиСторно);
	
	#КонецОбласти
	
	#Область СторноВозвратНаДругойСклад
	
	Источники = Новый Соответствие;
	Источники.Вставить(Перечисления.ТипыЗаписейПартий.Потребление);
	Источники.Вставить(Перечисления.ТипыЗаписейПартий.ПотреблениеАвто);
	Источники.Вставить(Перечисления.ТипыЗаписейПартий.Прошлое);
	
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеПриемника(
		ОписаниеЦепочек,
		Перечисления.ТипыЗаписейПартий.СторноВозвратНаДругойСклад,
		ПоляСвязиСторно,
		Источники,
		КорПоляСвязиСторно);
	
	#КонецОбласти

	#Область Дополнение_ОтклонениеВСтоимости_РаспределениеПоВыбывшимТоварам_ПеремещениеУпр
	
	Если НЕ РасчетПоПартиямПрочихРасходов Тогда
		
		// Без источников - для формирования записей по данным запроса
		// Эти же типы записей указываются в отборе запроса ТекстДвиженияСебестоимостиТоваров2_4()
		РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеДополнения(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.Дополнение);
		РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеДополнения(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.ВключениеИсключениеНДСВСтоимости);
		РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеДополнения(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.ОтклонениеВСтоимости);
		РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеДополнения(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.РаспределениеПоВыбывшимТоварам);
		РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеДополнения(ОписаниеЦепочек, Перечисления.ТипыЗаписейПартий.ПеремещениеУпр);
		
	КонецЕсли;
	
	#КонецОбласти
	
	Возврат ОписаниеЦепочек;
	
КонецФункции

Функция ОписаниеДвиженийПартийНДС2_4(ПараметрыРасчета)
	
	КолонкиТаблицыРаспределения = ТаблицаДляРаспределенияПартийНДС2_4(ПараметрыРасчета).Колонки;
	
	ОписаниеДвижений = РасчетСебестоимостиПрикладныеАлгоритмы.ОписаниеДвижений();
    ОписаниеДвижений.Вставить("Контекст", "ПодготовкаДанныхДляУчетаНДС2_4");
    ОписаниеДвижений.Вставить("ИмяРегистра", Метаданные.РегистрыНакопления.ДетализацияПартийТоваровДляНДС2_4.Имя);
	ОписаниеДвижений.Вставить("ПоляРасчета", РасчетСебестоимостиПрикладныеАлгоритмы.ПереченьПолей(КолонкиТаблицыРаспределения));
	ОписаниеДвижений.Вставить("КлючиСравнения",	ПоляПотребленийПартииНДС2_4(ПараметрыРасчета));
	ОписаниеДвижений.Вставить("Показатели", "Знаменатель, ЗнаменательДляИсточников, СтоимостьБезНДС, НДС, СтоимостьБезНДСУпр, НДСУпр");
	ОписаниеДвижений.Вставить("БазисПрихода", "Знаменатель");
	ОписаниеДвижений.Вставить("БазисРасхода", "Знаменатель");
	ОписаниеДвижений.Вставить("КлючРасхода", "ДокументИсточник");
	ОписаниеДвижений.Вставить("ПолеПорядка", "ПериодПоступления");
	ОписаниеДвижений.Вставить("ПоляСортировки", "Партия");
	ОписаниеДвижений.Вставить("СортировкаПоУсловию", Истина);
	
	ОписаниеДвижений.Вставить("ПоляСуммирования", "СтоимостьБезНДС, НДС, СтоимостьБезНДСУпр, НДСУпр");
	ОписаниеДвижений.Вставить("ПоляГруппировки",  
		РасчетСебестоимостиПрикладныеАлгоритмы.ПереченьПолей(КолонкиТаблицыРаспределения, ОписаниеДвижений.ПоляСуммирования));
	ОписаниеДвижений.Вставить("ЕстьСторно", Истина);
	ОписаниеДвижений.Вставить("УменьшатьБазис", Истина);
	ОписаниеДвижений.Вставить("УдалятьСтрокиБезИсточников", Истина);
	
	ОписаниеДвижений.Вставить("ВременныеТаблицыДляСледующихЭтапов",
		"ВТНачальныеОстаткиПартийНДС, ПриходыТоваровНДС2_4, ДвиженияСебестоимостиНДС2_4, ДвиженияСебестоимостиНДС2_4КодСтроки, ЗнаменателиПриходов, ЗнаменателиПриходовКодСтроки");
	
	Возврат ОписаниеДвижений;
	
КонецФункции

Функция ОписаниеНезаписываемыхПартийНДС2_4(ПараметрыРасчета, НезаписываемыеТипыЗаписей = Неопределено)
	
	Если НезаписываемыеТипыЗаписей = Неопределено Тогда
		НезаписываемыеТипыЗаписей = Новый Соответствие;
	КонецЕсли;
	
	НезаписываемыеТипыЗаписей.Вставить(Перечисления.ТипыЗаписейПартий.Остаток,   Истина);
	НезаписываемыеТипыЗаписей.Вставить(Перечисления.ТипыЗаписейПартий.Прошлое,   Истина);
	НезаписываемыеТипыЗаписей.Вставить(Перечисления.ТипыЗаписейПартий.ОстатокСгруппированный, Истина);
	НезаписываемыеТипыЗаписей.Вставить(Перечисления.ТипыЗаписейПартий.ПартияСгруппированная, Истина);
	
	Возврат РасчетСебестоимостиПрикладныеАлгоритмы.ОписаниеНезаписываемыхДанных(Ложь, НезаписываемыеТипыЗаписей);
	
КонецФункции

Функция ТаблицаДляРаспределенияПартийНДС2_4(ПараметрыРасчета)
	
    Возврат РасчетСебестоимостиПрикладныеАлгоритмы.ТаблицаДляРаспределенияПартий(ПараметрыРасчета,	ТекстОписаниеДанныхДляПартийНДС2_4());
	
КонецФункции

// Выборка данных

Процедура ПолучитьДанныеДляПартийНДС2_4(ПараметрыРасчета)
	
	ДопПараметры = Новый Структура;
	ДопПараметры.Вставить("РасчетПоПартиямПрочихРасходов", Ложь);
	
	ПараметрыНумерации = РасчетСебестоимостиПрикладныеАлгоритмы.СформироватьПараметрыНумерацииСтрокВременнойТаблицы(
		"ДокументПоступления", // разделитель
		"Знаменатель, СтоимостьБезНДС, НДС, СтоимостьБезНДСУпр, НДСУпр", // ресурсы
		"Период, Приоритет ВОЗР, Организация, Партия, АналитикаУчетаПартий, Регистратор"); // порядок
	
	РасчетСебестоимостиПрикладныеАлгоритмы.ПолучитьДанныеЭтапаРасчета(
		ПараметрыРасчета,
		ТекстЗапросаДляПартийНДС2_4(ПараметрыРасчета),
		ПараметрыНумерации,
		ДопПараметры);
	
	СкорректироватьАналитикиУчетаПартийДляПартийНДС2_4(ПараметрыРасчета);
	
	//++ НЕ УТ
	ПроверитьКорректностьДанныхДляПартийНДС2_4(ПараметрыРасчета);
	//-- НЕ УТ
КонецПроцедуры

Процедура СкорректироватьАналитикиУчетаПартийДляПартийНДС2_4(ПараметрыРасчета)
	
	ТекстЗапроса = 
	"ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	Т.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
	|	Т.АналитикаУчетаДокументаПоступления КАК АналитикаУчетаПартий
	|ИЗ
	|	Данные КАК Т
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	Т.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
	|	Т.АналитикаУчетаПартий КАК АналитикаУчетаПартий
	|ИЗ
	|	Данные КАК Т";
	
	РасчетСебестоимостиПрикладныеАлгоритмы.СкорректироватьАналитикиУчетаПартийПриРасчете(ПараметрыРасчета, ТекстЗапроса);
	
КонецПроцедуры

//++ НЕ УТ

Процедура ПроверитьКорректностьДанныхДляПартийНДС2_4(ПараметрыРасчета)
	
	ЗначенияПараметров = РасчетСебестоимостиПовтИсп.ЗначенияТехнологическихПараметров();
	
	// Проверка выполняется в автотестах или если явно включен соответствующий технологический параметр.
	Если НЕ ПараметрыРасчета.АвтоматическоеТестирование И НЕ ЗначенияПараметров.ПроверитьКорректностьДанныхДляПартийНДС2_4 Тогда
		Возврат;
	КонецЕсли;
	
	Запрос = Новый Запрос;
	РасчетСебестоимостиПрикладныеАлгоритмы.ИнициализироватьСвойстваЗапроса(
		Запрос,
		ПараметрыРасчета);
		
	Запрос.Текст =
	"ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	Т.Организация КАК Организация,
	|	Ключи.Номенклатура КАК Номенклатура,
	|	Ключи.Характеристика КАК Характеристика
	|ИЗ
	|	ПриходыТоваровНДС2_4 КАК Т
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК Ключи
	|		ПО Т.АналитикаУчетаНоменклатуры = Ключи.Ссылка
	|	ЛЕВОЕ СОЕДИНЕНИЕ ВТСтоимостьПартийТоваров КАК Цены
	|		ПО Цены.Организация = Т.Организация
	|		И Цены.Партия = Т.Партия
	|		И Цены.АналитикаУчетаПартий = Т.АналитикаУчетаПартий
    |		И Цены.НалоговоеНазначение = Т.НалоговоеНазначение
	|		И Цены.АналитикаУчетаНоменклатуры = Т.АналитикаУчетаНоменклатуры
	|		И Цены.ВидЗапасов = Т.ВидЗапасов
	|ГДЕ
	|	Т.Знаменатель = 0
	|	И Т.Количество <> 0
	|	И (Т.СтоимостьБезНДС <> 0 ИЛИ Т.НДС <> 0 ИЛИ Т.СтоимостьБезНДСУпр <> 0 ИЛИ Т.НДСУпр <> 0)
	|	И Цены.Организация ЕСТЬ NULL
	|
	|ОБЪЕДИНИТЬ
	|
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	Т.Организация,
	|	Ключи.Номенклатура,
	|	Ключи.Характеристика
	|ИЗ
	|	ДвиженияСебестоимостиНДС2_4 КАК Т
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК Ключи
	|		ПО Т.АналитикаУчетаНоменклатуры = Ключи.Ссылка
	|	ЛЕВОЕ СОЕДИНЕНИЕ ВТСтоимостьПартийТоваров КАК Цены
	|		ПО Цены.Организация = Т.Организация
	|		И Цены.Партия = Т.Партия
	|		И Цены.АналитикаУчетаПартий = Т.АналитикаУчетаПартий
    |		И Цены.НалоговоеНазначение = Т.НалоговоеНазначение
	|		И Цены.АналитикаУчетаНоменклатуры = Т.АналитикаУчетаНоменклатуры
	|		И Цены.ВидЗапасов = Т.ВидЗапасов
	|ГДЕ
	|	Т.Знаменатель = 0
	|	И Т.Количество <> 0
	|	И Цены.Организация ЕСТЬ NULL
	|
	|УПОРЯДОЧИТЬ ПО
	|	Организация,
	|	Номенклатура,
	|	Характеристика";
	
	Выборка = Запрос.Выполнить().Выбрать();
	
	Пока Выборка.Следующий() Цикл
		
		ТекстИнформации = НСтр("ru='Не удалось определить стоимость некоторых позиций продукции для целей раздельного учета по налогообложению НДС';uk='Не вдалося визначити вартість деяких позицій продукції для цілей роздільного обліку з оподаткування ПДВ'");
		
		ТекстДляПротокола = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(
			НСтр("ru='По организации ""%1"" за период %2 необходимо указать цену плановой стоимости материалов и работ по номенклатуре ""%3"" с характеристикой ""%4""';uk='По організації ""%1"" за період %2 необхідно вказати ціну планової вартості матеріалів і робіт за номенклатурою ""%3"" з характеристикою ""%4""'"),
			Выборка.Организация,
			РасчетСебестоимостиПротоколРасчета.ПредставлениеПериодаРасчета(ПараметрыРасчета),
			Выборка.Номенклатура,
			Выборка.Характеристика);
			
		ПоляДляРасшифровки = Новый Структура;
		ПоляДляРасшифровки.Вставить("Организация",    Выборка.Организация);
		ПоляДляРасшифровки.Вставить("Номенклатура",   Выборка.Номенклатура);
		ПоляДляРасшифровки.Вставить("Характеристика", Выборка.Характеристика);
		
		// Добавим информацию в протокол расчета.
		РасчетСебестоимостиПротоколРасчета.ЗафиксироватьОшибкуРасчета(
			ПараметрыРасчета,
			Перечисления.ТипыОшибокПартионногоУчетаИСебестоимости.ОшибкаРаспределенияПартий,
			ТекстДляПротокола);
			
		// Добавим информацию в форму закрытия месяца.
		РасчетСебестоимостиПрикладныеАлгоритмы.ЗарегистрироватьПроблемуВыполненияРасчета(
			ПараметрыРасчета,
			Выборка.Организация,
			ТекстИнформации,
			ТекстДляПротокола,
			ПоляДляРасшифровки,
			Перечисления.ВариантыВажностиПроблемыСостоянияСистемы.Предупреждение);
		
	КонецЦикла;
	
КонецПроцедуры

//-- НЕ УТ

// Тексты запросов

// ... общий

Функция ТекстЗапросаДляПартийНДС2_4(ПараметрыРасчета = Неопределено) Экспорт
	
	ТекстЗапроса = ""
		// подготовка временных таблиц
		+ ТекстИнициализацияПартийНДС2_4()
		+ ОбщегоНазначенияУТ.РазделительЗапросовВПакете()
		// выборка данных
        + ТекстОписаниеДанныхДляПартийНДС2_4() //вт Данные
		+ ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстДетальныеНачальныеОстаткиПартийНДС2_4()
		+ ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстНачальныеОстаткиПартийНДС2_4()
		+ ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстПриходыСебестоимостиТоваров2_4()
		+ ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстДвиженияСебестоимостиТоваров2_4()
		+ ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстДвиженияСебестоимостиТоваровСборка2_4()
		+ ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстВозвратыПрошлыхПериодов2_4()
		+ ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстРеализацииПрошлыхМесяцевПартииНДС2_2()
		+ ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстРеализацииПрошлыхМесяцевПартииНДС2_4()
		+ ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстРеализацииПрошлыхМесяцевПартииНДС21_2_4()
		+ ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстТаможенныеДекларацииИзменениеВидыДеятельностиНДС2_4()
		+ "";
		
	Возврат ТекстЗапроса;
	
КонецФункции

// ... описания данных

Функция ТекстОписаниеДанныхДляПартийНДС2_4()
	Возврат
		"ВЫБРАТЬ ПЕРВЫЕ 0
		|	ВЫРАЗИТЬ("""" КАК СТРОКА(80)) 								 КАК ЗапросИсточник,
		|	ДД.ТипЗаписи 												 КАК ТипЗаписи,
		|	ЛОЖЬ														 КАК Сторно,
		|	0 															 КАК Приоритет,
		|	0 															 КАК Знаменатель,
		|	0 															 КАК ЗнаменательДляИсточников,
		|	ЛОЖЬ 														 КАК РасчетЗавершен,
		|	ЗНАЧЕНИЕ(Справочник.Номенклатура.ПустаяСсылка) 				 КАК Номенклатура,
		|	ЗНАЧЕНИЕ(Справочник.ХарактеристикиНоменклатуры.ПустаяСсылка) КАК Характеристика,
		|	
		|	ДД.Период,
		|	ДД.Период КАК ПериодПоступления,
		|	ДД.Регистратор,
		|	ДД.ВидДвижения,
		|	ДД.Организация,
		|	ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаНоменклатуры.ПустаяСсылка) КАК АналитикаУчетаНоменклатуры,
		|	ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка) 				      КАК ВидЗапасов,
		|	ДД.КорАналитикаУчетаНоменклатуры,
		|	ДД.КорВидЗапасов,
		|	ДД.Партия,
		|	ДД.АналитикаУчетаПартий,
        |	ДД.НалоговоеНазначение,
		|	ДД.ДокументПоступления,
		|	ДД.АналитикаУчетаДокументаПоступления,
		|	ДД.НаправлениеДеятельности,
		|
		|	ДД.СтоимостьБезНДС,
		|	ДД.НДС,
		|	ДД.СтоимостьБезНДСУпр,
		|	ДД.НДСУпр,
		|
		|	ДД.ХозяйственнаяОперация,
        |	ДД.КорНалоговоеНазначение,
		|	ДД.Организация КАК КорОрганизация,
		|	ДД.Партия КАК КорПартия,
		|	ДД.АналитикаУчетаПартий КАК КорАналитикаУчетаПартий,
		|	ДД.КорНаправлениеДеятельности,
		|	ДД.Подразделение,
        |	ДД.КорАналитикаФинансовогоУчета,
		|	ДД.СтатьяРасходовАктивов,
		|	ДД.АналитикаРасходов,
		|	ДД.АналитикаАктивов,
		|	ДД.ДокументИсточник,
		|	ДД.СтатьяСписанияНДС,
		|	ДД.АналитикаСписанияНДС
		|//ВоВременнуюТаблицу
		|ИЗ
        |	РегистрНакопления.ДетализацияПартийТоваровДляНДС2_4 КАК ДД
		|";
КонецФункции

// ... формирования временные таблиц

Функция ТекстИнициализацияПартийНДС2_4()
	Возврат
		"ВЫБРАТЬ
		|	ИСТИНА КАК ЕстьЗаписи
		|ПОМЕСТИТЬ ВыполнятьРаспределениеПартийНДС2_4
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	ДД.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
		|	Цены.Цена КАК Цена
		|ПОМЕСТИТЬ ВТПлановыеЦены
		|ИЗ
		|	ВТКэшРасчетныеОборотыСебестоимостьТоваров КАК ДД
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК Ключи
		|		ПО ДД.АналитикаУчетаНоменклатуры = Ключи.Ссылка
		|	ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ЦеныНоменклатуры.СрезПоследних(&КонецПериода, ВидЦены = &ВидПлановыхЦен) КАК Цены
		|		ПО Цены.Номенклатура   = Ключи.Номенклатура
		|		 И Цены.Характеристика = Ключи.Характеристика
		|ГДЕ
		|	ДД.Организация В (&ОрганизацииСУчетомПартийНДСВерсии24)
		|	И ДД.РазделУчета <> ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НеотфактурованныеПоставки)
		|	И ЕСТЬNULL(Цены.Цена, 0) <> 0
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ДД.Организация,
		|	ДД.Партия,
		|	ДД.АналитикаУчетаПартий,
		|	ДД.АналитикаФинансовогоУчета,
        |	ДД.НалоговоеНазначение,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.ВидЗапасов,
		|	ДД.РазделУчета,
		|	ДД.СтоимостьРегл
		|ПОМЕСТИТЬ ВТРасчетныеЦены
		|ИЗ
		|	ВТСтоимостьПартийТоваров КАК ДД
		|ГДЕ
		|	ДД.СтоимостьРегл <> 0
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ДД.Организация,
		|	ДД.Партия,
		|	ДД.АналитикаУчетаПартий,
		|	ДД.АналитикаФинансовогоУчета,
        |	ДД.НалоговоеНазначение,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.ВидЗапасов,
		|	ДД.РазделУчета,
		|	ВЫРАЗИТЬ(ДД.СтоимостьРегл / ДД.Количество КАК ЧИСЛО(31,2)) КАК СтоимостьРегл
		|ИЗ
		|	ВТКэшРасчетныеОборотыСебестоимостьТоваров КАК ДД
		|	ЛЕВОЕ СОЕДИНЕНИЕ ВТСтоимостьПартийТоваров КАК Цены
		|		ПО Цены.Организация = ДД.Организация
		|		И Цены.Партия = ДД.Партия
		|		И Цены.АналитикаУчетаПартий = ДД.АналитикаУчетаПартий
		|		И Цены.АналитикаФинансовогоУчета = ДД.АналитикаФинансовогоУчета
        |		И Цены.НалоговоеНазначение = ДД.НалоговоеНазначение
		|		И Цены.АналитикаУчетаНоменклатуры = ДД.АналитикаУчетаНоменклатуры
		|		И Цены.ВидЗапасов = ДД.ВидЗапасов
		|		И Цены.РазделУчета = ДД.РазделУчета
		|	
		|ГДЕ
		|	ДД.Регистратор = ДД.Партия
		|	И ДД.Количество <> 0
		|	И (Цены.Организация ЕСТЬ NULL
		|		ИЛИ Цены.СтоимостьРегл = 0)
		|	И ВЫРАЗИТЬ(ДД.СтоимостьРегл / ДД.Количество КАК ЧИСЛО(31,2)) <> 0
		|	И ДД.РазделУчета <> ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НеотфактурованныеПоставки)
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	ДД.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
		|	ДД.КодСтроки КАК КодСтроки,
		|	Цены.Цена КАК Цена
		|ПОМЕСТИТЬ ВТПлановыеЦеныКодСтроки
		|ИЗ
		|	ВТКэшРасчетныеОборотыСебестоимостьТоваров КАК ДД
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК Ключи
		|		ПО ДД.АналитикаУчетаНоменклатуры = Ключи.Ссылка
		|	ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ЦеныНоменклатуры.СрезПоследних(&КонецПериода, ВидЦены = &ВидПлановыхЦен) КАК Цены
		|		ПО Цены.Номенклатура   = Ключи.Номенклатура
		|		 И Цены.Характеристика = Ключи.Характеристика
		|ГДЕ
		|	ДД.Организация В (&ОрганизацииСУчетомПартийНДСВерсии24)
		|	И ДД.РазделУчета <> ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НеотфактурованныеПоставки)
		|	И ЕСТЬNULL(Цены.Цена, 0) <> 0
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ДД.Организация,
		|	ДД.Партия, 
		|	НЕОПРЕДЕЛЕНО КАК КодСтроки,
		|	ДД.АналитикаУчетаПартий,
		|	ДД.АналитикаФинансовогоУчета,
        |	ДД.НалоговоеНазначение,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.ВидЗапасов,
		|	ДД.РазделУчета,
		|	ДД.СтоимостьРегл
		|ПОМЕСТИТЬ ВТРасчетныеЦеныКодСтроки
		|ИЗ
		|	ВТСтоимостьПартийТоваров КАК ДД
		|ГДЕ
		|	ДД.СтоимостьРегл <> 0
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ДД.Организация,
		|	ДД.Партия,      
		|	ДД.КодСтроки КАК КодСтроки,
		|	ДД.АналитикаУчетаПартий,
		|	ДД.АналитикаФинансовогоУчета,
        |	ДД.НалоговоеНазначение,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.ВидЗапасов,
		|	ДД.РазделУчета,
		|	ВЫРАЗИТЬ(ДД.СтоимостьРегл / ДД.Количество КАК ЧИСЛО(31,2)) КАК СтоимостьРегл
		|ИЗ
		|	ВТКэшРасчетныеОборотыСебестоимостьТоваров КАК ДД
		|	ЛЕВОЕ СОЕДИНЕНИЕ ВТСтоимостьПартийТоваров КАК Цены
		|		ПО Цены.Организация = ДД.Организация
		|		И Цены.Партия = ДД.Партия
		|		И Цены.АналитикаУчетаПартий = ДД.АналитикаУчетаПартий
		|		И Цены.АналитикаФинансовогоУчета = ДД.АналитикаФинансовогоУчета
        |		И Цены.НалоговоеНазначение = ДД.НалоговоеНазначение
		|		И Цены.АналитикаУчетаНоменклатуры = ДД.АналитикаУчетаНоменклатуры
		|		И Цены.ВидЗапасов = ДД.ВидЗапасов
		|		И Цены.РазделУчета = ДД.РазделУчета
		|	
		|ГДЕ
		|	ДД.Регистратор = ДД.Партия
		|	И ДД.Количество <> 0
		|	И (Цены.Организация ЕСТЬ NULL
		|		ИЛИ Цены.СтоимостьРегл = 0)
		|	И ВЫРАЗИТЬ(ДД.СтоимостьРегл / ДД.Количество КАК ЧИСЛО(31,2)) <> 0
		|	И ДД.РазделУчета <> ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НеотфактурованныеПоставки)
		|;         
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ДД.Организация,
		|	ДД.Партия,
		|	ДД.АналитикаУчетаПартий,
		|	ВЫРАЗИТЬ(ДД.АналитикаУчетаНоменклатуры КАК Справочник.КлючиАналитикиУчетаНоменклатуры).Номенклатура КАК Номенклатура,
		|	ВЫРАЗИТЬ(ДД.АналитикаУчетаНоменклатуры КАК Справочник.КлючиАналитикиУчетаНоменклатуры).Характеристика КАК Характеристика,
		|	СУММА(ДД.Знаменатель) КАК Знаменатель
		|ПОМЕСТИТЬ ВТЗнаменателиПоНоменклатуре
		|ИЗ
		|	(ВЫБРАТЬ
		|		ДД.РазделУчета,
		|		ДД.Организация,
		|		ДД.Партия,
		|		ДД.АналитикаУчетаПартий,
		|		ДД.АналитикаФинансовогоУчета,
        |		ДД.НалоговоеНазначение,
		|		ДД.АналитикаУчетаНоменклатуры,
		|		ДД.ВидЗапасов,
		|		ВЫРАЗИТЬ(ДД.Количество
		|			* ЕСТЬNULL(Цены.СтоимостьРегл, ЕСТЬNULL(ПлановыеЦены.Цена, 0)) КАК ЧИСЛО(31,2)) КАК Знаменатель
		|	ИЗ
		|		ВТКэшРасчетныеОборотыСебестоимостьТоваров КАК ДД
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТРасчетныеЦены КАК Цены
		|			ПО Цены.Организация = ДД.Организация
		|			И Цены.Партия = ДД.Партия
		|			И Цены.АналитикаУчетаПартий = ДД.АналитикаУчетаПартий
		|			И Цены.АналитикаФинансовогоУчета = ДД.АналитикаФинансовогоУчета
        |			И Цены.НалоговоеНазначение = ДД.НалоговоеНазначение
		|			И Цены.АналитикаУчетаНоменклатуры = ДД.АналитикаУчетаНоменклатуры
		|			И Цены.ВидЗапасов = ДД.ВидЗапасов
		|			И Цены.РазделУчета = ДД.РазделУчета
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТПлановыеЦены КАК ПлановыеЦены
		|			ПО ПлановыеЦены.АналитикаУчетаНоменклатуры = ДД.АналитикаУчетаНоменклатуры
		|	ГДЕ
		|		ДД.Организация В (&ОрганизацииСУчетомПартийНДСВерсии24)
		|		И ДД.СлужебноеВидДвиженияПриход
		|		И ДД.ТипЗаписи В (
		|			ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Партия),
		|			ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаПриобретения),
		|			ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаПриобретенияПрошлогоПериода))
		|		И ДД.РазделУчета <> ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НеотфактурованныеПоставки)
		|
		|	ОБЪЕДИНИТЬ ВСЕ
		|
		|	ВЫБРАТЬ
		|		ДД.РазделУчета,
		|		ДД.Организация,
		|		ДД.Партия,
		|		ДД.АналитикаУчетаПартий,
		|		ДД.АналитикаФинансовогоУчета,
        |		ДД.НалоговоеНазначение,
		|		ДД.АналитикаУчетаНоменклатуры,
		|		ДД.ВидЗапасов,
		|		ВЫРАЗИТЬ(ДД.КоличествоОстаток
		|			* ЕСТЬNULL(Цены.СтоимостьРегл, ЕСТЬNULL(ПлановыеЦены.Цена, 0)) КАК ЧИСЛО(31,2)) КАК Знаменатель
		|	ИЗ
		|		РегистрНакопления.СебестоимостьТоваров.Остатки(&ГраницаКонецПредыдущегоПериода,
		|			Организация В (&ОрганизацииСУчетомПартийНДСВерсии24)
		|			И РазделУчета <> ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НеотфактурованныеПоставки)) КАК ДД
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТРасчетныеЦены КАК Цены
		|			ПО Цены.Организация = ДД.Организация
		|			И Цены.Партия = ДД.Партия
		|			И Цены.АналитикаУчетаПартий = ДД.АналитикаУчетаПартий
		|			И Цены.АналитикаФинансовогоУчета = ДД.АналитикаФинансовогоУчета
        |			И Цены.НалоговоеНазначение = ДД.НалоговоеНазначение
		|			И Цены.АналитикаУчетаНоменклатуры = ДД.АналитикаУчетаНоменклатуры
		|			И Цены.ВидЗапасов = ДД.ВидЗапасов
		|			И Цены.РазделУчета = ДД.РазделУчета
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТПлановыеЦены КАК ПлановыеЦены
		|			ПО ПлановыеЦены.АналитикаУчетаНоменклатуры = ДД.АналитикаУчетаНоменклатуры
		|	) КАК ДД
		|СГРУППИРОВАТЬ ПО
		|	ДД.Организация,
		|	ДД.Партия,
		|	ДД.АналитикаУчетаПартий,
		|	ВЫРАЗИТЬ(ДД.АналитикаУчетаНоменклатуры КАК Справочник.КлючиАналитикиУчетаНоменклатуры).Номенклатура,
		|	ВЫРАЗИТЬ(ДД.АналитикаУчетаНоменклатуры КАК Справочник.КлючиАналитикиУчетаНоменклатуры).Характеристика
		|ИМЕЮЩИЕ
		|	СУММА(ДД.Знаменатель) > 0
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ДД.Организация,
		|	ДД.Партия,
		|	ЕСТЬNULL(АналитикиУчетаПартий.Ссылка, ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка)) КАК АналитикаУчетаПартий,
        |	ДД.НалоговоеНазначение,
		|	ДД.АналитикаУчетаНоменклатуры.Номенклатура КАК Номенклатура,
		|	ДД.АналитикаУчетаНоменклатуры.Характеристика КАК Характеристика,
		|	СУММА(ВЫБОР КОГДА ДД.СтоимостьРеглОстаток <> 0
		|			ТОГДА ДД.СтоимостьРеглОстаток
		|			ИНАЧЕ ВЫРАЗИТЬ(ДД.КоличествоОстаток * ЕСТЬNULL(ПлановыеЦены.Цена, 0) КАК ЧИСЛО(31,2))
		|		  КОНЕЦ) КАК Знаменатель
		|ПОМЕСТИТЬ ОстаткиСебестоимостиТоваровДетально2_4
		|ИЗ
		|	РегистрНакопления.СебестоимостьТоваров.Остатки(&ГраницаКонецПредыдущегоПериода,
		|		Организация В (&ОрганизацииСУчетомПартийНДСВерсии24)
		|		И РазделУчета <> ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НеотфактурованныеПоставки)) КАК ДД
		|	ЛЕВОЕ СОЕДИНЕНИЕ ВТОтборАналитикиУчетаПартийНДС2_4 КАК АналитикиУчетаПартий
		|		ПО ДД.АналитикаУчетаПартий = АналитикиУчетаПартий.Ссылка
		|	ЛЕВОЕ СОЕДИНЕНИЕ ВТПлановыеЦены КАК ПлановыеЦены
		|		ПО ПлановыеЦены.АналитикаУчетаНоменклатуры = ДД.АналитикаУчетаНоменклатуры
		|ГДЕ
		|	ДД.КоличествоОстаток > 0
		|
		|СГРУППИРОВАТЬ ПО
		|	ДД.Организация,
		|	ДД.Партия,
		|	ЕСТЬNULL(АналитикиУчетаПартий.Ссылка, ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка)),
        |	ДД.НалоговоеНазначение,
		|	ДД.АналитикаУчетаНоменклатуры.Номенклатура,
		|	ДД.АналитикаУчетаНоменклатуры.Характеристика
		|	
		|ИМЕЮЩИЕ
		|	СУММА(ВЫБОР КОГДА ДД.СтоимостьРеглОстаток <> 0
		|			ТОГДА ДД.СтоимостьРеглОстаток
		|			ИНАЧЕ ВЫРАЗИТЬ(ДД.КоличествоОстаток * ЕСТЬNULL(ПлановыеЦены.Цена, 0) КАК ЧИСЛО(31,2))
		|		  КОНЕЦ) <> 0
		|;
		|////////////////////////////////////////////////////////////////////////////////
		|
		|ВЫБРАТЬ
		|	ДД.Организация,
		|	ДД.Партия,
		|	ДД.АналитикаУчетаПартий,
        |	ДД.НалоговоеНазначение,
		|	СУММА(ДД.Знаменатель) КАК Знаменатель
		|ПОМЕСТИТЬ ОстаткиСебестоимостиТоваров2_4
		|ИЗ
		|	ОстаткиСебестоимостиТоваровДетально2_4 КАК ДД
		|СГРУППИРОВАТЬ ПО
		|	ДД.Организация,
		|	ДД.Партия,
		|	ДД.АналитикаУчетаПартий,
        |	ДД.НалоговоеНазначение
		|
		|;
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ДД.Регистратор КАК Регистратор,
		|	ДД.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
		|	ДД.РазделУчета КАК РазделУчета,
		|	ДД.ВидЗапасов КАК ВидЗапасов,
		|	ДД.Организация КАК Организация,
		|	ДД.Партия КАК Партия,
		|	ДД.АналитикаУчетаПартий КАК АналитикаУчетаПартий,
		|	ДД.АналитикаФинансовогоУчета КАК АналитикаФинансовогоУчета,
        |	ДД.НалоговоеНазначение КАК НалоговоеНазначение,
		|	ДД.ЭтоДопРасходы КАК ЭтоДопРасходы,
		|	СУММА(ДД.ЗнаменательПриход) КАК Знаменатель,
		|	СУММА(ДД.ЗнаменательРасход) КАК ЗнаменательДляИсточников
		|ПОМЕСТИТЬ ЗнаменателиПриходов
		|ИЗ
		|	(ВЫБРАТЬ
		|		ДД.Регистратор КАК Регистратор,
		|		ЛОЖЬ КАК ЭтоДопРасходы,
		|		ИСТИНА КАК ЕстьПриход,
		|		ЛОЖЬ КАК ЕстьРасход,
		|		ДД.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
		|		ДД.РазделУчета КАК РазделУчета,
		|		ДД.ВидЗапасов КАК ВидЗапасов,
		|		ДД.Организация КАК Организация,
		|		ДД.Партия КАК Партия,
		|		ДД.АналитикаУчетаПартий КАК АналитикаУчетаПартий,
		|		ДД.АналитикаФинансовогоУчета КАК АналитикаФинансовогоУчета,
        |		ДД.НалоговоеНазначение КАК НалоговоеНазначение,
		|		СУММА(ВЫРАЗИТЬ(ДД.Количество
		|			* ЕСТЬNULL(Цены.СтоимостьРегл, ЕСТЬNULL(ПлановыеЦены.Цена, 0)) КАК ЧИСЛО(31,2))) КАК ЗнаменательПриход,
		|		0 КАК ЗнаменательРасход
		|	ИЗ
		|		ВТКэшРасчетныеОборотыСебестоимостьТоваров КАК ДД
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТРасчетныеЦены КАК Цены
		|			ПО Цены.Организация = ДД.Организация
		|			И Цены.Партия = ДД.Партия
		|			И Цены.АналитикаУчетаПартий = ДД.АналитикаУчетаПартий
		|			И Цены.АналитикаФинансовогоУчета = ДД.АналитикаФинансовогоУчета
        |			И Цены.НалоговоеНазначение = ДД.НалоговоеНазначение
		|			И Цены.АналитикаУчетаНоменклатуры = ДД.АналитикаУчетаНоменклатуры
		|			И Цены.ВидЗапасов = ДД.ВидЗапасов
		|			И Цены.РазделУчета = ДД.РазделУчета
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТПлановыеЦены КАК ПлановыеЦены
		|			ПО ПлановыеЦены.АналитикаУчетаНоменклатуры = ДД.АналитикаУчетаНоменклатуры
		|	ГДЕ
		|		ДД.Организация В (&ОрганизацииСУчетомПартийНДСВерсии24)
		|		И ДД.СлужебноеВидДвиженияПриход
		|		И НЕ ДД.ТипЗаписи В (
		|			ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаСтоимости),
		|			ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаПриобретенияПрошлогоПериода),
		|			ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ОтклонениеВСтоимости),
		|			ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходы),
		|			ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыБезПартии),
		|			ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыСПартией))
		|		И ДД.РазделУчета <> ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НеотфактурованныеПоставки)
		|	СГРУППИРОВАТЬ ПО
		|		ДД.Регистратор,
		|		ДД.АналитикаУчетаНоменклатуры,
		|		ДД.РазделУчета,
		|		ДД.ВидЗапасов,
		|		ДД.Организация,
		|		ДД.Партия,
		|		ДД.АналитикаУчетаПартий,
		|		ДД.АналитикаФинансовогоУчета,
        |		ДД.НалоговоеНазначение
		|	
		|	ОБЪЕДИНИТЬ ВСЕ
		|	
		|	ВЫБРАТЬ
		|		ДД.Регистратор КАК Регистратор,
		|		ИСТИНА КАК ЭтоДопРасходы,
		|		ИСТИНА КАК ЕстьПриход,
		|		ЛОЖЬ КАК ЕстьРасход,
		|		ДД.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
		|		ДД.РазделУчета КАК РазделУчета,
		|		ДД.ВидЗапасов КАК ВидЗапасов,
		|		ДД.Организация КАК Организация,
		|		ДД.Партия КАК Партия,
		|		ДД.АналитикаУчетаПартий КАК АналитикаУчетаПартий,
		|		ДД.АналитикаФинансовогоУчета КАК АналитикаФинансовогоУчета,
        |		ДД.НалоговоеНазначение КАК НалоговоеНазначение,
		|		МАКСИМУМ(ЕСТЬNULL(Знаменатели.Знаменатель, 0)) КАК ЗнаменательПриход,
		|		0 КАК ЗнаменательРасход
		|	ИЗ
		|		ВТКэшРасчетныеОборотыСебестоимостьТоваров КАК ДД
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТЗнаменателиПоНоменклатуре КАК Знаменатели
		|			ПО Знаменатели.Организация = ДД.Организация
		|			И Знаменатели.Партия = ДД.Партия
		|			И Знаменатели.АналитикаУчетаПартий = ДД.АналитикаУчетаПартий
		|			И Знаменатели.Номенклатура = ДД.АналитикаУчетаНоменклатуры.Номенклатура
		|			И Знаменатели.Характеристика = ДД.АналитикаУчетаНоменклатуры.Характеристика
		|	ГДЕ
		|		ДД.Организация В (&ОрганизацииСУчетомПартийНДСВерсии24)
		|		И ДД.СлужебноеВидДвиженияПриход
		|		И ДД.ТипЗаписи В (
		|			ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаСтоимости),
		|			ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаПриобретенияПрошлогоПериода),
		|			ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ОтклонениеВСтоимости),
		|			ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходы),
		|			ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыБезПартии),
		|			ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыСПартией))
		|		И ДД.РазделУчета <> ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НеотфактурованныеПоставки)
		|	СГРУППИРОВАТЬ ПО
		|		ДД.Регистратор,
		|		ДД.АналитикаУчетаНоменклатуры,
		|		ДД.РазделУчета,
		|		ДД.ВидЗапасов,
		|		ДД.Организация,
		|		ДД.Партия,
		|		ДД.АналитикаУчетаПартий,
		|		ДД.АналитикаФинансовогоУчета,
        |		ДД.НалоговоеНазначение
		|
		|	ОБЪЕДИНИТЬ ВСЕ
		|	
		|	ВЫБРАТЬ
		|		ДД.Регистратор,
		|		ЛОЖЬ,
		|		ЛОЖЬ,
		|		ИСТИНА,
		|		ДД.КорАналитикаУчетаНоменклатуры,
		|		ДД.КорРазделУчета,
		|		ДД.КорВидЗапасов,
		|		ВЫБОР КОГДА ДД.КорОрганизация = ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка) ТОГДА ДД.Организация ИНАЧЕ ДД.КорОрганизация КОНЕЦ,
		|		ДД.КорПартия,
		|		ДД.КорАналитикаУчетаПартий,
		|		ДД.КорАналитикаФинансовогоУчета,
        |		ДД.КорНалоговоеНазначение,
		|		0,
		|		ВЫРАЗИТЬ(ДД.Количество * ЕСТЬNULL(Цены.СтоимостьРегл, ЕСТЬNULL(ПлановыеЦены.Цена, 0)) КАК ЧИСЛО(31,2))
		|	ИЗ
		|		ВТКэшРасчетныеОборотыСебестоимостьТоваров КАК ДД
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТРасчетныеЦены КАК Цены
		|			ПО Цены.Организация = ДД.Организация
		|			И Цены.Партия = ДД.Партия
		|			И Цены.АналитикаУчетаПартий = ДД.АналитикаУчетаПартий
		|			И Цены.АналитикаФинансовогоУчета = ДД.АналитикаФинансовогоУчета
        |			И Цены.НалоговоеНазначение = ДД.НалоговоеНазначение
		|			И Цены.АналитикаУчетаНоменклатуры = ДД.АналитикаУчетаНоменклатуры
		|			И Цены.ВидЗапасов = ДД.ВидЗапасов
		|			И Цены.РазделУчета = ДД.РазделУчета
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТПлановыеЦены КАК ПлановыеЦены
		|			ПО ПлановыеЦены.АналитикаУчетаНоменклатуры = ДД.АналитикаУчетаНоменклатуры
		|	ГДЕ
		|		ДД.Организация В (&ОрганизацииСУчетомПартийНДСВерсии24)
		|		И ДД.РазделУчета <> ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НеотфактурованныеПоставки)
		|		И НЕ ДД.СлужебноеВидДвиженияПриход) КАК ДД
		|
		|СГРУППИРОВАТЬ ПО
		|	ДД.Регистратор,
		|	ДД.ЭтоДопРасходы,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.РазделУчета,
		|	ДД.ВидЗапасов,
		|	ДД.Организация,
		|	ДД.Партия,
		|	ДД.АналитикаУчетаПартий,
		|	ДД.АналитикаФинансовогоУчета,
        |	ДД.НалоговоеНазначение
		|
		|ИМЕЮЩИЕ
		|	МАКСИМУМ(ДД.ЕстьПриход) = ИСТИНА
		|;
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ДД.Регистратор КАК Регистратор,
		|	ДД.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
		|	ДД.РазделУчета КАК РазделУчета,
		|	ДД.ВидЗапасов КАК ВидЗапасов,
		|	ДД.Организация КАК Организация,
		|	ДД.Партия КАК Партия,  
		|	ДД.КодСтроки КАК КодСтроки,
		|	ДД.АналитикаУчетаПартий КАК АналитикаУчетаПартий,
		|	ДД.АналитикаФинансовогоУчета КАК АналитикаФинансовогоУчета,
        |	ДД.НалоговоеНазначение КАК НалоговоеНазначение,
		|	ДД.ЭтоДопРасходы КАК ЭтоДопРасходы,
		|	СУММА(ДД.ЗнаменательПриход) КАК Знаменатель,
		|	СУММА(ДД.ЗнаменательРасход) КАК ЗнаменательДляИсточников
		|ПОМЕСТИТЬ ЗнаменателиПриходовКодСтроки
		|ИЗ
		|	(ВЫБРАТЬ
		|		ДД.Регистратор КАК Регистратор,
		|		ЛОЖЬ КАК ЭтоДопРасходы,
		|		ИСТИНА КАК ЕстьПриход,
		|		ЛОЖЬ КАК ЕстьРасход,
		|		ДД.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
		|		ДД.РазделУчета КАК РазделУчета,
		|		ДД.ВидЗапасов КАК ВидЗапасов,
		|		ДД.Организация КАК Организация,
		|		ДД.Партия КАК Партия,
		|		ДД.КодСтроки КАК КодСтроки,
		|		ДД.АналитикаУчетаПартий КАК АналитикаУчетаПартий,
		|		ДД.АналитикаФинансовогоУчета КАК АналитикаФинансовогоУчета,
        |		ДД.НалоговоеНазначение КАК НалоговоеНазначение,
		|		СУММА(ВЫРАЗИТЬ(ДД.Количество
		|			* ЕСТЬNULL(Цены.СтоимостьРегл, ЕСТЬNULL(ПлановыеЦены.Цена, 0)) КАК ЧИСЛО(31,2))) КАК ЗнаменательПриход,
		|		0 КАК ЗнаменательРасход
		|	ИЗ
		|		ВТКэшРасчетныеОборотыСебестоимостьТоваров КАК ДД
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТРасчетныеЦеныКодСтроки КАК Цены
		|			ПО Цены.Организация = ДД.Организация
		|			И Цены.Партия = ДД.Партия
		|			И Цены.АналитикаУчетаПартий = ДД.АналитикаУчетаПартий
		|			И Цены.АналитикаФинансовогоУчета = ДД.АналитикаФинансовогоУчета
        |			И Цены.НалоговоеНазначение = ДД.НалоговоеНазначение
		|			И Цены.АналитикаУчетаНоменклатуры = ДД.АналитикаУчетаНоменклатуры
		|			И Цены.ВидЗапасов = ДД.ВидЗапасов
		|			И Цены.РазделУчета = ДД.РазделУчета
		|			И (Цены.КодСтроки = ДД.КодСтроки ИЛИ Цены.КодСтроки = НЕОПРЕДЕЛЕНО)
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТПлановыеЦеныКодСтроки КАК ПлановыеЦены
		|			ПО ПлановыеЦены.АналитикаУчетаНоменклатуры = ДД.АналитикаУчетаНоменклатуры
		|			И ПлановыеЦены.КодСтроки = ДД.КодСтроки
		|	ГДЕ
		|		ДД.Организация В (&ОрганизацииСУчетомПартийНДСВерсии24)
		|		И ДД.СлужебноеВидДвиженияПриход
		|		И НЕ ДД.ТипЗаписи В (
		|			ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаСтоимости),
		|			ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаПриобретенияПрошлогоПериода),
		|			ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ОтклонениеВСтоимости),
		|			ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходы),
		|			ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыБезПартии),
		|			ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыСПартией))
		|		И ДД.РазделУчета <> ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НеотфактурованныеПоставки)
		|	СГРУППИРОВАТЬ ПО
		|		ДД.Регистратор,
		|		ДД.АналитикаУчетаНоменклатуры,
		|		ДД.РазделУчета,
		|		ДД.ВидЗапасов,
		|		ДД.Организация,
		|		ДД.Партия,
		|		ДД.КодСтроки,
		|		ДД.АналитикаУчетаПартий,
		|		ДД.АналитикаФинансовогоУчета,
        |		ДД.НалоговоеНазначение
		|	
		|	ОБЪЕДИНИТЬ ВСЕ
		|	
		|	ВЫБРАТЬ
		|		ДД.Регистратор КАК Регистратор,
		|		ИСТИНА КАК ЭтоДопРасходы,
		|		ИСТИНА КАК ЕстьПриход,
		|		ЛОЖЬ КАК ЕстьРасход,
		|		ДД.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
		|		ДД.РазделУчета КАК РазделУчета,
		|		ДД.ВидЗапасов КАК ВидЗапасов,
		|		ДД.Организация КАК Организация,
		|		ДД.Партия КАК Партия,
		|		0 КАК КодСтроки,
		|		ДД.АналитикаУчетаПартий КАК АналитикаУчетаПартий,
		|		ДД.АналитикаФинансовогоУчета КАК АналитикаФинансовогоУчета,
        |		ДД.НалоговоеНазначение КАК НалоговоеНазначение,
		|		МАКСИМУМ(ЕСТЬNULL(Знаменатели.Знаменатель, 0)) КАК ЗнаменательПриход,
		|		0 КАК ЗнаменательРасход
		|	ИЗ
		|		ВТКэшРасчетныеОборотыСебестоимостьТоваров КАК ДД
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТЗнаменателиПоНоменклатуре КАК Знаменатели
		|			ПО Знаменатели.Организация = ДД.Организация
		|			И Знаменатели.Партия = ДД.Партия
		|			И Знаменатели.АналитикаУчетаПартий = ДД.АналитикаУчетаПартий
		|			И Знаменатели.Номенклатура = ДД.АналитикаУчетаНоменклатуры.Номенклатура
		|			И Знаменатели.Характеристика = ДД.АналитикаУчетаНоменклатуры.Характеристика
		|	ГДЕ
		|		ДД.Организация В (&ОрганизацииСУчетомПартийНДСВерсии24)
		|		И ДД.СлужебноеВидДвиженияПриход
		|		И ДД.ТипЗаписи В (
		|			ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаСтоимости),
		|			ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаПриобретенияПрошлогоПериода),
		|			ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ОтклонениеВСтоимости),
		|			ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходы),
		|			ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыБезПартии),
		|			ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыСПартией))
		|		И ДД.РазделУчета <> ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НеотфактурованныеПоставки)
		|	СГРУППИРОВАТЬ ПО
		|		ДД.Регистратор,
		|		ДД.АналитикаУчетаНоменклатуры,
		|		ДД.РазделУчета,
		|		ДД.ВидЗапасов,
		|		ДД.Организация,
		|		ДД.Партия,
		|		ДД.АналитикаУчетаПартий,
		|		ДД.АналитикаФинансовогоУчета,
        |		ДД.НалоговоеНазначение
		|
		|	ОБЪЕДИНИТЬ ВСЕ
		|	
		|	ВЫБРАТЬ
		|		ДД.Регистратор,
		|		ЛОЖЬ,
		|		ЛОЖЬ,
		|		ИСТИНА,
		|		ДД.КорАналитикаУчетаНоменклатуры,
		|		ДД.КорРазделУчета,
		|		ДД.КорВидЗапасов,
		|		ВЫБОР КОГДА ДД.КорОрганизация = ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка) ТОГДА ДД.Организация ИНАЧЕ ДД.КорОрганизация КОНЕЦ,
		|		ДД.КорПартия,
		|		ДД.КодСтроки КАК КодСтроки,
		|		ДД.КорАналитикаУчетаПартий,
		|		ДД.КорАналитикаФинансовогоУчета,
        |		ДД.КорНалоговоеНазначение,
		|		0,
		|		ВЫРАЗИТЬ(ДД.Количество * ЕСТЬNULL(Цены.СтоимостьРегл, ЕСТЬNULL(ПлановыеЦены.Цена, 0)) КАК ЧИСЛО(31,2))
		|	ИЗ
		|		ВТКэшРасчетныеОборотыСебестоимостьТоваров КАК ДД
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТРасчетныеЦеныКодСтроки КАК Цены
		|			ПО Цены.Организация = ДД.Организация
		|			И Цены.Партия = ДД.Партия
		|			И Цены.АналитикаУчетаПартий = ДД.АналитикаУчетаПартий
		|			И Цены.АналитикаФинансовогоУчета = ДД.АналитикаФинансовогоУчета
        |			И Цены.НалоговоеНазначение = ДД.НалоговоеНазначение
		|			И Цены.АналитикаУчетаНоменклатуры = ДД.АналитикаУчетаНоменклатуры
		|			И Цены.ВидЗапасов = ДД.ВидЗапасов
		|			И Цены.РазделУчета = ДД.РазделУчета
		|			И (Цены.КодСтроки = ДД.КодСтроки ИЛИ Цены.КодСтроки = НЕОПРЕДЕЛЕНО)
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТПлановыеЦеныКодСтроки КАК ПлановыеЦены
		|			ПО ПлановыеЦены.АналитикаУчетаНоменклатуры = ДД.АналитикаУчетаНоменклатуры
		|			И ПлановыеЦены.КодСтроки = ДД.КодСтроки
		|	ГДЕ
		|		ДД.Организация В (&ОрганизацииСУчетомПартийНДСВерсии24)
		|		И ДД.РазделУчета <> ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НеотфактурованныеПоставки)
		|		И НЕ ДД.СлужебноеВидДвиженияПриход) КАК ДД
		|
		|СГРУППИРОВАТЬ ПО
		|	ДД.Регистратор,
		|	ДД.ЭтоДопРасходы,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.РазделУчета,
		|	ДД.ВидЗапасов,
		|	ДД.Организация,
		|	ДД.Партия, 
		|	ДД.КодСтроки,
		|	ДД.АналитикаУчетаПартий,
		|	ДД.АналитикаФинансовогоУчета,
        |	ДД.НалоговоеНазначение
		|
		|ИМЕЮЩИЕ
		|	МАКСИМУМ(ДД.ЕстьПриход) = ИСТИНА
		|;  
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ДД.Организация,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.ВидЗапасов,
		|	ДД.Партия,
		|	ДД.АналитикаУчетаПартий,
        |	ДД.НалоговоеНазначение,
		|	ЕСТЬNULL(ДД.АналитикаУчетаНоменклатуры.Назначение.НаправлениеДеятельности, ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка)) КАК НаправлениеДеятельности,
		|	СУММА(ДД.ДопРасходыРегл)	КАК ДопРасходыРегл,
		|	СУММА(ДД.ДопРасходыУпр)		КАК ДопРасходыУпр,
        |	СУММА(ДД.НДСРеглРеквизит)	КАК НДСРеглРеквизит,
		|	СУММА(ДД.НДСУпр)			КАК НДСУпр
		|ПОМЕСТИТЬ СписаниеОтклоненийВСтоимости2_4
		|ИЗ
		|	ВТКэшРасчетныеОборотыСебестоимостьТоваров КАК ДД
		|ГДЕ
		|	ДД.Организация В (&ОрганизацииСУчетомПартийНДСВерсии24)
		|	И ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ОтклонениеВСтоимости)
		|	И НЕ ДД.СлужебноеВидДвиженияПриход
		|	И ДД.РазделУчета <> ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НеотфактурованныеПоставки)
		|СГРУППИРОВАТЬ ПО
		|	ДД.Организация,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.ВидЗапасов,
		|	ДД.Партия,
		|	ДД.АналитикаУчетаПартий,
        |	ДД.НалоговоеНазначение,
		|	ЕСТЬNULL(ДД.АналитикаУчетаНоменклатуры.Назначение.НаправлениеДеятельности, ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка))
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ДД.ДокументИсточник,
		|	ДД.Организация,
		|	ВЫБОР
		|		КОГДА ДД.КорРазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПустаяСсылка)
		|			ТОГДА ДД.РазделУчета
		|		ИНАЧЕ ДД.КорРазделУчета
		|	КОНЕЦ КАК РазделУчета,
		|	ВЫБОР
		|		КОГДА ДД.КорАналитикаУчетаНоменклатуры = ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаНоменклатуры.ПустаяСсылка)
		|			ТОГДА ДД.АналитикаУчетаНоменклатуры
		|		ИНАЧЕ ДД.КорАналитикаУчетаНоменклатуры
		|	КОНЕЦ КАК АналитикаУчетаНоменклатуры,
		|	ВЫБОР
		|		КОГДА ДД.КорВидЗапасов = ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка)
		|			ТОГДА ДД.ВидЗапасов
		|		ИНАЧЕ ДД.КорВидЗапасов
		|	КОНЕЦ КАК ВидЗапасов,
		|	ДД.Партия,
		|	ДД.АналитикаУчетаПартий,
		|	ДД.АналитикаФинансовогоУчета,
        |	ВЫБОР
        |		КОГДА ДД.КорНалоговоеНазначение = ЗНАЧЕНИЕ(Справочник.НалоговыеНазначенияАктивовИЗатрат.ПустаяСсылка)
        |			ТОГДА ДД.НалоговоеНазначение
        |		ИНАЧЕ ДД.КорНалоговоеНазначение
        |	КОНЕЦ КАК НалоговоеНазначение,
		|	СУММА(ВЫБОР
		|			КОГДА ЕСТЬNULL(Знаменатели.Знаменатель, 0) <> 0
		|				ТОГДА Знаменатели.Знаменатель
		|				ИНАЧЕ ВЫРАЗИТЬ(ДД.Количество * ЕСТЬNULL(Цены.СтоимостьРегл, ЕСТЬNULL(ПлановыеЦены.Цена, 0)) КАК ЧИСЛО(31,2))
		|		  КОНЕЦ) КАК Знаменатель,
		|	СУММА(ЕСТЬNULL(Знаменатели.ЗнаменательДляИсточников, 0)) КАК ЗнаменательДляИсточников,
		|	СУММА(ДД.Количество) КАК Количество
		|ПОМЕСТИТЬ ПрошлыеРеализацииПартийНДС2_2
		|ИЗ
		|	ВТКэшРасчетныеОборотыСебестоимостьТоваров КАК ДД
		|	ЛЕВОЕ СОЕДИНЕНИЕ ЗнаменателиПриходов КАК Знаменатели
		|		ПО Знаменатели.Регистратор = ДД.Регистратор
		|		И Знаменатели.Организация = ДД.Организация
		|		И Знаменатели.Партия = ДД.Партия
		|		И Знаменатели.АналитикаУчетаПартий = ДД.АналитикаУчетаПартий
		|		И Знаменатели.АналитикаФинансовогоУчета = ДД.АналитикаФинансовогоУчета
        |		И Знаменатели.НалоговоеНазначение = ДД.НалоговоеНазначение
		|		И Знаменатели.АналитикаУчетаНоменклатуры = ДД.АналитикаУчетаНоменклатуры
		|		И Знаменатели.ВидЗапасов = ДД.ВидЗапасов
		|		И Знаменатели.РазделУчета = ДД.РазделУчета
		|		И ДД.СлужебноеВидДвиженияПриход
		|		И ВЫБОР КОГДА ДД.ТипЗаписи В (
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаСтоимости),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаПриобретенияПрошлогоПериода),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ОтклонениеВСтоимости),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходы),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыБезПартии),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыСПартией))
		|			ТОГДА ИСТИНА
		|			ИНАЧЕ ЛОЖЬ
		|		  КОНЕЦ = Знаменатели.ЭтоДопРасходы
		|	ЛЕВОЕ СОЕДИНЕНИЕ ВТРасчетныеЦены КАК Цены
		|		ПО Цены.Организация = ДД.Организация
		|		И Цены.Партия = ДД.Партия
		|		И Цены.АналитикаУчетаПартий = ДД.АналитикаУчетаПартий
		|		И Цены.АналитикаФинансовогоУчета = ДД.АналитикаФинансовогоУчета
        |		И Цены.НалоговоеНазначение = ДД.НалоговоеНазначение
		|		И Цены.АналитикаУчетаНоменклатуры = ДД.АналитикаУчетаНоменклатуры
		|		И Цены.ВидЗапасов = ДД.ВидЗапасов
		|		И Цены.РазделУчета = ДД.РазделУчета
		|	ЛЕВОЕ СОЕДИНЕНИЕ ВТПлановыеЦены КАК ПлановыеЦены
		|		ПО ПлановыеЦены.АналитикаУчетаНоменклатуры = ДД.АналитикаУчетаНоменклатуры
		|ГДЕ
		|	ДД.Организация В (&ОрганизацииСУчетомПартийНДСВерсии24)
		|	И ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ВозвратПрошлыхПериодов)
		|	И ДД.Количество <> 0
		|СГРУППИРОВАТЬ ПО
		|	ДД.ДокументИсточник,
		|	ДД.Организация,
		|	ВЫБОР
		|		КОГДА ДД.КорРазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПустаяСсылка)
		|			ТОГДА ДД.РазделУчета
		|		ИНАЧЕ ДД.КорРазделУчета
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА ДД.КорАналитикаУчетаНоменклатуры = ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаНоменклатуры.ПустаяСсылка)
		|			ТОГДА ДД.АналитикаУчетаНоменклатуры
		|		ИНАЧЕ ДД.КорАналитикаУчетаНоменклатуры
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА ДД.КорВидЗапасов = ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка)
		|			ТОГДА ДД.ВидЗапасов
		|		ИНАЧЕ ДД.КорВидЗапасов
		|	КОНЕЦ,
		|	ДД.Партия,
		|	ДД.АналитикаУчетаПартий,
		|	ДД.АналитикаФинансовогоУчета,
        |	ВЫБОР
        |		КОГДА ДД.КорНалоговоеНазначение = ЗНАЧЕНИЕ(Справочник.НалоговыеНазначенияАктивовИЗатрат.ПустаяСсылка)
        |			ТОГДА ДД.НалоговоеНазначение
        |		ИНАЧЕ ДД.КорНалоговоеНазначение
        |	КОНЕЦ
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ДД.Регистратор,
		|	ДД.Организация,
		|	ДД.РазделУчета,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.ВидЗапасов,
		|	ДД.Партия,
		|	ДД.АналитикаФинансовогоУчета,
        |	ДД.НалоговоеНазначение,
		|	СУММА(ДД.Количество) КАК Количество
		|ПОМЕСТИТЬ КоличествоПрошлыеРеализацииПартийНДС2_2
		|ИЗ
        |	РегистрНакопления.ДетализацияПартийТоваровДляНДС КАК ДД
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ ПрошлыеРеализацииПартийНДС2_2 КАК Прошлые
		|		ПО ДД.Регистратор = Прошлые.ДокументИсточник
		|		И ДД.Организация = Прошлые.Организация
		|		И ДД.РазделУчета = Прошлые.РазделУчета
		|		И ДД.АналитикаУчетаНоменклатуры = Прошлые.АналитикаУчетаНоменклатуры
		|		И ДД.ВидЗапасов = Прошлые.ВидЗапасов
		|		И ДД.АналитикаФинансовогоУчета = Прошлые.АналитикаФинансовогоУчета
        |		И ДД.КорНалоговоеНазначение = Прошлые.НалоговоеНазначение
		|ГДЕ
		|	ДД.Организация В (&ОрганизацииСУчетомПартийНДСВерсии24)
		|	И ДД.Количество <> 0
		|СГРУППИРОВАТЬ ПО
		|	ДД.Регистратор,
		|	ДД.Организация,
		|	ДД.РазделУчета,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.ВидЗапасов,
		|	ДД.Партия,
		|	ДД.АналитикаФинансовогоУчета,
        |	ДД.НалоговоеНазначение
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ДД.ДокументИсточник,
		|	ДД.Организация,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.ВидЗапасов,
		|	ДД.Партия,
		|	ДД.АналитикаУчетаПартий,
		|	ЕСТЬNULL(АналитикиУчетаПартий.Ссылка, ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка)) КАК АналитикаУчетаВнешнихПартий,
		|	ЕСТЬNULL(ДД.АналитикаУчетаНоменклатуры.Назначение.НаправлениеДеятельности, ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка)) КАК НаправлениеДеятельности,
        |	ВЫБОР
        |		КОГДА ДД.КорНалоговоеНазначение = ЗНАЧЕНИЕ(Справочник.НалоговыеНазначенияАктивовИЗатрат.ПустаяСсылка)
        |			ТОГДА ДД.НалоговоеНазначение
        |		ИНАЧЕ ДД.КорНалоговоеНазначение
        |	КОНЕЦ КАК НалоговоеНазначение,
		|	СУММА(
		|	  ВЫБОР
		|		КОГДА ЕСТЬNULL(Знаменатели.Знаменатель, 0) <> 0
		|			ТОГДА Знаменатели.Знаменатель
		|		КОГДА ДД.СтоимостьРегл <> 0
		|			ТОГДА ДД.СтоимостьРегл
		|			ИНАЧЕ ВЫРАЗИТЬ(ДД.Количество * ЕСТЬNULL(Цены.СтоимостьРегл, ЕСТЬNULL(ПлановыеЦены.Цена, 0)) КАК ЧИСЛО(31,2))
		|	  КОНЕЦ) КАК Знаменатель,
		|	СУММА(ЕСТЬNULL(Знаменатели.ЗнаменательДляИсточников, 0)) КАК ЗнаменательДляИсточников
		|ПОМЕСТИТЬ ПрошлыеРеализацииПартийНДС2_4
		|ИЗ
		|	ВТКэшРасчетныеОборотыСебестоимостьТоваров КАК ДД
		|	ЛЕВОЕ СОЕДИНЕНИЕ ЗнаменателиПриходов КАК Знаменатели
		|		ПО Знаменатели.Регистратор = ДД.Регистратор
		|		И Знаменатели.Организация = ДД.Организация
		|		И Знаменатели.Партия = ДД.Партия
		|		И Знаменатели.АналитикаУчетаПартий = ДД.АналитикаУчетаПартий
		|		И Знаменатели.АналитикаФинансовогоУчета = ДД.АналитикаФинансовогоУчета
        |		И Знаменатели.НалоговоеНазначение = ДД.НалоговоеНазначение
		|		И Знаменатели.АналитикаУчетаНоменклатуры = ДД.АналитикаУчетаНоменклатуры
		|		И Знаменатели.ВидЗапасов = ДД.ВидЗапасов
		|		И Знаменатели.РазделУчета = ДД.РазделУчета
		|		И ДД.СлужебноеВидДвиженияПриход
		|		И НЕ Знаменатели.ЭтоДопРасходы
		|	ЛЕВОЕ СОЕДИНЕНИЕ ВТРасчетныеЦены КАК Цены
		|		ПО Цены.Организация = ДД.Организация
		|		И Цены.Партия = ДД.Партия
		|		И Цены.АналитикаУчетаПартий = ДД.АналитикаУчетаПартий
		|		И Цены.АналитикаФинансовогоУчета = ДД.АналитикаФинансовогоУчета
        |		И Цены.НалоговоеНазначение = ДД.НалоговоеНазначение
		|		И Цены.АналитикаУчетаНоменклатуры = ДД.АналитикаУчетаНоменклатуры
		|		И Цены.ВидЗапасов = ДД.ВидЗапасов
		|		И Цены.РазделУчета = ДД.РазделУчета
		|	ЛЕВОЕ СОЕДИНЕНИЕ ВТПлановыеЦены КАК ПлановыеЦены
		|		ПО ПлановыеЦены.АналитикаУчетаНоменклатуры = ДД.АналитикаУчетаНоменклатуры
		|	ЛЕВОЕ СОЕДИНЕНИЕ ВТОтборАналитикиУчетаПартийНДС2_4 КАК АналитикиУчетаПартий
		|		ПО ДД.АналитикаУчетаПартий = АналитикиУчетаПартий.Ссылка
		|ГДЕ
		|	ДД.Организация В (&ОрганизацииСУчетомПартийНДСВерсии24)
		|	И ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ВозвратПрошлыхПериодов)
		|
		|СГРУППИРОВАТЬ ПО
		|	ДД.ДокументИсточник,
		|	ДД.Организация,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.ВидЗапасов,
		|	ДД.Партия,
		|	ДД.АналитикаУчетаПартий,
		|	ЕСТЬNULL(АналитикиУчетаПартий.Ссылка, ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка)),
		|	ЕСТЬNULL(ДД.АналитикаУчетаНоменклатуры.Назначение.НаправлениеДеятельности, ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка)),
        |	ВЫБОР
        |		КОГДА ДД.КорНалоговоеНазначение = ЗНАЧЕНИЕ(Справочник.НалоговыеНазначенияАктивовИЗатрат.ПустаяСсылка)
        |			ТОГДА ДД.НалоговоеНазначение
        |		ИНАЧЕ ДД.КорНалоговоеНазначение
        |	КОНЕЦ
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	(ВЫБОР
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Партия)
		|		КОГДА НЕ ДД.СлужебноеВидДвиженияПриход
		|			И ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ОтклонениеВСтоимости)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение)
		//++ НЕ УТ
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Партия)
		|			И ДД.Регистратор ССЫЛКА Документ.ОтчетПереработчика
		|			И ДД.Количество = 0
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходы)
		//-- НЕ УТ
		|		ИНАЧЕ ДД.ТипЗаписи КОНЕЦ) КАК ТипЗаписи,
		|	ЛОЖЬ КАК Сторно,
		|	СУММА(ВЫБОР
		|			КОГДА ЕСТЬNULL(Знаменатели.Знаменатель, 0) <> 0
		|				ТОГДА Знаменатели.Знаменатель
		|			КОГДА ДД.СтоимостьРегл <> 0
		|				ТОГДА ДД.СтоимостьРегл
		|				ИНАЧЕ ВЫРАЗИТЬ(ДД.Количество * ЕСТЬNULL(Цены.СтоимостьРегл, ЕСТЬNULL(ПлановыеЦены.Цена, 0)) КАК ЧИСЛО(31,2))
		|		  КОНЕЦ) КАК Знаменатель,
		|	СУММА(ЕСТЬNULL(Знаменатели.ЗнаменательДляИсточников, 0)) КАК ЗнаменательДляИсточников,
		|	ДД.АналитикаУчетаНоменклатуры.Номенклатура КАК Номенклатура,
		|	ДД.АналитикаУчетаНоменклатуры.Характеристика КАК Характеристика,
		|	ЕСТЬNULL(ДД.АналитикаУчетаНоменклатуры.Назначение.НаправлениеДеятельности, ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка)) КАК НаправлениеДеятельности,
		|	
		|	ДД.Период,
		|	ДД.Регистратор,
		|	ВЫБОР КОГДА ДД.СлужебноеВидДвиженияПриход
		|		 ТОГДА ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|		ИНАЧЕ ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
		|	КОНЕЦ КАК ВидДвижения,
		|	ДД.Организация,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.ВидЗапасов,
		|	(ВЫБОР
		|		КОГДА ДД.Организация В (&ОрганизацииСФИФОСкользящая)
		|			ТОГДА ДД.Партия
		|		КОГДА ДД.ТипЗаписи В (
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходы),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыСПартией),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыБезПартии),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаСтоимости),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаПриобретенияПрошлогоПериода),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ОтклонениеВСтоимости))
		|			ТОГДА ДД.ДокументИсточник
		|		ИНАЧЕ ДД.Регистратор КОНЕЦ) КАК Партия,
		|	ЕСТЬNULL(АналитикиУчетаПартий.Ссылка, ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка)) КАК АналитикаУчетаПартий,
        |	ДД.НалоговоеНазначение,
		|	(ВЫБОР
		|		КОГДА НЕ ДД.СлужебноеВидДвиженияПриход
		|		 И ДД.ТипЗаписи В (
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ОтклонениеВСтоимости),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаПриобретенияПрошлогоПериода))
		|			ТОГДА ДД.АналитикаУчетаНоменклатуры
		|		ИНАЧЕ ДД.КорАналитикаУчетаНоменклатуры КОНЕЦ) КАК КорАналитикаУчетаНоменклатуры,
		|	(ВЫБОР
		|		КОГДА НЕ ДД.СлужебноеВидДвиженияПриход
		|		 И ДД.ТипЗаписи В (
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ОтклонениеВСтоимости),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаПриобретенияПрошлогоПериода))
		|			ТОГДА ДД.ВидЗапасов
		|		ИНАЧЕ ДД.КорВидЗапасов КОНЕЦ) КАК КорВидЗапасов,
		|
		|	(ВЫБОР
		|		КОГДА ДД.ТипЗаписи В (
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходы),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыСПартией),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыБезПартии),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.РаспределениеПоВыбывшимТоварам))
		|			ТОГДА ДД.КорАналитикаУчетаПартий
		|		КОГДА ДД.ТипЗаписи В (ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаСтоимости), ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаПриобретенияПрошлогоПериода))
		|		 И ДД.Количество = 0
		|		 И ДД.КорАналитикаУчетаПартий <> ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка)
		|			ТОГДА ДД.КорАналитикаУчетаПартий
		|		КОГДА ДД.АналитикаУчетаПартий = ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка)
		|			ТОГДА ДД.КорАналитикаУчетаПартий
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Партия) И ДД.Количество = 0
		|		 И ДД.КорАналитикаУчетаПартий <> ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка)
		|			ТОГДА ДД.КорАналитикаУчетаПартий
		|		ИНАЧЕ ДД.АналитикаУчетаПартий КОНЕЦ) КАК АналитикаУчетаДокументаПоступления,
		|	(ВЫБОР
		|		КОГДА НЕ Корректировка.ВидКорректировки ЕСТЬ NULL
		|		 И Корректировка.ВидКорректировки <> ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.КорректировкаПоСогласованиюСторон)
		|			ТОГДА Корректировка.ДокументОснование
		|		ИНАЧЕ ДД.Регистратор КОНЕЦ) КАК ДокументПоступления,
		|
		|	СУММА(ДД.Количество) КАК Количество,
		|	СУММА(ДД.СтоимостьРегл + ДД.ДопРасходыРегл
		|		+ ВЫБОР
        |			КОГДА ДД.НалоговоеНазначение.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ВидыДеятельностиНДС.Необлагаемая) 
        |				ТОГДА -ДД.НДСРеглРеквизит
		|			ИНАЧЕ 0
		|	КОНЕЦ - ЕСТЬNULL(СписаниеОтклонений.ДопРасходыРегл, 0)) КАК СтоимостьБезНДС,
        |	СУММА(ДД.НДСРеглРеквизит - ЕСТЬNULL(СписаниеОтклонений.НДСРеглРеквизит, 0)) КАК НДС,
		|	СУММА(ВЫБОР КОГДА &УправленческийУчетОрганизаций
		|		ТОГДА ДД.СтоимостьУпр + ДД.ДопРасходыУпр
		|			+ ВЫБОР
        |			    КОГДА ДД.НалоговоеНазначение.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ВидыДеятельностиНДС.Необлагаемая) 
		|				ТОГДА -ДД.НДСУпр
		|				ИНАЧЕ 0
		|			  КОНЕЦ - ЕСТЬNULL(СписаниеОтклонений.ДопРасходыУпр, 0)
		|		ИНАЧЕ 0
		|	КОНЕЦ) КАК СтоимостьБезНДСУпр,
		|	СУММА(ВЫБОР
		|		КОГДА &УправленческийУчетОрганизаций
		|			ТОГДА ДД.НДСУпр - ЕСТЬNULL(СписаниеОтклонений.НДСУпр, 0)
		|		ИНАЧЕ 0
		|	КОНЕЦ) КАК НДСУпр,
		|
		|	ДД.ХозяйственнаяОперация,
        |	ДД.КорНалоговоеНазначение,
		|	ДД.КорОрганизация,
		|	ДД.КорПартия,
		|	ЕСТЬNULL(КорАналитикиУчетаПартий.Ссылка, ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка)) КАК КорАналитикаУчетаПартий,
		|	ЕСТЬNULL(ДД.КорАналитикаУчетаНоменклатуры.Назначение.НаправлениеДеятельности, ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка)) КАК КорНаправлениеДеятельности,
		|	ДД.Подразделение,
		|	(ВЫБОР
		|		КОГДА ДД.СтатьяРасходовСписания <> ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиРасходов.ПустаяСсылка)
		|		 И ДД.СтатьяРасходовСписания <> НЕОПРЕДЕЛЕНО
		|			ТОГДА ДД.СтатьяРасходовСписания
		|		КОГДА ДД.СтатьяАктивовПассивов <> ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиАктивовПассивов.ПустаяСсылка)
		|			ТОГДА ДД.СтатьяАктивовПассивов
		|		ИНАЧЕ НЕОПРЕДЕЛЕНО КОНЕЦ) КАК СтатьяРасходовАктивов,
		|	ДД.АналитикаРасходов,
		|	ДД.АналитикаАктивовПассивов КАК АналитикаАктивов,
		|	(ВЫБОР
		|		КОГДА НЕ ДД.Организация В (&ОрганизацииСФИФОСкользящая)
		|		 И Реестр.ДатаДокументаИБ < &НачалоПериода
		|			ТОГДА НЕОПРЕДЕЛЕНО
		|		КОГДА ДД.Партия <> НЕОПРЕДЕЛЕНО
		|		 И ДД.ТипЗаписи В (
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходы),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыСПартией),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыБезПартии),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаСтоимости),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаПриобретенияПрошлогоПериода),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ОтклонениеВСтоимости))
		|			ТОГДА ДД.Партия
		|		ИНАЧЕ ДД.ДокументИсточник КОНЕЦ) КАК ДокументИсточник
		|ПОМЕСТИТЬ ПриходыТоваровНДС2_4
		|ИЗ
		|	ВТКэшРасчетныеОборотыСебестоимостьТоваров КАК ДД
		|	ЛЕВОЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаПоПартнерам КАК АналитикаРасчетов
		|		ПО АналитикаРасчетов.Ссылка = ДД.АналитикаУчетаПоПартнерам
		|	ЛЕВОЕ СОЕДИНЕНИЕ Справочник.ДоговорыКонтрагентов КАК Договоры
		|		ПО Договоры.Ссылка = АналитикаРасчетов.Договор
		|	ЛЕВОЕ СОЕДИНЕНИЕ Документ.КорректировкаПриобретения КАК Корректировка
		|		ПО Корректировка.Ссылка = ДД.Регистратор
		|	ЛЕВОЕ СОЕДИНЕНИЕ СписаниеОтклоненийВСтоимости2_4 КАК СписаниеОтклонений
		|		ПО СписаниеОтклонений.Организация = ДД.Организация
		|		И СписаниеОтклонений.Партия = ДД.Партия
		|		И СписаниеОтклонений.АналитикаУчетаПартий = ДД.АналитикаУчетаПартий
        |		И СписаниеОтклонений.НалоговоеНазначение = ДД.НалоговоеНазначение
		|		И СписаниеОтклонений.НаправлениеДеятельности = ЕСТЬNULL(ДД.АналитикаУчетаНоменклатуры.Назначение.НаправлениеДеятельности, ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка))
		|		И ДД.СлужебноеВидДвиженияПриход
		|	ЛЕВОЕ СОЕДИНЕНИЕ ЗнаменателиПриходов КАК Знаменатели
		|		ПО Знаменатели.Регистратор = ДД.Регистратор
		|		И Знаменатели.Организация = ДД.Организация
		|		И Знаменатели.Партия = ДД.Партия
		|		И Знаменатели.АналитикаУчетаПартий = ДД.АналитикаУчетаПартий
		|		И Знаменатели.АналитикаФинансовогоУчета = ДД.АналитикаФинансовогоУчета
        |		И Знаменатели.НалоговоеНазначение = ДД.НалоговоеНазначение
		|		И Знаменатели.АналитикаУчетаНоменклатуры = ДД.АналитикаУчетаНоменклатуры
		|		И Знаменатели.ВидЗапасов = ДД.ВидЗапасов
		|		И Знаменатели.РазделУчета = ДД.РазделУчета
		|		И ДД.СлужебноеВидДвиженияПриход
		|		И ВЫБОР КОГДА ДД.ТипЗаписи В (
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаСтоимости),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаПриобретенияПрошлогоПериода),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ОтклонениеВСтоимости),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходы),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыБезПартии),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыСПартией))
		|			ТОГДА ИСТИНА
		|			ИНАЧЕ ЛОЖЬ
		|		  КОНЕЦ = Знаменатели.ЭтоДопРасходы
		|	ЛЕВОЕ СОЕДИНЕНИЕ ВТРасчетныеЦены КАК Цены
		|		ПО Цены.Организация = ДД.Организация
		|		И Цены.Партия = ДД.Партия
		|		И Цены.АналитикаУчетаПартий = ДД.АналитикаУчетаПартий
		|		И Цены.АналитикаФинансовогоУчета = ДД.АналитикаФинансовогоУчета
        |		И Цены.НалоговоеНазначение = ДД.НалоговоеНазначение
		|		И Цены.АналитикаУчетаНоменклатуры = ДД.АналитикаУчетаНоменклатуры
		|		И Цены.ВидЗапасов = ДД.ВидЗапасов
		|		И Цены.РазделУчета = ДД.РазделУчета
		|	ЛЕВОЕ СОЕДИНЕНИЕ ВТПлановыеЦены КАК ПлановыеЦены
		|		ПО ПлановыеЦены.АналитикаУчетаНоменклатуры = ДД.АналитикаУчетаНоменклатуры
		|	ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.РеестрДокументов КАК Реестр
		|		ПО Реестр.Ссылка = ДД.ДокументИсточник
		|		И НЕ Реестр.ДополнительнаяЗапись
		|		И Реестр.Ссылка <> НЕОПРЕДЕЛЕНО
		|	ЛЕВОЕ СОЕДИНЕНИЕ ВТОтборАналитикиУчетаПартийНДС2_4 КАК АналитикиУчетаПартий
		|		ПО ДД.АналитикаУчетаПартий = АналитикиУчетаПартий.Ссылка
		|	ЛЕВОЕ СОЕДИНЕНИЕ ВТОтборАналитикиУчетаПартийНДС2_4 КАК КорАналитикиУчетаПартий
		|		ПО ДД.КорАналитикаУчетаПартий = КорАналитикиУчетаПартий.Ссылка
		|ГДЕ
		|	ДД.Организация В (&ОрганизацииСУчетомПартийНДСВерсии24)
		|	И ДД.Партия <> НЕОПРЕДЕЛЕНО
		|	И ДД.РазделУчета <> ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НеотфактурованныеПоставки)
		|   И (ДД.СлужебноеВидДвиженияПриход
		|		ИЛИ ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ОтклонениеВСтоимости)
		|		ИЛИ ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.РаспределениеПоВыбывшимТоварам)
		|		ИЛИ ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаПриобретенияПрошлогоПериода))
		// Исключаем суммовую корректировку приобретения, если корректируемый документ относится к периоду с выключенным партионным учетом.
		|	И НЕ (
		|		ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаПриобретенияПрошлогоПериода)
		|		И ДД.СлужебноеВидДвиженияПриход
		|		И ДД.Количество = 0
		|		И Реестр.ДатаДокументаИБ < &ДатаПереходаНаПартионныйУчетВерсии22
		|		И &ИспользовалсяПартионныйУчетДоПереходаНаВерсию22 = ЛОЖЬ)
        |	И (ДД.НДСРеглРеквизит <> 0
		|		ИЛИ ДД.НДСУпр <> 0
		|		ИЛИ ДД.Регистратор ССЫЛКА Документ.СборкаТоваров
		|		ИЛИ ДД.Регистратор ССЫЛКА Документ.ТаможеннаяДекларацияИмпорт
		|		ИЛИ ДД.Регистратор ССЫЛКА Документ.ПорчаТоваров
		|		ИЛИ ДД.Регистратор ССЫЛКА Документ.ПересортицаТоваров
		|		ИЛИ ДД.Регистратор ССЫЛКА Документ.ОприходованиеИзлишковТоваров
		|		ИЛИ ДД.ХозяйственнаяОперация В (
		|			ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаПоИмпорту),
		|			ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаПоИмпортуТоварыВПути))
		//++ НЕ УТ
		|		ИЛИ ДД.Регистратор ССЫЛКА Документ.ВыпускПродукции
		|		ИЛИ ДД.Регистратор ССЫЛКА Документ.ПроизводствоБезЗаказа
		//-- НЕ УТ
		|		ИЛИ ДД.Регистратор ССЫЛКА Документ.ПоступлениеТоваровНаСклад
		|		)
		// Исключаем возвратные отходы в производственных затратах
		|	И НЕ (
		|		ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение)
		|		И ДД.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукцииФиксированнаяСтоимость)
		|		)
		// Исключаем выпуск продукции по плановой стоимости
		|	И НЕ (
		|		ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Партия)
		|		И ДД.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукции)
		|		И ДД.Количество <> 0
		|		И ДД.СтоимостьРегл <> 0
		|		)
		//++ НЕ УТ
		|	И НЕ (
		|		ТИПЗНАЧЕНИЯ(ДД.Регистратор) = ТИП(Документ.ПроизводствоБезЗаказа)
		|		И ((ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Партия)
		|			И ДД.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПередачаПродукцииИзПроизводства))
		|		  ИЛИ
		|		  (ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение)
		|			И ДД.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукции)))
		|		И ДД.Количество <> 0
		|		И ДД.СтоимостьРегл <> 0
		|		)
		//-- НЕ УТ
		|	И (ДД.ТипЗаписи В (
		|		ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Партия),
		|		ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходы),
		|		ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыСПартией),
		|		ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыБезПартии),
		|		ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.РаспределениеПоВыбывшимТоварам),
		|		ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ОтклонениеВСтоимости),
		|		ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаПриобретенияПрошлогоПериода),
		|		ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаСтоимости),
		|		ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение))
		//++ НЕ УТ
		|		ИЛИ (ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Партия)
		|			И ДД.Количество = 0
		|			И ДД.Регистратор ССЫЛКА Документ.ОтчетПереработчика)
		//-- НЕ УТ
		|		)
        |	И ДД.НалоговоеНазначение <> ЗНАЧЕНИЕ(Справочник.НалоговыеНазначенияАктивовИЗатрат.ПустаяСсылка)
		|	И (ДД.РазделУчета <> ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НезавершенноеПроизводство)
		//++ НЕ УТ
		|		ИЛИ ДД.Регистратор ССЫЛКА Документ.ОтчетПереработчика
		|			И ДД.ТипЗаписи <> ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение)
		//-- НЕ УТ     
		|		ИЛИ ДД.СлужебноеВидДвиженияПриход
		|			И ДД.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукцииФиксированнаяСтоимость)
		|		)
		|	И НЕ ДД.РазделУчета В (
		|		ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПринятыеНаКомиссию),
		|		ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.МатериалыПринятыеВПереработку),
		|		ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НеотфактурованныеПоставки))
		|	И (ВЫБОР
		|		КОГДА ДД.ТипЗаписи В (
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходы),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыСПартией),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыБезПартии),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.РаспределениеПоВыбывшимТоварам))
		|		И ДД.СлужебноеВидДвиженияПриход
		|			ТОГДА ДД.КорАналитикаУчетаПартий
		|		КОГДА ДД.АналитикаУчетаПартий = ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка)
		|			ТОГДА ДД.КорАналитикаУчетаПартий
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Партия) И ДД.Количество = 0
		|		 И ДД.КорАналитикаУчетаПартий <> ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка)
		|			ТОГДА ДД.КорАналитикаУчетаПартий
		|		ИНАЧЕ ДД.АналитикаУчетаПартий КОНЕЦ) <> ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка)
		|	И НЕ ДД.Регистратор ССЫЛКА Документ.ОтчетКомитентуОСписании
		|	И НЕ ((ДД.Регистратор ССЫЛКА Документ.ВводОстатков
		|				И НЕ ВЫРАЗИТЬ(ДД.Регистратор КАК Документ.ВводОстатков).ВводОстатков22)
		|			ИЛИ ДД.Регистратор ССЫЛКА Документ.ВводОстатковТоваров)
		|	И НЕ (НЕ Корректировка.ВидКорректировки ЕСТЬ NULL
		|			И Корректировка.ВидКорректировки = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.КорректировкаПоСогласованиюСторон)
		|			И ДД.Количество = 0
		|			И (ДД.СтоимостьРегл < 0 ИЛИ ДД.ДопРасходыРегл < 0))
		//++ НЕ УТ
		|	И НЕ (ДД.Регистратор ССЫЛКА Документ.ВыпускПродукции
		|			И ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Партия))
		//-- НЕ УТ           
		|СГРУППИРОВАТЬ ПО
		|	(ВЫБОР
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Партия)
		|		КОГДА НЕ ДД.СлужебноеВидДвиженияПриход
		|			И ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ОтклонениеВСтоимости)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение)
		//++ НЕ УТ
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Партия)
		|			И ДД.Регистратор ССЫЛКА Документ.ОтчетПереработчика
		|			И ДД.Количество = 0
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходы)
		//-- НЕ УТ
		|		ИНАЧЕ ДД.ТипЗаписи КОНЕЦ),
		|	ДД.АналитикаУчетаНоменклатуры.Номенклатура,
		|	ДД.АналитикаУчетаНоменклатуры.Характеристика,
		|	ЕСТЬNULL(ДД.АналитикаУчетаНоменклатуры.Назначение.НаправлениеДеятельности, ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка)),
        |	ДД.АналитикаУчетаПартий.НалоговоеНазначение,
		|	ДД.Период,
		|	ДД.Регистратор,
		|	ВЫБОР КОГДА ДД.СлужебноеВидДвиженияПриход
		|		 ТОГДА ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|		ИНАЧЕ ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
		|	КОНЕЦ,
		|	ДД.Организация,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.ВидЗапасов,
		|	(ВЫБОР
		|		КОГДА ДД.Организация В (&ОрганизацииСФИФОСкользящая)
		|			ТОГДА ДД.Партия
		|		КОГДА ДД.ТипЗаписи В (
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходы),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыСПартией),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыБезПартии),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаСтоимости),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаПриобретенияПрошлогоПериода),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ОтклонениеВСтоимости))
		|			ТОГДА ДД.ДокументИсточник
		|		ИНАЧЕ ДД.Регистратор КОНЕЦ),
		|	ЕСТЬNULL(АналитикиУчетаПартий.Ссылка, ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка)),
        |	ДД.НалоговоеНазначение,
		|	(ВЫБОР
		|		КОГДА НЕ ДД.СлужебноеВидДвиженияПриход
		|		 И ДД.ТипЗаписи В (
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ОтклонениеВСтоимости),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаПриобретенияПрошлогоПериода))
		|			ТОГДА ДД.АналитикаУчетаНоменклатуры
		|		ИНАЧЕ ДД.КорАналитикаУчетаНоменклатуры КОНЕЦ),
		|	(ВЫБОР
		|		КОГДА НЕ ДД.СлужебноеВидДвиженияПриход
		|		 И ДД.ТипЗаписи В (
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ОтклонениеВСтоимости),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаПриобретенияПрошлогоПериода))
		|			ТОГДА ДД.ВидЗапасов
		|		ИНАЧЕ ДД.КорВидЗапасов КОНЕЦ),
		|	ЕСТЬNULL(ДД.АналитикаУчетаНоменклатуры.Назначение.НаправлениеДеятельности, ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка)),
		|	(ВЫБОР
		|		КОГДА ДД.ТипЗаписи В (
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходы),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыСПартией),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыБезПартии),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.РаспределениеПоВыбывшимТоварам))
		|			ТОГДА ДД.КорАналитикаУчетаПартий
		|		КОГДА ДД.ТипЗаписи В (ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаСтоимости), ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаПриобретенияПрошлогоПериода))
		|		 И ДД.Количество = 0
		|		 И ДД.КорАналитикаУчетаПартий <> ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка)
		|			ТОГДА ДД.КорАналитикаУчетаПартий
		|		КОГДА ДД.АналитикаУчетаПартий = ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка)
		|			ТОГДА ДД.КорАналитикаУчетаПартий
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Партия) И ДД.Количество = 0
		|		 И ДД.КорАналитикаУчетаПартий <> ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка)
		|			ТОГДА ДД.КорАналитикаУчетаПартий
		|		ИНАЧЕ ДД.АналитикаУчетаПартий КОНЕЦ),
		|	(ВЫБОР
		|		КОГДА НЕ Корректировка.ВидКорректировки ЕСТЬ NULL
		|		 И Корректировка.ВидКорректировки <> ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.КорректировкаПоСогласованиюСторон)
		|			ТОГДА Корректировка.ДокументОснование
		|		ИНАЧЕ ДД.Регистратор КОНЕЦ),
		|	ДД.ХозяйственнаяОперация,
        |	ДД.КорНалоговоеНазначение,
		|	ДД.КорОрганизация,
		|	ДД.КорПартия,
		|	ЕСТЬNULL(КорАналитикиУчетаПартий.Ссылка, ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка)),
		|	ЕСТЬNULL(ДД.КорАналитикаУчетаНоменклатуры.Назначение.НаправлениеДеятельности, ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка)),
		|	ДД.Подразделение,
		|	(ВЫБОР
		|		КОГДА ДД.СтатьяРасходовСписания <> ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиРасходов.ПустаяСсылка)
		|		 И ДД.СтатьяРасходовСписания <> НЕОПРЕДЕЛЕНО
		|			ТОГДА ДД.СтатьяРасходовСписания
		|		КОГДА ДД.СтатьяАктивовПассивов <> ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиАктивовПассивов.ПустаяСсылка)
		|			ТОГДА ДД.СтатьяАктивовПассивов
		|		ИНАЧЕ НЕОПРЕДЕЛЕНО КОНЕЦ),
		|	ДД.АналитикаРасходов,
		|	ДД.АналитикаАктивовПассивов,
		|	(ВЫБОР
		|		КОГДА НЕ ДД.Организация В (&ОрганизацииСФИФОСкользящая)
		|		 И Реестр.ДатаДокументаИБ < &НачалоПериода
		|			ТОГДА НЕОПРЕДЕЛЕНО
		|		КОГДА ДД.Партия <> НЕОПРЕДЕЛЕНО
		|		 И ДД.ТипЗаписи В (
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходы),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыСПартией),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыБезПартии),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаСтоимости),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаПриобретенияПрошлогоПериода),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ОтклонениеВСтоимости))
		|			ТОГДА ДД.Партия
		|		ИНАЧЕ ДД.ДокументИсточник КОНЕЦ)
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение) КАК ТипЗаписи,
		|	ЛОЖЬ КАК Сторно,
		|	СУММА(ДД.СтоимостьРегл) КАК Знаменатель,
		|	СУММА(ДД.СтоимостьРегл) КАК ЗнаменательДляИсточников,
		|	ДД.АналитикаУчетаНоменклатуры.Номенклатура КАК Номенклатура,
		|	ДД.АналитикаУчетаНоменклатуры.Характеристика КАК Характеристика,
		|	ЕСТЬNULL(ДД.АналитикаУчетаНоменклатуры.Назначение.НаправлениеДеятельности, ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка)) КАК НаправлениеДеятельности,
		|	
		|	ДД.Период,
		|	ДД.Регистратор,
		|	ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход) КАК ВидДвижения,
		|	ДД.Организация,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.ВидЗапасов,
		|	ДД.Партия,
		|	ЕСТЬNULL(АналитикиУчетаПартий.Ссылка, ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка)) КАК АналитикаУчетаПартий,
        |	ДД.НалоговоеНазначение,
		|	ДД.КорАналитикаУчетаНоменклатуры КАК КорАналитикаУчетаНоменклатуры,
		|	ДД.КорВидЗапасов КАК КорВидЗапасов,
		|
		|	(ВЫБОР
		|		КОГДА ДД.АналитикаУчетаПартий = ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка)
		|			ТОГДА ДД.КорАналитикаУчетаПартий
		|		ИНАЧЕ ДД.АналитикаУчетаПартий КОНЕЦ) КАК АналитикаУчетаДокументаПоступления,
		|	ДД.Регистратор КАК ДокументПоступления,
		|
		|	СУММА(ДД.Количество) КАК Количество,
		|	СУММА(СписаниеОтклонений.ДопРасходыРегл
		|		+ ВЫБОР
        |			КОГДА ДД.НалоговоеНазначение.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ВидыДеятельностиНДС.Необлагаемая) 
        |				ТОГДА -СписаниеОтклонений.НДСРеглРеквизит
		|			ИНАЧЕ 0
		|	КОНЕЦ) КАК СтоимостьБезНДС,
        |	СУММА(СписаниеОтклонений.НДСРеглРеквизит) КАК НДС,
		|	СУММА(ВЫБОР КОГДА &УправленческийУчетОрганизаций
		|		ТОГДА СписаниеОтклонений.ДопРасходыУпр
		|			+ ВЫБОР
        |			    КОГДА ДД.НалоговоеНазначение.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ВидыДеятельностиНДС.Необлагаемая) 
		|				ТОГДА -СписаниеОтклонений.НДСУпр
		|				ИНАЧЕ 0
		|			  КОНЕЦ
		|		ИНАЧЕ 0
		|	КОНЕЦ) КАК СтоимостьБезНДСУпр,
		|	СУММА(ВЫБОР
		|		КОГДА &УправленческийУчетОрганизаций
		|			ТОГДА СписаниеОтклонений.НДСУпр
		|		ИНАЧЕ 0
		|	КОНЕЦ) КАК НДСУпр,
		|
		|	ДД.ХозяйственнаяОперация,
        |	ДД.КорНалоговоеНазначение,
		|	ДД.КорОрганизация,
		|	ДД.КорПартия,
		|	ЕСТЬNULL(КорАналитикиУчетаПартий.Ссылка, ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка)) КАК КорАналитикаУчетаПартий,
		|	ЕСТЬNULL(ДД.КорАналитикаУчетаНоменклатуры.Назначение.НаправлениеДеятельности, ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка)) КАК КорНаправлениеДеятельности,
		|	ДД.Подразделение,
		|	НЕОПРЕДЕЛЕНО КАК СтатьяРасходовАктивов,
		|	ДД.АналитикаРасходов,
		|	ДД.АналитикаАктивовПассивов КАК АналитикаАктивов,
		|	(ВЫБОР
		|		КОГДА ДД.Партия <> НЕОПРЕДЕЛЕНО
		|			ТОГДА ДД.Партия
		|		ИНАЧЕ ДД.ДокументИсточник КОНЕЦ) КАК ДокументИсточник
		|ИЗ
		|	ВТКэшРасчетныеОборотыСебестоимостьТоваров КАК ДД
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ СписаниеОтклоненийВСтоимости2_4 КАК СписаниеОтклонений
		|		ПО СписаниеОтклонений.Организация = ДД.Организация
		|		И СписаниеОтклонений.Партия = ДД.Партия
		|		И СписаниеОтклонений.АналитикаУчетаПартий = ДД.АналитикаУчетаПартий
        |		И СписаниеОтклонений.НалоговоеНазначение = ДД.НалоговоеНазначение
		|		И СписаниеОтклонений.НаправлениеДеятельности = ЕСТЬNULL(ДД.АналитикаУчетаНоменклатуры.Назначение.НаправлениеДеятельности, ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка))
		|		И ДД.СлужебноеВидДвиженияПриход
		|	ЛЕВОЕ СОЕДИНЕНИЕ ВТОтборАналитикиУчетаПартийНДС2_4 КАК АналитикиУчетаПартий
		|		ПО ДД.АналитикаУчетаПартий = АналитикиУчетаПартий.Ссылка
		|	ЛЕВОЕ СОЕДИНЕНИЕ ВТОтборАналитикиУчетаПартийНДС2_4 КАК КорАналитикиУчетаПартий
		|		ПО ДД.КорАналитикаУчетаПартий = КорАналитикиУчетаПартий.Ссылка
		|ГДЕ
		|	ДД.Организация В (&ОрганизацииСУчетомПартийНДСВерсии24)
		|	И ДД.Партия <> НЕОПРЕДЕЛЕНО
		|	И ДД.РазделУчета <> ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НеотфактурованныеПоставки)
		|	И ДД.СлужебноеВидДвиженияПриход
		|	И ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ОтклонениеВСтоимости)
        |	И ДД.НалоговоеНазначение <> ЗНАЧЕНИЕ(Справочник.НалоговыеНазначенияАктивовИЗатрат.ПустаяСсылка)
		|	И ДД.РазделУчета <> ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НеотфактурованныеПоставки)
		|	И (ВЫБОР
		|		КОГДА ДД.АналитикаУчетаПартий = ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка)
		|			ТОГДА ДД.КорАналитикаУчетаПартий
		|		ИНАЧЕ ДД.АналитикаУчетаПартий КОНЕЦ) <> ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка)
		|СГРУППИРОВАТЬ ПО
		|	ДД.АналитикаУчетаНоменклатуры.Номенклатура,
		|	ДД.АналитикаУчетаНоменклатуры.Характеристика,
        |	ДД.АналитикаУчетаПартий.НалоговоеНазначение,
		|	ДД.Период,
		|	ДД.Регистратор,
		|	ДД.Организация,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.ВидЗапасов,
		|	ДД.Партия,
		|	ЕСТЬNULL(АналитикиУчетаПартий.Ссылка, ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка)),
        |	ДД.НалоговоеНазначение,
		|	ДД.КорАналитикаУчетаНоменклатуры,
		|	ДД.КорВидЗапасов,
		|	ЕСТЬNULL(ДД.АналитикаУчетаНоменклатуры.Назначение.НаправлениеДеятельности, ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка)),
		|	(ВЫБОР
		|		КОГДА ДД.АналитикаУчетаПартий = ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка)
		|			ТОГДА ДД.КорАналитикаУчетаПартий
		|		ИНАЧЕ ДД.АналитикаУчетаПартий КОНЕЦ),
		|	ДД.ХозяйственнаяОперация,
        |	ДД.КорНалоговоеНазначение,
		|	ДД.КорОрганизация,
		|	ДД.КорПартия,
		|	ЕСТЬNULL(КорАналитикиУчетаПартий.Ссылка, ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка)),
		|	ЕСТЬNULL(ДД.КорАналитикаУчетаНоменклатуры.Назначение.НаправлениеДеятельности, ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка)),
		|	ДД.Подразделение,
		|	ДД.АналитикаРасходов,
		|	ДД.АналитикаАктивовПассивов,
		|	(ВЫБОР
		|		КОГДА ДД.Партия <> НЕОПРЕДЕЛЕНО
		|			ТОГДА ДД.Партия
		|		ИНАЧЕ ДД.ДокументИсточник КОНЕЦ)
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ОстатокСгруппированный) КАК ТипЗаписи,
		|	ЛОЖЬ КАК Сторно,
		|	СУММА(ДД.СтоимостьБезНДС
        |			+ ВЫБОР КОГДА ДД.НалоговоеНазначение.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ВидыДеятельностиНДС.Необлагаемая) 
		|				ТОГДА ДД.НДС
		|				ИНАЧЕ 0
		|			  КОНЕЦ) КАК Знаменатель,
		|	0 КАК ЗнаменательДляИсточников,
		|	ДД.Номенклатура КАК Номенклатура,
		|	ДД.Характеристика КАК Характеристика,
		|	ДД.НаправлениеДеятельности КАК НаправлениеДеятельности,
		|	
		|	ДД.Период,
		|	ДД.Регистратор,
		|	ВЫБОР КОГДА ДД.СлужебноеВидДвиженияПриход
		|		 ТОГДА ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|		ИНАЧЕ ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
		|	КОНЕЦ КАК ВидДвижения,
		|	ДД.Организация,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаУчетаНоменклатуры,
		|	НЕОПРЕДЕЛЕНО КАК ВидЗапасов,
		|	ДД.Партия,
		|	ДД.АналитикаУчетаПартий,
        |	ДД.НалоговоеНазначение,
		|	ДД.КорАналитикаУчетаНоменклатуры КАК КорАналитикаУчетаНоменклатуры,
		|	ДД.КорВидЗапасов КАК КорВидЗапасов,
		|
		|	ДД.АналитикаУчетаДокументаПоступления КАК АналитикаУчетаДокументаПоступления,
		|	ДД.ДокументПоступления,
		|
		|	0 КАК Количество,
		|	СУММА(ДД.СтоимостьБезНДС) КАК СтоимостьБезНДС,
		|	СУММА(ДД.НДС) КАК НДС,
		|	СУММА(ДД.СтоимостьБезНДСУпр) КАК СтоимостьБезНДСУпр,
		|	СУММА(ДД.НДСУпр) КАК НДСУпр,
		|
		|	ДД.ХозяйственнаяОперация,
        |	ДД.КорНалоговоеНазначение,
		|	НЕОПРЕДЕЛЕНО КАК КорОрганизация,
		|	НЕОПРЕДЕЛЕНО КАК КорПартия,
		|	НЕОПРЕДЕЛЕНО КАК КорАналитикаУчетаПартий,
		|	ДД.КорНаправлениеДеятельности,
		|	ДД.Подразделение,
		|	НЕОПРЕДЕЛЕНО КАК СтатьяРасходовАктивов,
		|	ДД.АналитикаРасходов,
		|	ДД.АналитикаАктивов КАК АналитикаАктивов,
		|	ДД.Регистратор КАК ДокументИсточник
		|ИЗ
        |	ВТКэшРасчетныеОборотыДетализацияПартийТоваровДляНДС2_4 КАК ДД
		|ГДЕ
		|	((ДД.Регистратор ССЫЛКА Документ.ВводОстатков
		|			И НЕ ВЫРАЗИТЬ(Регистратор КАК Документ.ВводОстатков).ВводОстатков22)
		|		ИЛИ ДД.Регистратор ССЫЛКА Документ.ВводОстатков)
		|	И ДД.Организация В (&ОрганизацииСУчетомПартийНДСВерсии24)
		|
		|СГРУППИРОВАТЬ ПО
		|	ДД.ТипЗаписи,
		|	ДД.Номенклатура,
		|	ДД.Характеристика,
		|	ДД.НаправлениеДеятельности,
		|	ДД.Период,
		|	ДД.Регистратор,
		|	ВЫБОР КОГДА ДД.СлужебноеВидДвиженияПриход
		|		 ТОГДА ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|		ИНАЧЕ ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
		|	КОНЕЦ,
		|	ДД.Организация,
		|	ДД.Партия,
		|	ДД.АналитикаУчетаПартий,
        |	ДД.НалоговоеНазначение,
		|	ДД.КорАналитикаУчетаНоменклатуры,
		|	ДД.КорВидЗапасов,
		|	ДД.АналитикаУчетаДокументаПоступления,
		|	ДД.ДокументПоступления,
		|	ДД.ХозяйственнаяОперация,
        |	ДД.КорНалоговоеНазначение,
		|	ДД.КорНаправлениеДеятельности,
		|	ДД.Подразделение,
		|	ДД.АналитикаРасходов,
		|	ДД.АналитикаАктивов
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ВЫБОР
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Партия)
		|		 И ДД.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПоступлениеОтПереработчика)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Перемещение)
		//++ НЕ УТ
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Партия)
		|		 И ДД.Регистратор ССЫЛКА Документ.ВыпускПродукции
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Перемещение)
		//-- НЕ УТ
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Партия)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Выпуск)
		//++ НЕ УТ
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Выпуск) И НЕ ДД.СлужебноеВидДвиженияПриход
		|		 И ДД.Регистратор ССЫЛКА Документ.ВыпускПродукции
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Потребление)
		//-- НЕ УТ
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Потребление) И НЕ ДД.СлужебноеВидДвиженияПриход
		|		 И ДД.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукции)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.СписанияНаВыпуск)
		|
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение) И НЕ ДД.СлужебноеВидДвиженияПриход
		|		 И ДД.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукции)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.СписанияНаВыпуск)
		|
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение) И НЕ ДД.СлужебноеВидДвиженияПриход
		|		 И ДД.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаУПоставщика)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.СписанияНаВыпуск)
		|
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение) И ДД.СлужебноеВидДвиженияПриход
		|		 И ДД.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукции)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Выпуск)
		|
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение) И ДД.СлужебноеВидДвиженияПриход
		|		 И ДД.ХозяйственнаяОперация В (
		|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СписаниеРасходовНаПартииПроизводства),
		|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РаспределениеРасходовНаПартииПроизводства))
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ПеремещениеАвто)
		|
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение) И НЕ ДД.СлужебноеВидДвиженияПриход
		|		 И ДД.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СписаниеТоваровПоТребованию)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Потребление)
		|
		|		ИНАЧЕ ДД.ТипЗаписи
		|	КОНЕЦ КАК ТипЗаписи,
		|	(ВЫБОР
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаПриобретения) ТОГДА ЛОЖЬ
		|		КОГДА ДД.Количество < 0 ТОГДА ИСТИНА
		|		ИНАЧЕ ЛОЖЬ КОНЕЦ) КАК Сторно,
		|	МАКСИМУМ(ЕСТЬNULL(Знаменатели.Знаменатель, 0))
		|		+ СУММА(ВЫБОР
		|			КОГДА ЕСТЬNULL(Знаменатели.Знаменатель, 0) <> 0
		|				ТОГДА 0
		|				ИНАЧЕ ВЫРАЗИТЬ(ДД.Количество * ЕСТЬNULL(Цены.СтоимостьРегл, ЕСТЬNULL(ПлановыеЦены.Цена, 0)) КАК ЧИСЛО(31,2))
		|		  КОНЕЦ) КАК Знаменатель,
		|	МАКСИМУМ(ЕСТЬNULL(Знаменатели.ЗнаменательДляИсточников, 0)) КАК ЗнаменательДляИсточников,
		|	СУММА(ДД.Количество) КАК Количество,
		|	ДД.АналитикаУчетаНоменклатуры.Номенклатура КАК Номенклатура,
		|	ДД.АналитикаУчетаНоменклатуры.Характеристика КАК Характеристика,
		|	ЕСТЬNULL(ДД.АналитикаУчетаНоменклатуры.Назначение.НаправлениеДеятельности, ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка)) КАК НаправлениеДеятельности,
		|	
		|	ДД.Период,
		|	ДД.Регистратор,
		|	ВЫБОР КОГДА ДД.СлужебноеВидДвиженияПриход
		|		 ТОГДА ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|		ИНАЧЕ ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
		|	КОНЕЦ КАК ВидДвижения,
		|	ДД.Организация КАК Организация,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.ВидЗапасов,
		|	ВЫБОР
		//++ НЕ УТ
		|		КОГДА ДД.Партия ССЫЛКА Справочник.ПартииПроизводства
		|		  И НЕ ВЫРАЗИТЬ(ДД.Партия КАК Справочник.ПартииПроизводства).Документ ССЫЛКА Документ.ПроизводствоБезЗаказа
		|		  И НЕ ВЫРАЗИТЬ(ДД.Партия КАК Справочник.ПартииПроизводства).Документ ССЫЛКА Документ.ОтчетПереработчика
		|			ТОГДА ВЫРАЗИТЬ(ДД.Партия КАК Справочник.ПартииПроизводства).Документ
		//-- НЕ УТ
		|		КОГДА ИСТИНА
		|			ТОГДА ДД.Партия
		|	КОНЕЦ КАК Партия,
		|	ЕСТЬNULL(АналитикиУчетаПартий.Ссылка, ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка)) КАК АналитикаУчетаПартий,
        |	ДД.НалоговоеНазначение КАК НалоговоеНазначение,
		|
		|	ДД.ХозяйственнаяОперация,
        |	ДД.КорНалоговоеНазначение КАК КорНалоговоеНазначение,
		|	ДД.КорОрганизация,
		|	ВЫБОР
		//++ НЕ УТ
		|		КОГДА ДД.КорПартия ССЫЛКА Справочник.ПартииПроизводства
		|		  И НЕ ВЫРАЗИТЬ(ДД.КорПартия КАК Справочник.ПартииПроизводства).Документ ССЫЛКА Документ.ПроизводствоБезЗаказа
		|		  И НЕ ВЫРАЗИТЬ(ДД.КорПартия КАК Справочник.ПартииПроизводства).Документ ССЫЛКА Документ.ОтчетПереработчика
		|			ТОГДА ВЫРАЗИТЬ(ДД.КорПартия КАК Справочник.ПартииПроизводства).Документ
		//-- НЕ УТ
		|		КОГДА ИСТИНА
		|			ТОГДА ДД.КорПартия
		|	КОНЕЦ КАК КорПартия,
		|	ЕСТЬNULL(КорАналитикиУчетаПартий.Ссылка, ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка)) КАК КорАналитикаУчетаПартий,
		|	ЕСТЬNULL(ДД.КорАналитикаУчетаНоменклатуры.Назначение.НаправлениеДеятельности, ДД.КорНаправлениеДеятельности) КАК КорНаправлениеДеятельности,
		|	ДД.КорАналитикаУчетаНоменклатуры КАК КорАналитикаУчетаНоменклатуры,
		|	ДД.КорВидЗапасов КАК КорВидЗапасов,
		|	ДД.Подразделение,
        |	ДД.КорАналитикаФинансовогоУчета,
		|	(ВЫБОР
		|		КОГДА ДД.СтатьяРасходовСписания <> ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиРасходов.ПустаяСсылка)
		|		 И ДД.СтатьяРасходовСписания <> НЕОПРЕДЕЛЕНО
		|			ТОГДА ДД.СтатьяРасходовСписания
		|		КОГДА ДД.СтатьяАктивовПассивов <> ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиАктивовПассивов.ПустаяСсылка)
		|			ТОГДА ДД.СтатьяАктивовПассивов
		|		ИНАЧЕ НЕОПРЕДЕЛЕНО КОНЕЦ) КАК СтатьяРасходовАктивов,
		|	ДД.АналитикаРасходов,
		|	ДД.АналитикаАктивовПассивов КАК АналитикаАктивов,
		|	(ВЫБОР
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Партия)
		|		 И ДД.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПоступлениеОтПереработчика)
		|			ТОГДА ДД.Регистратор
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Перемещение)
		|		 И ДД.ДокументИсточник = НЕОПРЕДЕЛЕНО
		|			ТОГДА ДД.Регистратор
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение)
		|		 И ДД.ХозяйственнаяОперация В (
		|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СписаниеРасходовНаПартииПроизводства),
		|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РаспределениеРасходовНаПартииПроизводства))
		|		 И ДД.ДокументИсточник = НЕОПРЕДЕЛЕНО
		|			ТОГДА ДД.Регистратор
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение) И НЕ ДД.СлужебноеВидДвиженияПриход
		|		 И ДД.ХозяйственнаяОперация В (
		|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукции),
		|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукцииНаСклад),
		|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукцииВПодразделение))
		|		 И ДД.ДокументИсточник = НЕОПРЕДЕЛЕНО
		|			ТОГДА ДД.Регистратор
		//++ НЕ УТ
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Потребление) И НЕ ДД.СлужебноеВидДвиженияПриход
		|		 И ДД.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукции)
		|		 И НЕ ДД.Регистратор ССЫЛКА Документ.ПоступлениеОтПереработчика
		|		 И ДД.ДокументИсточник = НЕОПРЕДЕЛЕНО
		|			ТОГДА ДД.Регистратор
		//-- НЕ УТ
		|		ИНАЧЕ ДД.ДокументИсточник КОНЕЦ) КАК ДокументИсточник,
		|		ДД.РазделУчета КАК РазделУчета,
		|		ДД.КорРазделУчета КАК КорРазделУчета
		|ПОМЕСТИТЬ ДвиженияСебестоимостиНДС2_4
		|ИЗ
		|	ВТКэшРасчетныеОборотыСебестоимостьТоваров КАК ДД
		|	ЛЕВОЕ СОЕДИНЕНИЕ Документ.ПередачаТоваровМеждуОрганизациями КАК Передача
		|		ПО Передача.Ссылка = ДД.Регистратор
		|	ЛЕВОЕ СОЕДИНЕНИЕ ЗнаменателиПриходов КАК Знаменатели
		|		ПО Знаменатели.Регистратор = ДД.Регистратор
		|		И Знаменатели.Организация = ДД.Организация
		|		И Знаменатели.Партия = ДД.Партия
		|		И Знаменатели.АналитикаУчетаПартий = ДД.АналитикаУчетаПартий
		|		И Знаменатели.АналитикаФинансовогоУчета = ДД.АналитикаФинансовогоУчета
        |		И Знаменатели.НалоговоеНазначение = ДД.НалоговоеНазначение
		|		И Знаменатели.АналитикаУчетаНоменклатуры = ДД.АналитикаУчетаНоменклатуры
		|		И Знаменатели.ВидЗапасов = ДД.ВидЗапасов
		|		И Знаменатели.РазделУчета = ДД.РазделУчета
		|		И ДД.СлужебноеВидДвиженияПриход
		|		И ВЫБОР КОГДА ДД.ТипЗаписи В (
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаСтоимости),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ОтклонениеВСтоимости),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходы),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыБезПартии),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыСПартией))
		|			ТОГДА ИСТИНА
		|			ИНАЧЕ ЛОЖЬ
		|		  КОНЕЦ = Знаменатели.ЭтоДопРасходы
		|	ЛЕВОЕ СОЕДИНЕНИЕ ВТРасчетныеЦены КАК Цены
		|		ПО Цены.Организация = ДД.Организация
		|		И Цены.Партия = ДД.Партия
		|		И Цены.АналитикаУчетаПартий = ДД.АналитикаУчетаПартий
		|		И Цены.АналитикаФинансовогоУчета = ДД.АналитикаФинансовогоУчета
        |		И Цены.НалоговоеНазначение = ДД.НалоговоеНазначение
		|		И Цены.АналитикаУчетаНоменклатуры = ДД.АналитикаУчетаНоменклатуры
		|		И Цены.ВидЗапасов = ДД.ВидЗапасов
		|		И Цены.РазделУчета = ДД.РазделУчета
		|	ЛЕВОЕ СОЕДИНЕНИЕ ВТПлановыеЦены КАК ПлановыеЦены
		|		ПО ПлановыеЦены.АналитикаУчетаНоменклатуры = ДД.АналитикаУчетаНоменклатуры
		|	ЛЕВОЕ СОЕДИНЕНИЕ ВТОтборАналитикиУчетаПартийНДС2_4 КАК АналитикиУчетаПартий
		|		ПО ДД.АналитикаУчетаПартий = АналитикиУчетаПартий.Ссылка
		|	ЛЕВОЕ СОЕДИНЕНИЕ ВТОтборАналитикиУчетаПартийНДС2_4 КАК КорАналитикиУчетаПартий
		|		ПО ДД.КорАналитикаУчетаПартий = КорАналитикиУчетаПартий.Ссылка
		|ГДЕ
		|	ДД.Организация В (&ОрганизацииСУчетомПартийНДСВерсии24)
		|	И ДД.Партия <> НЕОПРЕДЕЛЕНО
		|	И ДД.РазделУчета <> ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НеотфактурованныеПоставки)
		|	И ДД.ХозяйственнаяОперация <> ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукцииФиксированнаяСтоимость)
		|	И ВЫБОР
		//++ НЕ УТ
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Партия)
		|		 И ДД.Регистратор ССЫЛКА Документ.ОтчетПереработчика
		|		 И ДД.Количество > 0
		|			ТОГДА ИСТИНА
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Потребление)
		|		 И ДД.Регистратор ССЫЛКА Документ.ОтчетПереработчика
		|		 И ДД.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НезавершенноеПроизводство)
		|			ТОГДА ИСТИНА      
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Партия)
		|		 И ДД.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПередачаПродукцииИзПроизводства)
		|			ТОГДА ЛОЖЬ
		//-- НЕ УТ
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Партия)
		//++ НЕ УТ
		|		 И НЕ ДД.Регистратор ССЫЛКА Документ.ВыпускПродукции
		|		 И НЕ ДД.Регистратор ССЫЛКА Документ.ПроизводствоБезЗаказа
		//-- НЕ УТ
		|			ТОГДА ЛОЖЬ
		|
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Выпуск) И НЕ ДД.СлужебноеВидДвиженияПриход
		//++ НЕ УТ
		|		 И НЕ ДД.Регистратор ССЫЛКА Документ.ВыпускПродукции
		//-- НЕ УТ
		|			ТОГДА ЛОЖЬ
		|
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Потребление) И НЕ ДД.СлужебноеВидДвиженияПриход
		|		 И ДД.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукции)
		//++ НЕ УТ
		|		 И НЕ ДД.Регистратор ССЫЛКА Документ.ПоступлениеОтПереработчика
		//-- НЕ УТ
		|			ТОГДА ЛОЖЬ
		|                          
		//++ НЕ УТ
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение)
		|		 И ДД.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукции)
		|			ТОГДА ИСТИНА
		//-- НЕ УТ
		|
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение) И НЕ ДД.СлужебноеВидДвиженияПриход
		|		 И ДД.ХозяйственнаяОперация В
		|		 	(ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукции),
		|		 	 ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПередачаПродукцииИзПроизводства),
		|		 	 ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаУПоставщика))
		|			ТОГДА ЛОЖЬ
		|		
		//++ НЕ УТ                         
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение) И ДД.СлужебноеВидДвиженияПриход
		|		 И (ДД.Регистратор ССЫЛКА Документ.ОтчетПереработчика
		|		 	ИЛИ ДД.Регистратор ССЫЛКА Документ.ПроизводствоБезЗаказа)
		|			ТОГДА ЛОЖЬ
		//-- НЕ УТ
		|
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.СписанияНаВыпуск) И НЕ ДД.СлужебноеВидДвиженияПриход
		//++ НЕ УТ
		|		 И НЕ ДД.Регистратор ССЫЛКА Документ.ПроизводствоБезЗаказа
		|		 И НЕ ДД.Регистратор ССЫЛКА Документ.ОтчетПереработчика
		//-- НЕ УТ
		|			ТОГДА ЛОЖЬ
		|
		|		КОГДА ДД.ТипЗаписи В (
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Потребление),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ПотреблениеАвто),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ПотреблениеПроизводство),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Распределение),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.СписанияНаВыпуск),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ВозвратНаДругойСклад))
		|			И ЕСТЬNULL(ДД.АналитикаУчетаНоменклатуры.Назначение.НаправлениеДеятельности, ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка))
		|				= ЕСТЬNULL(ДД.КорАналитикаУчетаНоменклатуры.Назначение.НаправлениеДеятельности, ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка))
        |			И ДД.НалоговоеНазначение         = ДД.КорНалоговоеНазначение
		|			И ДД.Партия         			= ДД.КорПартия
		|			И (ДД.КорОрганизация = ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка)
		|				ИЛИ ДД.Организация = ДД.КорОрганизация)
		|			И ДД.КорРазделУчета	<> ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПустаяСсылка)
		|			ТОГДА ЛОЖЬ
		|			
		|		КОГДА ДД.ТипЗаписи В (
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Перемещение),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ПеремещениеОбособленно),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ПеремещениеАвто),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Выпуск),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Сторно),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.СторноВозвратНаДругойСклад))
		|			И ЕСТЬNULL(ДД.АналитикаУчетаНоменклатуры.Назначение.НаправлениеДеятельности, ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка))
		|				= ЕСТЬNULL(ДД.КорАналитикаУчетаНоменклатуры.Назначение.НаправлениеДеятельности, ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка))
        |			И ДД.НалоговоеНазначение         = ДД.КорНалоговоеНазначение
		|			И ДД.Партия         			= ДД.КорПартия
		|			И (ДД.КорОрганизация = ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка)
		|				ИЛИ ДД.Организация = ДД.КорОрганизация)
		|			ТОГДА ЛОЖЬ
		|			
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаСтоимости)
		|			ТОГДА ЛОЖЬ
		|			
		|		ИНАЧЕ ИСТИНА
		|	КОНЕЦ = ИСТИНА
        |	И ДД.НалоговоеНазначение <> ЗНАЧЕНИЕ(Справочник.НалоговыеНазначенияАктивовИЗатрат.ПустаяСсылка)
		|	И НЕ ДД.РазделУчета В (
		|		ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПринятыеНаКомиссию),
		|		ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.МатериалыПринятыеВПереработку),
		|		ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПринятыеНаОтветхранение),
		|		ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыНаХраненииСПравомПродажи),
		|		ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыНаХраненииСПравомПродажиПереданныеПартнерам),
		|		ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыНаХраненииСПравомПродажиКОформлениюСписания),
		|		ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НеотфактурованныеПоставки))
		|	И (НЕ ДД.ТипЗаписи В (
		|		ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Партия),
		|		ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходы),
		|		ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ВозвратПрошлыхПериодов))
		//++ НЕ УТ
		|		ИЛИ ДД.Регистратор ССЫЛКА Документ.ВыпускПродукции
		|		ИЛИ ДД.Регистратор ССЫЛКА Документ.ПроизводствоБезЗаказа
		|		ИЛИ ДД.Регистратор ССЫЛКА Документ.ПоступлениеОтПереработчика
		|		ИЛИ (ДД.Регистратор ССЫЛКА Документ.ОтчетПереработчика
		|			И ДД.ТипЗаписи <> ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение))
		//-- НЕ УТ
		|	  )                                        
		|	И НЕ (ДД.Регистратор ССЫЛКА Документ.ПорчаТоваров И ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Перемещение))
		|	И НЕ (ДД.Регистратор ССЫЛКА Документ.ПересортицаТоваров И ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Перемещение))
		|
		|СГРУППИРОВАТЬ ПО
		|	ВЫБОР
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Партия)
		|		 И ДД.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПоступлениеОтПереработчика)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Перемещение)
		//++ НЕ УТ
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Партия)
		|		 И ДД.Регистратор ССЫЛКА Документ.ВыпускПродукции
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Перемещение)
		//-- НЕ УТ
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Партия)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Выпуск)
		//++ НЕ УТ
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Выпуск) И НЕ ДД.СлужебноеВидДвиженияПриход
		|		 И ДД.Регистратор ССЫЛКА Документ.ВыпускПродукции
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Потребление)
		//-- НЕ УТ
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Потребление) И НЕ ДД.СлужебноеВидДвиженияПриход
		|		 И ДД.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукции)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.СписанияНаВыпуск)
		|
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение) И НЕ ДД.СлужебноеВидДвиженияПриход
		|		 И ДД.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукции)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.СписанияНаВыпуск)
		|
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение) И НЕ ДД.СлужебноеВидДвиженияПриход
		|		 И ДД.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаУПоставщика)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.СписанияНаВыпуск)
		|
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение) И ДД.СлужебноеВидДвиженияПриход
		|		 И ДД.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукции)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Выпуск)
		|
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение) И ДД.СлужебноеВидДвиженияПриход
		|		 И ДД.ХозяйственнаяОперация В (
		|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СписаниеРасходовНаПартииПроизводства),
		|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РаспределениеРасходовНаПартииПроизводства))
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ПеремещениеАвто)
		|
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение) И НЕ ДД.СлужебноеВидДвиженияПриход
		|		 И ДД.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СписаниеТоваровПоТребованию)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Потребление)
		|
		|		ИНАЧЕ ДД.ТипЗаписи
		|	КОНЕЦ,
		|	(ВЫБОР
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаПриобретения) ТОГДА ЛОЖЬ
		|		КОГДА ДД.Количество < 0 ТОГДА ИСТИНА
		|		ИНАЧЕ ЛОЖЬ КОНЕЦ),
		|	ДД.АналитикаУчетаНоменклатуры.Номенклатура,
		|	ДД.АналитикаУчетаНоменклатуры.Характеристика,
		|	ЕСТЬNULL(ДД.АналитикаУчетаНоменклатуры.Назначение.НаправлениеДеятельности, ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка)),
		|	ЕСТЬNULL(ДД.КорАналитикаУчетаНоменклатуры.Назначение.НаправлениеДеятельности, ДД.КорНаправлениеДеятельности),
		|	ДД.КорАналитикаУчетаНоменклатуры,
		|	ДД.КорВидЗапасов,
		|	
		|	ДД.Период,
		|	ДД.Регистратор,
		|	ВЫБОР КОГДА ДД.СлужебноеВидДвиженияПриход
		|		 ТОГДА ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|		ИНАЧЕ ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
		|	КОНЕЦ,
		|	ДД.Организация,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.ВидЗапасов,
		|	ВЫБОР
		//++ НЕ УТ
		|		КОГДА ДД.Партия ССЫЛКА Справочник.ПартииПроизводства
		|		  И НЕ ВЫРАЗИТЬ(ДД.Партия КАК Справочник.ПартииПроизводства).Документ ССЫЛКА Документ.ПроизводствоБезЗаказа
		|		  И НЕ ВЫРАЗИТЬ(ДД.Партия КАК Справочник.ПартииПроизводства).Документ ССЫЛКА Документ.ОтчетПереработчика
		|			ТОГДА ВЫРАЗИТЬ(ДД.Партия КАК Справочник.ПартииПроизводства).Документ
		//-- НЕ УТ
		|		КОГДА ИСТИНА
		|			ТОГДА ДД.Партия
		|	КОНЕЦ,
		|	ЕСТЬNULL(АналитикиУчетаПартий.Ссылка, ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка)),
        |	ДД.НалоговоеНазначение,
		|
		|	ДД.ХозяйственнаяОперация,
        |	ДД.КорНалоговоеНазначение,
		|	ДД.КорОрганизация,
		|	ВЫБОР
		//++ НЕ УТ
		|		КОГДА ДД.КорПартия ССЫЛКА Справочник.ПартииПроизводства
		|		  И НЕ ВЫРАЗИТЬ(ДД.КорПартия КАК Справочник.ПартииПроизводства).Документ ССЫЛКА Документ.ПроизводствоБезЗаказа
		|		  И НЕ ВЫРАЗИТЬ(ДД.КорПартия КАК Справочник.ПартииПроизводства).Документ ССЫЛКА Документ.ОтчетПереработчика
		|			ТОГДА ВЫРАЗИТЬ(ДД.КорПартия КАК Справочник.ПартииПроизводства).Документ
		//-- НЕ УТ
		|		КОГДА ИСТИНА
		|			ТОГДА ДД.КорПартия
		|	КОНЕЦ,
		|	ЕСТЬNULL(ДД.КорАналитикаУчетаНоменклатуры.Назначение.НаправлениеДеятельности, ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка)),
		|	ДД.Подразделение,
        |	ДД.КорАналитикаФинансовогоУчета,
		|	(ВЫБОР
		|		КОГДА ДД.СтатьяРасходовСписания <> ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиРасходов.ПустаяСсылка)
		|		 И ДД.СтатьяРасходовСписания <> НЕОПРЕДЕЛЕНО
		|			ТОГДА ДД.СтатьяРасходовСписания
		|		КОГДА ДД.СтатьяАктивовПассивов <> ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиАктивовПассивов.ПустаяСсылка)
		|			ТОГДА ДД.СтатьяАктивовПассивов
		|		ИНАЧЕ НЕОПРЕДЕЛЕНО КОНЕЦ),
		|	ДД.АналитикаРасходов,
		|	ДД.АналитикаАктивовПассивов,
		|	(ВЫБОР
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Партия)
		|		 И ДД.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПоступлениеОтПереработчика)
		|			ТОГДА ДД.Регистратор
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Перемещение)
		|		 И ДД.ДокументИсточник = НЕОПРЕДЕЛЕНО
		|			ТОГДА ДД.Регистратор
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение)
		|		 И ДД.ХозяйственнаяОперация В (
		|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СписаниеРасходовНаПартииПроизводства),
		|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РаспределениеРасходовНаПартииПроизводства))
		|		 И ДД.ДокументИсточник = НЕОПРЕДЕЛЕНО
		|			ТОГДА ДД.Регистратор
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение) И НЕ ДД.СлужебноеВидДвиженияПриход
		|		 И ДД.ХозяйственнаяОперация В (
		|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукции),
		|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукцииНаСклад),
		|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукцииВПодразделение))
		|		 И ДД.ДокументИсточник = НЕОПРЕДЕЛЕНО
		|			ТОГДА ДД.Регистратор
		//++ НЕ УТ
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Потребление) И НЕ ДД.СлужебноеВидДвиженияПриход
		|		 И ДД.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукции)
		|		 И НЕ ДД.Регистратор ССЫЛКА Документ.ПоступлениеОтПереработчика
		|		 И ДД.ДокументИсточник = НЕОПРЕДЕЛЕНО
		|			ТОГДА ДД.Регистратор
		//-- НЕ УТ
		|		ИНАЧЕ ДД.ДокументИсточник КОНЕЦ),
		|		ДД.РазделУчета,
		|		ДД.КорРазделУчета,
		|	ЕСТЬNULL(КорАналитикиУчетаПартий.Ссылка, ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка))
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ВЫБОР
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Партия)
		|		 И ДД.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПоступлениеОтПереработчика)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Перемещение)
		//++ НЕ УТ
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Партия)
		|		 И ДД.Регистратор ССЫЛКА Документ.ВыпускПродукции
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Перемещение)
		//-- НЕ УТ
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Партия)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Выпуск)
		//++ НЕ УТ
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Выпуск) И НЕ ДД.СлужебноеВидДвиженияПриход
		|		 И ДД.Регистратор ССЫЛКА Документ.ВыпускПродукции
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Потребление)
		//-- НЕ УТ
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Потребление) И НЕ ДД.СлужебноеВидДвиженияПриход
		|		 И ДД.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукции)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.СписанияНаВыпуск)
		|
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение) И НЕ ДД.СлужебноеВидДвиженияПриход
		|		 И ДД.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукции)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.СписанияНаВыпуск)
		|
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение) И НЕ ДД.СлужебноеВидДвиженияПриход
		|		 И ДД.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаУПоставщика)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.СписанияНаВыпуск)
		|
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение) И ДД.СлужебноеВидДвиженияПриход
		|		 И ДД.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукции)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Выпуск)
		|
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение) И ДД.СлужебноеВидДвиженияПриход
		|		 И ДД.ХозяйственнаяОперация В (
		|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СписаниеРасходовНаПартииПроизводства),
		|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РаспределениеРасходовНаПартииПроизводства))
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ПеремещениеАвто)
		|
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение) И НЕ ДД.СлужебноеВидДвиженияПриход
		|		 И ДД.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СписаниеТоваровПоТребованию)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Потребление)
		|
		|		ИНАЧЕ ДД.ТипЗаписи
		|	КОНЕЦ КАК ТипЗаписи,
		|	(ВЫБОР
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаПриобретения) ТОГДА ЛОЖЬ
		|		КОГДА ДД.Количество < 0 ТОГДА ИСТИНА
		|		ИНАЧЕ ЛОЖЬ КОНЕЦ) КАК Сторно,
		|	МАКСИМУМ(ЕСТЬNULL(Знаменатели.Знаменатель, 0))
		|		+ СУММА(ВЫБОР
		|			КОГДА ЕСТЬNULL(Знаменатели.Знаменатель, 0) <> 0
		|				ТОГДА 0
		|				ИНАЧЕ ВЫРАЗИТЬ(ДД.Количество * ЕСТЬNULL(Цены.СтоимостьРегл, ЕСТЬNULL(ПлановыеЦены.Цена, 0)) КАК ЧИСЛО(31,2))
		|		  КОНЕЦ) КАК Знаменатель,
		|	МАКСИМУМ(ЕСТЬNULL(Знаменатели.ЗнаменательДляИсточников, 0)) КАК ЗнаменательДляИсточников,
		|	СУММА(ДД.Количество) КАК Количество,
		|	ДД.АналитикаУчетаНоменклатуры.Номенклатура КАК Номенклатура,
		|	ДД.АналитикаУчетаНоменклатуры.Характеристика КАК Характеристика,
		|	ЕСТЬNULL(ДД.АналитикаУчетаНоменклатуры.Назначение.НаправлениеДеятельности, ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка)) КАК НаправлениеДеятельности,
		|	
		|	ДД.Период,
		|	ДД.Регистратор,
		|	ВЫБОР КОГДА ДД.СлужебноеВидДвиженияПриход
		|		 ТОГДА ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|		ИНАЧЕ ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
		|	КОНЕЦ КАК ВидДвижения,
		|	ДД.Организация КАК Организация,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.ВидЗапасов,
		|	ВЫБОР
		//++ НЕ УТ
		|		КОГДА ДД.Партия ССЫЛКА Справочник.ПартииПроизводства
		|		  И НЕ ВЫРАЗИТЬ(ДД.Партия КАК Справочник.ПартииПроизводства).Документ ССЫЛКА Документ.ПроизводствоБезЗаказа
		|		  И НЕ ВЫРАЗИТЬ(ДД.Партия КАК Справочник.ПартииПроизводства).Документ ССЫЛКА Документ.ОтчетПереработчика
		|			ТОГДА ВЫРАЗИТЬ(ДД.Партия КАК Справочник.ПартииПроизводства).Документ
		//-- НЕ УТ
		|		КОГДА ИСТИНА
		|			ТОГДА ДД.Партия
		|	КОНЕЦ КАК Партия,
		|	ДД.КодСтроки 								КАК КодСтроки,
		|	ЕСТЬNULL(АналитикиУчетаПартий.Ссылка, ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка)) КАК АналитикаУчетаПартий,
        |	ДД.НалоговоеНазначение КАК НалоговоеНазначение,
		|
		|	ДД.ХозяйственнаяОперация,
        |	ДД.КорНалоговоеНазначение КАК КорНалоговоеНазначение,
		|	ДД.КорОрганизация,
		|	ВЫБОР
		//++ НЕ УТ
		|		КОГДА ДД.КорПартия ССЫЛКА Справочник.ПартииПроизводства
		|		  И НЕ ВЫРАЗИТЬ(ДД.КорПартия КАК Справочник.ПартииПроизводства).Документ ССЫЛКА Документ.ПроизводствоБезЗаказа
		|		  И НЕ ВЫРАЗИТЬ(ДД.КорПартия КАК Справочник.ПартииПроизводства).Документ ССЫЛКА Документ.ОтчетПереработчика
		|			ТОГДА ВЫРАЗИТЬ(ДД.КорПартия КАК Справочник.ПартииПроизводства).Документ
		//-- НЕ УТ
		|		КОГДА ИСТИНА
		|			ТОГДА ДД.КорПартия
		|	КОНЕЦ КАК КорПартия,
		|	ЕСТЬNULL(КорАналитикиУчетаПартий.Ссылка, ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка)) КАК КорАналитикаУчетаПартий,
		|	ЕСТЬNULL(ДД.КорАналитикаУчетаНоменклатуры.Назначение.НаправлениеДеятельности, ДД.КорНаправлениеДеятельности) КАК КорНаправлениеДеятельности,
		|	ДД.КорАналитикаУчетаНоменклатуры КАК КорАналитикаУчетаНоменклатуры,
		|	ДД.КорВидЗапасов КАК КорВидЗапасов,
		|	ДД.Подразделение,
        |	ДД.КорАналитикаФинансовогоУчета,
		|	(ВЫБОР
		|		КОГДА ДД.СтатьяРасходовСписания <> ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиРасходов.ПустаяСсылка)
		|		 И ДД.СтатьяРасходовСписания <> НЕОПРЕДЕЛЕНО
		|			ТОГДА ДД.СтатьяРасходовСписания
		|		КОГДА ДД.СтатьяАктивовПассивов <> ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиАктивовПассивов.ПустаяСсылка)
		|			ТОГДА ДД.СтатьяАктивовПассивов
		|		ИНАЧЕ НЕОПРЕДЕЛЕНО КОНЕЦ) КАК СтатьяРасходовАктивов,
		|	ДД.АналитикаРасходов,
		|	ДД.АналитикаАктивовПассивов КАК АналитикаАктивов,
		|	(ВЫБОР
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Партия)
		|		 И ДД.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПоступлениеОтПереработчика)
		|			ТОГДА ДД.Регистратор
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Перемещение)
		|		 И ДД.ДокументИсточник = НЕОПРЕДЕЛЕНО
		|			ТОГДА ДД.Регистратор
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение)
		|		 И ДД.ХозяйственнаяОперация В (
		|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СписаниеРасходовНаПартииПроизводства),
		|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РаспределениеРасходовНаПартииПроизводства))
		|		 И ДД.ДокументИсточник = НЕОПРЕДЕЛЕНО
		|			ТОГДА ДД.Регистратор
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение) И НЕ ДД.СлужебноеВидДвиженияПриход
		|		 И ДД.ХозяйственнаяОперация В (
		|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукции),
		|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукцииНаСклад),
		|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукцииВПодразделение))
		|		 И ДД.ДокументИсточник = НЕОПРЕДЕЛЕНО
		|			ТОГДА ДД.Регистратор
		//++ НЕ УТ
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Потребление) И НЕ ДД.СлужебноеВидДвиженияПриход
		|		 И ДД.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукции)
		|		 И НЕ ДД.Регистратор ССЫЛКА Документ.ПоступлениеОтПереработчика
		|		 И ДД.ДокументИсточник = НЕОПРЕДЕЛЕНО
		|			ТОГДА ДД.Регистратор
		//-- НЕ УТ
		|		ИНАЧЕ ДД.ДокументИсточник КОНЕЦ) КАК ДокументИсточник,
		|		ДД.РазделУчета КАК РазделУчета,
		|		ДД.КорРазделУчета КАК КорРазделУчета
		|ПОМЕСТИТЬ ДвиженияСебестоимостиНДС2_4КодСтроки
		|ИЗ
		|	ВТКэшРасчетныеОборотыСебестоимостьТоваров КАК ДД
		|	ЛЕВОЕ СОЕДИНЕНИЕ Документ.ПередачаТоваровМеждуОрганизациями КАК Передача
		|		ПО Передача.Ссылка = ДД.Регистратор
		|	ЛЕВОЕ СОЕДИНЕНИЕ ЗнаменателиПриходов КАК Знаменатели
		|		ПО Знаменатели.Регистратор = ДД.Регистратор
		|		И Знаменатели.Организация = ДД.Организация
		|		И Знаменатели.Партия = ДД.Партия
		|		И Знаменатели.АналитикаУчетаПартий = ДД.АналитикаУчетаПартий
		|		И Знаменатели.АналитикаФинансовогоУчета = ДД.АналитикаФинансовогоУчета
        |		И Знаменатели.НалоговоеНазначение = ДД.НалоговоеНазначение
		|		И Знаменатели.АналитикаУчетаНоменклатуры = ДД.АналитикаУчетаНоменклатуры
		|		И Знаменатели.ВидЗапасов = ДД.ВидЗапасов
		|		И Знаменатели.РазделУчета = ДД.РазделУчета
		|		И ДД.СлужебноеВидДвиженияПриход
		|		И ВЫБОР КОГДА ДД.ТипЗаписи В (
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаСтоимости),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ОтклонениеВСтоимости),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходы),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыБезПартии),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыСПартией))
		|			ТОГДА ИСТИНА
		|			ИНАЧЕ ЛОЖЬ
		|		  КОНЕЦ = Знаменатели.ЭтоДопРасходы
		|	ЛЕВОЕ СОЕДИНЕНИЕ ВТРасчетныеЦены КАК Цены
		|		ПО Цены.Организация = ДД.Организация
		|		И Цены.Партия = ДД.Партия
		|		И Цены.АналитикаУчетаПартий = ДД.АналитикаУчетаПартий
		|		И Цены.АналитикаФинансовогоУчета = ДД.АналитикаФинансовогоУчета
        |		И Цены.НалоговоеНазначение = ДД.НалоговоеНазначение
		|		И Цены.АналитикаУчетаНоменклатуры = ДД.АналитикаУчетаНоменклатуры
		|		И Цены.ВидЗапасов = ДД.ВидЗапасов
		|		И Цены.РазделУчета = ДД.РазделУчета
		|	ЛЕВОЕ СОЕДИНЕНИЕ ВТПлановыеЦены КАК ПлановыеЦены
		|		ПО ПлановыеЦены.АналитикаУчетаНоменклатуры = ДД.АналитикаУчетаНоменклатуры
		|	ЛЕВОЕ СОЕДИНЕНИЕ ВТОтборАналитикиУчетаПартийНДС2_4 КАК АналитикиУчетаПартий
		|		ПО ДД.АналитикаУчетаПартий = АналитикиУчетаПартий.Ссылка
		|	ЛЕВОЕ СОЕДИНЕНИЕ ВТОтборАналитикиУчетаПартийНДС2_4 КАК КорАналитикиУчетаПартий
		|		ПО ДД.КорАналитикаУчетаПартий = КорАналитикиУчетаПартий.Ссылка
		|ГДЕ
		|	ДД.Организация В (&ОрганизацииСУчетомПартийНДСВерсии24)
		|	И ДД.Партия <> НЕОПРЕДЕЛЕНО
		|	И ДД.РазделУчета <> ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НеотфактурованныеПоставки)
		|	И ДД.ХозяйственнаяОперация <> ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукцииФиксированнаяСтоимость)
		|	И ВЫБОР
		//++ НЕ УТ
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Партия)
		|		 И ДД.Регистратор ССЫЛКА Документ.ОтчетПереработчика
		|		 И ДД.Количество > 0
		|			ТОГДА ИСТИНА
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Потребление)
		|		 И ДД.Регистратор ССЫЛКА Документ.ОтчетПереработчика
		|		 И ДД.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НезавершенноеПроизводство)
		|			ТОГДА ИСТИНА          
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Партия)
		|		 И ДД.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПередачаПродукцииИзПроизводства)
		|			ТОГДА ЛОЖЬ
		//-- НЕ УТ
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Партия)
		//++ НЕ УТ
		|		 И НЕ ДД.Регистратор ССЫЛКА Документ.ВыпускПродукции
		|		 И НЕ ДД.Регистратор ССЫЛКА Документ.ПроизводствоБезЗаказа
		//-- НЕ УТ
		|			ТОГДА ЛОЖЬ
		|
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Выпуск) И НЕ ДД.СлужебноеВидДвиженияПриход
		//++ НЕ УТ
		|		 И НЕ ДД.Регистратор ССЫЛКА Документ.ВыпускПродукции
		//-- НЕ УТ
		|			ТОГДА ЛОЖЬ
		|
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Потребление) И НЕ ДД.СлужебноеВидДвиженияПриход
		|		 И ДД.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукции)
		//++ НЕ УТ
		|		 И НЕ ДД.Регистратор ССЫЛКА Документ.ПоступлениеОтПереработчика
		//-- НЕ УТ
		|			ТОГДА ЛОЖЬ
		|
		//++ НЕ УТ
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение)
		|		 И ДД.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукции)
		|			ТОГДА ИСТИНА
		//-- НЕ УТ
		|
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение) И НЕ ДД.СлужебноеВидДвиженияПриход
		|		 И ДД.ХозяйственнаяОперация В
		|		 	(ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукции),
		|		 	 ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПередачаПродукцииИзПроизводства),
		|		 	 ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаУПоставщика))
		|			ТОГДА ЛОЖЬ
		|		
		//++ НЕ УТ            
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение) И ДД.СлужебноеВидДвиженияПриход
		|		 И (ДД.Регистратор ССЫЛКА Документ.ОтчетПереработчика
		|		 	ИЛИ ДД.Регистратор ССЫЛКА Документ.ПроизводствоБезЗаказа)
		|			ТОГДА ЛОЖЬ
		//-- НЕ УТ
		|
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.СписанияНаВыпуск) И НЕ ДД.СлужебноеВидДвиженияПриход
		//++ НЕ УТ
		|		 И НЕ ДД.Регистратор ССЫЛКА Документ.ПроизводствоБезЗаказа
		|		 И НЕ ДД.Регистратор ССЫЛКА Документ.ОтчетПереработчика
		//-- НЕ УТ
		|			ТОГДА ЛОЖЬ
		|
		|		КОГДА ДД.ТипЗаписи В (
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Потребление),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ПотреблениеАвто),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ПотреблениеПроизводство),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Распределение),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.СписанияНаВыпуск),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ВозвратНаДругойСклад))
		|			И ЕСТЬNULL(ДД.АналитикаУчетаНоменклатуры.Назначение.НаправлениеДеятельности, ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка))
		|				= ЕСТЬNULL(ДД.КорАналитикаУчетаНоменклатуры.Назначение.НаправлениеДеятельности, ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка))
        |			И ДД.НалоговоеНазначение         = ДД.КорНалоговоеНазначение
		|			И ДД.Партия         			= ДД.КорПартия
		|			И (ДД.КорОрганизация = ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка)
		|				ИЛИ ДД.Организация = ДД.КорОрганизация)
		|			И ДД.КорРазделУчета	<> ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПустаяСсылка)
		|			ТОГДА ЛОЖЬ
		|			
		|		КОГДА ДД.ТипЗаписи В (
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Перемещение),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ПеремещениеОбособленно),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ПеремещениеАвто),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Выпуск),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Сторно),
		|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.СторноВозвратНаДругойСклад))
		|			И ЕСТЬNULL(ДД.АналитикаУчетаНоменклатуры.Назначение.НаправлениеДеятельности, ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка))
		|				= ЕСТЬNULL(ДД.КорАналитикаУчетаНоменклатуры.Назначение.НаправлениеДеятельности, ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка))
        |			И ДД.НалоговоеНазначение         = ДД.КорНалоговоеНазначение
		|			И ДД.Партия         			= ДД.КорПартия
		|			И (ДД.КорОрганизация = ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка)
		|				ИЛИ ДД.Организация = ДД.КорОрганизация)
		|			ТОГДА ЛОЖЬ
		|			
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаСтоимости)
		|			ТОГДА ЛОЖЬ
		|			
		|		ИНАЧЕ ИСТИНА
		|	КОНЕЦ = ИСТИНА
        |	И ДД.НалоговоеНазначение <> ЗНАЧЕНИЕ(Справочник.НалоговыеНазначенияАктивовИЗатрат.ПустаяСсылка)
		|	И НЕ ДД.РазделУчета В (
		|		ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПринятыеНаКомиссию),
		|		ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.МатериалыПринятыеВПереработку),
		|		ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПринятыеНаОтветхранение),
		|		ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыНаХраненииСПравомПродажи),
		|		ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыНаХраненииСПравомПродажиПереданныеПартнерам),
		|		ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыНаХраненииСПравомПродажиКОформлениюСписания),
		|		ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НеотфактурованныеПоставки))
		|	И (НЕ ДД.ТипЗаписи В (
		|		ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Партия),
		|		ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходы),
		|		ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ВозвратПрошлыхПериодов))
		//++ НЕ УТ
		|		ИЛИ ДД.Регистратор ССЫЛКА Документ.ВыпускПродукции
		|		ИЛИ ДД.Регистратор ССЫЛКА Документ.ПроизводствоБезЗаказа
		|		ИЛИ ДД.Регистратор ССЫЛКА Документ.ПоступлениеОтПереработчика
		|		ИЛИ (ДД.Регистратор ССЫЛКА Документ.ОтчетПереработчика
		|			И ДД.ТипЗаписи <> ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение))
		//-- НЕ УТ
		|	  )                                
		|	И НЕ (ДД.Регистратор ССЫЛКА Документ.ПорчаТоваров И ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Перемещение))
		|	И НЕ (ДД.Регистратор ССЫЛКА Документ.ПересортицаТоваров И ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Перемещение))
		|
		|СГРУППИРОВАТЬ ПО
		|	ВЫБОР
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Партия)
		|		 И ДД.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПоступлениеОтПереработчика)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Перемещение)
		//++ НЕ УТ
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Партия)
		|		 И ДД.Регистратор ССЫЛКА Документ.ВыпускПродукции
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Перемещение)
		//-- НЕ УТ
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Партия)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Выпуск)
		//++ НЕ УТ
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Выпуск) И НЕ ДД.СлужебноеВидДвиженияПриход
		|		 И ДД.Регистратор ССЫЛКА Документ.ВыпускПродукции
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Потребление)
		//-- НЕ УТ
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Потребление) И НЕ ДД.СлужебноеВидДвиженияПриход
		|		 И ДД.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукции)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.СписанияНаВыпуск)
		|
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение) И НЕ ДД.СлужебноеВидДвиженияПриход
		|		 И ДД.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукции)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.СписанияНаВыпуск)
		|
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение) И НЕ ДД.СлужебноеВидДвиженияПриход
		|		 И ДД.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаУПоставщика)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.СписанияНаВыпуск)
		|
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение) И ДД.СлужебноеВидДвиженияПриход
		|		 И ДД.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукции)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Выпуск)
		|
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение) И ДД.СлужебноеВидДвиженияПриход
		|		 И ДД.ХозяйственнаяОперация В (
		|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СписаниеРасходовНаПартииПроизводства),
		|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РаспределениеРасходовНаПартииПроизводства))
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ПеремещениеАвто)
		|
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение) И НЕ ДД.СлужебноеВидДвиженияПриход
		|		 И ДД.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СписаниеТоваровПоТребованию)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Потребление)
		|
		|		ИНАЧЕ ДД.ТипЗаписи
		|	КОНЕЦ,
		|	(ВЫБОР
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаПриобретения) ТОГДА ЛОЖЬ
		|		КОГДА ДД.Количество < 0 ТОГДА ИСТИНА
		|		ИНАЧЕ ЛОЖЬ КОНЕЦ),
		|	ДД.АналитикаУчетаНоменклатуры.Номенклатура,
		|	ДД.АналитикаУчетаНоменклатуры.Характеристика,
		|	ЕСТЬNULL(ДД.АналитикаУчетаНоменклатуры.Назначение.НаправлениеДеятельности, ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка)),
		|	ЕСТЬNULL(ДД.КорАналитикаУчетаНоменклатуры.Назначение.НаправлениеДеятельности, ДД.КорНаправлениеДеятельности),
		|	ДД.КорАналитикаУчетаНоменклатуры,
		|	ДД.КорВидЗапасов,
		|	
		|	ДД.Период,
		|	ДД.Регистратор,
		|	ВЫБОР КОГДА ДД.СлужебноеВидДвиженияПриход
		|		 ТОГДА ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|		ИНАЧЕ ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
		|	КОНЕЦ,
		|	ДД.Организация,
		|	ДД.АналитикаУчетаНоменклатуры,
		|	ДД.ВидЗапасов,
		|	ВЫБОР
		//++ НЕ УТ
		|		КОГДА ДД.Партия ССЫЛКА Справочник.ПартииПроизводства
		|		  И НЕ ВЫРАЗИТЬ(ДД.Партия КАК Справочник.ПартииПроизводства).Документ ССЫЛКА Документ.ПроизводствоБезЗаказа
		|		  И НЕ ВЫРАЗИТЬ(ДД.Партия КАК Справочник.ПартииПроизводства).Документ ССЫЛКА Документ.ОтчетПереработчика
		|			ТОГДА ВЫРАЗИТЬ(ДД.Партия КАК Справочник.ПартииПроизводства).Документ
		//-- НЕ УТ
		|		КОГДА ИСТИНА
		|			ТОГДА ДД.Партия
		|	КОНЕЦ,       
		|	ДД.КодСтроки,
		|	ЕСТЬNULL(АналитикиУчетаПартий.Ссылка, ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка)),
        |	ДД.НалоговоеНазначение,
		|
		|	ДД.ХозяйственнаяОперация,
        |	ДД.КорНалоговоеНазначение,
		|	ДД.КорОрганизация,
		|	ВЫБОР
		//++ НЕ УТ
		|		КОГДА ДД.КорПартия ССЫЛКА Справочник.ПартииПроизводства
		|		  И НЕ ВЫРАЗИТЬ(ДД.КорПартия КАК Справочник.ПартииПроизводства).Документ ССЫЛКА Документ.ПроизводствоБезЗаказа
		|		  И НЕ ВЫРАЗИТЬ(ДД.КорПартия КАК Справочник.ПартииПроизводства).Документ ССЫЛКА Документ.ОтчетПереработчика
		|			ТОГДА ВЫРАЗИТЬ(ДД.КорПартия КАК Справочник.ПартииПроизводства).Документ
		//-- НЕ УТ
		|		КОГДА ИСТИНА
		|			ТОГДА ДД.КорПартия
		|	КОНЕЦ,
		|	ЕСТЬNULL(ДД.КорАналитикаУчетаНоменклатуры.Назначение.НаправлениеДеятельности, ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка)),
		|	ДД.Подразделение,
        |	ДД.КорАналитикаФинансовогоУчета,
		|	(ВЫБОР
		|		КОГДА ДД.СтатьяРасходовСписания <> ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиРасходов.ПустаяСсылка)
		|		 И ДД.СтатьяРасходовСписания <> НЕОПРЕДЕЛЕНО
		|			ТОГДА ДД.СтатьяРасходовСписания
		|		КОГДА ДД.СтатьяАктивовПассивов <> ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиАктивовПассивов.ПустаяСсылка)
		|			ТОГДА ДД.СтатьяАктивовПассивов
		|		ИНАЧЕ НЕОПРЕДЕЛЕНО КОНЕЦ),
		|	ДД.АналитикаРасходов,
		|	ДД.АналитикаАктивовПассивов,
		|	(ВЫБОР
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Партия)
		|		 И ДД.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПоступлениеОтПереработчика)
		|			ТОГДА ДД.Регистратор
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Перемещение)
		|		 И ДД.ДокументИсточник = НЕОПРЕДЕЛЕНО
		|			ТОГДА ДД.Регистратор
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение)
		|		 И ДД.ХозяйственнаяОперация В (
		|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СписаниеРасходовНаПартииПроизводства),
		|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РаспределениеРасходовНаПартииПроизводства))
		|		 И ДД.ДокументИсточник = НЕОПРЕДЕЛЕНО
		|			ТОГДА ДД.Регистратор
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение) И НЕ ДД.СлужебноеВидДвиженияПриход
		|		 И ДД.ХозяйственнаяОперация В (
		|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукции),
		|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукцииНаСклад),
		|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукцииВПодразделение))
		|		 И ДД.ДокументИсточник = НЕОПРЕДЕЛЕНО
		|			ТОГДА ДД.Регистратор
		//++ НЕ УТ
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Потребление) И НЕ ДД.СлужебноеВидДвиженияПриход
		|		 И ДД.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукции)
		|		 И НЕ ДД.Регистратор ССЫЛКА Документ.ПоступлениеОтПереработчика
		|		 И ДД.ДокументИсточник = НЕОПРЕДЕЛЕНО
		|			ТОГДА ДД.Регистратор
		//-- НЕ УТ
		|		ИНАЧЕ ДД.ДокументИсточник КОНЕЦ),
		|		ДД.РазделУчета,
		|		ДД.КорРазделУчета,
		|	ЕСТЬNULL(КорАналитикиУчетаПартий.Ссылка, ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка))
		|ИНДЕКСИРОВАТЬ ПО
		|	ДД.Регистратор
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ВЫБОР
		|		КОГДА ДД.СтоимостьБезНДСОстаток < 0 ТОГДА ИСТИНА
		|		ИНАЧЕ ЛОЖЬ
		|	КОНЕЦ КАК Сторно,
		|	ЕСТЬNULL(ОстаткиДетально.Знаменатель, ЕСТЬNULL(Остатки.Знаменатель,
		|		ДД.СтоимостьБезНДСОстаток
        |		  + ВЫБОР КОГДА ДД.НалоговоеНазначение.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ВидыДеятельностиНДС.Необлагаемая) 
		|				ТОГДА ДД.НДСОстаток
		|				ИНАЧЕ 0
		|			КОНЕЦ)) КАК Знаменатель,
		|	ДД.Номенклатура   КАК Номенклатура,
		|	ДД.Характеристика КАК Характеристика,
		|	
		| ЕСТЬNULL(ПериодикаПартии.ДатаРегистратора, &КонецПредыдущегоПериода) КАК Период,
		|	(ВЫБОР
		|		КОГДА ЕСТЬNULL(ОстаткиДетально.Партия, Остатки.Партия) ЕСТЬ NULL
		|			ТОГДА НЕОПРЕДЕЛЕНО
		|		ИНАЧЕ ЕСТЬNULL(ОстаткиДетально.Партия, Остатки.Партия) КОНЕЦ) КАК Регистратор,
		|	ДД.Организация,
		|	ДД.Партия,
		|	ДД.АналитикаУчетаПартий,
        |	ДД.НалоговоеНазначение,
		|	ДД.ДокументПоступления,
		|	ДД.АналитикаУчетаДокументаПоступления,
		|	ДД.НаправлениеДеятельности,
		|
		|	ДД.СтоимостьБезНДСОстаток КАК СтоимостьБезНДС,
		|	ДД.НДСОстаток КАК НДС,
		|	ДД.СтоимостьБезНДСУпрОстаток КАК СтоимостьБезНДСУпр,
		|	ДД.НДСУпрОстаток КАК НДСУпр
		|ПОМЕСТИТЬ ВТНачальныеОстаткиПартийНДС
		|ИЗ
        |	РегистрНакопления.ДетализацияПартийТоваровДляНДС2_4.Остатки(&ГраницаКонецПредыдущегоПериода,
		|		Организация В (&ОрганизацииСУчетомПартийНДСВерсии24)) КАК ДД
		|
		|	ЛЕВОЕ СОЕДИНЕНИЕ ОстаткиСебестоимостиТоваров2_4 КАК Остатки
		|		ПО Остатки.Организация = ДД.Организация
		|		И Остатки.Партия = ДД.Партия
		|		И Остатки.АналитикаУчетаПартий = ДД.АналитикаУчетаПартий
        |		И Остатки.НалоговоеНазначение = ДД.НалоговоеНазначение
		|
		|	ЛЕВОЕ СОЕДИНЕНИЕ ОстаткиСебестоимостиТоваровДетально2_4 КАК ОстаткиДетально
		|		ПО ОстаткиДетально.Организация = ДД.Организация
		|		И ОстаткиДетально.Партия = ДД.Партия
		|		И ОстаткиДетально.АналитикаУчетаПартий = ДД.АналитикаУчетаПартий
        |		И ОстаткиДетально.НалоговоеНазначение = ДД.НалоговоеНазначение
		|		И ОстаткиДетально.Номенклатура = ДД.Номенклатура
		|		И ОстаткиДетально.Характеристика = ДД.Характеристика
		|
		|	ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ДанныеПервичныхДокументов КАК ПериодикаПартии
		|		ПО ПериодикаПартии.Организация = ДД.Организация
		|		И ПериодикаПартии.Документ = ДД.Партия
		|";
КонецФункции

// ... выборки данных

Функция ТекстДетальныеНачальныеОстаткиПартийНДС2_4() // использует ОстаткиТоваров
	Возврат
		"ВЫБРАТЬ
		|	""ТекстДетальныеНачальныеОстаткиПартийНДС2_4"" КАК ЗапросИсточник,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Остаток) КАК ТипЗаписи,
		|	ВЫБОР
		|		КОГДА ДД.Знаменатель < 0 ТОГДА ИСТИНА
		|		ИНАЧЕ ЛОЖЬ
		|	КОНЕЦ КАК Сторно,
		|	0 КАК Приоритет,
		|	ДД.Знаменатель,
		|	0 КАК ЗнаменательДляИсточников,
		|	ИСТИНА КАК РасчетЗавершен,
		|	ДД.Номенклатура   КАК Номенклатура,
		|	ДД.Характеристика КАК Характеристика,
		|	
		|	ДД.Период,
		|	ДД.Период КАК ПериодПоступления,
		|	ДД.Регистратор,
		|	НЕОПРЕДЕЛЕНО КАК ВидДвижения,
		|	ДД.Организация,
		|	ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаНоменклатуры.ПустаяСсылка) КАК АналитикаУчетаНоменклатуры,
		|	ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка) 				      КАК ВидЗапасов,
		|	ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаНоменклатуры.ПустаяСсылка) КАК КорАналитикаУчетаНоменклатуры,
		|	ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка) 				      КАК КорВидЗапасов,
		|	ДД.Партия,
		|	ДД.АналитикаУчетаПартий,
        |	ДД.НалоговоеНазначение,
		|	ДД.ДокументПоступления,
		|	ДД.АналитикаУчетаДокументаПоступления,
		|	ДД.НаправлениеДеятельности,
		|
		|	ДД.СтоимостьБезНДС,
		|	ДД.НДС,
		|	ДД.СтоимостьБезНДСУпр,
		|	ДД.НДСУпр,
		|
		|	ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПустаяСсылка) КАК ХозяйственнаяОперация,
        |	ЗНАЧЕНИЕ(Справочник.НалоговыеНазначенияАктивовИЗатрат.ПустаяСсылка) КАК КорНалоговоеНазначение,
		|	ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка) КАК КорОрганизация,
		|	НЕОПРЕДЕЛЕНО КАК КорПартия,
		|	НЕОПРЕДЕЛЕНО КАК КорАналитикаУчетаПартий,
		|	НЕОПРЕДЕЛЕНО КАК КорНаправлениеДеятельности,
		|	НЕОПРЕДЕЛЕНО КАК Подразделение,
        |	НЕОПРЕДЕЛЕНО КАК КорАналитикаФинансовогоУчета,
		|	ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиРасходов.ПустаяСсылка) КАК СтатьяРасходовАктивов,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаРасходов,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаАктивов,
		|	НЕОПРЕДЕЛЕНО КАК ДокументИсточник,
		|	НЕОПРЕДЕЛЕНО КАК СтатьяСписанияНДС,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаСписанияНДС
		|ИЗ
		|	ВТНачальныеОстаткиПартийНДС КАК ДД
		|";
КонецФункции

Функция ТекстНачальныеОстаткиПартийНДС2_4() // использует ОстаткиТоваров
	Возврат
		"ВЫБРАТЬ
		|	""ТекстНачальныеОстаткиПартийНДС2_4"" КАК ЗапросИсточник,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ОстатокСгруппированный) КАК ТипЗаписи,
		|	ВЫБОР
		|		КОГДА МАКСИМУМ(ДД.Знаменатель) < 0 ТОГДА ИСТИНА
		|		ИНАЧЕ ЛОЖЬ
		|	КОНЕЦ КАК Сторно,
		|	0 КАК Приоритет,
		|	МАКСИМУМ(ДД.Знаменатель) КАК Знаменатель,
		|	СУММА(ДД.Знаменатель) КАК ЗнаменательДляИсточников,
		|	ВЫБОР КОГДА &РасчетПоПартиямПрочихРасходов
		|			ТОГДА ИСТИНА
		|			ИНАЧЕ ЛОЖЬ
		|	КОНЕЦ КАК РасчетЗавершен,
		|	НЕОПРЕДЕЛЕНО КАК Номенклатура,
		|	НЕОПРЕДЕЛЕНО КАК Характеристика,
		|	
		|	ДД.Период,
		|	ДД.Период КАК ПериодПоступления,
		|	ДД.Регистратор,
		|	ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход) КАК ВидДвижения,
		|	ДД.Организация,
		|	ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаНоменклатуры.ПустаяСсылка) КАК АналитикаУчетаНоменклатуры,
		|	ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка) 				      КАК ВидЗапасов,
		|	ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаНоменклатуры.ПустаяСсылка) КАК КорАналитикаУчетаНоменклатуры,
		|	ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка) 				      КАК КорВидЗапасов,
		|	ДД.Партия,
		|	ДД.АналитикаУчетаПартий,
        |	ДД.НалоговоеНазначение,
		|	НЕОПРЕДЕЛЕНО КАК ДокументПоступления,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаУчетаДокументаПоступления,
		|	ДД.НаправлениеДеятельности,
		|
		|	0,
		|	0,
		|	0,
		|	0,
		|
		|	ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПустаяСсылка) КАК ХозяйственнаяОперация,
        |	ЗНАЧЕНИЕ(Справочник.НалоговыеНазначенияАктивовИЗатрат.ПустаяСсылка) КАК КорНалоговоеНазначение,
		|	ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка) КАК КорОрганизация,
		|	НЕОПРЕДЕЛЕНО КАК КорПартия,
		|	НЕОПРЕДЕЛЕНО КАК КорАналитикаУчетаПартий,
		|	НЕОПРЕДЕЛЕНО КАК КорНаправлениеДеятельности,
		|	НЕОПРЕДЕЛЕНО КАК Подразделение,
        |	НЕОПРЕДЕЛЕНО КАК КорАналитикаФинансовогоУчета,
		|	ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиРасходов.ПустаяСсылка) КАК СтатьяРасходовАктивов,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаРасходов,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаАктивов,
		|	НЕОПРЕДЕЛЕНО КАК ДокументИсточник,
		|	НЕОПРЕДЕЛЕНО КАК СтатьяСписанияНДС,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаСписанияНДС
		|ИЗ
		|	ВТНачальныеОстаткиПартийНДС КАК ДД
		|ГДЕ
		|	ИСТИНА В (ВЫБРАТЬ Т.ЕстьЗаписи ИЗ ВыполнятьРаспределениеПартийНДС2_4 КАК Т)
		|
		|СГРУППИРОВАТЬ ПО
		|	ДД.Сторно,
		|	ДД.Период,
		|	ДД.Регистратор,
		|	ДД.Организация,
		|	ДД.Партия,
		|	ДД.АналитикаУчетаПартий,
        |	ДД.НалоговоеНазначение,
		|	ДД.НаправлениеДеятельности
		|";
КонецФункции

Функция ТекстПриходыСебестоимостиТоваров2_4()
	Возврат
		"ВЫБРАТЬ
		|	""ТекстПриходыСебестоимостиТоваров2_4"" КАК ЗапросИсточник,
		|	ДД.ТипЗаписи,
		|	ВЫБОР
		|		КОГДА СУММА(ДД.Знаменатель) < 0 ТОГДА ИСТИНА
		|		ИНАЧЕ ЛОЖЬ
		|	КОНЕЦ КАК Сторно,
		|	0 КАК Приоритет,
		|	СУММА(ДД.Знаменатель) КАК Знаменатель,
		|	СУММА(ДД.ЗнаменательДляИсточников) КАК ЗнаменательДляИсточников,
		|	ИСТИНА КАК РасчетЗавершен,
        |	ВЫБОР КОГДА ДД.ТипЗаписи В (
        |		ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходы),
        |		ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыСПартией),
        |		ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыБезПартии),
        |		ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаСтоимости),
        |		ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаПриобретенияПрошлогоПериода),
        |		ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ОтклонениеВСтоимости))
        |			ТОГДА ДД.Номенклатура
        |			ИНАЧЕ НЕОПРЕДЕЛЕНО
        |	КОНЕЦ КАК Номенклатура,
        |	ВЫБОР КОГДА ДД.ТипЗаписи В (
        |		ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходы),
        |		ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыСПартией),
        |		ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыБезПартии),
        |		ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаСтоимости),
        |		ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаПриобретенияПрошлогоПериода),
        |		ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ОтклонениеВСтоимости))
        |			ТОГДА ДД.Характеристика
        |			ИНАЧЕ НЕОПРЕДЕЛЕНО
        |	КОНЕЦ КАК Характеристика,
		|	
		|	ДД.Период,
		|	ДД.Период КАК ПериодПоступления,
		|	ДД.Регистратор,
		|	ДД.ВидДвижения,
		|	ДД.Организация,
        |	ВЫБОР КОГДА ДД.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
        |		ТОГДА 
        |			ВЫБОР КОГДА ДД.ТипЗаписи В (
        |				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходы),
        |				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыСПартией),
        |				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыБезПартии),
        |				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаСтоимости),
        |				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаПриобретенияПрошлогоПериода),
        |				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ОтклонениеВСтоимости))
        |					ТОГДА ДД.АналитикаУчетаНоменклатуры
        |					ИНАЧЕ ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаНоменклатуры.ПустаяСсылка)
        |			КОНЕЦ
        |		ИНАЧЕ ДД.АналитикаУчетаНоменклатуры
        |	КОНЕЦ КАК АналитикаУчетаНоменклатуры,
        |	ВЫБОР КОГДА ДД.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
        |		ТОГДА
        |			ВЫБОР КОГДА ДД.ТипЗаписи В (
        |				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходы),
        |				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыСПартией),
        |				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыБезПартии),
        |				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаСтоимости),
        |				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаПриобретенияПрошлогоПериода),
        |				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ОтклонениеВСтоимости))
        |					ТОГДА ДД.ВидЗапасов
        |					ИНАЧЕ ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка)
        |			КОНЕЦ
        |		ИНАЧЕ ДД.ВидЗапасов
        |	КОНЕЦ КАК ВидЗапасов,
		|	ДД.КорАналитикаУчетаНоменклатуры КАК КорАналитикаУчетаНоменклатуры,
		|	ДД.КорВидЗапасов КАК КорВидЗапасов,
		|	ДД.Партия,
		|	ДД.АналитикаУчетаПартий,
        |	ДД.НалоговоеНазначение,
		|	ДД.ДокументПоступления,
		|	ДД.АналитикаУчетаДокументаПоступления КАК АналитикаУчетаДокументаПоступления,
		|	ДД.НаправлениеДеятельности,
		|
		|	СУММА(ВЫБОР КОГДА &РасчетПоПартиямПрочихРасходов ТОГДА 0 ИНАЧЕ ДД.СтоимостьБезНДС КОНЕЦ),
		|	СУММА(ВЫБОР КОГДА &РасчетПоПартиямПрочихРасходов ТОГДА 0 ИНАЧЕ ДД.НДС КОНЕЦ),
		|	СУММА(ВЫБОР КОГДА &РасчетПоПартиямПрочихРасходов ТОГДА 0 ИНАЧЕ ДД.СтоимостьБезНДСУпр КОНЕЦ),
		|	СУММА(ВЫБОР КОГДА &РасчетПоПартиямПрочихРасходов ТОГДА 0 ИНАЧЕ ДД.НДСУпр КОНЕЦ),
		|
		|	ДД.ХозяйственнаяОперация,
        |	ДД.КорНалоговоеНазначение,
		|	ДД.КорОрганизация,
		|	ДД.КорПартия,
		|	ДД.КорАналитикаУчетаПартий,
		|	ДД.КорНаправлениеДеятельности,
		|	ДД.Подразделение,
        |	НЕОПРЕДЕЛЕНО КАК КорАналитикаФинансовогоУчета,
		|	ДД.СтатьяРасходовАктивов,
		|	ДД.АналитикаРасходов,
		|	ДД.АналитикаАктивов,
		|	ДД.ДокументИсточник,
		|	НЕОПРЕДЕЛЕНО КАК СтатьяСписанияНДС,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаСписанияНДС
		|ИЗ
		|	ПриходыТоваровНДС2_4 КАК ДД
		|ГДЕ
        |	(ДД.СтоимостьБезНДС <> 0 ИЛИ ДД.НДС <> 0 ИЛИ ДД.СтоимостьБезНДСУпр <> 0 ИЛИ ДД.НДСУпр <> 0)
		|	И НЕ (&РасчетПоПартиямПрочихРасходов И ДД.ТипЗаписи <> ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Партия))
		|	И ИСТИНА В (ВЫБРАТЬ Т.ЕстьЗаписи ИЗ ВыполнятьРаспределениеПартийНДС2_4 КАК Т)
		|
		|СГРУППИРОВАТЬ ПО
		|	ДД.ТипЗаписи,
		|	ВЫБОР
		|		КОГДА ДД.СтоимостьБезНДС < 0 ТОГДА ИСТИНА
		|		ИНАЧЕ ЛОЖЬ
		|	КОНЕЦ,
        |	ВЫБОР КОГДА ДД.ТипЗаписи В (
        |		ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходы),
        |		ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыСПартией),
        |		ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыБезПартии),
        |		ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаСтоимости),
        |		ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаПриобретенияПрошлогоПериода),
        |		ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ОтклонениеВСтоимости))
        |			ТОГДА ДД.Номенклатура
        |			ИНАЧЕ НЕОПРЕДЕЛЕНО
        |	КОНЕЦ,
        |	ВЫБОР КОГДА ДД.ТипЗаписи В (
        |		ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходы),
        |		ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыСПартией),
        |		ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыБезПартии),
        |		ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаСтоимости),
        |		ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаПриобретенияПрошлогоПериода),
        |		ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ОтклонениеВСтоимости))
        |			ТОГДА ДД.Характеристика
        |			ИНАЧЕ НЕОПРЕДЕЛЕНО
        |	КОНЕЦ,
		|	ДД.Период,
		|	ДД.Регистратор,
		|	ДД.ВидДвижения,
		|	ДД.Организация,
        |	ВЫБОР КОГДА ДД.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
        |		ТОГДА 
        |			ВЫБОР КОГДА ДД.ТипЗаписи В (
        |				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходы),
        |				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыСПартией),
        |				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыБезПартии),
        |				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаСтоимости),
        |				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаПриобретенияПрошлогоПериода),
        |				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ОтклонениеВСтоимости))
        |					ТОГДА ДД.АналитикаУчетаНоменклатуры
        |					ИНАЧЕ ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаНоменклатуры.ПустаяСсылка)
        |			КОНЕЦ
        |		ИНАЧЕ ДД.АналитикаУчетаНоменклатуры
        |	КОНЕЦ,
        |	ВЫБОР КОГДА ДД.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
        |		ТОГДА
        |			ВЫБОР КОГДА ДД.ТипЗаписи В (
        |				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходы),
        |				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыСПартией),
        |				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыБезПартии),
        |				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаСтоимости),
        |				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаПриобретенияПрошлогоПериода),
        |				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ОтклонениеВСтоимости))
        |					ТОГДА ДД.ВидЗапасов
        |					ИНАЧЕ ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка)
        |			КОНЕЦ
        |		ИНАЧЕ ДД.ВидЗапасов
        |	КОНЕЦ,
		|	ДД.КорАналитикаУчетаНоменклатуры,
		|	ДД.КорВидЗапасов,
		|	ДД.Партия,
		|	ДД.АналитикаУчетаПартий,
        |	ДД.НалоговоеНазначение,
		|	ДД.ДокументПоступления,
		|	ДД.АналитикаУчетаДокументаПоступления,
		|	ДД.НаправлениеДеятельности,
		|	ДД.ХозяйственнаяОперация,
        |	ДД.КорНалоговоеНазначение,
		|	ДД.КорОрганизация,
		|	ДД.КорПартия,
		|	ДД.КорАналитикаУчетаПартий,
		|	ДД.КорНаправлениеДеятельности,
		|	ДД.Подразделение,
		|	ДД.СтатьяРасходовАктивов,
		|	ДД.АналитикаРасходов,
		|	ДД.АналитикаАктивов,
		|	ДД.ДокументИсточник
		|";
КонецФункции

Функция ТекстДвиженияСебестоимостиТоваров2_4()
	Возврат
		"ВЫБРАТЬ
		|	""ТекстДвиженияСебестоимостиТоваров2_4"" КАК ЗапросИсточник,
		|	ДД.ТипЗаписи,
		|	ВЫБОР
		|		КОГДА СУММА(ДД.Знаменатель) < 0 ТОГДА ИСТИНА
		|		ИНАЧЕ ЛОЖЬ
		|	КОНЕЦ КАК Сторно,
		|	0 КАК Приоритет,
		|	СУММА(ДД.Знаменатель) КАК Знаменатель,
		|	СУММА(ДД.ЗнаменательДляИсточников) КАК ЗнаменательДляИсточников,
		|	ЛОЖЬ КАК РасчетЗавершен,
        |	ВЫБОР КОГДА НЕ &РасчетПоПартиямПрочихРасходов И ДД.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
        |			ТОГДА ДД.Номенклатура
        |			ИНАЧЕ НЕОПРЕДЕЛЕНО
        |	КОНЕЦ КАК Номенклатура,
        |	ВЫБОР КОГДА НЕ &РасчетПоПартиямПрочихРасходов И ДД.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
        |			ТОГДА ДД.Характеристика
        |			ИНАЧЕ НЕОПРЕДЕЛЕНО
        |	КОНЕЦ КАК Характеристика,
		|
		|	ДД.Период,
		|	ВЫБОР
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаПриобретения)
		|			ТОГДА &НачалоПериода
		|		ИНАЧЕ ДД.Период
		|	КОНЕЦ КАК ПериодПоступления,
		|	ДД.Регистратор,
		|	ДД.ВидДвижения,
		|	ДД.Организация,
        |	ВЫБОР КОГДА &РасчетПоПартиямПрочихРасходов ИЛИ ДД.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
        |		ТОГДА ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаНоменклатуры.ПустаяСсылка)
        |		ИНАЧЕ ДД.АналитикаУчетаНоменклатуры
        |	КОНЕЦ КАК АналитикаУчетаНоменклатуры,
        |	ВЫБОР КОГДА &РасчетПоПартиямПрочихРасходов ИЛИ ДД.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
        |		ТОГДА ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка)
        |		ИНАЧЕ ДД.ВидЗапасов
        |	КОНЕЦ КАК ВидЗапасов,
		|	ВЫБОР
		|		КОГДА ДД.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
		|			И ДД.КорАналитикаУчетаНоменклатуры = ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаНоменклатуры.ПустаяСсылка)
		|		ТОГДА ДД.АналитикаУчетаНоменклатуры
		|		ИНАЧЕ ДД.КорАналитикаУчетаНоменклатуры
		|	КОНЕЦ КАК КорАналитикаУчетаНоменклатуры,
		|	ВЫБОР
		|		КОГДА ДД.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
		|			И ДД.КорВидЗапасов = ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка)
		|		ТОГДА ДД.ВидЗапасов
		|		ИНАЧЕ ДД.КорВидЗапасов
		|	КОНЕЦ КАК КорВидЗапасов,
		|	(ВЫБОР
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Выпуск)
		|		 И ДД.Партия = НЕОПРЕДЕЛЕНО
		|			ТОГДА ДД.Регистратор
		|		КОГДА ДД.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыВПути)
		|		 И ДД.Партия = НЕОПРЕДЕЛЕНО
		|			ТОГДА ДД.Регистратор
		|		ИНАЧЕ ДД.Партия КОНЕЦ) КАК Партия,
		|	ДД.АналитикаУчетаПартий,
        |	ДД.НалоговоеНазначение,
		|	НЕОПРЕДЕЛЕНО КАК ДокументПоступления,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаУчетаДокументаПоступления,
		|	ДД.НаправлениеДеятельности,
		|
		|	0 КАК СтоимостьБезНДС,
		|	0 КАК НДС,
		|	0 КАК СтоимостьБезНДСУпр,
		|	0 КАК НДСУпр,
		|	ДД.ХозяйственнаяОперация,
        |	ДД.КорНалоговоеНазначение,
		|	ДД.КорОрганизация,
		|	(ВЫБОР
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.СписанияНаВыпуск)
		|		 И ДД.КорПартия = НЕОПРЕДЕЛЕНО
		|			ТОГДА ДД.Регистратор
		|		КОГДА ДД.КорРазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыВПути)
		|		 И ДД.КорПартия = НЕОПРЕДЕЛЕНО
		|			ТОГДА ДД.Регистратор
		|		ИНАЧЕ ДД.КорПартия КОНЕЦ) КАК КорПартия,
		|	ДД.КорАналитикаУчетаПартий КАК КорАналитикаУчетаПартий,
		|	ВЫБОР
		|		КОГДА ДД.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
		|			И ДД.КорНаправлениеДеятельности = ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка)
		|		ТОГДА ДД.НаправлениеДеятельности
		|		ИНАЧЕ ДД.КорНаправлениеДеятельности
		|	КОНЕЦ КАК КорНаправлениеДеятельности,
		|	ДД.Подразделение,
		|	ДД.КорАналитикаФинансовогоУчета,
		|	ДД.СтатьяРасходовАктивов,
		|	ДД.АналитикаРасходов,
		|	ДД.АналитикаАктивов,
		|	ВЫБОР КОГДА ДД.ТипЗаписи В (ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Сторно), ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.СторноВозвратНаДругойСклад))
		|		ТОГДА ДД.ДокументИсточник
		|		ИНАЧЕ НЕОПРЕДЕЛЕНО
		|	КОНЕЦ КАК ДокументИсточник,
		|	НЕОПРЕДЕЛЕНО КАК СтатьяСписанияНДС,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаСписанияНДС
		|ИЗ
		|	ДвиженияСебестоимостиНДС2_4 КАК ДД
		|ГДЕ
		|	ДД.Знаменатель <> 0
		|	И ДД.ТипЗаписи <> ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ВключениеИсключениеНДСвСтоимости)
		|	И НЕ (&РасчетПоПартиямПрочихРасходов
		|		И ДД.ТипЗаписи В
		|			(ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение),
		|			ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ОтклонениеВСтоимости),
		|			ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.РаспределениеПоВыбывшимТоварам),
		|			ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаСтоимости),
		|			ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходы),
		|			ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыСПартией),
		|			ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыБезПартии),
		|			ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ПеремещениеУпр)))
		|	И ИСТИНА В (ВЫБРАТЬ Т.ЕстьЗаписи ИЗ ВыполнятьРаспределениеПартийНДС2_4 КАК Т)
		|
		|СГРУППИРОВАТЬ ПО
		|	ДД.ТипЗаписи,
		|	ДД.Сторно,
        |	ВЫБОР КОГДА НЕ &РасчетПоПартиямПрочихРасходов И ДД.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
        |			ТОГДА ДД.Номенклатура
        |			ИНАЧЕ НЕОПРЕДЕЛЕНО
        |	КОНЕЦ,
        |	ВЫБОР КОГДА НЕ &РасчетПоПартиямПрочихРасходов И ДД.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
        |			ТОГДА ДД.Характеристика
        |			ИНАЧЕ НЕОПРЕДЕЛЕНО
        |	КОНЕЦ,
		|	ДД.Период,
		|	ДД.Регистратор,
		|	ДД.ВидДвижения,
		|	ДД.Организация,
        |	ВЫБОР КОГДА &РасчетПоПартиямПрочихРасходов ИЛИ ДД.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
        |		ТОГДА ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаНоменклатуры.ПустаяСсылка)
        |		ИНАЧЕ ДД.АналитикаУчетаНоменклатуры
        |	КОНЕЦ,
        |	ВЫБОР КОГДА &РасчетПоПартиямПрочихРасходов ИЛИ ДД.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
        |		ТОГДА ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка)
        |		ИНАЧЕ ДД.ВидЗапасов
        |	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА ДД.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
		|			И ДД.КорАналитикаУчетаНоменклатуры = ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаНоменклатуры.ПустаяСсылка)
		|		ТОГДА ДД.АналитикаУчетаНоменклатуры
		|		ИНАЧЕ ДД.КорАналитикаУчетаНоменклатуры
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА ДД.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
		|			И ДД.КорВидЗапасов = ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка)
		|		ТОГДА ДД.ВидЗапасов
		|		ИНАЧЕ ДД.КорВидЗапасов
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА ДД.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
		|			И ДД.КорАналитикаУчетаНоменклатуры = ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаНоменклатуры.ПустаяСсылка)
		|		ТОГДА ДД.НаправлениеДеятельности
		|		ИНАЧЕ ДД.КорНаправлениеДеятельности
		|	КОНЕЦ,
		|	(ВЫБОР
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Выпуск)
		|		 И ДД.Партия = НЕОПРЕДЕЛЕНО
		|			ТОГДА ДД.Регистратор
		|		КОГДА ДД.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыВПути)
		|		 И ДД.Партия = НЕОПРЕДЕЛЕНО
		|			ТОГДА ДД.Регистратор
		|		ИНАЧЕ ДД.Партия КОНЕЦ),
        |	ДД.НалоговоеНазначение,
		|	ДД.АналитикаУчетаПартий,
		|	ДД.НаправлениеДеятельности,
		|	ВЫБОР
		|		КОГДА ДД.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
		|			И ДД.КорНаправлениеДеятельности = ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка)
		|		ТОГДА ДД.НаправлениеДеятельности
		|		ИНАЧЕ ДД.КорНаправлениеДеятельности
		|	КОНЕЦ,
		|	ДД.ХозяйственнаяОперация,
        |	ДД.КорНалоговоеНазначение,
		|	ДД.КорОрганизация,
		|	(ВЫБОР
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.СписанияНаВыпуск)
		|		 И ДД.КорПартия = НЕОПРЕДЕЛЕНО
		|			ТОГДА ДД.Регистратор
		|		КОГДА ДД.КорРазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыВПути)
		|		 И ДД.КорПартия = НЕОПРЕДЕЛЕНО
		|			ТОГДА ДД.Регистратор
		|		ИНАЧЕ ДД.КорПартия КОНЕЦ),
		|	ДД.Подразделение,
		|	ДД.КорАналитикаФинансовогоУчета,
		|	ДД.КорАналитикаУчетаПартий,
		|	ДД.СтатьяРасходовАктивов,
		|	ДД.АналитикаРасходов,
		|	ДД.АналитикаАктивов,
		|	ВЫБОР КОГДА ДД.ТипЗаписи В (ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Сторно), ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.СторноВозвратНаДругойСклад))
		|		ТОГДА ДД.ДокументИсточник
		|		ИНАЧЕ НЕОПРЕДЕЛЕНО
		|	КОНЕЦ";
КонецФункции

Функция ТекстДвиженияСебестоимостиТоваровСборка2_4()
	Возврат
		"ВЫБРАТЬ
		|	""ТекстДвиженияСебестоимостиТоваровСборка2_4"" КАК ЗапросИсточник,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Перемещение) КАК ТипЗаписи,
		|	ВЫБОР
		|		КОГДА МАКСИМУМ(ЕСТЬNULL(Знаменатели.Знаменатель, 0)) < 0 ТОГДА ИСТИНА
		|		ИНАЧЕ ЛОЖЬ
		|	КОНЕЦ КАК Сторно,
		|	0 КАК Приоритет,
		|	МАКСИМУМ(ЕСТЬNULL(Знаменатели.Знаменатель, 0)) КАК Знаменатель,
		|	МАКСИМУМ(ЕСТЬNULL(Знаменатели.ЗнаменательДляИсточников, 0)) КАК ЗнаменательДляИсточников,
		|	ЛОЖЬ КАК РасчетЗавершен,
		|	НЕОПРЕДЕЛЕНО КАК Номенклатура,
		|	НЕОПРЕДЕЛЕНО КАК Характеристика,
		|	
		|	ДД.Период,
		|	ДД.Период КАК ПериодПоступления,
		|	ДД.Регистратор,
		|	ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход) КАК ВидДвижения,
		|	ДД.Организация,
		|	ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаНоменклатуры.ПустаяСсылка) КАК АналитикаУчетаНоменклатуры,
		|	ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка) КАК ВидЗапасов,
		|	ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаНоменклатуры.ПустаяСсылка) КАК КорАналитикаУчетаНоменклатуры,
		|	ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка) КАК КорВидЗапасов,
		|	ДД.КорПартия КАК Партия,
		|	ЕСТЬNULL(АналитикиУчетаПартий.Ссылка, ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка)) КАК АналитикаУчетаПартий,
        |	ДД.КорНалоговоеНазначение КАК НалоговоеНазначение,
		|
		|	НЕОПРЕДЕЛЕНО КАК ДокументПоступления,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаУчетаДокументаПоступления,
		|	ЕСТЬNULL(ДД.КорАналитикаУчетаНоменклатуры.Назначение.НаправлениеДеятельности, ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка)) КАК НаправлениеДеятельности,
		|
		|	0 КАК СтоимостьБезНДС,
		|	0 КАК НДС,
		|	0 КАК СтоимостьБезНДСУпр,
		|	0 КАК НДСУпр,
		|
		|	ДД.ХозяйственнаяОперация,
        |	НЕОПРЕДЕЛЕНО КАК КорНалоговоеНазначение,
		|	НЕОПРЕДЕЛЕНО КАК КорОрганизация,
		|	НЕОПРЕДЕЛЕНО КАК КорПартия,
		|	НЕОПРЕДЕЛЕНО КАК КорАналитикаУчетаПартий,
		|	НЕОПРЕДЕЛЕНО КАК КорНаправлениеДеятельности,
		|	НЕОПРЕДЕЛЕНО КАК Подразделение,
        |	НЕОПРЕДЕЛЕНО КАК КорАналитикаФинансовогоУчета,
		|	НЕОПРЕДЕЛЕНО КАК СтатьяРасходовАктивов,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаРасходов,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаАктивов,
		|	ДД.Регистратор КАК ДокументИсточник,
		|	НЕОПРЕДЕЛЕНО КАК СтатьяСписанияНДС,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаСписанияНДС
		|ИЗ
		|	ВТКэшРасчетныеОборотыСебестоимостьТоваров КАК ДД
		|	ЛЕВОЕ СОЕДИНЕНИЕ ЗнаменателиПриходов КАК Знаменатели
		|		ПО Знаменатели.Регистратор = ДД.Регистратор
		|		И Знаменатели.Организация = ДД.Организация
		|		И Знаменатели.Партия = ДД.КорПартия
		|		И Знаменатели.АналитикаУчетаПартий = ДД.КорАналитикаУчетаПартий
		|		И Знаменатели.АналитикаФинансовогоУчета = ДД.КорАналитикаФинансовогоУчета
        |		И Знаменатели.НалоговоеНазначение = ДД.КорНалоговоеНазначение
		|		И Знаменатели.АналитикаУчетаНоменклатуры = ДД.КорАналитикаУчетаНоменклатуры
		|		И Знаменатели.ВидЗапасов = ДД.КорВидЗапасов
		|		И Знаменатели.РазделУчета = ДД.КорРазделУчета
		|		И НЕ ДД.СлужебноеВидДвиженияПриход
		|		И НЕ Знаменатели.ЭтоДопРасходы
		|	ЛЕВОЕ СОЕДИНЕНИЕ ВТОтборАналитикиУчетаПартийНДС2_4 КАК АналитикиУчетаПартий
		|		ПО ДД.КорАналитикаУчетаПартий = АналитикиУчетаПартий.Ссылка
		|	ЛЕВОЕ СОЕДИНЕНИЕ ВТОтборАналитикиУчетаПартийНДС2_4 КАК КорАналитикиУчетаПартий
		|		ПО ДД.КорАналитикаУчетаПартий = КорАналитикиУчетаПартий.Ссылка
		|ГДЕ
		|	ДД.Организация В (&ОрганизацииСУчетомПартийНДСВерсии24)
		|	И ДД.Количество <> 0
		|	И ДД.Регистратор ССЫЛКА Документ.СборкаТоваров
		|	И ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Потребление)
		|СГРУППИРОВАТЬ ПО
		|	(ВЫБОР
		|		КОГДА ДД.СтоимостьРегл < 0 ТОГДА ИСТИНА
		|		ИНАЧЕ ЛОЖЬ КОНЕЦ),
		|	ДД.Период,
		|	ДД.Регистратор,
		|	ДД.Организация,
		|	ДД.КорПартия,
		|	ЕСТЬNULL(АналитикиУчетаПартий.Ссылка, ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка)),
        |	ДД.КорНалоговоеНазначение,
		|	ЕСТЬNULL(ДД.КорАналитикаУчетаНоменклатуры.Назначение.НаправлениеДеятельности, ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка)),
		|	ДД.ХозяйственнаяОперация
		|";
КонецФункции

Функция ТекстВозвратыПрошлыхПериодов2_4()
	Возврат
		"ВЫБРАТЬ
		|	""ТекстВозвратыПрошлыхПериодов2_4"" КАК ЗапросИсточник,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ВозвратПрошлыхПериодов) КАК ТипЗаписи,
		|	ИСТИНА КАК Сторно,
		|	0 КАК Приоритет,
		|	-Знаменатели.Знаменатель КАК Знаменатель,
		|	-Знаменатели.Знаменатель КАК ЗнаменательДляИсточников,
		|	ЛОЖЬ КАК РасчетЗавершен,
		|	ДД.АналитикаУчетаНоменклатуры.Номенклатура КАК Номенклатура,
		|	ДД.АналитикаУчетаНоменклатуры.Характеристика КАК Характеристика,
		|	
		|	ДД.Период,
		|	ДД.Период КАК ПериодПоступления,
		|	ДД.Регистратор,
		|	ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход) КАК ВидДвижения,
		|	ДД.Организация,
		|	ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаНоменклатуры.ПустаяСсылка) КАК АналитикаУчетаНоменклатуры,
		|	ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка) КАК ВидЗапасов,
		|	ДД.АналитикаУчетаНоменклатуры КАК КорАналитикаУчетаНоменклатуры,
		|	ДД.ВидЗапасов КАК КорВидЗапасов,
		|	ДД.Партия,
		|	ЕСТЬNULL(АналитикиУчетаПартий.Ссылка, ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка)) КАК АналитикаУчетаПартий,
        |	ДД.НалоговоеНазначение,
		|
		|	НЕОПРЕДЕЛЕНО КАК ДокументПоступления,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаУчетаДокументаПоступления,
		|	ЕСТЬNULL(ДД.АналитикаУчетаНоменклатуры.Назначение.НаправлениеДеятельности, ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка)) КАК НаправлениеДеятельности,
		|
		|	0 КАК СтоимостьБезНДС,
		|	0 КАК НДС,
		|	0 КАК СтоимостьБезНДСУпр,
		|	0 КАК НДСУпр,
		|
		|	ДД.ХозяйственнаяОперация,
        |	ДД.КорНалоговоеНазначение,
		|	ДД.Организация КАК КорОрганизация,
		|	ДД.Партия КАК КорПартия,
		|	ЕСТЬNULL(КорАналитикиУчетаПартий.Ссылка, ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка)) КАК КорАналитикаУчетаПартий,
		|	ЕСТЬNULL(ДД.АналитикаУчетаНоменклатуры.Назначение.НаправлениеДеятельности, ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка)) КАК КорНаправлениеДеятельности,
        |	НЕОПРЕДЕЛЕНО КАК Подразделение,
		|	ДД.КорАналитикаФинансовогоУчета,
		|	НЕОПРЕДЕЛЕНО КАК СтатьяРасходовАктивов,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаРасходов,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаАктивов,
		|	ДД.ДокументИсточник,
		|	НЕОПРЕДЕЛЕНО КАК СтатьяСписанияНДС,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаСписанияНДС
		|ИЗ
		|	ВТКэшРасчетныеОборотыСебестоимостьТоваров КАК ДД
		|	ЛЕВОЕ СОЕДИНЕНИЕ ЗнаменателиПриходов КАК Знаменатели
		|		ПО Знаменатели.Регистратор = ДД.Регистратор
		|		И Знаменатели.Организация = ДД.Организация
		|		И Знаменатели.Партия = ДД.Партия
		|		И Знаменатели.АналитикаУчетаПартий = ДД.АналитикаУчетаПартий
		|		И Знаменатели.АналитикаФинансовогоУчета = ДД.АналитикаФинансовогоУчета
        |		И Знаменатели.НалоговоеНазначение = ДД.НалоговоеНазначение
		|		И Знаменатели.АналитикаУчетаНоменклатуры = ДД.АналитикаУчетаНоменклатуры
		|		И Знаменатели.ВидЗапасов = ДД.ВидЗапасов
		|		И Знаменатели.РазделУчета = ДД.РазделУчета
		|		И ДД.СлужебноеВидДвиженияПриход
		|		И НЕ Знаменатели.ЭтоДопРасходы
		|	ЛЕВОЕ СОЕДИНЕНИЕ ВТОтборАналитикиУчетаПартийНДС2_4 КАК АналитикиУчетаПартий
		|		ПО ДД.АналитикаУчетаПартий = АналитикиУчетаПартий.Ссылка
		|	ЛЕВОЕ СОЕДИНЕНИЕ ВТОтборАналитикиУчетаПартийНДС2_4 КАК КорАналитикиУчетаПартий
		|		ПО ДД.КорАналитикаУчетаПартий = КорАналитикиУчетаПартий.Ссылка
		|ГДЕ
		|	ДД.Организация В (&ОрганизацииСУчетомПартийНДСВерсии24)
		|	И ЕСТЬNULL(Знаменатели.Знаменатель, 0) <> 0
        |	И ДД.НалоговоеНазначение <> ЗНАЧЕНИЕ(Справочник.НалоговыеНазначенияАктивовИЗатрат.ПустаяСсылка)
		|	И ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ВозвратПрошлыхПериодов)
		|";
КонецФункции

Функция ТекстРеализацииПрошлыхМесяцевПартииНДС2_2() // использует ПрошлыеРеализации 
	Возврат
		"ВЫБРАТЬ
		|	""ТекстРеализацииПрошлыхМесяцевПартииНДС2_2"" КАК ЗапросИсточник,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Прошлое) КАК ТипЗаписи,
		|	ЛОЖЬ КАК Сторно,
		|	0 КАК Приоритет,
		|	Прошлые.Знаменатель * КоличествоРеализации.Количество / Прошлые.Количество КАК Знаменатель,
		|	0 КАК ЗнаменательДляИсточников,
		|	ИСТИНА КАК РасчетЗавершен,
		|	ВЫБОР КОГДА ДД.Количество = 0
		|		ТОГДА ДД.АналитикаУчетаНоменклатуры.Номенклатура
		|		ИНАЧЕ НЕОПРЕДЕЛЕНО
		|	КОНЕЦ КАК Номенклатура,
		|	ВЫБОР КОГДА ДД.Количество = 0
		|		ТОГДА ДД.АналитикаУчетаНоменклатуры.Характеристика
		|		ИНАЧЕ НЕОПРЕДЕЛЕНО
		|	КОНЕЦ КАК Характеристика,
		|	
		|	ДД.Период,
		|	ДД.Период КАК ПериодПоступления,
		|	ДД.Регистратор,
		|	ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход) КАК ВидДвижения,
		|	ДД.Организация,
		|	ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаНоменклатуры.ПустаяСсылка) КАК АналитикаУчетаНоменклатуры,
		|	ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка) КАК ВидЗапасов,
		|	ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаНоменклатуры.ПустаяСсылка) КАК КорАналитикаУчетаНоменклатуры,
		|	ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка) КАК КорВидЗапасов,
		|	НЕОПРЕДЕЛЕНО,
		|	Прошлые.АналитикаУчетаПартий,
        |	ДД.КорНалоговоеНазначение КАК НалоговоеНазначение,
		|	ДД.ДокументПоступления,
		|	ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка),
		|	ЕСТЬNULL(ДД.АналитикаУчетаНоменклатуры.Назначение.НаправлениеДеятельности, ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка)),
		|
		|	ДД.СтоимостьБезНДС,
		|	ДД.НДС,
		|	0,
		|	ДД.НДСУпр,
		|
		|	НЕОПРЕДЕЛЕНО КАК ХозяйственнаяОперация,
        |	НЕОПРЕДЕЛЕНО КАК КорНалоговоеНазначение,
		|	НЕОПРЕДЕЛЕНО КАК КорОрганизация,
		|	НЕОПРЕДЕЛЕНО КАК КорПартия,
		|	НЕОПРЕДЕЛЕНО КАК КорАналитикаУчетаПартий,
		|	НЕОПРЕДЕЛЕНО КАК КорНаправлениеДеятельности,
		|	НЕОПРЕДЕЛЕНО КАК Подразделение,
        |	НЕОПРЕДЕЛЕНО КАК КорАналитикаФинансовогоУчета,
		|	НЕОПРЕДЕЛЕНО КАК СтатьяРасходовАктивов,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаРасходов,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаАктивов,
		|	НЕОПРЕДЕЛЕНО КАК ДокументИсточник,
		|	НЕОПРЕДЕЛЕНО КАК СтатьяСписанияНДС,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаСписанияНДС
		|ИЗ
        |	РегистрНакопления.ДетализацияПартийТоваровДляНДС КАК ДД
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ КоличествоПрошлыеРеализацииПартийНДС2_2 КАК КоличествоРеализации
		|		ПО ДД.Регистратор = КоличествоРеализации.Регистратор
		|		И ДД.Организация = КоличествоРеализации.Организация
		|		И ДД.РазделУчета = КоличествоРеализации.РазделУчета
		|		И ДД.АналитикаУчетаНоменклатуры = КоличествоРеализации.АналитикаУчетаНоменклатуры
		|		И ДД.ВидЗапасов = КоличествоРеализации.ВидЗапасов
		|		И ДД.Партия = КоличествоРеализации.Партия
		|		И ДД.АналитикаФинансовогоУчета = КоличествоРеализации.АналитикаФинансовогоУчета
        |		И ДД.НалоговоеНазначение = КоличествоРеализации.НалоговоеНазначение
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ ПрошлыеРеализацииПартийНДС2_2 КАК Прошлые
		|		ПО ДД.Регистратор = Прошлые.ДокументИсточник
		|		И ДД.Организация = Прошлые.Организация
		|		И ДД.РазделУчета = Прошлые.РазделУчета
		|		И ДД.АналитикаУчетаНоменклатуры = Прошлые.АналитикаУчетаНоменклатуры
		|		И ДД.ВидЗапасов = Прошлые.ВидЗапасов
		|		И ДД.АналитикаФинансовогоУчета = Прошлые.АналитикаФинансовогоУчета
        |		И ДД.КорНалоговоеНазначение = Прошлые.НалоговоеНазначение
		|ГДЕ
		|	ДД.Организация В (&ОрганизацииСУчетомПартийНДСВерсии24)
		|	И ДД.Активность
		|";
КонецФункции

Функция ТекстРеализацииПрошлыхМесяцевПартииНДС2_4() // использует ПрошлыеРеализации 
	Возврат
		"ВЫБРАТЬ
		|	""ТекстРеализацииПрошлыхМесяцевПартииНДС2_4"" КАК ЗапросИсточник,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Прошлое) КАК ТипЗаписи,
		|	ЛОЖЬ КАК Сторно,
		|	0 КАК Приоритет,
		|	ДД.СтоимостьБезНДС
        |		+ ВЫБОР КОГДА ДД.НалоговоеНазначение.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ВидыДеятельностиНДС.Необлагаемая) 
		|			ТОГДА ДД.НДС
		|			ИНАЧЕ 0
		|		КОНЕЦ 									КАК Знаменатель,
		|	0											КАК ЗнаменательДляИсточников,
		|	ИСТИНА КАК 									РасчетЗавершен,
		|	ДД.Номенклатура   							КАК Номенклатура,
		|	ДД.Характеристика 							КАК Характеристика,
		|	
		|	ДД.Период,
		|	ДД.Период КАК ПериодПоступления,
		|	ДД.Регистратор,
		|	ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход) КАК ВидДвижения,
		|	ДД.Организация,
		|	ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаНоменклатуры.ПустаяСсылка) КАК АналитикаУчетаНоменклатуры,
		|	ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка) КАК ВидЗапасов,
		|	ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаНоменклатуры.ПустаяСсылка) КАК КорАналитикаУчетаНоменклатуры,
		|	ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка) КАК КорВидЗапасов,
		|	ДД.Партия,
		|	ДД.АналитикаУчетаПартий,
        |	ДД.КорНалоговоеНазначение КАК НалоговоеНазначение,
		|	ДД.ДокументПоступления,
		|	ДД.АналитикаУчетаДокументаПоступления,
		|	ДД.НаправлениеДеятельности,
		|
		|	ДД.СтоимостьБезНДС,
		|	ДД.НДС,
		|	ДД.СтоимостьБезНДСУпр,
		|	ДД.НДСУпр,
		|
		|	НЕОПРЕДЕЛЕНО КАК ХозяйственнаяОперация,
        |	НЕОПРЕДЕЛЕНО КАК КорНалоговоеНазначение,
		|	НЕОПРЕДЕЛЕНО КАК КорОрганизация,
		|	НЕОПРЕДЕЛЕНО КАК КорПартия,
		|	НЕОПРЕДЕЛЕНО КАК КорАналитикаУчетаПартий,
		|	НЕОПРЕДЕЛЕНО КАК КорНаправлениеДеятельности,
		|	НЕОПРЕДЕЛЕНО КАК Подразделение,
        |	НЕОПРЕДЕЛЕНО КАК КорАналитикаФинансовогоУчета,
		|	НЕОПРЕДЕЛЕНО КАК СтатьяРасходовАктивов,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаРасходов,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаАктивов,
		|	НЕОПРЕДЕЛЕНО КАК ДокументИсточник,
		|	НЕОПРЕДЕЛЕНО КАК СтатьяСписанияНДС,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаСписанияНДС
		|ИЗ
        |	РегистрНакопления.ДетализацияПартийТоваровДляНДС2_4 КАК ДД
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ ПрошлыеРеализацииПартийНДС2_4 КАК Прошлые
		|		ПО ДД.Регистратор = Прошлые.ДокументИсточник
		|		И ДД.Организация = Прошлые.Организация
		|		И ДД.Партия = Прошлые.Партия
		|		И ДД.АналитикаУчетаПартий = Прошлые.АналитикаУчетаВнешнихПартий
        |		И ДД.КорНалоговоеНазначение = Прошлые.НалоговоеНазначение
		|ГДЕ
		|	ДД.Организация В (&ОрганизацииСУчетомПартийНДСВерсии24)
		|	И ДД.Активность
		|	И Прошлые.Знаменатель <> 0
		|";
КонецФункции

Функция ТекстРеализацииПрошлыхМесяцевПартииНДС21_2_4() // использует ПрошлыеРеализации 
	Возврат
		"ВЫБРАТЬ
		|	""ТекстРеализацииПрошлыхМесяцевПартииНДС21_2_4"" КАК ЗапросИсточник,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Прошлое) КАК ТипЗаписи,
		|	ЛОЖЬ 											 КАК Сторно,
		|	0 												 КАК Приоритет,
		|	ВЫБОР КОГДА ДД.СтоимостьРегл = 0
		|		ТОГДА ДД.СтоимостьБезНДС
		|		ИНАЧЕ ДД.СтоимостьРегл
		|	КОНЕЦ											 КАК Знаменатель,
		|	0								 				 КАК ЗнаменательДляИсточников,
		|	ИСТИНА 											 КАК РасчетЗавершен,
		|	НЕОПРЕДЕЛЕНО									 КАК Номенклатура,
		|	НЕОПРЕДЕЛЕНО 									 КАК Характеристика,
		|	
		|	ДД.Период,
		|	ДД.Период КАК ПериодПоступления,
		|	ДД.Регистратор,
		|	ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход) КАК ВидДвижения,
		|	ДД.Организация,
		|	Прошлые.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
		|	ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка) КАК ВидЗапасов,
		|	ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаНоменклатуры.ПустаяСсылка) КАК КорАналитикаУчетаНоменклатуры,
		|	ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка) КАК КорВидЗапасов,
		|	Прошлые.Партия,
		|	Прошлые.АналитикаУчетаВнешнихПартий КАК АналитикаУчетаПартий,
        |	ДД.НалоговоеНазначение КАК НалоговоеНазначение,
		|	ДД.ДокументПоступления,
		|	ДД.АналитикаУчетаПартий КАК АналитикаУчетаДокументаПоступления,
		|	ЕСТЬNULL(ДД.АналитикаУчетаНоменклатуры.Назначение.НаправлениеДеятельности, ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка)) КАК НаправлениеДеятельности,
		|
		|	ДД.СтоимостьБезНДС,
		|	ДД.НДСРегл,
		|	0 КАК СтоимостьБезНДС,
		|	0 КАК НДСУпр,
		|
		|	НЕОПРЕДЕЛЕНО КАК ХозяйственнаяОперация,
        |	НЕОПРЕДЕЛЕНО КАК КорНалоговоеНазначение,
		|	НЕОПРЕДЕЛЕНО КАК КорОрганизация,
		|	НЕОПРЕДЕЛЕНО КАК КорПартия,
		|	НЕОПРЕДЕЛЕНО КАК КорАналитикаУчетаПартий,
		|	НЕОПРЕДЕЛЕНО КАК КорНаправлениеДеятельности,
		|	НЕОПРЕДЕЛЕНО КАК Подразделение,
        |	НЕОПРЕДЕЛЕНО КАК КорАналитикаФинансовогоУчета,
		|	НЕОПРЕДЕЛЕНО КАК СтатьяРасходовАктивов,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаРасходов,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаАктивов,
		|	НЕОПРЕДЕЛЕНО КАК ДокументИсточник,
		|	НЕОПРЕДЕЛЕНО КАК СтатьяСписанияНДС,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаСписанияНДС
		|ИЗ
		|	РегистрНакопления.ПартииТоваровОрганизаций КАК ДД
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ ПрошлыеРеализацииПартийНДС2_4 КАК Прошлые
		|		ПО ДД.Регистратор = Прошлые.ДокументИсточник
		|		И ДД.Организация = Прошлые.Организация
		|		И (ДД.ДокументПоступления = Прошлые.Партия
		|			ИЛИ Прошлые.Партия = НЕОПРЕДЕЛЕНО)
		|		И (ДД.АналитикаУчетаПартий = Прошлые.АналитикаУчетаПартий
		|			ИЛИ Прошлые.АналитикаУчетаПартий = ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка))
		|ГДЕ
		|	ДД.Организация В (&ОрганизацииСУчетомПартийНДСВерсии24)
		|	И ДД.Активность
		|	И Прошлые.Знаменатель <> 0
		|";
КонецФункции

Функция ТекстТаможенныеДекларацииИзменениеВидыДеятельностиНДС2_4()
	Возврат
		"ВЫБРАТЬ
		|	""ТекстТаможенныеДекларацииИзменениеВидыДеятельностиНДС2_4"" КАК ЗапросИсточник,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ВключениеИсключениеНДСВСтоимости) КАК ТипЗаписи,
		|	ЛОЖЬ КАК Сторно,
		|	0 КАК Приоритет,
		|	0 КАК Знаменатель,
		|	0 КАК ЗнаменательДляИсточников,
		|	ИСТИНА КАК РасчетЗавершен,
		|	НЕОПРЕДЕЛЕНО КАК Номенклатура,
		|	НЕОПРЕДЕЛЕНО КАК Характеристика,
		|	
		|	ДД.Период,
		|	ДД.Период КАК ПериодПоступления,
		|	ДД.Регистратор,
		|	ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход) КАК ВидДвижения,
		|	ДД.Организация,
		|	ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаНоменклатуры.ПустаяСсылка) КАК АналитикаУчетаНоменклатуры,
		|	ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка) КАК ВидЗапасов,
		|	ДД.АналитикаУчетаНоменклатуры КАК КорАналитикаУчетаНоменклатуры,
		|	ДД.ВидЗапасов КАК КорВидЗапасов,
		|	ДД.Партия,
		|	ДД.АналитикаУчетаПартий,
        |	ДД.КорНалоговоеНазначение КАК НалоговоеНазначение,
		|
		|	ДД.Регистратор КАК ДокументПоступления,
		|	ДД.КорАналитикаУчетаПартий КАК АналитикаУчетаДокументаПоступления,
		|	ЕСТЬNULL(ДД.АналитикаУчетаНоменклатуры.Назначение.НаправлениеДеятельности,
		|		ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка)) КАК НаправлениеДеятельности,
		|
		|	0 КАК СтоимостьБезНДС,
        |	ДД.НДСРеглРеквизит КАК НДС,
		|	0 КАК СтоимостьБезНДСУпр,
		|	(ВЫБОР
		|		КОГДА &УправленческийУчетОрганизаций ТОГДА ДД.НДСУпр
		|		ИНАЧЕ 0 КОНЕЦ) КАК НДСУпр,
		|
		|	ДД.ХозяйственнаяОперация,
        |	НЕОПРЕДЕЛЕНО КАК КорНалоговоеНазначение,
		|	ДД.Организация КАК КорОрганизация,
		|	ДД.Партия КАК КорПартия,
		|	ДД.АналитикаУчетаПартий КАК КорАналитикаУчетаПартий,
		|	ЕСТЬNULL(ДД.АналитикаУчетаНоменклатуры.Назначение.НаправлениеДеятельности, 
		|		ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка)) КАК КорНаправлениеДеятельности,
		|	НЕОПРЕДЕЛЕНО КАК Подразделение,
        |	НЕОПРЕДЕЛЕНО КАК КорАналитикаФинансовогоУчета,
		|	НЕОПРЕДЕЛЕНО КАК СтатьяРасходовАктивов,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаРасходов,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаАктивов,
		|	ДД.ДокументИсточник,
		|	НЕОПРЕДЕЛЕНО КАК СтатьяСписанияНДС,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаСписанияНДС
		|ИЗ
		|	ВТКэшРасчетныеОборотыСебестоимостьТоваров КАК ДД
		|ГДЕ
		|	ДД.Организация В (&ОрганизацииСУчетомПартийНДСВерсии24)
        |	И ДД.НалоговоеНазначение <> ДД.КорНалоговоеНазначение
        |	И ДД.КорНалоговоеНазначение <> ЗНАЧЕНИЕ(Справочник.НалоговыеНазначенияАктивовИЗатрат.ПустаяСсылка)
        |	И (ДД.НДСРеглРеквизит <> 0 ИЛИ ДД.НДСУпр <> 0)
		|	И ДД.ТипЗаписи В (
		|		ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыСПартией),
		|		ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыБезПартии))
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	""ТекстТаможенныеДекларацииИзменениеВидыДеятельностиНДС2_4"" КАК ЗапросИсточник,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ВключениеИсключениеНДСВСтоимости) КАК ТипЗаписи,
		|	ЛОЖЬ КАК Сторно,
		|	0 КАК Приоритет,
		|	0 КАК Знаменатель,
		|	0 КАК ЗнаменательДляИсточников,
		|	ИСТИНА КАК РасчетЗавершен,
		|	НЕОПРЕДЕЛЕНО КАК Номенклатура,
		|	НЕОПРЕДЕЛЕНО КАК Характеристика,
		|	
		|	ДД.Период,
		|	ДД.Период КАК ПериодПоступления,
		|	ДД.Регистратор,
		|	ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход) КАК ВидДвижения,
		|	ДД.Организация,
		|	ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаНоменклатуры.ПустаяСсылка) КАК АналитикаУчетаНоменклатуры,
		|	ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка) КАК ВидЗапасов,
		|	ДД.АналитикаУчетаНоменклатуры КАК КорАналитикаУчетаНоменклатуры,
		|	ДД.ВидЗапасов КАК КорВидЗапасов,
		|	ДД.Партия,
		|	ДД.АналитикаУчетаПартий,
        |	ДД.КорНалоговоеНазначение КАК НалоговоеНазначение,
		|
		|	ДД.Регистратор КАК ДокументПоступления,
		|	ДД.КорАналитикаУчетаПартий КАК АналитикаУчетаДокументаПоступления,
		|	ЕСТЬNULL(ДД.АналитикаУчетаНоменклатуры.Назначение.НаправлениеДеятельности,
		|		ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка)) КАК НаправлениеДеятельности,
		|
		|	0 КАК СтоимостьБезНДС,
        |	ДД.НДСРеглРеквизит КАК НДС,
		|	0 КАК СтоимостьБезНДСУпр,
		|	(ВЫБОР
		|		КОГДА &УправленческийУчетОрганизаций ТОГДА ДД.НДСУпр
		|		ИНАЧЕ 0 КОНЕЦ) КАК НДСУпр,
		|
		|	ДД.ХозяйственнаяОперация,
        |	ДД.НалоговоеНазначение КАК КорНалоговоеНазначение,
		|	ДД.Организация КАК КорОрганизация,
		|	ДД.Партия КАК КорПартия,
		|	ДД.АналитикаУчетаПартий КАК КорАналитикаУчетаПартий,
		|	ЕСТЬNULL(ДД.АналитикаУчетаНоменклатуры.Назначение.НаправлениеДеятельности, 
		|		ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка)) КАК КорНаправлениеДеятельности,
		|	НЕОПРЕДЕЛЕНО КАК Подразделение,
        |	НЕОПРЕДЕЛЕНО КАК КорАналитикаФинансовогоУчета,
		|	НЕОПРЕДЕЛЕНО КАК СтатьяРасходовАктивов,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаРасходов,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаАктивов,
		|	ДД.ДокументИсточник,
		|	НЕОПРЕДЕЛЕНО КАК СтатьяСписанияНДС,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаСписанияНДС
		|ИЗ
		|	ВТКэшРасчетныеОборотыСебестоимостьТоваров КАК ДД
		|ГДЕ
		|	ДД.Организация В (&ОрганизацииСУчетомПартийНДСВерсии24)
        |	И ДД.НалоговоеНазначение <> ДД.КорНалоговоеНазначение
        |	И ДД.КорНалоговоеНазначение <> ЗНАЧЕНИЕ(Справочник.НалоговыеНазначенияАктивовИЗатрат.ПустаяСсылка)
        |	И (ДД.НДСРеглРеквизит <> 0 ИЛИ ДД.НДСУпр <> 0)
		|	И ДД.ТипЗаписи В (
		|		ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыСПартией),
		|		ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыБезПартии))
		|";
КонецФункции

// Заполнение расчетной партии

Процедура ЗаполнитьРасчетнуюПартиюНДС2_4(ПараметрыРасчета, РасчетнаяПартия, Расход, Приход)
	
	Если Расход.ВидДвижения = ВидДвиженияНакопления.Расход
	 И ЗначениеЗаполнено(Приход.Номенклатура)
	 И (Приход.Номенклатура <> Расход.Номенклатура
		 ИЛИ Приход.Характеристика <> Расход.Характеристика) Тогда
		Возврат;
		
	// Для корректировки приобретения источником может быть только корректируемая партия.
	// Дополнительные расходы по товарам не могут списываться при такой корректировке.
	ИначеЕсли Расход.ТипЗаписи = Перечисления.ТипыЗаписейПартий.КорректировкаПриобретения
	 И Приход.ТипЗаписи = Перечисления.ТипыЗаписейПартий.ОстатокСгруппированный
	 И Приход.Партия <> Приход.ДокументПоступления Тогда
		Приход.Знаменатель = Приход.Знаменатель - Мин(Расход.Знаменатель, Приход.Знаменатель);
	 	Возврат;
	КонецЕсли;
	
	СуммовыеРесурсы = Новый Структура("СтоимостьБезНДС, НДС, СтоимостьБезНДСУпр, НДСУпр");
	
	// Заполняем расчетную партию по расходной партии-основании
	ЗаполнитьЗначенияСвойств(РасчетнаяПартия, Расход);
	
	// Заполняем партионную идентификацию в расчетной партии
	ЗаполнитьЗначенияСвойств(РасчетнаяПартия, Приход, "ДокументПоступления, АналитикаУчетаДокументаПоступления, Номенклатура, Характеристика");
	Если РасчетнаяПартия.ТипЗаписи <> Перечисления.ТипыЗаписейПартий.ВозвратПрошлыхПериодов Тогда
		РасчетнаяПартия.ДокументИсточник = Неопределено;
	КонецЕсли;
	Если Не ЗначениеЗаполнено(РасчетнаяПартия.Партия) Тогда
		РасчетнаяПартия.Партия = Приход.Партия;
		РасчетнаяПартия.АналитикаУчетаПартий = Приход.АналитикаУчетаПартий;
	КонецЕсли;
	
	Если Приход.Партия <> РасчетнаяПартия.Партия Тогда
		// Доп. расходы "обезличиваются"
		РасчетнаяПартия.Номенклатура   = Неопределено;
		РасчетнаяПартия.Характеристика = Неопределено;
	КонецЕсли;
	
	// Заменим старые аналитики учета партий на новые.
	Если ПараметрыРасчета.РаспределениеПартий.ДополнительныеСвойства.Свойство("АналитикиУчетаПартий") Тогда
		
		НоваяАналитикаУчетаПартий = ПараметрыРасчета.РаспределениеПартий.ДополнительныеСвойства.АналитикиУчетаПартий.Получить(РасчетнаяПартия.АналитикаУчетаДокументаПоступления);
		
		Если ЗначениеЗаполнено(НоваяАналитикаУчетаПартий) Тогда
			РасчетнаяПартия.АналитикаУчетаДокументаПоступления = НоваяАналитикаУчетаПартий;
		КонецЕсли;
		
		НоваяАналитикаУчетаПартий = ПараметрыРасчета.РаспределениеПартий.ДополнительныеСвойства.АналитикиУчетаПартий.Получить(РасчетнаяПартия.АналитикаУчетаПартий);
		
		Если ЗначениеЗаполнено(НоваяАналитикаУчетаПартий) Тогда
			РасчетнаяПартия.АналитикаУчетаПартий = НоваяАналитикаУчетаПартий;
		КонецЕсли;
		
	КонецЕсли;
	
	// Очистим не используемые в дальнейшем поля.
	Если РасчетнаяПартия.ВидДвижения = ВидДвиженияНакопления.Приход Тогда
		РасчетнаяПартия.КорАналитикаУчетаНоменклатуры = Неопределено;
		РасчетнаяПартия.КорВидЗапасов = Неопределено;
	КонецЕсли;
	
	// Расчетная партия заполняется на наибольшее общее вычитаемое
	ПриходБазис = 0;
	
	Если РасчетнаяПартия.ТипЗаписи = Перечисления.ТипыЗаписейПартий.БазаРегл
	 ИЛИ РасчетнаяПартия.ТипЗаписи = Перечисления.ТипыЗаписейПартий.БазаУпр Тогда
	 
		КоличествоСписания = Мин(Расход.Знаменатель, Приход.Знаменатель);
		ЗнаменательСписания = КоличествоСписания;
		ПриходБазис = ?(Приход.Знаменатель <> 0, КоличествоСписания / Приход.Знаменатель, 0);
		
		ЗаполнитьЗначенияСвойств(РасчетнаяПартия, Приход, "ХозяйственнаяОперация, АналитикаСписанияНДС, Подразделение");
        ЗаполнитьЗначенияСвойств(РасчетнаяПартия, Расход, "Партия, АналитикаУчетаПартий, НалоговоеНазначение, Период, Регистратор");
		
        РасчетнаяПартия.КорНалоговоеНазначение = Приход.НалоговоеНазначение;
		РасчетнаяПартия.ТипЗаписи = Перечисления.ТипыЗаписейПартий.ДопРасходы;
		
	ИначеЕсли ((РасчетнаяПартия.ТипЗаписи = Перечисления.ТипыЗаписейПартий.Перемещение
	 	  И ТипЗнч(РасчетнаяПартия.Регистратор) = Тип("ДокументСсылка.СборкаТоваров"))
	 ИЛИ РасчетнаяПартия.ТипЗаписи = Перечисления.ТипыЗаписейПартий.Выпуск
	 ИЛИ РасчетнаяПартия.ТипЗаписи = Перечисления.ТипыЗаписейПартий.СписанияНаВыпуск) Тогда
		КоличествоСписания = Мин(Расход.Знаменатель, Приход.Знаменатель);
		ЗнаменательСписания = КоличествоСписания;
		ПриходБазис = ?(Приход.Знаменатель <> 0, КоличествоСписания / Приход.Знаменатель, 0);
	Иначе
		
		Если Расход.ВидДвижения = ВидДвиженияНакопления.Приход И Расход.ЗнаменательДляИсточников <> 0 Тогда
			ИмяПоляЗнаменательРасхода = "ЗнаменательДляИсточников";
		Иначе
			ИмяПоляЗнаменательРасхода = "Знаменатель";
		КонецЕсли;
		
		Если Приход.Знаменатель <> 0 Тогда
			КоличествоСписания = Мин(Расход[ИмяПоляЗнаменательРасхода], Приход.Знаменатель);
			ЗнаменательСписания = КоличествоСписания;
			ПриходБазис = ?(Приход.Знаменатель <> 0, КоличествоСписания / Приход.Знаменатель, 0);
		КонецЕсли;
		
	КонецЕсли;
	
	Если ПриходБазис = 0 Тогда
		Возврат;
	КонецЕсли;
	
	// Заполняем показатели расчетной партии
	Для Каждого ИмяРесурса Из СуммовыеРесурсы Цикл
		РасчетнаяПартия[ИмяРесурса.Ключ] = Окр(ПриходБазис * Приход[ИмяРесурса.Ключ], 2);
	КонецЦикла;
	
	Если РасчетнаяПартия.ТипЗаписи = Перечисления.ТипыЗаписейПартий.ОстатокСгруппированный Тогда
		РасчетнаяПартия.Знаменатель = Приход.Знаменатель;
	ИначеЕсли Расход.ТипЗаписи = Перечисления.ТипыЗаписейПартий.БазаРегл
	 ИЛИ Расход.ТипЗаписи = Перечисления.ТипыЗаписейПартий.БазаУпр Тогда
		РасчетнаяПартия.Знаменатель = Расход.ЗнаменательДляИсточников;
	Иначе
		РасчетнаяПартия.Знаменатель = 0;
	КонецЕсли;
	
	// Корректируем базу расчета в приходе
	Если НЕ (Приход.ХозяйственнаяОперация = Перечисления.ХозяйственныеОперации.РеализацияКлиентуРеглУчет
		И Приход.ТипЗаписи = Перечисления.ТипыЗаписейПартий.Потребление)
	И НЕ (Приход.ХозяйственнаяОперация = Перечисления.ХозяйственныеОперации.РаспределениеРасходовНаПартииПроизводства
		И Приход.ТипЗаписи = Перечисления.ТипыЗаписейПартий.Распределение) Тогда
	 
	 	Если НЕ Приход.Сторно И РасчетнаяПартия.Сторно
		 И РасчетнаяПартия.ТипЗаписи = Перечисления.ТипыЗаписейПартий.Потребление Тогда
			Знак = -1;
		Иначе
			Знак = 1;
		КонецЕсли;
	 	
	    Приход.Знаменатель = Приход.Знаменатель - Знак * ЗнаменательСписания;
		
		Для Каждого ИмяРесурса Из СуммовыеРесурсы Цикл
			Приход[ИмяРесурса.Ключ] = Приход[ИмяРесурса.Ключ] - Знак * РасчетнаяПартия[ИмяРесурса.Ключ];
		КонецЦикла;
	 	
	КонецЕсли;
	
	ЗаполнитьСтатьюИАналитикуСписанияНДС(ПараметрыРасчета, РасчетнаяПартия, Расход, Приход);
	
	// По результатам партионной идентификации определяем завершенность расчета
	Если ТипЗнч(Приход.Регистратор) = Тип("ДокументСсылка.ВводОстатков")
		Или ТипЗнч(Приход.Регистратор) = Тип("ДокументСсылка.ВводОстатковТоваров") Тогда
		// Для документов ВводОстатков с реквизитом ВводОстатков22 = Ложь в таблице Данные
		// установлен признак РасчетЗавершен = Ложь для того, чтобы движения этого документа не записывались в ИБ,
		// т.к. они уже сформированы самим документом.
		РасчетнаяПартия.РасчетЗавершен = Истина;
	ИначеЕсли РасчетнаяПартия.СтоимостьБезНДС = 0
	 И РасчетнаяПартия.НДС = 0
	 И РасчетнаяПартия.СтоимостьБезНДСУпр = 0
	 И РасчетнаяПартия.НДСУпр = 0 Тогда
		// Сформирована пустая расчетная запись. Такая запись не нужна в результатах расчета.
		РасчетнаяПартия.РасчетЗавершен = Ложь;
	Иначе
		РасчетнаяПартия.РасчетЗавершен = Приход.РасчетЗавершен;
	КонецЕсли;
	
КонецПроцедуры

Процедура ЗаполнитьРасчетнуюПартиюПрочихРасходовНДС2_4(ПараметрыРасчета, РасчетнаяПартия, Расход, Приход)
	
	Если Расход.ВидДвижения = ВидДвиженияНакопления.Расход
	 И ЗначениеЗаполнено(Приход.Номенклатура)
	 И (Приход.Номенклатура <> Расход.Номенклатура
		 ИЛИ Приход.Характеристика <> Расход.Характеристика) Тогда
		Возврат;
		
	// Для корректировки приобретения источником может быть только корректируемая партия.
	// Дополнительные расходы по товарам не могут списываться при такой корректировке.
	ИначеЕсли Расход.ТипЗаписи = Перечисления.ТипыЗаписейПартий.КорректировкаПриобретения
	 И Приход.ТипЗаписи = Перечисления.ТипыЗаписейПартий.ОстатокСгруппированный
	 И Приход.Партия <> Приход.ДокументПоступления Тогда
		Приход.Знаменатель = Приход.Знаменатель - Мин(Расход.Знаменатель, Приход.Знаменатель);
	 	Возврат;
	КонецЕсли;
	
	СуммовыеРесурсы = Новый Структура("СтоимостьБезНДС, НДС, СтоимостьБезНДСУпр, НДСУпр");
	
	// Заполняем расчетную партию по расходной партии-основании
	ЗаполнитьЗначенияСвойств(РасчетнаяПартия, Расход);
	
	// Заполняем партионную идентификацию в расчетной партии
	ЗаполнитьЗначенияСвойств(РасчетнаяПартия, Приход,
        "ДокументПоступления, АналитикаУчетаДокументаПоступления, СтатьяРасходовАктивов, АналитикаРасходов,
		|СтатьяКалькуляции, ГруппаПродукции, ПравилоОтнесенияНаВыпуск");
		
	Если Расход.ТипЗаписи = Перечисления.ТипыЗаписейПартий.Потребление Тогда
		ЗаполнитьЗначенияСвойств(РасчетнаяПартия, Расход, "СтатьяРасходовАктивов, АналитикаРасходов");			
	КонецЕсли;	
	
	
	Если Расход.ТипЗаписи = Перечисления.ТипыЗаписейПартий.БазаРегл
	 ИЛИ Расход.ТипЗаписи = Перечисления.ТипыЗаписейПартий.БазаУпр Тогда
		ЗаполнитьЗначенияСвойств(РасчетнаяПартия, Расход, "СтатьяКалькуляции, ГруппаПродукции, ПравилоОтнесенияНаВыпуск");
	КонецЕсли;
    
	Если РасчетнаяПартия.ТипЗаписи <> Перечисления.ТипыЗаписейПартий.ВозвратПрошлыхПериодов Тогда
		РасчетнаяПартия.ДокументИсточник = Неопределено;
	КонецЕсли;
	Если Не ЗначениеЗаполнено(РасчетнаяПартия.Партия) Тогда
		РасчетнаяПартия.Партия = Приход.Партия;
		РасчетнаяПартия.АналитикаУчетаПартий = Приход.АналитикаУчетаПартий;
	КонецЕсли;
	
	Если Приход.Партия <> РасчетнаяПартия.Партия Тогда
		// Доп. расходы "обезличиваются"
		РасчетнаяПартия.Номенклатура   = Неопределено;
		РасчетнаяПартия.Характеристика = Неопределено;
	КонецЕсли;
	
	// Заменим старые аналитики учета партий на новые.
	Если ПараметрыРасчета.РаспределениеПартий.ДополнительныеСвойства.Свойство("АналитикиУчетаПартий") Тогда
		
		НоваяАналитикаУчетаПартий = ПараметрыРасчета.РаспределениеПартий.ДополнительныеСвойства.АналитикиУчетаПартий.Получить(РасчетнаяПартия.АналитикаУчетаДокументаПоступления);
		
		Если ЗначениеЗаполнено(НоваяАналитикаУчетаПартий) Тогда
			РасчетнаяПартия.АналитикаУчетаДокументаПоступления = НоваяАналитикаУчетаПартий;
		КонецЕсли;
		
		НоваяАналитикаУчетаПартий = ПараметрыРасчета.РаспределениеПартий.ДополнительныеСвойства.АналитикиУчетаПартий.Получить(РасчетнаяПартия.АналитикаУчетаПартий);
		
		Если ЗначениеЗаполнено(НоваяАналитикаУчетаПартий) Тогда
			РасчетнаяПартия.АналитикаУчетаПартий = НоваяАналитикаУчетаПартий;
		КонецЕсли;
		
	КонецЕсли;
	
	// Очистим не используемые в дальнейшем поля.
	Если РасчетнаяПартия.ВидДвижения = ВидДвиженияНакопления.Приход Тогда
		РасчетнаяПартия.КорАналитикаУчетаНоменклатуры = Неопределено;
		РасчетнаяПартия.КорВидЗапасов = Неопределено;
	КонецЕсли;
	
	// Расчетная партия заполняется на наибольшее общее вычитаемое
	ПриходБазис = 0;
	
	Если РасчетнаяПартия.ТипЗаписи = Перечисления.ТипыЗаписейПартий.БазаРегл
	 ИЛИ РасчетнаяПартия.ТипЗаписи = Перечисления.ТипыЗаписейПартий.БазаУпр Тогда
	 
		КоличествоСписания = Мин(Расход.Знаменатель, Приход.Знаменатель);
		ЗнаменательСписания = КоличествоСписания;
		ПриходБазис = ?(Приход.Знаменатель <> 0, КоличествоСписания / Приход.Знаменатель, 0);
		
		ЗаполнитьЗначенияСвойств(РасчетнаяПартия, Приход, "ХозяйственнаяОперация, АналитикаСписанияНДС, Подразделение");
		
        ЗаполнитьЗначенияСвойств(РасчетнаяПартия, Расход, "Партия, АналитикаУчетаПартий, НалоговоеНазначение, Период, Регистратор");
		
        РасчетнаяПартия.КорНалоговоеНазначение = Приход.НалоговоеНазначение;
		РасчетнаяПартия.ТипЗаписи = Перечисления.ТипыЗаписейПартий.ДопРасходы;
		
	ИначеЕсли (
				(РасчетнаяПартия.ТипЗаписи = Перечисления.ТипыЗаписейПартий.Перемещение
	 	  			И (ТипЗнч(РасчетнаяПартия.Регистратор) = Тип("ДокументСсылка.СборкаТоваров")
					ИЛИ ТипЗнч(РасчетнаяПартия.Регистратор) = Тип("ДокументСсылка.ВыпускПродукции")
					)
			    )
	 ИЛИ РасчетнаяПартия.ТипЗаписи = Перечисления.ТипыЗаписейПартий.Выпуск
	 ИЛИ РасчетнаяПартия.ТипЗаписи = Перечисления.ТипыЗаписейПартий.СписанияНаВыпуск) Тогда
		КоличествоСписания = Мин(Расход.Знаменатель, Приход.Знаменатель);
		ЗнаменательСписания = КоличествоСписания;
		ПриходБазис = ?(Приход.Знаменатель <> 0, КоличествоСписания / Приход.Знаменатель, 0);
	Иначе
		
		Если Расход.ВидДвижения = ВидДвиженияНакопления.Приход И Расход.ЗнаменательДляИсточников <> 0 Тогда
			ИмяПоляЗнаменательРасхода = "ЗнаменательДляИсточников";
		Иначе
			ИмяПоляЗнаменательРасхода = "Знаменатель";
		КонецЕсли;
		
		Если Приход.Знаменатель <> 0 Тогда
			КоличествоСписания = Мин(Расход[ИмяПоляЗнаменательРасхода], Приход.Знаменатель);
			ЗнаменательСписания = КоличествоСписания;
			ПриходБазис = ?(Приход.Знаменатель <> 0, КоличествоСписания / Приход.Знаменатель, 0);
		КонецЕсли;
		
	КонецЕсли;
	
	Если ПриходБазис = 0 Тогда
		Возврат;
	КонецЕсли;
	
	// Заполняем показатели расчетной партии
	Для Каждого ИмяРесурса Из СуммовыеРесурсы Цикл
		РасчетнаяПартия[ИмяРесурса.Ключ] = Окр(ПриходБазис * Приход[ИмяРесурса.Ключ], 2);
	КонецЦикла;
	
	Если РасчетнаяПартия.ТипЗаписи = Перечисления.ТипыЗаписейПартий.ОстатокСгруппированный Тогда
		РасчетнаяПартия.Знаменатель = Приход.Знаменатель;
	ИначеЕсли Расход.ТипЗаписи = Перечисления.ТипыЗаписейПартий.БазаРегл
	 ИЛИ Расход.ТипЗаписи = Перечисления.ТипыЗаписейПартий.БазаУпр Тогда
		РасчетнаяПартия.Знаменатель = Расход.ЗнаменательДляИсточников;
	Иначе
		РасчетнаяПартия.Знаменатель = 0;
	КонецЕсли;
	
	// Корректируем базу расчета в приходе
	Если НЕ (Приход.ХозяйственнаяОперация = Перечисления.ХозяйственныеОперации.РеализацияКлиентуРеглУчет
		И Приход.ТипЗаписи = Перечисления.ТипыЗаписейПартий.Потребление)
	И НЕ (Приход.ХозяйственнаяОперация = Перечисления.ХозяйственныеОперации.РаспределениеРасходовНаПартииПроизводства
		И Приход.ТипЗаписи = Перечисления.ТипыЗаписейПартий.Распределение) Тогда
	 
	 	Если НЕ Приход.Сторно И РасчетнаяПартия.Сторно
		 И РасчетнаяПартия.ТипЗаписи = Перечисления.ТипыЗаписейПартий.Потребление Тогда
			Знак = -1;
		Иначе
			Знак = 1;
		КонецЕсли;
	 	
	    Приход.Знаменатель = Приход.Знаменатель - Знак * ЗнаменательСписания;
		
		Для Каждого ИмяРесурса Из СуммовыеРесурсы Цикл
			Приход[ИмяРесурса.Ключ] = Приход[ИмяРесурса.Ключ] - Знак * РасчетнаяПартия[ИмяРесурса.Ключ];
		КонецЦикла;
	 	
	КонецЕсли;
	
	ЗаполнитьСтатьюИАналитикуСписанияНДС(ПараметрыРасчета, РасчетнаяПартия, Расход, Приход);
	
	// По результатам партионной идентификации определяем завершенность расчета
	Если ТипЗнч(Приход.Регистратор) = Тип("ДокументСсылка.ВводОстатков")
		Или ТипЗнч(Приход.Регистратор) = Тип("ДокументСсылка.ВводОстатковТоваров") Тогда
		// Для документов ВводОстатков с реквизитом ВводОстатков22 = Ложь в таблице Данные
		// установлен признак РасчетЗавершен = Ложь для того, чтобы движения этого документа не записывались в ИБ,
		// т.к. они уже сформированы самим документом.
		РасчетнаяПартия.РасчетЗавершен = Истина;
	ИначеЕсли РасчетнаяПартия.СтоимостьБезНДС = 0
	 И РасчетнаяПартия.НДС = 0
	 И РасчетнаяПартия.СтоимостьБезНДСУпр = 0
	 И РасчетнаяПартия.НДСУпр = 0 Тогда
		// Сформирована пустая расчетная запись. Такая запись не нужна в результатах расчета.
		РасчетнаяПартия.РасчетЗавершен = Ложь;
	Иначе
		РасчетнаяПартия.РасчетЗавершен = Приход.РасчетЗавершен;
	КонецЕсли;
	
КонецПроцедуры


#КонецОбласти

//++ НЕ УТ

#Область ПроцедурыЭтапа_РасчетПартийНДС2_4ПоПартиямПрочихРасходов

// Инициализация данных

Функция ОписаниеЦепочекПартийНДС2_4ПоПартиямПрочихРасходов(ПараметрыРасчета)
	
	ОписаниеЦепочек = Новый Соответствие;
	
	ПоляСвязи = "Организация, СтатьяРасходовАктивов, АналитикаРасходов";
	
	#Область БазаРегл
	
	Источники = Новый Соответствие;
	Источники.Вставить(Перечисления.ТипыЗаписейПартий.ДопРасходыРегл);
	
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеПриемника(
		ОписаниеЦепочек,
		Перечисления.ТипыЗаписейПартий.БазаРегл,
		ПоляСвязи,
		Источники);
	
	#КонецОбласти
	
	#Область БазаУпр
	
	Источники = Новый Соответствие;
	Источники.Вставить(Перечисления.ТипыЗаписейПартий.ДопРасходыУпр);
	
	РасчетСебестоимостиПрикладныеАлгоритмы.ДобавитьОписаниеПриемника(
		ОписаниеЦепочек,
		Перечисления.ТипыЗаписейПартий.БазаУпр,
		ПоляСвязи,
		Источники);
	
	#КонецОбласти
	
	ОписаниеЦепочекПартийНДС2_4(ПараметрыРасчета, ОписаниеЦепочек);
	
	Возврат ОписаниеЦепочек;
	
КонецФункции

Функция ОписаниеДвиженийПартийНДС2_4ПоПартиямПрочихРасходов(ПараметрыРасчета)
	
	КолонкиТаблицыРаспределения = ТаблицаДляРаспределенияПартийНДС2_4(ПараметрыРасчета).Колонки;
	
	ОписаниеДвижений = РасчетСебестоимостиПрикладныеАлгоритмы.ОписаниеДвижений();
    ОписаниеДвижений.Вставить("Контекст", "ПодготовкаДанныхДляУчетаНДС2_4ПоПартиямПрочихРасходов");
	ОписаниеДвижений.Вставить("ИмяВременнойТаблицы", "ВТСписаниеПостатейныхЗатрат");
	ОписаниеДвижений.Вставить("ПоляРасчета", РасчетСебестоимостиПрикладныеАлгоритмы.ПереченьПолей(КолонкиТаблицыРаспределения));
	ОписаниеДвижений.Вставить("КлючиСравнения",	ПоляПотребленийПартииНДС2_4(ПараметрыРасчета));
	ОписаниеДвижений.Вставить("Показатели", "Знаменатель, СтоимостьБезНДС, НДС, СтоимостьБезНДСУпр, НДСУпр");
	ОписаниеДвижений.Вставить("БазисПрихода", "Знаменатель");
	ОписаниеДвижений.Вставить("БазисРасхода", "Знаменатель");
	ОписаниеДвижений.Вставить("КлючРасхода", "ДокументИсточник");
	ОписаниеДвижений.Вставить("ПолеПорядка", "ПериодПоступления");
	ОписаниеДвижений.Вставить("ПоляСортировки", "Партия");
	ОписаниеДвижений.Вставить("СортировкаПоУсловию", Истина);
	
	ОписаниеДвижений.Вставить("ПоляСуммирования", "СтоимостьБезНДС, НДС, СтоимостьБезНДСУпр, НДСУпр");
	ОписаниеДвижений.Вставить("ПоляГруппировки",  
		РасчетСебестоимостиПрикладныеАлгоритмы.ПереченьПолей(КолонкиТаблицыРаспределения, ОписаниеДвижений.ПоляСуммирования));
	ОписаниеДвижений.Вставить("УменьшатьБазис", Истина);
	ОписаниеДвижений.Вставить("УдалятьСтрокиБезИсточников", Истина);
	
	Возврат ОписаниеДвижений;
	
КонецФункции

Функция ОписаниеНезаписываемыхПартийНДС2_4ПоПартиямПрочихРасходов(ПараметрыРасчета, НезаписываемыеТипыЗаписей = Неопределено)
	
	Если НезаписываемыеТипыЗаписей = Неопределено Тогда
		НезаписываемыеТипыЗаписей = Новый Соответствие;
	КонецЕсли;
	
	НезаписываемыеТипыЗаписей.Вставить(Перечисления.ТипыЗаписейПартий.БазаРегл, 	  Истина);
	НезаписываемыеТипыЗаписей.Вставить(Перечисления.ТипыЗаписейПартий.БазаУпр, 		  Истина);
	НезаписываемыеТипыЗаписей.Вставить(Перечисления.ТипыЗаписейПартий.ДопРасходыРегл, Истина);
	НезаписываемыеТипыЗаписей.Вставить(Перечисления.ТипыЗаписейПартий.ДопРасходыУпр,  Истина);
	
	ОписаниеНезаписываемыхПартийНДС2_4(ПараметрыРасчета, НезаписываемыеТипыЗаписей);
	
	Возврат РасчетСебестоимостиПрикладныеАлгоритмы.ОписаниеНезаписываемыхДанных(Ложь, НезаписываемыеТипыЗаписей);
	
КонецФункции

Функция ТаблицаДляРаспределенияПартийПрочихРасходовНДС2_4(ПараметрыРасчета)
	
    Возврат РасчетСебестоимостиПрикладныеАлгоритмы.ТаблицаДляРаспределенияПартий(ПараметрыРасчета,	ТекстОписаниеДанныхДляПартийПрочихРасходовНДС2_4());
	
КонецФункции

// Выборка данных

Процедура ПолучитьДанныеДляПартийНДС2_4ПоПартиямПрочихРасходов(ПараметрыРасчета)
	
	ДопПараметры = Новый Структура;
	ДопПараметры.Вставить("РасчетПоПартиямПрочихРасходов", Истина);
	
	ПараметрыНумерации = РасчетСебестоимостиПрикладныеАлгоритмы.СформироватьПараметрыНумерацииСтрокВременнойТаблицы(
		"ДокументПоступления", // разделитель
		"Знаменатель, СтоимостьБезНДС, НДС, СтоимостьБезНДСУпр, НДСУпр", // ресурсы
		"Период, Приоритет ВОЗР, Организация, Партия, АналитикаУчетаПартий, Регистратор"); // порядок
	
	РасчетСебестоимостиПрикладныеАлгоритмы.ПолучитьДанныеЭтапаРасчета(
		ПараметрыРасчета,
		ТекстЗапросаДляПартийНДС2_4ПоПартиямПрочихРасходов(ПараметрыРасчета),
		ПараметрыНумерации,
		ДопПараметры);
		
	Если ПараметрыРасчета.РежимОтладки Тогда	
		ВТКэшРасчетныеОборотыПартииПрочихРасходов = ОбщегоНазначенияУТ.ПоказатьВременнуюТаблицу(ПараметрыРасчета.МенеджерВременныхТаблиц, "ВТКэшРасчетныеОборотыПартииПрочихРасходов");
		ДолиПроизводственныхРасходов              = ОбщегоНазначенияУТ.ПоказатьВременнуюТаблицу(ПараметрыРасчета.МенеджерВременныхТаблиц, "ДолиПроизводственныхРасходов");
		ВТБазаРаспределенияПрочиеРасходыНЗП2_4    = ОбщегоНазначенияУТ.ПоказатьВременнуюТаблицу(ПараметрыРасчета.МенеджерВременныхТаблиц, "ВТБазаРаспределенияПрочиеРасходыНЗП2_4");
		втПрочиеРасходыНезавершенногоПроизводства = ОбщегоНазначенияУТ.ПоказатьВременнуюТаблицу(ПараметрыРасчета.МенеджерВременныхТаблиц, "втПрочиеРасходыНезавершенногоПроизводства");
		ВТПартииПрочихДляРаспределения2_4         = ОбщегоНазначенияУТ.ПоказатьВременнуюТаблицу(ПараметрыРасчета.МенеджерВременныхТаблиц, "ВТПартииПрочихДляРаспределения2_4");
		ВТНачальныеОстаткиПартийНДС               = ОбщегоНазначенияУТ.ПоказатьВременнуюТаблицу(ПараметрыРасчета.МенеджерВременныхТаблиц, "ВТНачальныеОстаткиПартийНДС");
		ПриходыТоваровНДС2_4                      = ОбщегоНазначенияУТ.ПоказатьВременнуюТаблицу(ПараметрыРасчета.МенеджерВременныхТаблиц, "ПриходыТоваровНДС2_4");
		ДвиженияСебестоимостиНДС2_4               = ОбщегоНазначенияУТ.ПоказатьВременнуюТаблицу(ПараметрыРасчета.МенеджерВременныхТаблиц, "ДвиженияСебестоимостиНДС2_4");
		Данные                                    = ОбщегоНазначенияУТ.ПоказатьВременнуюТаблицу(ПараметрыРасчета.МенеджерВременныхТаблиц, "Данные");
	КонецЕсли;
КонецПроцедуры

// Тексты запросов

// ... общий

Функция ТекстЗапросаДляПартийНДС2_4ПоПартиямПрочихРасходов(ПараметрыРасчета = Неопределено) Экспорт
	
	ТекстЗапроса = ""
		// подготовка временных таблиц
		+ ТекстИнициализацияПартийНДС2_4ПоПартиямПрочихРасходов()
		+ ОбщегоНазначенияУТ.РазделительЗапросовВПакете()
		// выборка данных
        + ТекстОписаниеДанныхДляПартийПрочихРасходовНДС2_4() //вт Данные
		+ ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстПартииПрочихРасходовДляРаспределенияПоНЗПРегл()
		+ ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстБазаНЗПДляРаспределенияПартииПрочихРасходовРегл()
		+ ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстПартииПрочихРасходовДляРаспределенияПоНЗПУпр()
		+ ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстБазаНЗПДляРаспределенияПартииПрочихРасходовУпр()
		+ ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстСписаниеНаВыпускПостатейныеРасходы()
        + ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстНачальныеОстаткиПартийПрочиеРасходыНДС2_4()
        + ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстПриходыСебестоимостиТоваровПрочиеРасходы2_4()
        + ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстДвиженияСебестоимостиТоваровПрочиеРасходы2_4()
		+ "";
		
	Возврат ТекстЗапроса;
	
КонецФункции

// ... описания данных

// ... формирования временные таблиц

Функция ТекстИнициализацияПартийНДС2_4ПоПартиямПрочихРасходов()
	Возврат
		"ВЫБРАТЬ
		|	Т.Регистратор КАК Регистратор,  
		|	Т.КодСтроки КАК КодСтроки,
		|	СУММА(Т.Знаменатель) КАК Знаменатель
		|ПОМЕСТИТЬ ЗнаменателиРегистраторов
		|ИЗ
		|	ЗнаменателиПриходовКодСтроки КАК Т
		|ГДЕ
		|	Т.ЗнаменательДляИсточников <> 0
		|
		|СГРУППИРОВАТЬ ПО
		|	Т.КодСтроки,
		|	Т.Регистратор
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	Т.Партия КАК Партия,
		|	Т.КодСтроки КАК КодСтроки,
		|	СУММА(Т.Знаменатель) КАК Знаменатель
		|ПОМЕСТИТЬ ЗнаменателиПартий
		|ИЗ
		|	ЗнаменателиПриходовКодСтроки КАК Т
		|ГДЕ
		|	Т.ЗнаменательДляИсточников <> 0
		|
		|СГРУППИРОВАТЬ ПО
		|	Т.КодСтроки,
		|	Т.Партия
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	Т.Ссылка,
		|	ВЫБОР КОГДА Т.ВариантРаспределенияРасходовУпр = ЗНАЧЕНИЕ(Перечисление.ВариантыРаспределенияРасходов.НаПроизводственныеЗатраты)
		|		ТОГДА 1
		|		ИНАЧЕ 0
		|	КОНЕЦ КАК КоэффициентУпр,
		|	ВЫБОР КОГДА Т.ВариантРаспределенияРасходовРегл = ЗНАЧЕНИЕ(Перечисление.ВариантыРаспределенияРасходов.НаПроизводственныеЗатраты)
		|		ТОГДА 1
		|		ИНАЧЕ 0
		|	КОНЕЦ КАК КоэффициентРегл
		|ПОМЕСТИТЬ ВТСтатьиПроизводственныхЗатрат
		|ИЗ
		|	ПланВидовХарактеристик.СтатьиРасходов КАК Т
		|ГДЕ
		|	(Т.ВариантРаспределенияРасходовУпр = ЗНАЧЕНИЕ(Перечисление.ВариантыРаспределенияРасходов.НаПроизводственныеЗатраты)
		|		ИЛИ Т.ВариантРаспределенияРасходовРегл = ЗНАЧЕНИЕ(Перечисление.ВариантыРаспределенияРасходов.НаПроизводственныеЗатраты))
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	Т.Регистратор КАК Регистратор,
		|	Т.Период КАК Период,
		|	Т.Организация КАК Организация,
		|	Т.Подразделение КАК Подразделение,
		|	Т.СтатьяРасходов КАК СтатьяРасходов,
		|	Т.АналитикаРасходов КАК АналитикаРасходов,
		|	Т.ДокументПоступленияРасходов КАК ДокументПоступления,
		|	Т.АналитикаУчетаПартий КАК АналитикаУчетаДокументаПоступления,
        |	Т.НалоговоеНазначение КАК НалоговоеНазначение,
		|	Т.НаправлениеДеятельности КАК НаправлениеДеятельности,
		|	Т.ХозяйственнаяОперация КАК ХозяйственнаяОперация,
		|	СУММА(Т.СтоимостьРегл * Статьи.КоэффициентРегл) КАК СтоимостьБезНДС,
		|	СУММА(Т.НДСРегл * Статьи.КоэффициентРегл) КАК НДС,
		|	0 КАК СтоимостьБезНДСУпр,
		|	СУММА(Т.НДСУпр * Статьи.КоэффициентУпр) КАК НДСУпр
		|ПОМЕСТИТЬ ВТПартииПрочихДляРаспределения2_4
		|ИЗ
		|	ВТКэшРасчетныеОборотыПартииПрочихРасходов КАК Т
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТСтатьиПроизводственныхЗатрат КАК Статьи
		|		ПО Т.СтатьяРасходов = Статьи.Ссылка
		|ГДЕ
		|	Т.Организация В(&ОрганизацииСРаздельнымУчетомПостатейныхЗатрат)
		|	И Т.СлужебноеВидДвиженияПриход
        |	И Т.НалоговоеНазначение <> ЗНАЧЕНИЕ(Справочник.НалоговыеНазначенияАктивовИЗатрат.ПустаяСсылка)
		|
		|СГРУППИРОВАТЬ ПО
		|	Т.Регистратор,
		|	Т.Период,
		|	Т.Организация,
		|	Т.Подразделение,
		|	Т.СтатьяРасходов,
		|	Т.АналитикаРасходов,
        |	Т.НалоговоеНазначение,
		|	Т.ДокументПоступленияРасходов,
		|	Т.АналитикаУчетаПартий,
		|	Т.НаправлениеДеятельности,
		|	Т.ХозяйственнаяОперация
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	НЕОПРЕДЕЛЕНО КАК Регистратор,
		|	&НачалоПериода КАК Период,
		|	Т.Организация КАК Организация,
		|	Т.Подразделение КАК Подразделение,
		|	Т.СтатьяРасходов КАК СтатьяРасходов,
		|	Т.АналитикаРасходов КАК АналитикаРасходов,
		|	Т.ДокументПоступленияРасходов КАК ДокументПоступления,
		|	Т.АналитикаУчетаПартий КАК АналитикаУчетаДокументаПоступления,
        |	Т.НалоговоеНазначение КАК НалоговоеНазначение,
		|	Т.НаправлениеДеятельности КАК НаправлениеДеятельности,
		|	НЕОПРЕДЕЛЕНО КАК ХозяйственнаяОперация,
		|	СУММА(Т.СтоимостьРеглОстаток * Статьи.КоэффициентРегл) КАК СтоимостьБезНДС,
		|	СУММА(Т.НДСРеглОстаток * Статьи.КоэффициентРегл) КАК НДС,
		|	0 КАК СтоимостьБезНДСУпр,
		|	СУММА(Т.НДСУпрОстаток * Статьи.КоэффициентУпр) КАК НДСУпр
		|ИЗ
		|	РегистрНакопления.ПартииПрочихРасходов.Остатки(&ГраницаКонецПредыдущегоПериода,
		|		Организация В(&ОрганизацииСРаздельнымУчетомПостатейныхЗатрат)
		|	) КАК Т
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТСтатьиПроизводственныхЗатрат КАК Статьи
		|		ПО Т.СтатьяРасходов = Статьи.Ссылка
		|
		|СГРУППИРОВАТЬ ПО
		|	Т.Организация,
		|	Т.Подразделение,
		|	Т.СтатьяРасходов,
		|	Т.АналитикаРасходов,
        |	Т.НалоговоеНазначение,
		|	Т.ДокументПоступленияРасходов,
		|	Т.АналитикаУчетаПартий,
		|	Т.НаправлениеДеятельности
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ ПЕРВЫЕ 1
		|	ИСТИНА КАК ЕстьЗаписи
		|ПОМЕСТИТЬ ВыполнятьРаспределениеПартийНДС2_4
		|ИЗ
		|	ВТПартииПрочихДляРаспределения2_4 КАК Т
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	Т.Организация КАК Организация,
		|	Т.СтатьяРасходов КАК СтатьяРасходов,
		|	Т.АналитикаРасходов КАК АналитикаРасходов
		|ПОМЕСТИТЬ ВТАналитикиРаспределенияПартийПрочих2_4
		|ИЗ
		|	ВТПартииПрочихДляРаспределения2_4 КАК Т
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	Т.Организация 						КАК Организация,
		|	Т.Период 							КАК Период,
		|	Т.Регистратор 						КАК Регистратор,
		//++ Устарело_Производство21  
		|	ВЫБОР 
		|		КОГДА Т.ПартияПроизводства = НЕОПРЕДЕЛЕНО ИЛИ Т.ПартияПроизводства = ЗНАЧЕНИЕ(Справочник.ПартииПроизводства.ПустаяСсылка)
		|			ТОГДА 
		|				ВЫБОР
		|					КОГДА Т.ЗаказНаПроизводство = НЕОПРЕДЕЛЕНО
		|                   	ТОГДА Т.ПартияПроизводства
		|					КОГДА Т.ЗаказНаПроизводство ССЫЛКА Документ.ВыпускПродукции И Т.ЗаказНаПроизводство <> ЗНАЧЕНИЕ(Документ.ВыпускПродукции.ПустаяСсылка)
		|                   	ТОГДА Т.ЗаказНаПроизводство
		|		    		ИНАЧЕ Т.ПартияПроизводства
		|				КОНЕЦ
		|       ИНАЧЕ 
		//-- Устарело_Производство21  
		|			Т.ПартияПроизводства
		//++ Устарело_Производство21  
		|	КОНЕЦ 
		//-- Устарело_Производство21  
		|		КАК Партия,       
		//++ Устарело_Производство21  
		|	ВЫБОР 
		|		КОГДА Т.ПартияПроизводства = НЕОПРЕДЕЛЕНО ИЛИ Т.ПартияПроизводства = ЗНАЧЕНИЕ(Справочник.ПартииПроизводства.ПустаяСсылка)
		|			ТОГДА 
		|				ВЫБОР
		|					КОГДА Т.ЗаказНаПроизводство = НЕОПРЕДЕЛЕНО
		|                   	ТОГДА 0
		|					КОГДА Т.ЗаказНаПроизводство ССЫЛКА Документ.ВыпускПродукции И Т.ЗаказНаПроизводство <> ЗНАЧЕНИЕ(Документ.ВыпускПродукции.ПустаяСсылка)
		|                   	ТОГДА Т.КодСтрокиПродукция
		|		    		ИНАЧЕ 0
		|				КОНЕЦ
		|       ИНАЧЕ 
		|			0
		|	КОНЕЦ КАК КодСтрокиПродукция,
		//-- Устарело_Производство21  
        |	ВЫБОР КОГДА НЕ Т.ПартияПроизводства.НалоговоеНазначение ЕСТЬ NULL
        |			ТОГДА Т.ПартияПроизводства.НалоговоеНазначение
        |		КОГДА Т.ЗаказНаПроизводство ССЫЛКА Документ.ВыпускПродукции
        |			ТОГДА ВЫРАЗИТЬ(Т.ЗаказНаПроизводство КАК Документ.ВыпускПродукции).НалоговоеНазначение
        |		ИНАЧЕ ЗНАЧЕНИЕ(Справочник.НалоговыеНазначенияАктивовИЗатрат.ПустаяСсылка)
        |	КОНЕЦ 								КАК НалоговоеНазначение,
		|	Т.НаправлениеДеятельности 			КАК НаправлениеДеятельности,
		|	Т.Подразделение 					КАК Подразделение,
		|	Т.КорПодразделение 					КАК КорПодразделение,
		|	Т.СтатьяРасходов 					КАК СтатьяРасходов,
		|	Т.АналитикаРасходов 				КАК АналитикаРасходов,
        |	Т.СтатьяКалькуляции					КАК СтатьяКалькуляции,
        |	Т.ГруппаПродукции 					КАК ГруппаПродукции,
        |	Т.ПравилоОтнесенияНаВыпуск			КАК ПравилоОтнесенияНаВыпуск,
		|	СУММА(Т.ДоляСтоимостиРегл)			КАК ПоказательОтнесенияНаПартиюРегл,
		|	СУММА(Т.ДоляСтоимостиУпр)			КАК ПоказательОтнесенияНаПартиюУпр
		|ПОМЕСТИТЬ ВТБазаРаспределенияПрочиеРасходыНЗП2_4
		|ИЗ
		|	ДолиПроизводственныхРасходов КАК Т
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТАналитикиРаспределенияПартийПрочих2_4 КАК АналитикиРаспределения
		|		ПО Т.Организация = АналитикиРаспределения.Организация
		|			И Т.СтатьяРасходов = АналитикиРаспределения.СтатьяРасходов
		|			И Т.АналитикаРасходов = АналитикиРаспределения.АналитикаРасходов
		|ГДЕ
		|	Т.Организация В(&ОрганизацииСРаздельнымУчетомПостатейныхЗатрат)
		|	И (
		|		(Т.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|		И ВЫБОР КОГДА НЕ Т.ПартияПроизводства.НалоговоеНазначение ЕСТЬ NULL
		|				ТОГДА Т.ПартияПроизводства.НалоговоеНазначение
		|			КОГДА Т.ЗаказНаПроизводство ССЫЛКА Документ.ВыпускПродукции
		|				ТОГДА ВЫРАЗИТЬ(Т.ЗаказНаПроизводство КАК Документ.ВыпускПродукции).НалоговоеНазначение
		|			ИНАЧЕ ЗНАЧЕНИЕ(Справочник.НалоговыеНазначенияАктивовИЗатрат.ПустаяСсылка)
		|		КОНЕЦ <> ЗНАЧЕНИЕ(Справочник.НалоговыеНазначенияАктивовИЗатрат.ПустаяСсылка)
		|		)
		|   	ИЛИ (                            
		|			Т.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход) 
		|			И Т.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.СписаниеНаРасходы)
		|		)
		|	)
		|	И (Т.ДоляСтоимостиРегл <> 0 ИЛИ Т.ДоляСтоимостиУпр <> 0)
		|СГРУППИРОВАТЬ ПО
		|	Т.Организация,
		|	Т.Период,
		|	Т.Регистратор,
		//++ Устарело_Производство21  
		|	ВЫБОР 
		|		КОГДА Т.ПартияПроизводства = НЕОПРЕДЕЛЕНО ИЛИ Т.ПартияПроизводства = ЗНАЧЕНИЕ(Справочник.ПартииПроизводства.ПустаяСсылка)
		|			ТОГДА 
		|				ВЫБОР
		|					КОГДА Т.ЗаказНаПроизводство = НЕОПРЕДЕЛЕНО
		|                   	ТОГДА Т.ПартияПроизводства
		|					КОГДА Т.ЗаказНаПроизводство ССЫЛКА Документ.ВыпускПродукции И Т.ЗаказНаПроизводство <> ЗНАЧЕНИЕ(Документ.ВыпускПродукции.ПустаяСсылка)
		|                   	ТОГДА Т.ЗаказНаПроизводство
		|		    	ИНАЧЕ Т.ПартияПроизводства
		|			КОНЕЦ
		|       ИНАЧЕ 
		//-- Устарело_Производство21  
		|			Т.ПартияПроизводства
		//++ Устарело_Производство21  
		|	КОНЕЦ
		//-- Устарело_Производство21  
		|	,
		//++ Устарело_Производство21  
		|	ВЫБОР 
		|		КОГДА Т.ПартияПроизводства = НЕОПРЕДЕЛЕНО ИЛИ Т.ПартияПроизводства = ЗНАЧЕНИЕ(Справочник.ПартииПроизводства.ПустаяСсылка)
		|			ТОГДА 
		|				ВЫБОР
		|					КОГДА Т.ЗаказНаПроизводство = НЕОПРЕДЕЛЕНО
		|                   	ТОГДА 0
		|					КОГДА Т.ЗаказНаПроизводство ССЫЛКА Документ.ВыпускПродукции И Т.ЗаказНаПроизводство <> ЗНАЧЕНИЕ(Документ.ВыпускПродукции.ПустаяСсылка)
		|                   	ТОГДА Т.КодСтрокиПродукция
		|		    		ИНАЧЕ 0
		|				КОНЕЦ
		|       ИНАЧЕ 
		|			0
		|	КОНЕЦ,
        |	ВЫБОР КОГДА НЕ Т.ПартияПроизводства.НалоговоеНазначение ЕСТЬ NULL
        |			ТОГДА Т.ПартияПроизводства.НалоговоеНазначение
        |		КОГДА Т.ЗаказНаПроизводство ССЫЛКА Документ.ВыпускПродукции
        |			ТОГДА ВЫРАЗИТЬ(Т.ЗаказНаПроизводство КАК Документ.ВыпускПродукции).НалоговоеНазначение
        |		ИНАЧЕ ЗНАЧЕНИЕ(Справочник.НалоговыеНазначенияАктивовИЗатрат.ПустаяСсылка)
		|	КОНЕЦ,
		|	Т.НаправлениеДеятельности,
		|	Т.Подразделение,
		|	Т.КорПодразделение,
        |	Т.СтатьяКалькуляции,
        |	Т.ГруппаПродукции,
        |	Т.ПравилоОтнесенияНаВыпуск,
		|	Т.СтатьяРасходов,
		|	Т.АналитикаРасходов
		|;
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	База.Организация,
		|	База.НалоговоеНазначение,
		|	База.НаправлениеДеятельности КАК НаправлениеДеятельности,
		|	База.Партия КАК Партия,
		|	База.СтатьяРасходов КАК СтатьяРасходовАктивов,
		|	База.АналитикаРасходов,
		|	СУММА(
		|		ВЫБОР КОГДА ДД.СтоимостьБезНДС <> 0 ИЛИ ДД.НДС <> 0
		|			ТОГДА База.ПоказательОтнесенияНаПартиюРегл
		|			ИНАЧЕ 0
		|		КОНЕЦ
		|		+ ВЫБОР КОГДА ДД.СтоимостьБезНДСУпр <> 0 ИЛИ ДД.НДСУпр <> 0
		|			ТОГДА База.ПоказательОтнесенияНаПартиюУпр
		|			ИНАЧЕ 0
		|		КОНЕЦ
		|	) КАК Знаменатель
		|ПОМЕСТИТЬ ЗнаменателиБазы
		|ИЗ
		|	ВТПартииПрочихДляРаспределения2_4 КАК ДД
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТБазаРаспределенияПрочиеРасходыНЗП2_4 КАК База
		|		ПО ДД.Организация = База.Организация
		|		И ДД.СтатьяРасходов = База.СтатьяРасходов
		|		И ДД.АналитикаРасходов = База.АналитикаРасходов
		|		И ДД.Подразделение = База.Подразделение
		|		И ДД.НаправлениеДеятельности = База.НаправлениеДеятельности
		|	
		|СГРУППИРОВАТЬ ПО
		|	База.Организация,
		|	База.НалоговоеНазначение,
		|	База.НаправлениеДеятельности,
		|	База.Партия,
		|	База.СтатьяРасходов,
		|	База.АналитикаРасходов
		|;
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	База.Организация,
		|	База.НалоговоеНазначение,
		|	База.НаправлениеДеятельности КАК НаправлениеДеятельности,
		|	База.Партия КАК Партия,
		//++ Устарело_Производство21  
		|	База.КодСтрокиПродукция КАК КодСтрокиПродукция,
		//-- Устарело_Производство21  
		|	База.СтатьяРасходов КАК СтатьяРасходовАктивов,
		|	База.АналитикаРасходов,
		|	СУММА(
		|		ВЫБОР КОГДА ДД.СтоимостьБезНДС <> 0 ИЛИ ДД.НДС <> 0
		|			ТОГДА База.ПоказательОтнесенияНаПартиюРегл
		|			ИНАЧЕ 0
		|		КОНЕЦ
		|		+ ВЫБОР КОГДА ДД.СтоимостьБезНДСУпр <> 0 ИЛИ ДД.НДСУпр <> 0
		|			ТОГДА База.ПоказательОтнесенияНаПартиюУпр
		|			ИНАЧЕ 0
		|		КОНЕЦ
		|	) КАК Знаменатель
		|ПОМЕСТИТЬ ЗнаменателиБазыКодСтроки
		|ИЗ
		|	ВТПартииПрочихДляРаспределения2_4 КАК ДД
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТБазаРаспределенияПрочиеРасходыНЗП2_4 КАК База
		|		ПО ДД.Организация = База.Организация
		|		И ДД.СтатьяРасходов = База.СтатьяРасходов
		|		И ДД.АналитикаРасходов = База.АналитикаРасходов
		|		И ДД.Подразделение = База.Подразделение
		|		И ДД.НаправлениеДеятельности = База.НаправлениеДеятельности
		|	
		|СГРУППИРОВАТЬ ПО
		|	База.Организация,
		|	База.НалоговоеНазначение,
		|	База.НаправлениеДеятельности,
		|	База.Партия,                
		//++ Устарело_Производство21  
		|	База.КодСтрокиПродукция,
		//-- Устарело_Производство21  
		|	База.СтатьяРасходов,
		|	База.АналитикаРасходов
		|";
КонецФункции

// ... выборки данных

Функция ТекстОписаниеДанныхДляПартийПрочихРасходовНДС2_4() Экспорт
	Возврат
		"ВЫБРАТЬ ПЕРВЫЕ 0
		|	ВЫРАЗИТЬ("""" КАК СТРОКА(80)) 								 КАК ЗапросИсточник,
		|	ДД.ТипЗаписи 												 КАК ТипЗаписи,
		|	ЛОЖЬ														 КАК Сторно,
		|	0 															 КАК Приоритет,
		|	0 															 КАК Знаменатель,
		|	0 															 КАК ЗнаменательДляИсточников,
		|	ЛОЖЬ 														 КАК РасчетЗавершен,
		|	ЗНАЧЕНИЕ(Справочник.Номенклатура.ПустаяСсылка) 				 КАК Номенклатура,
		|	ЗНАЧЕНИЕ(Справочник.ХарактеристикиНоменклатуры.ПустаяСсылка) КАК Характеристика,
		|	
		|	ДД.Период,
		|	ДД.Период КАК ПериодПоступления,
		|	ДД.Регистратор,
		|	ДД.ВидДвижения,
		|	ДД.Организация,
		|	ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаНоменклатуры.ПустаяСсылка) КАК АналитикаУчетаНоменклатуры,
		|	ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка) 				      КАК ВидЗапасов,
		|	ДД.КорАналитикаУчетаНоменклатуры,
		|	ДД.КорВидЗапасов,
		|	ДД.Партия,     
		//++ Устарело_Производство21  
		|	0 КАК КодСтрокиПродукция,
		//-- Устарело_Производство21  
		|	ДД.АналитикаУчетаПартий,
        |	ДД.НалоговоеНазначение,
		|	ДД.ДокументПоступления,
		|	ДД.АналитикаУчетаДокументаПоступления,
		|	ДД.НаправлениеДеятельности,
        |
		|	ЗНАЧЕНИЕ(Справочник.СтатьиКалькуляции.ПустаяСсылка) КАК СтатьяКалькуляции,
		|	ЗНАЧЕНИЕ(Справочник.ГруппыАналитическогоУчетаНоменклатуры.ПустаяСсылка) КАК ГруппаПродукции,
		|	ЗНАЧЕНИЕ(Перечисление.ПравилаОтнесенияНаВыпуск.ПустаяСсылка) КАК ПравилоОтнесенияНаВыпуск,
		|
		|	ДД.СтоимостьБезНДС,
		|	ДД.НДС,
		|	ДД.СтоимостьБезНДСУпр,
		|	ДД.НДСУпр,
		|
		|	ДД.ХозяйственнаяОперация,
        |	ДД.КорНалоговоеНазначение,
		|	ДД.Организация КАК КорОрганизация,
		|	ДД.Партия КАК КорПартия,
		|	ДД.АналитикаУчетаПартий КАК КорАналитикаУчетаПартий,
		|	ДД.КорНаправлениеДеятельности,
		|	ДД.Подразделение,
		|	ДД.КорПодразделение,
        |	ДД.КорАналитикаФинансовогоУчета,
		|	ДД.СтатьяРасходовАктивов,
		|	ДД.АналитикаРасходов,
		|	ДД.АналитикаАктивов,
		|	ДД.ДокументИсточник,
		|	ДД.СтатьяСписанияНДС,
		|	ДД.АналитикаСписанияНДС
		|//ВоВременнуюТаблицу
		|ИЗ
        |	РегистрНакопления.ДетализацияПартийТоваровДляНДС2_4 КАК ДД
		|";
КонецФункции

Функция ТекстПартииПрочихРасходовДляРаспределенияПоНЗПРегл()
	Возврат
		"ВЫБРАТЬ
		|	""ТекстПартииПрочихРасходовДляРаспределенияПоНЗПРегл"" КАК ЗапросИсточник,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыРегл) КАК ТипЗаписи,
		|	ЛОЖЬ КАК Сторно,
		|	0 КАК Приоритет,
		|	СУММА(База.ПоказательОтнесенияНаПартиюРегл) КАК Знаменатель,
		|	0											КАК ЗнаменательДляИсточников,
		|	ИСТИНА 										КАК РасчетЗавершен,
		|	ЗНАЧЕНИЕ(Справочник.Номенклатура.ПустаяСсылка) 				 КАК Номенклатура,
		|	ЗНАЧЕНИЕ(Справочник.ХарактеристикиНоменклатуры.ПустаяСсылка) КАК Характеристика,
		|	
		|	ДД.Период,
		|	ДД.Период КАК ПериодПоступления,
		|	ДД.Регистратор,
		|	ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход) КАК ВидДвижения,
		|	ДД.Организация,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаУчетаНоменклатуры,
		|	НЕОПРЕДЕЛЕНО КАК ВидЗапасов,
		|	НЕОПРЕДЕЛЕНО КАК КорАналитикаУчетаНоменклатуры,
		|	НЕОПРЕДЕЛЕНО КАК КорВидЗапасов,
		|	НЕОПРЕДЕЛЕНО КАК Партия,
		//++ Устарело_Производство21  
		|	0 КАК КодСтрокиПродукция,
		//-- Устарело_Производство21  
		|	ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка) КАК АналитикаУчетаПартий,
        |	ДД.НалоговоеНазначение КАК НалоговоеНазначение,
		|	ДД.ДокументПоступления,
		|	ДД.АналитикаУчетаДокументаПоступления,
		|	ДД.НаправлениеДеятельности,
        |	ЗНАЧЕНИЕ(Справочник.СтатьиКалькуляции.ПустаяСсылка) КАК СтатьяКалькуляции,
        |	ЗНАЧЕНИЕ(Справочник.ГруппыАналитическогоУчетаНоменклатуры.ПустаяСсылка) КАК ГруппаПродукции,
        |	ЗНАЧЕНИЕ(Перечисление.ПравилаОтнесенияНаВыпуск.ПустаяСсылка) КАК ПравилоОтнесенияНаВыпуск,
		|
		|	ДД.СтоимостьБезНДС,
		|	ДД.НДС,
		|	0 КАК СтоимостьБезНДСУпр,
		|	0 КАК НДСУпр,
		|
		|	ДД.ХозяйственнаяОперация,
        |	НЕОПРЕДЕЛЕНО КАК КорНалоговоеНазначение,
		|	ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка) КАК КорОрганизация,
		|	НЕОПРЕДЕЛЕНО КАК КорПартия,
		|	ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка) КАК КорАналитикаУчетаПартий,
		|	ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка) КАК КорНаправлениеДеятельности,
		|	ДД.Подразделение КАК Подразделение,
		|	ДД.Подразделение КАК КорПодразделение,
        |	НЕОПРЕДЕЛЕНО КАК КорАналитикаФинансовогоУчета,
		|	ДД.СтатьяРасходов КАК СтатьяРасходовАктивов,
		|	ДД.АналитикаРасходов КАК АналитикаРасходов,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаАктивов,
		|	НЕОПРЕДЕЛЕНО КАК ДокументИсточник,
		|	НЕОПРЕДЕЛЕНО КАК СтатьяСписанияНДС,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаСписанияНДС
		|ИЗ
		|	ВТПартииПрочихДляРаспределения2_4 КАК ДД
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТБазаРаспределенияПрочиеРасходыНЗП2_4 КАК База
		|		ПО ДД.Организация = База.Организация
		|		И ДД.СтатьяРасходов = База.СтатьяРасходов
		|		И ДД.АналитикаРасходов = База.АналитикаРасходов
		|		И ДД.Подразделение = База.Подразделение
		|		И ДД.НаправлениеДеятельности = База.НаправлениеДеятельности
		|ГДЕ
		|	База.ПоказательОтнесенияНаПартиюРегл <> 0
		|	И (ДД.СтоимостьБезНДС <> 0 ИЛИ ДД.НДС <> 0)
		|
		|СГРУППИРОВАТЬ ПО
        |	ДД.НалоговоеНазначение,
		|	ДД.Период,
		|	ДД.Регистратор,
		|	ДД.Организация,
        |	ДД.НалоговоеНазначение,
		|	ДД.ДокументПоступления,
		|	ДД.АналитикаУчетаДокументаПоступления,
		|	ДД.НаправлениеДеятельности,
		|	ДД.СтоимостьБезНДС,
		|	ДД.НДС,
		|	ДД.СтоимостьБезНДСУпр,
		|	ДД.НДСУпр,
		|	ДД.ХозяйственнаяОперация,
		|	ДД.СтатьяРасходов,
		|	ДД.АналитикаРасходов,
		|	ДД.Подразделение
		|";
КонецФункции

Функция ТекстБазаНЗПДляРаспределенияПартииПрочихРасходовРегл()
	Возврат
		"ВЫБРАТЬ
		|	""ТекстБазаНЗПДляРаспределенияПартииПрочихРасходовРегл"" КАК ЗапросИсточник,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.БазаРегл) 		 КАК ТипЗаписи,
		|	ЛОЖЬ 										КАК Сторно,
		|	0 											КАК Приоритет,
		|	ДД.ПоказательОтнесенияНаПартиюРегл			КАК Знаменатель,
		|	ЕСТЬNULL(Знаменатели.Знаменатель,
		|		ЕСТЬNULL(ЗнаменателиПартий.Знаменатель,
		|			ЕСТЬNULL(ЗнаменателиПартийПроизводства.Знаменатель,
		|				ДД.ПоказательОтнесенияНаПартиюРегл))) КАК ЗнаменательДляИсточников,
		|	ЛОЖЬ 										КАК РасчетЗавершен,
		|	ЗНАЧЕНИЕ(Справочник.Номенклатура.ПустаяСсылка) 				 КАК Номенклатура,
		|	ЗНАЧЕНИЕ(Справочник.ХарактеристикиНоменклатуры.ПустаяСсылка) КАК Характеристика,
		|	
		|	ДД.Период КАК Период,
		|	ДД.Период КАК ПериодПоступления,
		|	ДД.Регистратор КАК Регистратор,
		|	НЕОПРЕДЕЛЕНО КАК ВидДвижения,
		|	ДД.Организация,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаУчетаНоменклатуры,
		|	НЕОПРЕДЕЛЕНО КАК ВидЗапасов,
		|	НЕОПРЕДЕЛЕНО КАК КорАналитикаУчетаНоменклатуры,
		|	НЕОПРЕДЕЛЕНО КАК КорВидЗапасов,
		|	ДД.Партия КАК Партия,    
		//++ Устарело_Производство21  
		|	ДД.КодСтрокиПродукция КАК КодСтрокиПродукция,
		//-- Устарело_Производство21  
		|	ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка) КАК АналитикаУчетаПартий,
        |	ДД.НалоговоеНазначение КАК НалоговоеНазначение,
		|	НЕОПРЕДЕЛЕНО КАК ДокументПоступления,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаУчетаДокументаПоступления,
		|	ДД.НаправлениеДеятельности,
        |	ДД.СтатьяКалькуляции,
        |	ДД.ГруппаПродукции,
        |	ДД.ПравилоОтнесенияНаВыпуск,
		|
		|	0 КАК СтоимостьБезНДС,
		|	0 КАК НДС,
		|	0 КАК СтоимостьБезНДСУпр,
		|	0 КАК НДСУпр,
		|
		|	НЕОПРЕДЕЛЕНО КАК ХозяйственнаяОперация,
        |	НЕОПРЕДЕЛЕНО КАК КорНалоговоеНазначение,
		|	ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка) КАК КорОрганизация,
		|	НЕОПРЕДЕЛЕНО КАК КорПартия,
		|	ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка) КАК КорАналитикаУчетаПартий,
		|	ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка) КАК КорНаправлениеДеятельности,
		|	ДД.Подразделение КАК Подразделение,
		|	ДД.КорПодразделение КАК КорПодразделение,
        |	НЕОПРЕДЕЛЕНО КАК КорАналитикаФинансовогоУчета,
		|	ДД.СтатьяРасходов КАК СтатьяРасходовАктивов,
		|	ДД.АналитикаРасходов КАК АналитикаРасходов,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаАктивов,
		|	НЕОПРЕДЕЛЕНО КАК ДокументИсточник,
		|	НЕОПРЕДЕЛЕНО КАК СтатьяСписанияНДС,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаСписанияНДС
		|ИЗ
		|	ВТБазаРаспределенияПрочиеРасходыНЗП2_4 КАК ДД
		|	ЛЕВОЕ СОЕДИНЕНИЕ ЗнаменателиРегистраторов КАК Знаменатели
		|		ПО Знаменатели.Регистратор = ДД.Партия
		|		И Знаменатели.КодСтроки = ДД.КодСтрокиПродукция
		|	ЛЕВОЕ СОЕДИНЕНИЕ ЗнаменателиПартий КАК ЗнаменателиПартий
		|		ПО ЗнаменателиПартий.Партия = ДД.Партия
		|		И ЗнаменателиПартий.КодСтроки = ДД.КодСтрокиПродукция
		|	ЛЕВОЕ СОЕДИНЕНИЕ ЗнаменателиПартий КАК ЗнаменателиПартийПроизводства
		|		ПО ЗнаменателиПартийПроизводства.Партия = ВЫРАЗИТЬ(ДД.Партия КАК Справочник.ПартииПроизводства).Документ
		|		И ЗнаменателиПартийПроизводства.КодСтроки = ДД.КодСтрокиПродукция
		|ГДЕ
		|	ДД.ПоказательОтнесенияНаПартиюРегл <> 0
		|";
КонецФункции

Функция ТекстПартииПрочихРасходовДляРаспределенияПоНЗПУпр()
	Возврат
		"ВЫБРАТЬ
		|	""ТекстПартииПрочихРасходовДляРаспределенияПоНЗПУпр"" КАК ЗапросИсточник,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыУпр) КАК ТипЗаписи,
		|	ЛОЖЬ КАК Сторно,
		|	0 КАК Приоритет,
		|	СУММА(База.ПоказательОтнесенияНаПартиюУпр)  КАК Знаменатель,
		|	0											КАК ЗнаменательДляИсточников,
		|	ИСТИНА 										КАК РасчетЗавершен,
		|	ЗНАЧЕНИЕ(Справочник.Номенклатура.ПустаяСсылка) 				 КАК Номенклатура,
		|	ЗНАЧЕНИЕ(Справочник.ХарактеристикиНоменклатуры.ПустаяСсылка) КАК Характеристика,
		|	
		|	ДД.Период,
		|	ДД.Период КАК ПериодПоступления,
		|	ДД.Регистратор,
		|	ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход) КАК ВидДвижения,
		|	ДД.Организация,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаУчетаНоменклатуры,
		|	НЕОПРЕДЕЛЕНО КАК ВидЗапасов,
		|	НЕОПРЕДЕЛЕНО КАК КорАналитикаУчетаНоменклатуры,
		|	НЕОПРЕДЕЛЕНО КАК КорВидЗапасов,
		|	НЕОПРЕДЕЛЕНО КАК Партия,
		//++ Устарело_Производство21  
		|	0 КАК КодСтрокиПродукция,
		//-- Устарело_Производство21  
		|	ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка) КАК АналитикаУчетаПартий,
        |	ДД.НалоговоеНазначение КАК НалоговоеНазначение,
		|	ДД.ДокументПоступления,
		|	ДД.АналитикаУчетаДокументаПоступления,
		|	ДД.НаправлениеДеятельности,
        |	ЗНАЧЕНИЕ(Справочник.СтатьиКалькуляции.ПустаяСсылка) КАК СтатьяКалькуляции,
        |	ЗНАЧЕНИЕ(Справочник.ГруппыАналитическогоУчетаНоменклатуры.ПустаяСсылка) КАК ГруппаПродукции,
        |	ЗНАЧЕНИЕ(Перечисление.ПравилаОтнесенияНаВыпуск.ПустаяСсылка) КАК ПравилоОтнесенияНаВыпуск,
		|
		|	0 КАК СтоимостьБезНДС,
		|	0 КАК НДС,
		|	ДД.СтоимостьБезНДСУпр КАК СтоимостьБезНДСУпр,
		|	ДД.НДСУпр КАК НДСУпр,
		|
		|	ДД.ХозяйственнаяОперация,
        |	НЕОПРЕДЕЛЕНО КАК КорНалоговоеНазначение,
		|	ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка) КАК КорОрганизация,
		|	НЕОПРЕДЕЛЕНО КАК КорПартия,
		|	ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка) КАК КорАналитикаУчетаПартий,
		|	ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка) КАК КорНаправлениеДеятельности,
		|	ДД.Подразделение КАК Подразделение,
		|	ДД.Подразделение КАК КорПодразделение,
        |	НЕОПРЕДЕЛЕНО КАК КорАналитикаФинансовогоУчета,
		|	ДД.СтатьяРасходов КАК СтатьяРасходовАктивов,
		|	ДД.АналитикаРасходов КАК АналитикаРасходов,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаАктивов,
		|	НЕОПРЕДЕЛЕНО КАК ДокументИсточник,
		|	НЕОПРЕДЕЛЕНО КАК СтатьяСписанияНДС,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаСписанияНДС
		|ИЗ
		|	ВТПартииПрочихДляРаспределения2_4 КАК ДД
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТБазаРаспределенияПрочиеРасходыНЗП2_4 КАК База
		|		ПО ДД.Организация = База.Организация
		|		И ДД.СтатьяРасходов = База.СтатьяРасходов
		|		И ДД.АналитикаРасходов = База.АналитикаРасходов
		|		И ДД.Подразделение = База.Подразделение
		|		И ДД.НаправлениеДеятельности = База.НаправлениеДеятельности
		|ГДЕ
		|	База.ПоказательОтнесенияНаПартиюУпр <> 0
		|	И (ДД.СтоимостьБезНДСУпр <> 0 ИЛИ ДД.НДСУпр <> 0)
		|
		|СГРУППИРОВАТЬ ПО
        |	ДД.НалоговоеНазначение,
		|	ДД.Период,
		|	ДД.Регистратор,
		|	ДД.Организация,
        |	ДД.НалоговоеНазначение,
		|	ДД.ДокументПоступления,
		|	ДД.АналитикаУчетаДокументаПоступления,
		|	ДД.НаправлениеДеятельности,
		|	ДД.СтоимостьБезНДС,
		|	ДД.НДС,
		|	ДД.СтоимостьБезНДСУпр,
		|	ДД.НДСУпр,
		|	ДД.ХозяйственнаяОперация,
		|	ДД.СтатьяРасходов,
		|	ДД.АналитикаРасходов,
		|	ДД.Подразделение
		|";
КонецФункции

Функция ТекстБазаНЗПДляРаспределенияПартииПрочихРасходовУпр()
	Возврат
		"ВЫБРАТЬ
		|	""ТекстБазаНЗПДляРаспределенияПартииПрочихРасходовУпр"" КАК ЗапросИсточник,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.БазаУпр) КАК ТипЗаписи,
		|	ЛОЖЬ КАК Сторно,
		|	0 КАК Приоритет,
		|	ДД.ПоказательОтнесенияНаПартиюУпр			КАК Знаменатель,
		|	ЕСТЬNULL(Знаменатели.Знаменатель,
		|		ЕСТЬNULL(ЗнаменателиПартий.Знаменатель,
		|			ЕСТЬNULL(ЗнаменателиПартийПроизводства.Знаменатель,
		|				ДД.ПоказательОтнесенияНаПартиюУпр))) КАК ЗнаменательДляИсточников,
		|	ЛОЖЬ 										КАК РасчетЗавершен,
		|	ЗНАЧЕНИЕ(Справочник.Номенклатура.ПустаяСсылка) 				 КАК Номенклатура,
		|	ЗНАЧЕНИЕ(Справочник.ХарактеристикиНоменклатуры.ПустаяСсылка) КАК Характеристика,
		|	
		|	ДД.Период КАК Период,
		|	ДД.Период КАК ПериодПоступления,
		|	ДД.Регистратор КАК Регистратор,
		|	НЕОПРЕДЕЛЕНО КАК ВидДвижения,
		|	ДД.Организация,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаУчетаНоменклатуры,
		|	НЕОПРЕДЕЛЕНО КАК ВидЗапасов,
		|	НЕОПРЕДЕЛЕНО КАК КорАналитикаУчетаНоменклатуры,
		|	НЕОПРЕДЕЛЕНО КАК КорВидЗапасов,
		|	ДД.Партия КАК Партия,
		//++ Устарело_Производство21  
		|	ДД.КодСтрокиПродукция КАК КодСтрокиПродукция,
		//-- Устарело_Производство21  
		|	ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка) КАК АналитикаУчетаПартий,
        |	ДД.НалоговоеНазначение КАК НалоговоеНазначение,
		|	НЕОПРЕДЕЛЕНО КАК ДокументПоступления,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаУчетаДокументаПоступления,
		|	ДД.НаправлениеДеятельности,
        |	ДД.СтатьяКалькуляции,
        |	ДД.ГруппаПродукции,
        |	ДД.ПравилоОтнесенияНаВыпуск,
		|
		|	0 КАК СтоимостьБезНДС,
		|	0 КАК НДС,
		|	0 КАК СтоимостьБезНДСУпр,
		|	0 КАК НДСУпр,
		|
		|	НЕОПРЕДЕЛЕНО КАК ХозяйственнаяОперация,
        |	НЕОПРЕДЕЛЕНО КАК КорНалоговоеНазначение,
		|	ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка) КАК КорОрганизация,
		|	НЕОПРЕДЕЛЕНО КАК КорПартия,
		|	ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка) КАК КорАналитикаУчетаПартий,
		|	ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка) КАК КорНаправлениеДеятельности,
		|	ДД.Подразделение КАК Подразделение,
		|	ДД.КорПодразделение КАК КорПодразделение,
        |	НЕОПРЕДЕЛЕНО КАК КорАналитикаФинансовогоУчета,
		|	ДД.СтатьяРасходов КАК СтатьяРасходовАктивов,
		|	ДД.АналитикаРасходов КАК АналитикаРасходов,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаАктивов,
		|	НЕОПРЕДЕЛЕНО КАК ДокументИсточник,
		|	НЕОПРЕДЕЛЕНО КАК СтатьяСписанияНДС,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаСписанияНДС
		|ИЗ
		|	ВТБазаРаспределенияПрочиеРасходыНЗП2_4 КАК ДД
		|	ЛЕВОЕ СОЕДИНЕНИЕ ЗнаменателиРегистраторов КАК Знаменатели
		|		ПО Знаменатели.Регистратор = ДД.Партия
		|		И Знаменатели.КодСтроки = ДД.КодСтрокиПродукция
		|	ЛЕВОЕ СОЕДИНЕНИЕ ЗнаменателиПартий КАК ЗнаменателиПартий
		|		ПО ЗнаменателиПартий.Партия = ДД.Партия
		|		И ЗнаменателиПартий.КодСтроки = ДД.КодСтрокиПродукция
		|	ЛЕВОЕ СОЕДИНЕНИЕ ЗнаменателиПартий КАК ЗнаменателиПартийПроизводства
		|		ПО ЗнаменателиПартийПроизводства.Партия = ВЫРАЗИТЬ(ДД.Партия КАК Справочник.ПартииПроизводства).Документ
		|		И ЗнаменателиПартийПроизводства.КодСтроки = ДД.КодСтрокиПродукция
		|ГДЕ
		|	ДД.ПоказательОтнесенияНаПартиюУпр <> 0
		|";
КонецФункции

Функция ТекстСписаниеНаВыпускПостатейныеРасходы()
	Возврат
		"ВЫБРАТЬ
		|	""ТекстСписаниеНаВыпускПостатейныеРасходы"" КАК ЗапросИсточник,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.СписанияНаВыпускПостатейные) КАК ТипЗаписи,
		|	ЛОЖЬ КАК Сторно,
		|	0 КАК Приоритет,
		|	СУММА(ВЫБОР КОГДА ЕСТЬNULL(Выпуски.Знаменатель, 0) = 0
		|		ТОГДА ЕСТЬNULL(ЗнаменателиБазы.Знаменатель, 0)
		|		ИНАЧЕ Выпуски.Знаменатель
		|	КОНЕЦ) 														 КАК Знаменатель,
		|	СУММА(ЕСТЬNULL(ЗнаменателиБазы.Знаменатель, 0))				 КАК ЗнаменательДляИсточников,
		|	ЛОЖЬ 										КАК РасчетЗавершен,
		|	ЗНАЧЕНИЕ(Справочник.Номенклатура.ПустаяСсылка) 				 КАК Номенклатура,
		|	ЗНАЧЕНИЕ(Справочник.ХарактеристикиНоменклатуры.ПустаяСсылка) КАК Характеристика,
		|	
		|	ДД.Период,
		|	ДД.Период КАК ПериодПоступления,
		|	ДД.Регистратор,
		|	ДД.ВидДвижения,
		|	ДД.Организация,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаУчетаНоменклатуры,
		|	НЕОПРЕДЕЛЕНО КАК ВидЗапасов,
		|	ДД.АналитикаУчетаПродукции КАК КорАналитикаУчетаНоменклатуры,
		|	ДД.ВидЗапасов КАК КорВидЗапасов,
		//++ Устарело_Производство21  
		|	ВЫБОР 
		|		КОГДА ДД.ПартияПроизводства = НЕОПРЕДЕЛЕНО ИЛИ ДД.ПартияПроизводства = ЗНАЧЕНИЕ(Справочник.ПартииПроизводства.ПустаяСсылка)
		|			ТОГДА 
		|				ВЫБОР
		|					КОГДА ДД.ЗаказНаПроизводство = НЕОПРЕДЕЛЕНО
		|                   	ТОГДА ДД.ПартияПроизводства
		|					КОГДА ДД.ЗаказНаПроизводство ССЫЛКА Документ.ВыпускПродукции И ДД.ЗаказНаПроизводство <> ЗНАЧЕНИЕ(Документ.ВыпускПродукции.ПустаяСсылка)
		|                   	ТОГДА ДД.ЗаказНаПроизводство
		|		    		ИНАЧЕ ДД.ПартияПроизводства
		|				КОНЕЦ
		|       ИНАЧЕ 
		//-- Устарело_Производство21  
		|			ДД.ПартияПроизводства
		//++ Устарело_Производство21  
		|	КОНЕЦ 
		//-- Устарело_Производство21  
		|			КАК Партия,
		|	ДД.КодСтрокиПродукция КАК КодСтрокиПродукция,
		|	ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка) КАК АналитикаУчетаПартий,
        |	ВЫБОР КОГДА НЕ ПартииПроизводства.НалоговоеНазначение ЕСТЬ NULL
        |			ТОГДА ПартииПроизводства.НалоговоеНазначение
		//++ Устарело_Производство21  
        |		КОГДА ДД.ЗаказНаПроизводство ССЫЛКА Документ.ВыпускПродукции
        |			ТОГДА ВЫРАЗИТЬ(ДД.ЗаказНаПроизводство КАК Документ.ВыпускПродукции).НалоговоеНазначение
		//-- Устарело_Производство21  
        |		ИНАЧЕ ЗНАЧЕНИЕ(Справочник.НалоговыеНазначенияАктивовИЗатрат.ПустаяСсылка)
        |	КОНЕЦ 								КАК НалоговоеНазначение,
		|	НЕОПРЕДЕЛЕНО КАК ДокументПоступления,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаУчетаДокументаПоступления,
		|	ДД.НаправлениеДеятельности,
        |	ДД.СтатьяКалькуляции,
        |	ДД.ГруппаПродукции,
        |	ДД.ПравилоОтнесенияНаВыпуск,
		|
		|	0 КАК СтоимостьБезНДС,
		|	0 КАК НДС,
		|	0 КАК СтоимостьБезНДСУпр,
		|	0 КАК НДСУпр,
		|
		|	ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукции) КАК ХозяйственнаяОперация,
        |	ВЫБОР КОГДА НЕ Выпуски.НалоговоеНазначение ЕСТЬ NULL
        |			ТОГДА Выпуски.НалоговоеНазначение
		//++ Устарело_Производство21  
        |		КОГДА ДД.ЗаказНаПроизводство ССЫЛКА Документ.ВыпускПродукции
        |			ТОГДА ВЫРАЗИТЬ(ДД.ЗаказНаПроизводство КАК Документ.ВыпускПродукции).НалоговоеНазначение
		//-- Устарело_Производство21  
        |		ИНАЧЕ ЗНАЧЕНИЕ(Справочник.НалоговыеНазначенияАктивовИЗатрат.ПустаяСсылка)
        |	КОНЕЦ 								КАК КорНалоговоеНазначение,
		|	ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка) КАК КорОрганизация,
		|	ДД.Регистратор КАК КорПартия,
		|	ЕСТЬNULL(КорАналитикиУчетаПартий.Ссылка, ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка)) КАК КорАналитикаУчетаПартий,
		|	ДД.НаправлениеДеятельности КАК КорНаправлениеДеятельности,
		|	ДД.Подразделение КАК Подразделение,
		|	ДД.Подразделение КАК КорПодразделение,
        |	НЕОПРЕДЕЛЕНО КАК КорАналитикаФинансовогоУчета,
		|	ДД.СтатьяРасходов КАК СтатьяРасходовАктивов,
		|	ДД.АналитикаРасходов КАК АналитикаРасходов,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаАктивов,
		|	НЕОПРЕДЕЛЕНО КАК ДокументИсточник,
		|	НЕОПРЕДЕЛЕНО КАК СтатьяСписанияНДС,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаСписанияНДС
		|ИЗ
		|	втПрочиеРасходыНезавершенногоПроизводства КАК ДД
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТСтатьиПроизводственныхЗатрат КАК Статьи
		|		ПО ДД.СтатьяРасходов = Статьи.Ссылка
		|	ЛЕВОЕ СОЕДИНЕНИЕ Справочник.ПартииПроизводства КАК ПартииПроизводства
		|		ПО ДД.ПартияПроизводства = ПартииПроизводства.Ссылка
		|	ЛЕВОЕ СОЕДИНЕНИЕ ВТОтборАналитикиУчетаПартийНДС2_4 КАК КорАналитикиУчетаПартий
		|		ПО ДД.КорАналитикаУчетаПартий = КорАналитикиУчетаПартий.Ссылка
		|	ЛЕВОЕ СОЕДИНЕНИЕ ДвиженияСебестоимостиНДС2_4КодСтроки КАК Выпуски
		|		ПО Выпуски.Регистратор = ДД.Регистратор
		|		И Выпуски.Организация = ДД.Организация
		|		И Выпуски.Партия = ДД.Регистратор
		|		И Выпуски.АналитикаУчетаПартий = ЕСТЬNULL(КорАналитикиУчетаПартий.Ссылка, ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка))
		|		И Выпуски.НаправлениеДеятельности = ДД.НаправлениеДеятельности
		|		И (
		|			Выпуски.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Выпуск)
		//++ Устарело_Производство21  
		|		    ИЛИ (
		|				Выпуски.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Перемещение)
		|				И Выпуски.Регистратор ССЫЛКА Документ.ВыпускПродукции
		|				И Выпуски.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход) 
		|				И Выпуски.АналитикаУчетаНоменклатуры = ДД.АналитикаУчетаПродукции
		|				И Выпуски.КодСтроки = ДД.КодСтрокиПродукция
		|			)
		//-- Устарело_Производство21  
		|       )
		|	ЛЕВОЕ СОЕДИНЕНИЕ ЗнаменателиБазыКодСтроки КАК ЗнаменателиБазы
		|		ПО ЗнаменателиБазы.Организация = ДД.Организация
		|		 И ЗнаменателиБазы.НалоговоеНазначение = (
        |			ВЫБОР КОГДА НЕ ПартииПроизводства.НалоговоеНазначение ЕСТЬ NULL
        |				ТОГДА ПартииПроизводства.НалоговоеНазначение
		//++ Устарело_Производство21  
        |				КОГДА ДД.ЗаказНаПроизводство ССЫЛКА Документ.ВыпускПродукции
        |					ТОГДА ВЫРАЗИТЬ(ДД.ЗаказНаПроизводство КАК Документ.ВыпускПродукции).НалоговоеНазначение
		//-- Устарело_Производство21  
        |			ИНАЧЕ ЛОЖЬ
        |			КОНЕЦ
		|        )
		|		 И ЗнаменателиБазы.НаправлениеДеятельности = ДД.НаправлениеДеятельности
		|		 И ЗнаменателиБазы.Партия = (
		//++ Устарело_Производство21  
		|			ВЫБОР 
		|				КОГДА ДД.ПартияПроизводства = НЕОПРЕДЕЛЕНО ИЛИ ДД.ПартияПроизводства = ЗНАЧЕНИЕ(Справочник.ПартииПроизводства.ПустаяСсылка)
		|					ТОГДА 
		|						ВЫБОР
		|							КОГДА ДД.ЗаказНаПроизводство = НЕОПРЕДЕЛЕНО
		|                   			ТОГДА ДД.ПартияПроизводства
		|							КОГДА ДД.ЗаказНаПроизводство ССЫЛКА Документ.ВыпускПродукции И ДД.ЗаказНаПроизводство <> ЗНАЧЕНИЕ(Документ.ВыпускПродукции.ПустаяСсылка)
		|                   			ТОГДА ДД.ЗаказНаПроизводство
		|		    				ИНАЧЕ ДД.ПартияПроизводства
		|						КОНЕЦ
		|       		ИНАЧЕ 
		//-- Устарело_Производство21  
		|					ДД.ПартияПроизводства
		//++ Устарело_Производство21  
		|			КОНЕЦ
		//-- Устарело_Производство21  
		|		 )
		|		 И ЗнаменателиБазы.СтатьяРасходовАктивов = ДД.СтатьяРасходов
		|		 И ЗнаменателиБазы.АналитикаРасходов = ДД.АналитикаРасходов
		|		 И ЗнаменателиБазы.КодСтрокиПродукция = ДД.КодСтрокиПродукция
		|ГДЕ
		|	ДД.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
		|
		|СГРУППИРОВАТЬ ПО
		|	ДД.Период,
		|	ДД.Регистратор,
		|	ДД.ВидДвижения,
		|	ДД.Организация,
		|	ДД.АналитикаУчетаПродукции,
		|	ДД.ВидЗапасов,
		|	ВЫБОР 
		|		КОГДА ДД.ПартияПроизводства = НЕОПРЕДЕЛЕНО ИЛИ ДД.ПартияПроизводства = ЗНАЧЕНИЕ(Справочник.ПартииПроизводства.ПустаяСсылка)
		|			ТОГДА 
		|				ВЫБОР
		|					КОГДА ДД.ЗаказНаПроизводство = НЕОПРЕДЕЛЕНО
		|                   	ТОГДА ДД.ПартияПроизводства
		|					КОГДА ДД.ЗаказНаПроизводство ССЫЛКА Документ.ВыпускПродукции И ДД.ЗаказНаПроизводство <> ЗНАЧЕНИЕ(Документ.ВыпускПродукции.ПустаяСсылка)
		|                   	ТОГДА ДД.ЗаказНаПроизводство
		|		    		ИНАЧЕ ДД.ПартияПроизводства
		|				КОНЕЦ
		|       ИНАЧЕ 
		|			ДД.ПартияПроизводства
		|	КОНЕЦ
		|	,
		//++ Устарело_Производство21  
		|	ДД.КодСтрокиПродукция,
		//-- Устарело_Производство21  
        |	ВЫБОР КОГДА НЕ ПартииПроизводства.НалоговоеНазначение ЕСТЬ NULL
        |			ТОГДА ПартииПроизводства.НалоговоеНазначение
		//++ Устарело_Производство21  
        |		КОГДА ДД.ЗаказНаПроизводство ССЫЛКА Документ.ВыпускПродукции
        |			ТОГДА ВЫРАЗИТЬ(ДД.ЗаказНаПроизводство КАК Документ.ВыпускПродукции).НалоговоеНазначение
		//-- Устарело_Производство21  
        |		ИНАЧЕ ЗНАЧЕНИЕ(Справочник.НалоговыеНазначенияАктивовИЗатрат.ПустаяСсылка)
        |	КОНЕЦ,
		|	ДД.НаправлениеДеятельности,
        |	ДД.СтатьяКалькуляции,
        |	ДД.ГруппаПродукции,
        |	ДД.ПравилоОтнесенияНаВыпуск,
        |	ВЫБОР КОГДА НЕ Выпуски.НалоговоеНазначение ЕСТЬ NULL
        |			ТОГДА Выпуски.НалоговоеНазначение
		//++ Устарело_Производство21  
        |		КОГДА ДД.ЗаказНаПроизводство ССЫЛКА Документ.ВыпускПродукции
        |			ТОГДА ВЫРАЗИТЬ(ДД.ЗаказНаПроизводство КАК Документ.ВыпускПродукции).НалоговоеНазначение
		//-- Устарело_Производство21  
        |		ИНАЧЕ ЗНАЧЕНИЕ(Справочник.НалоговыеНазначенияАктивовИЗатрат.ПустаяСсылка)
        |	КОНЕЦ,
		|	ЕСТЬNULL(КорАналитикиУчетаПартий.Ссылка, ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка)),
		|	ДД.Подразделение,
		|	ДД.СтатьяРасходов,
		|	ДД.АналитикаРасходов
		|";
КонецФункции

Функция ТекстНачальныеОстаткиПартийПрочиеРасходыНДС2_4() // использует ОстаткиТоваров
	Возврат
		"ВЫБРАТЬ
		|	""ТекстНачальныеОстаткиПартийНДС2_4"" КАК ЗапросИсточник,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ОстатокСгруппированный) КАК ТипЗаписи,
		|	ВЫБОР
		|		КОГДА МАКСИМУМ(ДД.Знаменатель) < 0 ТОГДА ИСТИНА
		|		ИНАЧЕ ЛОЖЬ
		|	КОНЕЦ КАК Сторно,
		|	0 КАК Приоритет,
		|	МАКСИМУМ(ДД.Знаменатель) КАК Знаменатель,
		|	СУММА(ДД.Знаменатель) КАК ЗнаменательДляИсточников,
		|	ВЫБОР КОГДА &РасчетПоПартиямПрочихРасходов
		|			ТОГДА ИСТИНА
		|			ИНАЧЕ ЛОЖЬ
		|	КОНЕЦ КАК РасчетЗавершен,
		|	НЕОПРЕДЕЛЕНО КАК Номенклатура,
		|	НЕОПРЕДЕЛЕНО КАК Характеристика,
		|	
		|	ДД.Период,
		|	ДД.Период КАК ПериодПоступления,
		|	ДД.Регистратор,
		|	ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход) КАК ВидДвижения,
		|	ДД.Организация,
		|	ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаНоменклатуры.ПустаяСсылка) КАК АналитикаУчетаНоменклатуры,
		|	ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка) 				      КАК ВидЗапасов,
		|	ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаНоменклатуры.ПустаяСсылка) КАК КорАналитикаУчетаНоменклатуры,
		|	ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка) 				      КАК КорВидЗапасов,
		|	ДД.Партия,
		//++ Устарело_Производство21  
		|	0 КАК КодСтрокиПродукция,
		//-- Устарело_Производство21  
		|	ДД.АналитикаУчетаПартий,
        |	ДД.НалоговоеНазначение,
		|	НЕОПРЕДЕЛЕНО КАК ДокументПоступления,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаУчетаДокументаПоступления,
		|	ДД.НаправлениеДеятельности,
		|	ЗНАЧЕНИЕ(Справочник.СтатьиКалькуляции.ПустаяСсылка) КАК СтатьяКалькуляции,
		|	ЗНАЧЕНИЕ(Справочник.ГруппыАналитическогоУчетаНоменклатуры.ПустаяСсылка) КАК ГруппаПродукции,
		|	ЗНАЧЕНИЕ(Перечисление.ПравилаОтнесенияНаВыпуск.ПустаяСсылка) КАК ПравилоОтнесенияНаВыпуск,
		|
		|	0,
		|	0,
		|	0,
		|	0,
		|
		|	ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПустаяСсылка) КАК ХозяйственнаяОперация,
        |	ЗНАЧЕНИЕ(Справочник.НалоговыеНазначенияАктивовИЗатрат.ПустаяСсылка) КАК КорНалоговоеНазначение,
		|	ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка) КАК КорОрганизация,
		|	НЕОПРЕДЕЛЕНО КАК КорПартия,
		|	НЕОПРЕДЕЛЕНО КАК КорАналитикаУчетаПартий,
		|	НЕОПРЕДЕЛЕНО КАК КорНаправлениеДеятельности,
		|	НЕОПРЕДЕЛЕНО КАК Подразделение,
		|	НЕОПРЕДЕЛЕНО КАК КорПодразделение,
        |	НЕОПРЕДЕЛЕНО КАК КорАналитикаФинансовогоУчета,
		|	ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиРасходов.ПустаяСсылка) КАК СтатьяРасходовАктивов,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаРасходов,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаАктивов,
		|	НЕОПРЕДЕЛЕНО КАК ДокументИсточник,
		|	НЕОПРЕДЕЛЕНО КАК СтатьяСписанияНДС,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаСписанияНДС
		|ИЗ
		|	ВТНачальныеОстаткиПартийНДС КАК ДД
		|ГДЕ
		|	ИСТИНА В (ВЫБРАТЬ Т.ЕстьЗаписи ИЗ ВыполнятьРаспределениеПартийНДС2_4 КАК Т)
		|
		|СГРУППИРОВАТЬ ПО
		|	ДД.Сторно,
		|	ДД.Период,
		|	ДД.Регистратор,
		|	ДД.Организация,
		|	ДД.Партия,
		|	ДД.АналитикаУчетаПартий,
        |	ДД.НалоговоеНазначение,
		|	ДД.НаправлениеДеятельности
		|";
КонецФункции

Функция ТекстПриходыСебестоимостиТоваровПрочиеРасходы2_4()
	Возврат
		"ВЫБРАТЬ
		|	""ТекстПриходыСебестоимостиТоваров2_4"" КАК ЗапросИсточник,
		|	ДД.ТипЗаписи,
		|	ВЫБОР
		|		КОГДА СУММА(ДД.Знаменатель) < 0 ТОГДА ИСТИНА
		|		ИНАЧЕ ЛОЖЬ
		|	КОНЕЦ КАК Сторно,
		|	0 КАК Приоритет,
		|	СУММА(ДД.Знаменатель) КАК Знаменатель,
		|	СУММА(ДД.ЗнаменательДляИсточников) КАК ЗнаменательДляИсточников,
		|	ИСТИНА КАК РасчетЗавершен,
        |	ВЫБОР КОГДА ДД.ТипЗаписи В (
        |		ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходы),
        |		ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыСПартией),
        |		ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыБезПартии),
        |		ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаСтоимости),
        |		ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаПриобретенияПрошлогоПериода),
        |		ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ОтклонениеВСтоимости))
        |			ТОГДА ДД.Номенклатура
        |			ИНАЧЕ НЕОПРЕДЕЛЕНО
        |	КОНЕЦ КАК Номенклатура,
        |	ВЫБОР КОГДА ДД.ТипЗаписи В (
        |		ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходы),
        |		ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыСПартией),
        |		ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыБезПартии),
        |		ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаСтоимости),
        |		ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаПриобретенияПрошлогоПериода),
        |		ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ОтклонениеВСтоимости))
        |			ТОГДА ДД.Характеристика
        |			ИНАЧЕ НЕОПРЕДЕЛЕНО
        |	КОНЕЦ КАК Характеристика,
		|	
		|	ДД.Период,
		|	ДД.Период КАК ПериодПоступления,
		|	ДД.Регистратор,
		|	ДД.ВидДвижения,
		|	ДД.Организация,
        |	ВЫБОР КОГДА ДД.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
        |		ТОГДА 
        |			ВЫБОР КОГДА ДД.ТипЗаписи В (
        |				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходы),
        |				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыСПартией),
        |				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыБезПартии),
        |				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаСтоимости),
        |				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаПриобретенияПрошлогоПериода),
        |				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ОтклонениеВСтоимости))
        |					ТОГДА ДД.АналитикаУчетаНоменклатуры
        |					ИНАЧЕ ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаНоменклатуры.ПустаяСсылка)
        |			КОНЕЦ
        |		ИНАЧЕ ДД.АналитикаУчетаНоменклатуры
        |	КОНЕЦ КАК АналитикаУчетаНоменклатуры,
        |	ВЫБОР КОГДА ДД.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
        |		ТОГДА
        |			ВЫБОР КОГДА ДД.ТипЗаписи В (
        |				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходы),
        |				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыСПартией),
        |				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыБезПартии),
        |				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаСтоимости),
        |				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаПриобретенияПрошлогоПериода),
        |				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ОтклонениеВСтоимости))
        |					ТОГДА ДД.ВидЗапасов
        |					ИНАЧЕ ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка)
        |			КОНЕЦ
        |		ИНАЧЕ ДД.ВидЗапасов
        |	КОНЕЦ КАК ВидЗапасов,
		|	ДД.КорАналитикаУчетаНоменклатуры КАК КорАналитикаУчетаНоменклатуры,
		|	ДД.КорВидЗапасов КАК КорВидЗапасов,
		|	ДД.Партия,
		//++ Устарело_Производство21  
		|	0 КАК КодСтрокиПродукция,
		//-- Устарело_Производство21  
		|	ДД.АналитикаУчетаПартий,
        |	ДД.НалоговоеНазначение,
		|	ДД.ДокументПоступления,
		|	ДД.АналитикаУчетаДокументаПоступления КАК АналитикаУчетаДокументаПоступления,
		|	ДД.НаправлениеДеятельности,
		|	ЗНАЧЕНИЕ(Справочник.СтатьиКалькуляции.ПустаяСсылка) КАК СтатьяКалькуляции,
		|	ЗНАЧЕНИЕ(Справочник.ГруппыАналитическогоУчетаНоменклатуры.ПустаяСсылка) КАК ГруппаПродукции,
		|	ЗНАЧЕНИЕ(Перечисление.ПравилаОтнесенияНаВыпуск.ПустаяСсылка) КАК ПравилоОтнесенияНаВыпуск,
		|
		|	СУММА(ВЫБОР КОГДА &РасчетПоПартиямПрочихРасходов ТОГДА 0 ИНАЧЕ ДД.СтоимостьБезНДС КОНЕЦ),
		|	СУММА(ВЫБОР КОГДА &РасчетПоПартиямПрочихРасходов ТОГДА 0 ИНАЧЕ ДД.НДС КОНЕЦ),
		|	СУММА(ВЫБОР КОГДА &РасчетПоПартиямПрочихРасходов ТОГДА 0 ИНАЧЕ ДД.СтоимостьБезНДСУпр КОНЕЦ),
		|	СУММА(ВЫБОР КОГДА &РасчетПоПартиямПрочихРасходов ТОГДА 0 ИНАЧЕ ДД.НДСУпр КОНЕЦ),
		|
		|	ДД.ХозяйственнаяОперация,
        |	ДД.КорНалоговоеНазначение,
		|	ДД.КорОрганизация,
		|	ДД.КорПартия,
		|	ДД.КорАналитикаУчетаПартий,
		|	ДД.КорНаправлениеДеятельности,
		|	ДД.Подразделение,
		|	ДД.Подразделение,
        |	НЕОПРЕДЕЛЕНО КАК КорАналитикаФинансовогоУчета,
		|	ДД.СтатьяРасходовАктивов,
		|	ДД.АналитикаРасходов,
		|	ДД.АналитикаАктивов,
		|	ДД.ДокументИсточник,
		|	НЕОПРЕДЕЛЕНО КАК СтатьяСписанияНДС,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаСписанияНДС
		|ИЗ
		|	ПриходыТоваровНДС2_4 КАК ДД
		|ГДЕ
        |	(ДД.СтоимостьБезНДС <> 0 ИЛИ ДД.НДС <> 0 ИЛИ ДД.СтоимостьБезНДСУпр <> 0 ИЛИ ДД.НДСУпр <> 0)
		|	И НЕ (&РасчетПоПартиямПрочихРасходов И ДД.ТипЗаписи <> ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Партия))
		|	И ИСТИНА В (ВЫБРАТЬ Т.ЕстьЗаписи ИЗ ВыполнятьРаспределениеПартийНДС2_4 КАК Т)
		|
		|СГРУППИРОВАТЬ ПО
		|	ДД.ТипЗаписи,
		|	ВЫБОР
		|		КОГДА ДД.СтоимостьБезНДС < 0 ТОГДА ИСТИНА
		|		ИНАЧЕ ЛОЖЬ
		|	КОНЕЦ,
        |	ВЫБОР КОГДА ДД.ТипЗаписи В (
        |		ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходы),
        |		ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыСПартией),
        |		ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыБезПартии),
        |		ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаСтоимости),
        |		ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаПриобретенияПрошлогоПериода),
        |		ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ОтклонениеВСтоимости))
        |			ТОГДА ДД.Номенклатура
        |			ИНАЧЕ НЕОПРЕДЕЛЕНО
        |	КОНЕЦ,
        |	ВЫБОР КОГДА ДД.ТипЗаписи В (
        |		ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходы),
        |		ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыСПартией),
        |		ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыБезПартии),
        |		ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаСтоимости),
        |		ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаПриобретенияПрошлогоПериода),
        |		ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ОтклонениеВСтоимости))
        |			ТОГДА ДД.Характеристика
        |			ИНАЧЕ НЕОПРЕДЕЛЕНО
        |	КОНЕЦ,
		|	ДД.Период,
		|	ДД.Регистратор,
		|	ДД.ВидДвижения,
		|	ДД.Организация,
        |	ВЫБОР КОГДА ДД.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
        |		ТОГДА 
        |			ВЫБОР КОГДА ДД.ТипЗаписи В (
        |				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходы),
        |				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыСПартией),
        |				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыБезПартии),
        |				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаСтоимости),
        |				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаПриобретенияПрошлогоПериода),
        |				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ОтклонениеВСтоимости))
        |					ТОГДА ДД.АналитикаУчетаНоменклатуры
        |					ИНАЧЕ ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаНоменклатуры.ПустаяСсылка)
        |			КОНЕЦ
        |		ИНАЧЕ ДД.АналитикаУчетаНоменклатуры
        |	КОНЕЦ,
        |	ВЫБОР КОГДА ДД.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
        |		ТОГДА
        |			ВЫБОР КОГДА ДД.ТипЗаписи В (
        |				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходы),
        |				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыСПартией),
        |				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыБезПартии),
        |				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаСтоимости),
        |				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаПриобретенияПрошлогоПериода),
        |				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ОтклонениеВСтоимости))
        |					ТОГДА ДД.ВидЗапасов
        |					ИНАЧЕ ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка)
        |			КОНЕЦ
        |		ИНАЧЕ ДД.ВидЗапасов
        |	КОНЕЦ,
		|	ДД.КорАналитикаУчетаНоменклатуры,
		|	ДД.КорВидЗапасов,
		|	ДД.Партия,
		|	ДД.АналитикаУчетаПартий,
        |	ДД.НалоговоеНазначение,
		|	ДД.ДокументПоступления,
		|	ДД.АналитикаУчетаДокументаПоступления,
		|	ДД.НаправлениеДеятельности,
		|	ДД.ХозяйственнаяОперация,
        |	ДД.КорНалоговоеНазначение,
		|	ДД.КорОрганизация,
		|	ДД.КорПартия,
		|	ДД.КорАналитикаУчетаПартий,
		|	ДД.КорНаправлениеДеятельности,
		|	ДД.Подразделение,
		|	ДД.СтатьяРасходовАктивов,
		|	ДД.АналитикаРасходов,
		|	ДД.АналитикаАктивов,
		|	ДД.ДокументИсточник
		|";
КонецФункции

Функция ТекстДвиженияСебестоимостиТоваровПрочиеРасходы2_4()
	Возврат
		"ВЫБРАТЬ
		|	""ТекстДвиженияСебестоимостиТоваров2_4"" КАК ЗапросИсточник,
		|	ДД.ТипЗаписи,
		|	ВЫБОР
		|		КОГДА СУММА(ДД.Знаменатель) < 0 ТОГДА ИСТИНА
		|		ИНАЧЕ ЛОЖЬ
		|	КОНЕЦ КАК Сторно,
		|	0 КАК Приоритет,
		|	СУММА(ДД.Знаменатель) КАК Знаменатель,
		|	СУММА(ДД.ЗнаменательДляИсточников) КАК ЗнаменательДляИсточников,
		|	ЛОЖЬ КАК РасчетЗавершен,
        |	ВЫБОР КОГДА НЕ &РасчетПоПартиямПрочихРасходов И ДД.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
        |			ТОГДА ДД.Номенклатура
        |			ИНАЧЕ НЕОПРЕДЕЛЕНО
        |	КОНЕЦ КАК Номенклатура,
        |	ВЫБОР КОГДА НЕ &РасчетПоПартиямПрочихРасходов И ДД.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
        |			ТОГДА ДД.Характеристика
        |			ИНАЧЕ НЕОПРЕДЕЛЕНО
        |	КОНЕЦ КАК Характеристика,
		|
		|	ДД.Период,
		|	ВЫБОР
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаПриобретения)
		|			ТОГДА &НачалоПериода
		|		ИНАЧЕ ДД.Период
		|	КОНЕЦ КАК ПериодПоступления,
		|	ДД.Регистратор,
		|	ДД.ВидДвижения,
		|	ДД.Организация,
        |	ВЫБОР КОГДА &РасчетПоПартиямПрочихРасходов ИЛИ ДД.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
        |		ТОГДА ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаНоменклатуры.ПустаяСсылка)
        |		ИНАЧЕ ДД.АналитикаУчетаНоменклатуры
        |	КОНЕЦ КАК АналитикаУчетаНоменклатуры,
        |	ВЫБОР КОГДА &РасчетПоПартиямПрочихРасходов ИЛИ ДД.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
        |		ТОГДА ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка)
        |		ИНАЧЕ ДД.ВидЗапасов
        |	КОНЕЦ КАК ВидЗапасов,
		|	ВЫБОР
		|		КОГДА ДД.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
		|			И ДД.КорАналитикаУчетаНоменклатуры = ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаНоменклатуры.ПустаяСсылка)
		|		ТОГДА ДД.АналитикаУчетаНоменклатуры
		|		ИНАЧЕ ДД.КорАналитикаУчетаНоменклатуры
		|	КОНЕЦ КАК КорАналитикаУчетаНоменклатуры,
		|	ВЫБОР
		|		КОГДА ДД.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
		|			И ДД.КорВидЗапасов = ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка)
		|		ТОГДА ДД.ВидЗапасов
		|		ИНАЧЕ ДД.КорВидЗапасов
		|	КОНЕЦ КАК КорВидЗапасов,
		|	(ВЫБОР
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Выпуск)
		|		 И ДД.Партия = НЕОПРЕДЕЛЕНО
		|			ТОГДА ДД.Регистратор
		|		КОГДА ДД.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыВПути)
		|		 И ДД.Партия = НЕОПРЕДЕЛЕНО
		|			ТОГДА ДД.Регистратор
		|		ИНАЧЕ ДД.Партия КОНЕЦ) КАК Партия,
		//++ Устарело_Производство21  
		|	ДД.КодСтроки КАК КодСтрокиПродукция,
		//-- Устарело_Производство21  
		|	ДД.АналитикаУчетаПартий,
        |	ДД.НалоговоеНазначение,
		|	НЕОПРЕДЕЛЕНО КАК ДокументПоступления,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаУчетаДокументаПоступления,
		|	ДД.НаправлениеДеятельности,
		|	ЗНАЧЕНИЕ(Справочник.СтатьиКалькуляции.ПустаяСсылка) КАК СтатьяКалькуляции,
		|	ЗНАЧЕНИЕ(Справочник.ГруппыАналитическогоУчетаНоменклатуры.ПустаяСсылка) КАК ГруппаПродукции,
		|	ЗНАЧЕНИЕ(Перечисление.ПравилаОтнесенияНаВыпуск.ПустаяСсылка) КАК ПравилоОтнесенияНаВыпуск,
		|
		|	0 КАК СтоимостьБезНДС,
		|	0 КАК НДС,
		|	0 КАК СтоимостьБезНДСУпр,
		|	0 КАК НДСУпр,
		|	ДД.ХозяйственнаяОперация,
        |	ДД.КорНалоговоеНазначение,
		|	ДД.КорОрганизация,
		|	(ВЫБОР
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.СписанияНаВыпуск)
		|		 И ДД.КорПартия = НЕОПРЕДЕЛЕНО
		|			ТОГДА ДД.Регистратор
		|		КОГДА ДД.КорРазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыВПути)
		|		 И ДД.КорПартия = НЕОПРЕДЕЛЕНО
		|			ТОГДА ДД.Регистратор
		|		ИНАЧЕ ДД.КорПартия КОНЕЦ) КАК КорПартия,
		|	ДД.КорАналитикаУчетаПартий КАК КорАналитикаУчетаПартий,
		|	ВЫБОР
		|		КОГДА ДД.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
		|			И ДД.КорНаправлениеДеятельности = ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка)
		|		ТОГДА ДД.НаправлениеДеятельности
		|		ИНАЧЕ ДД.КорНаправлениеДеятельности
		|	КОНЕЦ КАК КорНаправлениеДеятельности,
		|	ДД.Подразделение,
		|	ДД.Подразделение,
		|	ДД.КорАналитикаФинансовогоУчета,
		|	ДД.СтатьяРасходовАктивов,
		|	ДД.АналитикаРасходов,
		|	ДД.АналитикаАктивов,
		|	ВЫБОР КОГДА ДД.ТипЗаписи В (ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Сторно), ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.СторноВозвратНаДругойСклад))
		|		ТОГДА ДД.ДокументИсточник
		|		ИНАЧЕ НЕОПРЕДЕЛЕНО
		|	КОНЕЦ КАК ДокументИсточник,
		|	НЕОПРЕДЕЛЕНО КАК СтатьяСписанияНДС,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаСписанияНДС
		|ИЗ
		|	ДвиженияСебестоимостиНДС2_4КодСтроки КАК ДД
		|ГДЕ
		|	ДД.Знаменатель <> 0
		|	И ДД.ТипЗаписи <> ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ВключениеИсключениеНДСвСтоимости)
		|	И НЕ (&РасчетПоПартиямПрочихРасходов
		|		И ДД.ТипЗаписи В
		|			(ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение),
		|			ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ОтклонениеВСтоимости),
		|			ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.РаспределениеПоВыбывшимТоварам),
		|			ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаСтоимости),
		|			ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходы),
		|			ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыСПартией),
		|			ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыБезПартии),
		|			ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ПеремещениеУпр)))
		|	И ИСТИНА В (ВЫБРАТЬ Т.ЕстьЗаписи ИЗ ВыполнятьРаспределениеПартийНДС2_4 КАК Т)
		|
		|СГРУППИРОВАТЬ ПО
		|	ДД.ТипЗаписи,
		|	ДД.Сторно,
        |	ВЫБОР КОГДА НЕ &РасчетПоПартиямПрочихРасходов И ДД.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
        |			ТОГДА ДД.Номенклатура
        |			ИНАЧЕ НЕОПРЕДЕЛЕНО
        |	КОНЕЦ,
        |	ВЫБОР КОГДА НЕ &РасчетПоПартиямПрочихРасходов И ДД.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
        |			ТОГДА ДД.Характеристика
        |			ИНАЧЕ НЕОПРЕДЕЛЕНО
        |	КОНЕЦ,
		|	ДД.Период,
		|	ДД.Регистратор,
		|	ДД.ВидДвижения,
		|	ДД.Организация,
        |	ВЫБОР КОГДА &РасчетПоПартиямПрочихРасходов ИЛИ ДД.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
        |		ТОГДА ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаНоменклатуры.ПустаяСсылка)
        |		ИНАЧЕ ДД.АналитикаУчетаНоменклатуры
        |	КОНЕЦ,
        |	ВЫБОР КОГДА &РасчетПоПартиямПрочихРасходов ИЛИ ДД.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
        |		ТОГДА ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка)
        |		ИНАЧЕ ДД.ВидЗапасов
        |	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА ДД.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
		|			И ДД.КорАналитикаУчетаНоменклатуры = ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаНоменклатуры.ПустаяСсылка)
		|		ТОГДА ДД.АналитикаУчетаНоменклатуры
		|		ИНАЧЕ ДД.КорАналитикаУчетаНоменклатуры
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА ДД.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
		|			И ДД.КорВидЗапасов = ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка)
		|		ТОГДА ДД.ВидЗапасов
		|		ИНАЧЕ ДД.КорВидЗапасов
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА ДД.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
		|			И ДД.КорАналитикаУчетаНоменклатуры = ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаНоменклатуры.ПустаяСсылка)
		|		ТОГДА ДД.НаправлениеДеятельности
		|		ИНАЧЕ ДД.КорНаправлениеДеятельности
		|	КОНЕЦ,
		|	(ВЫБОР
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Выпуск)
		|		 И ДД.Партия = НЕОПРЕДЕЛЕНО
		|			ТОГДА ДД.Регистратор
		|		КОГДА ДД.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыВПути)
		|		 И ДД.Партия = НЕОПРЕДЕЛЕНО
		|			ТОГДА ДД.Регистратор
		|		ИНАЧЕ ДД.Партия КОНЕЦ),
		|	ДД.КодСтроки,
        |	ДД.НалоговоеНазначение,
		|	ДД.АналитикаУчетаПартий,
		|	ДД.НаправлениеДеятельности,
		|	ВЫБОР
		|		КОГДА ДД.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
		|			И ДД.КорНаправлениеДеятельности = ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка)
		|		ТОГДА ДД.НаправлениеДеятельности
		|		ИНАЧЕ ДД.КорНаправлениеДеятельности
		|	КОНЕЦ,
		|	ДД.ХозяйственнаяОперация,
        |	ДД.КорНалоговоеНазначение,
		|	ДД.КорОрганизация,
		|	(ВЫБОР
		|		КОГДА ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.СписанияНаВыпуск)
		|		 И ДД.КорПартия = НЕОПРЕДЕЛЕНО
		|			ТОГДА ДД.Регистратор
		|		КОГДА ДД.КорРазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыВПути)
		|		 И ДД.КорПартия = НЕОПРЕДЕЛЕНО
		|			ТОГДА ДД.Регистратор
		|		ИНАЧЕ ДД.КорПартия КОНЕЦ),
		|	ДД.Подразделение,
		|	ДД.КорАналитикаФинансовогоУчета,
		|	ДД.КорАналитикаУчетаПартий,
		|	ДД.СтатьяРасходовАктивов,
		|	ДД.АналитикаРасходов,
		|	ДД.АналитикаАктивов,
		|	ВЫБОР КОГДА ДД.ТипЗаписи В (ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Сторно), ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.СторноВозвратНаДругойСклад))
		|		ТОГДА ДД.ДокументИсточник
		|		ИНАЧЕ НЕОПРЕДЕЛЕНО
		|	КОНЕЦ";
КонецФункции


#КонецОбласти

//-- НЕ УТ

#Область ПроцедурыЭтапа_ПодготовкаДанныхДляПартийПрочихРасходов

// Выборка данных

Процедура ПолучитьДанныеДляПартийПрочихРасходов(ПараметрыРасчета)
	
	РасчетСебестоимостиПрикладныеАлгоритмы.ПолучитьДанныеЭтапаРасчета(
		ПараметрыРасчета,
		ТекстЗапросаДляПартийПрочихРасходов(ПараметрыРасчета));
	
КонецПроцедуры

// Тексты запросов

// ... общий

Функция ТекстЗапросаДляПартийПрочихРасходов(ПараметрыРасчета = Неопределено) Экспорт
	
	ТекстЗапроса = ""
		// выборка данных
		+ ТекстОписаниеДанныхДляПартийПрочихРасходов() //вт Данные
		+ ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстПоступленияПартийПрочихРасходовИзПартийНДС()
		+ ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстПоступленияПартийПрочихРасходовИзПриходовСебестоимости() // использует ПриходыТоваровНДС
		+ ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстПоступленияПартийПрочихРасходовИзПартийНДС2_4()
		+ ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстПоступленияПартийПрочихРасходовИзПостатейныхПроизводственныхЗатрат()
		+ ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстПоступленияПартийПрочихРасходовИзПриходовСебестоимости2_4() // использует ПриходыТоваровНДС2_4
		+ "";
	
	Возврат ТекстЗапроса;
	
КонецФункции

// ... описания данных

Функция ТекстОписаниеДанныхДляПартийПрочихРасходов()
	Возврат "
		|ВЫБРАТЬ ПЕРВЫЕ 0
		|	ВЫРАЗИТЬ("""" КАК СТРОКА(80)) КАК ЗапросИсточник,
		|	0 КАК Приоритет,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ПустаяСсылка) КАК ТипЗаписи,
		|	ЛОЖЬ КАК РасчетЗавершен,
		|	ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход) КАК ВидДвижения,
		|	ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0) КАК Период,
		|	ДД.Регистратор,
		|	ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПустаяСсылка) КАК РазделУчета,
		|	ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка) КАК Организация,
		|	ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяСсылка) КАК Подразделение,
		|	ДД.СтатьяРасходов,
		|	ДД.АналитикаРасходов,
		|	ДД.АналитикаАктивовПассивов,
		|	ДД.ДокументПоступленияРасходов,
		|	ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка) КАК АналитикаУчетаПартий,
		|	ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка) КАК НаправлениеДеятельности,
		|	ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаНоменклатуры.ПустаяСсылка) КАК АналитикаУчетаНоменклатуры,
        |	ЗНАЧЕНИЕ(Справочник.НалоговыеНазначенияАктивовИЗатрат.ПустаяСсылка) КАК НалоговоеНазначение,
		|	0 КАК Стоимость,
		|	0 КАК СтоимостьБезНДС,
		|	0 КАК СтоимостьРегл,
		|	0 КАК НДСРегл,
		|	0 КАК НДСУпр,
		|	0 КАК ПостояннаяРазница,
		|	0 КАК ВременнаяРазница,
        |	ЗНАЧЕНИЕ(Справочник.НалоговыеНазначенияАктивовИЗатрат.ПустаяСсылка) КАК НалоговоеНазначениеСписания
		|//ВоВременнуюТаблицу
		|ИЗ
		|	РегистрНакопления.ПартииПрочихРасходов КАК ДД
		|";
КонецФункции

// ... выборки данных

Функция ТекстПоступленияПартийПрочихРасходовИзПартийНДС()
	Возврат "
		|ВЫБРАТЬ
		|	""ТекстПоступленияПартийПрочихРасходовИзПартийНДС"" КАК ЗапросИсточник,
		|	10 КАК Приоритет,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение) КАК ТипЗаписи,
		|	ИСТИНА КАК РасчетЗавершен,
		|	ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход) КАК ВидДвижения,
		|	ДД.Период,
		|	ДД.Регистратор,
		|	ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПустаяСсылка) КАК РазделУчета,
		|	ДД.Организация,
		|	ВЫБОР
		|		КОГДА НЕ Потребление.Подразделение ЕСТЬ NULL
		|			ТОГДА Потребление.Подразделение
		//++ НЕ УТ
		|		КОГДА НЕ ПередачаМатериалов.Подразделение ЕСТЬ NULL
		|			ТОГДА ПередачаМатериалов.Подразделение
		|		КОГДА НЕ ВозвратМатериалов.Подразделение ЕСТЬ NULL
		|			ТОГДА ВозвратМатериалов.Подразделение
		//-- НЕ УТ
		|		КОГДА НЕ Сторно.Подразделение ЕСТЬ NULL
		|			ТОГДА Сторно.Подразделение
		|		КОГДА Аналитика.ТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Подразделение)
		|			ТОГДА Аналитика.Подразделение
		|		ИНАЧЕ ЕСТЬNULL(Склады.Подразделение, ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяСсылка))
		|	КОНЕЦ КАК Подразделение,
		|	ДД.СтатьяРасходовАктивов КАК СтатьяРасходов,
		|	ДД.АналитикаРасходов,
		|	ДД.АналитикаАктивов КАК АналитикаАктивовПассивов,
		|	ДД.ДокументПоступления КАК ДокументПоступленияРасходов,
		|	ДД.АналитикаУчетаПартий,
		|	ЕСТЬNULL(Потребление.НаправлениеДеятельности,
		|		ЕСТЬNULL(Назначения.НаправлениеДеятельности,
		|			ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка))) КАК НаправлениеДеятельности,
		|	ДД.АналитикаУчетаНоменклатуры,
        |	(ВЫБОР
        |		КОГДА ДД.КорНалоговоеНазначение = ЗНАЧЕНИЕ(Справочник.НалоговыеНазначенияАктивовИЗатрат.ПустаяСсылка)
        |			ТОГДА ДД.НалоговоеНазначение
        |		ИНАЧЕ ДД.КорНалоговоеНазначение КОНЕЦ) КАК НалоговоеНазначение,
		|	0 КАК Стоимость,
		|	0 КАК СтоимостьБезНДС,
		|	СУММА(ДД.СтоимостьБезНДС) КАК СтоимостьРегл,
		|	СУММА(ДД.НДС) КАК НДСРегл,
		|	СУММА(ДД.НДСУпр) КАК НДСУпр,
		|	0 КАК ПостояннаяРазница,
		|	0 КАК ВременнаяРазница,
		|	(ВЫБОР
        |		КОГДА ДД.КорНалоговоеНазначение = ЗНАЧЕНИЕ(Справочник.НалоговыеНазначенияАктивовИЗатрат.ПустаяСсылка)
        |			ТОГДА ДД.НалоговоеНазначение
        |		ИНАЧЕ ДД.КорНалоговоеНазначение КОНЕЦ) КАК НалоговоеНазначениеСписания
		|ИЗ
        |	ВТКэшРасчетныеОборотыДетализацияПартийТоваровДляНДС КАК ДД
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК Аналитика
		|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Склады КАК Склады
		|		ПО Аналитика.МестоХранения = Склады.Ссылка
		|			ПО Аналитика.Ссылка = ДД.АналитикаУчетаНоменклатуры
		|	ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Назначения КАК Назначения
		|		ПО Назначения.Ссылка = Аналитика.Назначение
		|	ЛЕВОЕ СОЕДИНЕНИЕ Документ.ВнутреннееПотреблениеТоваров КАК Потребление
		|		ПО Потребление.Ссылка = ДД.Регистратор
		//++ НЕ УТ
		|	ЛЕВОЕ СОЕДИНЕНИЕ Документ.ПередачаМатериаловВПроизводство КАК ПередачаМатериалов
		|		ПО ПередачаМатериалов.Ссылка = ДД.Регистратор
		|	ЛЕВОЕ СОЕДИНЕНИЕ Документ.ВозвратМатериаловИзПроизводства КАК ВозвратМатериалов
		|		ПО ВозвратМатериалов.Ссылка = ДД.Регистратор
		//-- НЕ УТ
		|	ЛЕВОЕ СОЕДИНЕНИЕ Документ.ПрочееОприходованиеТоваров КАК Сторно
		|		ПО Сторно.Ссылка = ДД.Регистратор
		
		|	ЛЕВОЕ СОЕДИНЕНИЕ ПланВидовХарактеристик.СтатьиРасходов КАК Статья
		|		ПО Статья.Ссылка = ДД.СтатьяРасходовАктивов
		|	ЛЕВОЕ СОЕДИНЕНИЕ ПланВидовХарактеристик.СтатьиАктивовПассивов КАК СтатьяАктивов
		|		ПО СтатьяАктивов.Ссылка = ДД.СтатьяРасходовАктивов
		|ГДЕ
		|	НЕ ДД.СлужебноеВидДвиженияПриход
        |	И (Статья.ВариантРаспределенияРасходовРегл = ЗНАЧЕНИЕ(Перечисление.ВариантыРаспределенияРасходов.НаВнеоборотныеАктивы)
        |			И Статья.ВидЦенности = ЗНАЧЕНИЕ(Перечисление.ВидыЦенностей.ОС))
		|	И (ДД.НДС <> 0 ИЛИ ДД.НДСУпр <> 0)
        |	И ДД.НалоговоеНазначение <> ЗНАЧЕНИЕ(Справочник.НалоговыеНазначенияАктивовИЗатрат.ПустаяСсылка)
		|	И НЕ ДД.Регистратор ССЫЛКА Документ.ВозвратТоваровПоставщику
		|	И НЕ ДД.Регистратор ССЫЛКА Документ.ВозвратТоваровМеждуОрганизациями
		|СГРУППИРОВАТЬ ПО
		|	ДД.Период,
		|	ДД.Регистратор,
		|	ДД.Организация,
		|	ВЫБОР
		|		КОГДА НЕ Потребление.Подразделение ЕСТЬ NULL
		|			ТОГДА Потребление.Подразделение
		//++ НЕ УТ
		|		КОГДА НЕ ПередачаМатериалов.Подразделение ЕСТЬ NULL
		|			ТОГДА ПередачаМатериалов.Подразделение
		|		КОГДА НЕ ВозвратМатериалов.Подразделение ЕСТЬ NULL
		|			ТОГДА ВозвратМатериалов.Подразделение
		//-- НЕ УТ
		|		КОГДА НЕ Сторно.Подразделение ЕСТЬ NULL
		|			ТОГДА Сторно.Подразделение
		|		КОГДА Аналитика.ТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Подразделение)
		|			ТОГДА Аналитика.Подразделение
		|		ИНАЧЕ ЕСТЬNULL(Склады.Подразделение, ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяСсылка))
		|	КОНЕЦ,
		|	ДД.СтатьяРасходовАктивов,
		|	ДД.АналитикаРасходов,
		|	ДД.АналитикаАктивов,
		|	ДД.ДокументПоступления,
		|	ДД.АналитикаУчетаПартий,
		|	ЕСТЬNULL(Потребление.НаправлениеДеятельности,
		|		ЕСТЬNULL(Назначения.НаправлениеДеятельности,
		|			ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка))),
		|	ДД.АналитикаУчетаНоменклатуры,
        |	(ВЫБОР
        |		КОГДА ДД.КорНалоговоеНазначение = ЗНАЧЕНИЕ(Справочник.НалоговыеНазначенияАктивовИЗатрат.ПустаяСсылка)
        |			ТОГДА ДД.НалоговоеНазначение
        |		ИНАЧЕ ДД.КорНалоговоеНазначение КОНЕЦ),
        |	ДД.НалоговоеНазначение
		|";
КонецФункции

Функция ТекстПоступленияПартийПрочихРасходовИзПриходовСебестоимости()// использует ПриходыТоваровНДС
	Возврат "
		|ВЫБРАТЬ
		|	""ТекстПоступленияПартийПрочихРасходовИзПриходовСебестоимости"" КАК ЗапросИсточник,
		|	10 КАК Приоритет,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение) КАК ТипЗаписи,
		|	ИСТИНА КАК РасчетЗавершен,
		|	ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход) КАК ВидДвижения,
		|	ДД.Период,
		|	ДД.Регистратор,
		|	ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПустаяСсылка) КАК РазделУчета,
		|	ДД.Организация,
		|	ВЫБОР
		|		КОГДА НЕ Потребление.Подразделение ЕСТЬ NULL
		|			ТОГДА Потребление.Подразделение
		//++ НЕ УТ
		|		КОГДА НЕ ПередачаМатериалов.Подразделение ЕСТЬ NULL
		|			ТОГДА ПередачаМатериалов.Подразделение
		|		КОГДА НЕ ВозвратМатериалов.Подразделение ЕСТЬ NULL
		|			ТОГДА ВозвратМатериалов.Подразделение
		//-- НЕ УТ
		|		КОГДА НЕ СторноТоваров.Подразделение ЕСТЬ NULL
		|			ТОГДА СторноТоваров.Подразделение
		|		КОГДА ТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Подразделение)
		|			ТОГДА Аналитика.Подразделение
		|		ИНАЧЕ ЕСТЬNULL(Склады.Подразделение, ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяСсылка))
		|	КОНЕЦ КАК Подразделение,
		|	НЕОПРЕДЕЛЕНО КАК СтатьяРасходов,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаРасходов,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаАктивовПассивов,
		|	ДД.ДокументПоступления КАК ДокументПоступленияРасходов,
		|	ДД.АналитикаУчетаПартий,
		|	ЕСТЬNULL(Потребление.НаправлениеДеятельности,
		|		ЕСТЬNULL(Назначения.НаправлениеДеятельности,
		|			ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка))) КАК НаправлениеДеятельности,
		|	ДД.АналитикаУчетаНоменклатуры,
        |	ДД.НалоговоеНазначение,
		|	0 КАК Стоимость,
		|	0 КАК СтоимостьБезНДС,
		|	ДД.СтоимостьБезНДС КАК СтоимостьРегл,
		|	ДД.НДС КАК НДСРегл,
		|	ДД.НДСУпр КАК НДСУпр,
		|	0 КАК ПостояннаяРазница,
		|	0 КАК ВременнаяРазница,
        |	ЗНАЧЕНИЕ(Справочник.НалоговыеНазначенияАктивовИЗатрат.ПустаяСсылка) КАК НалоговоеНазначениеСписания
		|ИЗ
		|	ПриходыТоваровНДС КАК ДД
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК Аналитика
		|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Склады КАК Склады
		|		ПО Аналитика.МестоХранения = Склады.Ссылка
		|			ПО Аналитика.Ссылка = ДД.АналитикаУчетаНоменклатуры
		|	ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Назначения КАК Назначения
		|		ПО Назначения.Ссылка = Аналитика.Назначение
		|
		|	ЛЕВОЕ СОЕДИНЕНИЕ Документ.ВнутреннееПотреблениеТоваров КАК Потребление
		|		ПО Потребление.Ссылка = ДД.Регистратор
		//++ НЕ УТ
		|	ЛЕВОЕ СОЕДИНЕНИЕ Документ.ПередачаМатериаловВПроизводство КАК ПередачаМатериалов
		|		ПО ПередачаМатериалов.Ссылка = ДД.Регистратор
		|	ЛЕВОЕ СОЕДИНЕНИЕ Документ.ВозвратМатериаловИзПроизводства КАК ВозвратМатериалов
		|		ПО ВозвратМатериалов.Ссылка = ДД.Регистратор
		//-- НЕ УТ
		|	ЛЕВОЕ СОЕДИНЕНИЕ Документ.ПрочееОприходованиеТоваров КАК СторноТоваров
		|		ПО СторноТоваров.Ссылка = ДД.Регистратор
		|
		|ГДЕ
        |	ЛОЖЬ 
		|	И ДД.ТипЗаписи В (
		|			ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходы),
		|			ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыСПартией),
		|			ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыБезПартии))
		|";
КонецФункции

Функция ТекстПоступленияПартийПрочихРасходовИзПартийНДС2_4()
	Возврат "
		|ВЫБРАТЬ
		|	""ТекстПоступленияПартийПрочихРасходовИзПартийНДС2_4"" КАК ЗапросИсточник,
		|	10 КАК Приоритет,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение) КАК ТипЗаписи,
		|	ИСТИНА КАК РасчетЗавершен,
		|	ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход) КАК ВидДвижения,
		|	ДД.Период,
		|	ДД.Регистратор,
		|	ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПустаяСсылка) КАК РазделУчета,
		|	ДД.Организация,
		|	ВЫБОР
		|		КОГДА НЕ Потребление.Подразделение ЕСТЬ NULL
		|			ТОГДА Потребление.Подразделение
		//++ НЕ УТ
		|		КОГДА НЕ ПередачаМатериалов.Подразделение ЕСТЬ NULL
		|			ТОГДА ПередачаМатериалов.Подразделение
		|		КОГДА НЕ ВозвратМатериалов.Подразделение ЕСТЬ NULL
		|			ТОГДА ВозвратМатериалов.Подразделение
		//-- НЕ УТ
		|		КОГДА НЕ Сторно.Подразделение ЕСТЬ NULL
		|			ТОГДА Сторно.Подразделение
		|		КОГДА Аналитика.ТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Подразделение)
		|			ТОГДА Аналитика.Подразделение
		|		ИНАЧЕ ЕСТЬNULL(Склады.Подразделение, ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяСсылка))
		|	КОНЕЦ КАК Подразделение,
		|	ДД.СтатьяРасходовАктивов КАК СтатьяРасходов,
		|	ДД.АналитикаРасходов,
		|	ДД.АналитикаАктивов КАК АналитикаАктивовПассивов,
		|	ДД.ДокументПоступления КАК ДокументПоступленияРасходов,
		|	ДД.АналитикаУчетаДокументаПоступления КАК АналитикаУчетаПартий,
		|	ЕСТЬNULL(Потребление.НаправлениеДеятельности, ДД.НаправлениеДеятельности) КАК НаправлениеДеятельности,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаУчетаНоменклатуры,
        |	(ВЫБОР
        |		КОГДА ДД.КорНалоговоеНазначение = ЗНАЧЕНИЕ(Справочник.НалоговыеНазначенияАктивовИЗатрат.ПустаяСсылка)
        |			ТОГДА ДД.НалоговоеНазначение
        |		ИНАЧЕ ДД.КорНалоговоеНазначение КОНЕЦ) КАК НалоговоеНазначение,
		|	0 КАК Стоимость,
		|	0 КАК СтоимостьБезНДС,
		|	СУММА(ДД.СтоимостьБезНДС) КАК СтоимостьРегл,
		|	СУММА(ДД.НДС) КАК НДСРегл,
		|	СУММА(ДД.НДСУпр) КАК НДСУпр,
		|	0 КАК ПостояннаяРазница,
		|	0 КАК ВременнаяРазница,
        |	(ВЫБОР
        |		КОГДА ДД.КорНалоговоеНазначение = ЗНАЧЕНИЕ(Справочник.НалоговыеНазначенияАктивовИЗатрат.ПустаяСсылка)
        |			ТОГДА ДД.НалоговоеНазначение
        |		ИНАЧЕ ДД.КорНалоговоеНазначение КОНЕЦ) КАК НалоговоеНазначениеСписания
		|ИЗ
        |	ВТКэшРасчетныеОборотыДетализацияПартийТоваровДляНДС2_4 КАК ДД
		|	ЛЕВОЕ СОЕДИНЕНИЕ Документ.ВнутреннееПотреблениеТоваров КАК Потребление
		|		ПО Потребление.Ссылка = ДД.Регистратор
		//++ НЕ УТ
		|	ЛЕВОЕ СОЕДИНЕНИЕ Документ.ПередачаМатериаловВПроизводство КАК ПередачаМатериалов
		|		ПО ПередачаМатериалов.Ссылка = ДД.Регистратор
		|	ЛЕВОЕ СОЕДИНЕНИЕ Документ.ВозвратМатериаловИзПроизводства КАК ВозвратМатериалов
		|		ПО ВозвратМатериалов.Ссылка = ДД.Регистратор
		//-- НЕ УТ
		|	ЛЕВОЕ СОЕДИНЕНИЕ Документ.ПрочееОприходованиеТоваров КАК Сторно
		|		ПО Сторно.Ссылка = ДД.Регистратор
		|	ЛЕВОЕ СОЕДИНЕНИЕ ПланВидовХарактеристик.СтатьиРасходов КАК Статья
		|		ПО Статья.Ссылка = ДД.СтатьяРасходовАктивов
		|	ЛЕВОЕ СОЕДИНЕНИЕ ПланВидовХарактеристик.СтатьиАктивовПассивов КАК СтатьяАктивов
		|		ПО СтатьяАктивов.Ссылка = ДД.СтатьяРасходовАктивов
		|	ЛЕВОЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК Аналитика
		|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Склады КАК Склады
		|		ПО Аналитика.МестоХранения = Склады.Ссылка
		|			ПО Аналитика.Ссылка = ДД.КорАналитикаУчетаНоменклатуры
		|ГДЕ
		|	НЕ ДД.СлужебноеВидДвиженияПриход
        |	И (Статья.ВариантРаспределенияРасходовРегл = ЗНАЧЕНИЕ(Перечисление.ВариантыРаспределенияРасходов.НаВнеоборотныеАктивы)
        |			И Статья.ВидЦенности = ЗНАЧЕНИЕ(Перечисление.ВидыЦенностей.ОС))
		|	И (ДД.НДС <> 0 ИЛИ ДД.НДСУпр <> 0)
        |	И ДД.НалоговоеНазначение <> ЗНАЧЕНИЕ(Справочник.НалоговыеНазначенияАктивовИЗатрат.ПустаяСсылка)
		|	И НЕ ДД.Регистратор ССЫЛКА Документ.ВозвратТоваровПоставщику
		|	И НЕ ДД.Регистратор ССЫЛКА Документ.ВозвратТоваровМеждуОрганизациями
		|СГРУППИРОВАТЬ ПО
		|	ДД.Период,
		|	ДД.Регистратор,
		|	ДД.Организация,
		|	ВЫБОР
		|		КОГДА НЕ Потребление.Подразделение ЕСТЬ NULL
		|			ТОГДА Потребление.Подразделение
		//++ НЕ УТ
		|		КОГДА НЕ ПередачаМатериалов.Подразделение ЕСТЬ NULL
		|			ТОГДА ПередачаМатериалов.Подразделение
		|		КОГДА НЕ ВозвратМатериалов.Подразделение ЕСТЬ NULL
		|			ТОГДА ВозвратМатериалов.Подразделение
		//-- НЕ УТ
		|		КОГДА НЕ Сторно.Подразделение ЕСТЬ NULL
		|			ТОГДА Сторно.Подразделение
		|		КОГДА Аналитика.ТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Подразделение)
		|			ТОГДА Аналитика.Подразделение
		|		ИНАЧЕ ЕСТЬNULL(Склады.Подразделение, ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяСсылка))
		|	КОНЕЦ,
		|	ДД.СтатьяРасходовАктивов,
		|	ДД.АналитикаРасходов,
		|	ДД.АналитикаАктивов,
		|	ДД.ДокументПоступления,
		|	ДД.АналитикаУчетаДокументаПоступления,
		|	ЕСТЬNULL(Потребление.НаправлениеДеятельности, ДД.НаправлениеДеятельности),
        |	(ВЫБОР
        |		КОГДА ДД.КорНалоговоеНазначение = ЗНАЧЕНИЕ(Справочник.НалоговыеНазначенияАктивовИЗатрат.ПустаяСсылка)
        |			ТОГДА ДД.НалоговоеНазначение
        |		ИНАЧЕ ДД.КорНалоговоеНазначение КОНЕЦ),
        |	ДД.НалоговоеНазначение
		|";
КонецФункции

Функция ТекстПоступленияПартийПрочихРасходовИзПостатейныхПроизводственныхЗатрат()
	Возврат "
		|ВЫБРАТЬ
		|	""ТекстПоступленияПартийПрочихРасходовИзПостатейныхПроизводственныхЗатрат"" КАК ЗапросИсточник,
		|	10 КАК Приоритет,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение) КАК ТипЗаписи,
		|	ИСТИНА КАК РасчетЗавершен,
		|	ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход) КАК ВидДвижения,
		|	ДД.Период,
		|	ДД.Регистратор,
		|	ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПустаяСсылка) КАК РазделУчета,
		|	ДД.Организация,
		|	ВЫБОР КОГДА ДД.Подразделение <> ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяСсылка)
		|		ТОГДА ДД.Подразделение
		|		ИНАЧЕ ДД.АналитикаСписанияНДС
		|	КОНЕЦ КАК Подразделение,
		|	ДД.СтатьяРасходовАктивов КАК СтатьяРасходов,
		|	ДД.АналитикаРасходов,
		|	ДД.АналитикаАктивов КАК АналитикаАктивовПассивов,
		|	ДД.ДокументПоступления КАК ДокументПоступленияРасходов,
		|	ДД.АналитикаУчетаДокументаПоступления КАК АналитикаУчетаПартий,
		|	ДД.НаправлениеДеятельности,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаУчетаНоменклатуры,
        |	ВЫБОР
        |		КОГДА ДД.КорНалоговоеНазначение = ЗНАЧЕНИЕ(Справочник.НалоговыеНазначенияАктивовИЗатрат.ПустаяСсылка)
        |			ТОГДА ДД.НалоговоеНазначение
        |		ИНАЧЕ ДД.КорНалоговоеНазначение
        |	КОНЕЦ КАК НалоговоеНазначение,
		|	0 КАК Стоимость,
		|	0 КАК СтоимостьБезНДС,
		|	СУММА(ДД.СтоимостьБезНДС) КАК СтоимостьРегл,
		|	СУММА(ДД.НДС) КАК НДСРегл,
		|	СУММА(ДД.НДСУпр) КАК НДСУпр,
		|	0 КАК ПостояннаяРазница,
		|	0 КАК ВременнаяРазница,
        |	ДД.НалоговоеНазначение КАК НалоговоеНазначениеСписания
		|ИЗ
        |	ВТКэшРасчетныеОборотыДетализацияПартийТоваровДляНДС2_4 КАК ДД
		|ГДЕ
		|	ДД.СлужебноеВидДвиженияПриход
		|	И (ДД.СтоимостьБезНДС <> 0 ИЛИ ДД.НДС <> 0 ИЛИ ДД.НДСУпр <> 0)
		|	И ДД.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходы)
		|	И (ДД.СтатьяРасходовАктивов.ВариантРаспределенияРасходовУпр = ЗНАЧЕНИЕ(Перечисление.ВариантыРаспределенияРасходов.НаПроизводственныеЗатраты)
		|		 ИЛИ ДД.СтатьяРасходовАктивов.ВариантРаспределенияРасходовРегл = ЗНАЧЕНИЕ(Перечисление.ВариантыРаспределенияРасходов.НаПроизводственныеЗатраты))
		|
		|СГРУППИРОВАТЬ ПО
		|	ДД.Период,
		|	ДД.Регистратор,
		|	ДД.Организация,
		|	ВЫБОР КОГДА ДД.Подразделение <> ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяСсылка)
		|		ТОГДА ДД.Подразделение
		|		ИНАЧЕ ДД.АналитикаСписанияНДС
		|	КОНЕЦ,
		|	ДД.СтатьяРасходовАктивов,
		|	ДД.АналитикаРасходов,
		|	ДД.АналитикаАктивов,
		|	ДД.ДокументПоступления,
		|	ДД.АналитикаУчетаДокументаПоступления,
		|	ДД.НаправлениеДеятельности,
        |	ДД.НалоговоеНазначение,
        |	(ВЫБОР
        |		КОГДА ДД.КорНалоговоеНазначение = ЗНАЧЕНИЕ(Справочник.НалоговыеНазначенияАктивовИЗатрат.ПустаяСсылка)
        |			ТОГДА ДД.НалоговоеНазначение
        |		ИНАЧЕ ДД.КорНалоговоеНазначение КОНЕЦ)
		|";
КонецФункции

Функция ТекстПоступленияПартийПрочихРасходовИзПриходовСебестоимости2_4()// использует ПриходыТоваровНДС
	Возврат "
		|ВЫБРАТЬ
		|	""ТекстПоступленияПартийПрочихРасходовИзПриходовСебестоимости2_4"" КАК ЗапросИсточник,
		|	10 КАК Приоритет,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение) КАК ТипЗаписи,
		|	ИСТИНА КАК РасчетЗавершен,
		|	ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход) КАК ВидДвижения,
		|	ДД.Период,
		|	ДД.Регистратор,
		|	ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПустаяСсылка) КАК РазделУчета,
		|	ДД.Организация,
		|	ВЫБОР
		|		КОГДА НЕ Потребление.Подразделение ЕСТЬ NULL
		|			ТОГДА Потребление.Подразделение
		//++ НЕ УТ
		|		КОГДА НЕ ПередачаМатериалов.Подразделение ЕСТЬ NULL
		|			ТОГДА ПередачаМатериалов.Подразделение
		|		КОГДА НЕ ВозвратМатериалов.Подразделение ЕСТЬ NULL
		|			ТОГДА ВозвратМатериалов.Подразделение
		//-- НЕ УТ
		|		КОГДА НЕ СторноТоваров.Подразделение ЕСТЬ NULL
		|			ТОГДА СторноТоваров.Подразделение
		|		ИНАЧЕ ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяСсылка)
		|	КОНЕЦ КАК Подразделение,
		|	НЕОПРЕДЕЛЕНО КАК СтатьяРасходов,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаРасходов,
		|	НЕОПРЕДЕЛЕНО КАК АналитикаАктивовПассивов,
		|	ДД.ДокументПоступления КАК ДокументПоступленияРасходов,
		|	ДД.АналитикаУчетаДокументаПоступления КАК АналитикаУчетаПартий,
		|	ЕСТЬNULL(Потребление.НаправлениеДеятельности, ДД.НаправлениеДеятельности) КАК НаправлениеДеятельности,
		|	ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаНоменклатуры.ПустаяСсылка) КАК АналитикаУчетаНоменклатуры,
        |	ДД.НалоговоеНазначение,
		|	0 КАК Стоимость,
		|	0 КАК СтоимостьБезНДС,
		|	ДД.СтоимостьБезНДС КАК СтоимостьРегл,
		|	ДД.НДС КАК НДСРегл,
		|	ДД.НДСУпр КАК НДСУпр,
		|	0 КАК ПостояннаяРазница,
		|	0 КАК ВременнаяРазница,
        |	ЗНАЧЕНИЕ(Справочник.НалоговыеНазначенияАктивовИЗатрат.ПустаяСсылка) КАК НалоговоеНазначение
		|ИЗ
		|	ПриходыТоваровНДС2_4 КАК ДД
		|	ЛЕВОЕ СОЕДИНЕНИЕ Документ.ВнутреннееПотреблениеТоваров КАК Потребление
		|		ПО Потребление.Ссылка = ДД.Регистратор
		//++ НЕ УТ
		|	ЛЕВОЕ СОЕДИНЕНИЕ Документ.ПередачаМатериаловВПроизводство КАК ПередачаМатериалов
		|		ПО ПередачаМатериалов.Ссылка = ДД.Регистратор
		|	ЛЕВОЕ СОЕДИНЕНИЕ Документ.ВозвратМатериаловИзПроизводства КАК ВозвратМатериалов
		|		ПО ВозвратМатериалов.Ссылка = ДД.Регистратор
		//-- НЕ УТ
		|	ЛЕВОЕ СОЕДИНЕНИЕ Документ.ПрочееОприходованиеТоваров КАК СторноТоваров
		|		ПО СторноТоваров.Ссылка = ДД.Регистратор
		|
		|ГДЕ
        |	ЛОЖЬ 
		|	И ДД.ТипЗаписи В (
		|			ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходы),
		|			ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыСПартией),
		|			ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыБезПартии))
		|";
КонецФункции

#КонецОбласти


#Область ПроцедурыЭтапа_ПодготовкаДанныхДляНДСУсловныеПродажи

// Выборка данных

Процедура ПолучитьДанныеДляНДСУсловныеПродажи(ПараметрыРасчета)
    
	РасчетСебестоимостиПрикладныеАлгоритмы.ПолучитьДанныеЭтапаРасчета(
		ПараметрыРасчета,
		ТекстЗапросаДляНДСУсловныеПродажи(ПараметрыРасчета));
		
	Если ПараметрыРасчета.РежимОтладки Тогда	
		ВТКэшРасчетныеОборотыДетализацияПартийТоваровДляНДС    = ОбщегоНазначенияУТ.ПоказатьВременнуюТаблицу(ПараметрыРасчета.МенеджерВременныхТаблиц, "ВТКэшРасчетныеОборотыДетализацияПартийТоваровДляНДС");
		ВТКэшРасчетныеОборотыДетализацияПартийТоваровДляНДС2_4 = ОбщегоНазначенияУТ.ПоказатьВременнуюТаблицу(ПараметрыРасчета.МенеджерВременныхТаблиц, "ВТКэшРасчетныеОборотыДетализацияПартийТоваровДляНДС2_4");
		ВТКэшРасчетныеОборотыПартииПрочихРасходов              = ОбщегоНазначенияУТ.ПоказатьВременнуюТаблицу(ПараметрыРасчета.МенеджерВременныхТаблиц, "ВТКэшРасчетныеОборотыПартииПрочихРасходов");
		Данные                                                 = ОбщегоНазначенияУТ.ПоказатьВременнуюТаблицу(ПараметрыРасчета.МенеджерВременныхТаблиц, "Данные");
	КонецЕсли;
	
	РаспределитьУсловныеПродажиПоНомерамГТД(ПараметрыРасчета);

КонецПроцедуры

Процедура РаспределитьУсловныеПродажиПоНомерамГТД(ПараметрыРасчета)

	ТекстЗапросаВидыЗапасов = "
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	Данные.Регистратор КАК Регистратор
	|ПОМЕСТИТЬ ДанныеРегистраторы
	|   ИЗ Данные
	|;
	|////////////////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ 
	|	ДокументыВидыЗапасов.Регистратор КАК Регистратор,
	|	ДокументыВидыЗапасов.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
	|	ЕСТЬNULL(АналитикаНоменклатуры.Номенклатура, НЕОПРЕДЕЛЕНО) КАК Номенклатура,
	|	ЕСТЬNULL(АналитикаНоменклатуры.Характеристика, НЕОПРЕДЕЛЕНО) КАК Характеристика,
	|	ДокументыВидыЗапасов.НомерГТД КАК НомерГТД,
	|	СУММА(ДокументыВидыЗапасов.Количество) КАК Количество
	|ИЗ 
	|(
	|
	|";
	
	ШаблонТекстаЗапросаДокументВидыЗапасов = "
	|ВЫБРАТЬ 
	|	ДокументВидыЗапасов.Ссылка КАК Регистратор,
	|	ДокументВидыЗапасов.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
	|	ДокументВидыЗапасов.НомерГТД КАК НомерГТД,
	|	ДокументВидыЗапасов.Количество КАК Количество
	|ИЗ                                          
	|	Документ.РеализацияТоваровУслуг.ВидыЗапасов КАК ДокументВидыЗапасов
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ ДанныеРегистраторы КАК ДанныеРегистраторы
	|   	ПО ДанныеРегистраторы.Регистратор = ДокументВидыЗапасов.Ссылка
	|";                            
	
	ПервыйДокумент = Истина;
	Для Каждого МетаданныеДокумента Из Метаданные.Документы Цикл
		Если МетаданныеДокумента.ТабличныеЧасти.Найти("ВидыЗапасов") <> Неопределено 
			И МетаданныеДокумента.ТабличныеЧасти.ВидыЗапасов.Реквизиты.Найти("НомерГТД") <> Неопределено
			Тогда
			
			Если НЕ ПервыйДокумент Тогда
				ТекстЗапросаВидыЗапасов = ТекстЗапросаВидыЗапасов + " ОБЪЕДИНИТЬ ВСЕ ";
			Иначе	
				ПервыйДокумент = Ложь;
			КонецЕсли;		
			
			ТекстЗапросаВидыЗапасов = ТекстЗапросаВидыЗапасов 
									+ СтрЗаменить(ШаблонТекстаЗапросаДокументВидыЗапасов, "Документ.РеализацияТоваровУслуг", МетаданныеДокумента.ПолноеИмя());
			
		КонецЕсли;	
	КонецЦикла;
	
	ТекстЗапросаВидыЗапасов = ТекстЗапросаВидыЗапасов + " 
	|) КАК ДокументыВидыЗапасов  
	|	ЛЕВОЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК АналитикаНоменклатуры
	|		ПО АналитикаНоменклатуры.Ссылка = ДокументыВидыЗапасов.АналитикаУчетаНоменклатуры
	|СГРУППИРОВАТЬ ПО
	|	ДокументыВидыЗапасов.Регистратор,
	|	ДокументыВидыЗапасов.АналитикаУчетаНоменклатуры,
	|	ЕСТЬNULL(АналитикаНоменклатуры.Номенклатура, НЕОПРЕДЕЛЕНО),
	|	ЕСТЬNULL(АналитикаНоменклатуры.Характеристика, НЕОПРЕДЕЛЕНО),
	|	ДокументыВидыЗапасов.НомерГТД
	|УПОРЯДОЧИТЬ ПО
	|	ДокументыВидыЗапасов.Регистратор,
	|	ДокументыВидыЗапасов.АналитикаУчетаНоменклатуры,
	|	ЕСТЬNULL(АналитикаНоменклатуры.Номенклатура, НЕОПРЕДЕЛЕНО),
	|	ЕСТЬNULL(АналитикаНоменклатуры.Характеристика, НЕОПРЕДЕЛЕНО),
	|	ДокументыВидыЗапасов.НомерГТД
	|";
	
	ЗапросВидыЗапасов = Новый Запрос;
	ЗапросВидыЗапасов.МенеджерВременныхТаблиц = ПараметрыРасчета.МенеджерВременныхТаблиц;
	ЗапросВидыЗапасов.Текст = ТекстЗапросаВидыЗапасов;
	
	ТаблицаВидовЗапасов = ЗапросВидыЗапасов.Выполнить().Выгрузить();
	ТаблицаВидовЗапасов.Индексы.Добавить("Регистратор, Номенклатура, Характеристика");
	
	ТекстЗапросаТаблицаДанные = "
	|ВЫБРАТЬ 
	|	Данные.ЗапросИсточник КАК ЗапросИсточник,
	|	Данные.Приоритет КАК Приоритет,
	|	Данные.ТипЗаписи КАК ТипЗаписи,
	|	Данные.РасчетЗавершен КАК РасчетЗавершен,
	|	Данные.ВидДвижения КАК ВидДвижения,
	|	Данные.Период КАК Период,
	|	Данные.Регистратор КАК Регистратор,
    |
	|	Данные.РазделУчета КАК РазделУчета,
	|	Данные.Организация КАК Организация,
    |	Данные.ВидУсловнойПродажи КАК ВидУсловнойПродажи,
    |	Данные.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
	|	Данные.Номенклатура КАК Номенклатура,
	|	Данные.Характеристика КАК Характеристика,
	|	Данные.СтавкаНДС КАК СтавкаНДС,
    |	Данные.НалоговоеНазначение КАК НалоговоеНазначение,
    |	Данные.НалоговоеНазначениеПоФакту КАК НалоговоеНазначениеПоФакту,
    |
	|	СУММА(Данные.Количество) КАК Количество,
	|	СУММА(Данные.СтоимостьРегл) КАК СтоимостьРегл,
	|	СУММА(Данные.НДСРегл) КАК НДСРегл,
	|	СУММА(Данные.НДСРеглРучныеКорректировки) КАК НДСРеглРучныеКорректировки,
	|	СУММА(Данные.НДСУпр) КАК НДСУпр,
    |	СУММА(Данные.НДСУпрРучныеКорректировки) КАК НДСУпрРучныеКорректировки,
	|
	|   ЗНАЧЕНИЕ(Справочник.НоменклатураГТД.ПустаяСсылка) КАК НомерГТД,
	|	ЕСТЬNULL(СправочникНоменклатура.НоменклатураГТД, ЗНАЧЕНИЕ(Справочник.НоменклатураГТД.ПустаяСсылка)) КАК НомерГТДПоУмолчанию
	|
	|ИЗ 
	|	Данные КАК Данные 
	|	ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Номенклатура КАК СправочникНоменклатура
	|   	ПО Данные.Номенклатура = СправочникНоменклатура.Ссылка
	|
	|СГРУППИРОВАТЬ ПО  
	|
	|	Данные.ЗапросИсточник,
	|	Данные.Приоритет,
	|	Данные.ТипЗаписи,
	|	Данные.РасчетЗавершен,
	|	Данные.ВидДвижения,
	|	Данные.Период,
	|	Данные.Регистратор,
    |
	|	Данные.РазделУчета,
	|	Данные.Организация,
    |	Данные.ВидУсловнойПродажи,
    |	Данные.АналитикаУчетаНоменклатуры,
	|	Данные.Номенклатура,
	|	Данные.Характеристика,
	|	Данные.СтавкаНДС,
    |	Данные.НалоговоеНазначение,
    |	Данные.НалоговоеНазначениеПоФакту,
	|
	|	ЕСТЬNULL(СправочникНоменклатура.НоменклатураГТД, ЗНАЧЕНИЕ(Справочник.НоменклатураГТД.ПустаяСсылка))
	|
	|";
	
	ЗапросТаблицаДанные = Новый Запрос;
	ЗапросТаблицаДанные.МенеджерВременныхТаблиц = ПараметрыРасчета.МенеджерВременныхТаблиц;
	ЗапросТаблицаДанные.Текст = ТекстЗапросаТаблицаДанные;
	
	ТаблицаДанные = ЗапросТаблицаДанные.Выполнить().Выгрузить();
	ТаблицаНовыеДанные = ТаблицаДанные.СкопироватьКолонки(); 

	ПараметрыОтбораВидовЗапасов = Новый Структура("Регистратор, Номенклатура, Характеристика");
	
	Для Каждого СтрокаДанные Из ТаблицаДанные Цикл
		
		Если СтрокаДанные.ЗапросИсточник = "ТекстНДСУсловныеПродажиИзПартийПрочихРасходов" Тогда 
			СтрокаНовыеДанные = ТаблицаНовыеДанные.Добавить();
			ЗаполнитьЗначенияСвойств(СтрокаНовыеДанные, СтрокаДанные); 
			Продолжить;
		КонецЕсли;	
		
		ПараметрыОтбораВидовЗапасов.Регистратор     = СтрокаДанные.Регистратор;  
		ПараметрыОтбораВидовЗапасов.Номенклатура 	= СтрокаДанные.Номенклатура;
		ПараметрыОтбораВидовЗапасов.Характеристика 	= СтрокаДанные.Характеристика;
		СтрокиВидовЗапасов = ТаблицаВидовЗапасов.НайтиСтроки(ПараметрыОтбораВидовЗапасов);
		ОбщееКоличество = 0;
		Для Каждого СтрокаВидовЗапасов Из СтрокиВидовЗапасов Цикл
			ОбщееКоличество = ОбщееКоличество + СтрокаВидовЗапасов.Количество;			
		КонецЦикла;             
		Если ОбщееКоличество = 0 Тогда 
			СтрокаНовыеДанные = ТаблицаНовыеДанные.Добавить();
			ЗаполнитьЗначенияСвойств(СтрокаНовыеДанные, СтрокаДанные); 
			СтрокаНовыеДанные.НомерГТД = СтрокаДанные.НомерГТДПоУмолчанию;
			Продолжить;
		КонецЕсли;	
		
		КоличествоКРаспределению 	= ОбщееКоличество;
		СтоимостьРеглКРаспределению = СтрокаДанные.СтоимостьРегл;
		НДСРеглКРаспределению 		= СтрокаДанные.НДСРегл;
		НДСУпрКРаспределению 		= СтрокаДанные.НДСУпр;
		
		Для Каждого СтрокаВидовЗапасов Из СтрокиВидовЗапасов Цикл
			
			СтоимостьРегл 	= ОКР(СтоимостьРеглКРаспределению/КоличествоКРаспределению * СтрокаВидовЗапасов.Количество, 2);
			НДСРегл 		= ОКР(НДСРеглКРаспределению/КоличествоКРаспределению * СтрокаВидовЗапасов.Количество, 2);
			НДСУпр 			= ОКР(НДСУпрКРаспределению/КоличествоКРаспределению * СтрокаВидовЗапасов.Количество, 2);
			
			СтрокаНовыеДанные = ТаблицаНовыеДанные.Добавить();
			ЗаполнитьЗначенияСвойств(СтрокаНовыеДанные, СтрокаДанные); 
			
			СтрокаНовыеДанные.Количество 	= СтрокаВидовЗапасов.Количество;
			СтрокаНовыеДанные.НомерГТД   	= СтрокаВидовЗапасов.НомерГТД;
			СтрокаНовыеДанные.СтоимостьРегл = СтоимостьРегл;
			СтрокаНовыеДанные.НДСРегл 		= НДСРегл;
			СтрокаНовыеДанные.НДСУпр 		= НДСУпр;
			
			
			КоличествоКРаспределению 	= КоличествоКРаспределению - СтрокаВидовЗапасов.Количество;
			СтоимостьРеглКРаспределению	= СтоимостьРеглКРаспределению - СтоимостьРегл;
			НДСРеглКРаспределению 		= НДСРеглКРаспределению - НДСРегл;
			НДСУпрКРаспределению 		= НДСУпрКРаспределению - НДСУпр;
			
		КонецЦикла;
		
	КонецЦикла;  
	
	ТекстЗапросаПомещениеНовыхДанных = "
	|УНИЧТОЖИТЬ Данные
	|;
	|ВЫБРАТЬ 
	|	ТаблицаНовыеДанные.ЗапросИсточник КАК ЗапросИсточник,
	|	ТаблицаНовыеДанные.Приоритет КАК Приоритет,
	|	ТаблицаНовыеДанные.ТипЗаписи КАК ТипЗаписи,
	|	ТаблицаНовыеДанные.РасчетЗавершен КАК РасчетЗавершен,
	|	ТаблицаНовыеДанные.ВидДвижения КАК ВидДвижения,
	|	ТаблицаНовыеДанные.Период КАК Период,
	|	ТаблицаНовыеДанные.Регистратор КАК Регистратор,
    |
	|	ТаблицаНовыеДанные.РазделУчета КАК РазделУчета,
	|	ТаблицаНовыеДанные.Организация КАК Организация,
    |	ТаблицаНовыеДанные.ВидУсловнойПродажи КАК ВидУсловнойПродажи,
    |	ТаблицаНовыеДанные.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
	|	ТаблицаНовыеДанные.Номенклатура КАК Номенклатура,
	|	ТаблицаНовыеДанные.Характеристика КАК Характеристика,
	|	ТаблицаНовыеДанные.СтавкаНДС КАК СтавкаНДС,
    |	ТаблицаНовыеДанные.НалоговоеНазначение КАК НалоговоеНазначение,
    |	ТаблицаНовыеДанные.НалоговоеНазначениеПоФакту КАК НалоговоеНазначениеПоФакту,
	|
    |	ТаблицаНовыеДанные.НомерГТД КАК НомерГТД,
    |
	|	ТаблицаНовыеДанные.Количество КАК Количество,
	|	ТаблицаНовыеДанные.СтоимостьРегл КАК СтоимостьРегл,
	|	ТаблицаНовыеДанные.НДСРегл КАК НДСРегл,
	|	ТаблицаНовыеДанные.НДСРеглРучныеКорректировки КАК НДСРеглРучныеКорректировки,
	|	ТаблицаНовыеДанные.НДСУпр КАК НДСУпр,
    |	ТаблицаНовыеДанные.НДСУпрРучныеКорректировки КАК НДСУпрРучныеКорректировки
	|
	|ПОМЕСТИТЬ Данные 
	|
	|ИЗ 
	|	&ТаблицаНовыеДанные КАК ТаблицаНовыеДанные
	|";     
	
	ЗапросПомещениеНовыхДанных = Новый Запрос;
	ЗапросПомещениеНовыхДанных.МенеджерВременныхТаблиц = ПараметрыРасчета.МенеджерВременныхТаблиц;
	ЗапросПомещениеНовыхДанных.Текст = ТекстЗапросаПомещениеНовыхДанных;
	ЗапросПомещениеНовыхДанных.УстановитьПараметр("ТаблицаНовыеДанные", ТаблицаНовыеДанные);
	
	ЗапросПомещениеНовыхДанных.Выполнить();
	
КонецПроцедуры

// Тексты запросов

// ... общий

Функция ТекстЗапросаДляНДСУсловныеПродажи(ПараметрыРасчета = Неопределено) Экспорт
	
	ТекстЗапроса = ""
		// выборка данных
		+ ТекстОписаниеДанныхДляНДСУсловныеПродажи() //вт Данные
		+ ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстНДСУсловныеПродажиИзПартийНДС()
        + ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстНДСУсловныеПродажиИзПартийНДС2_4()
        + ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении() + ТекстНДСУсловныеПродажиИзПартийПрочихРасходов()
		+ "";
	
	Возврат ТекстЗапроса;
	
КонецФункции

// ... описания данных

Функция ТекстОписаниеДанныхДляНДСУсловныеПродажи()
	Возврат "
		|ВЫБРАТЬ ПЕРВЫЕ 0
		|	ВЫРАЗИТЬ("""" КАК СТРОКА(80)) КАК ЗапросИсточник,
		|	0 КАК Приоритет,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ПустаяСсылка) КАК ТипЗаписи,
		|	ЛОЖЬ КАК РасчетЗавершен,
		|	ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход) КАК ВидДвижения,
		|	ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0) КАК Период,
		|	ДД.Регистратор,
        |
		|	ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПустаяСсылка) КАК РазделУчета,
		|	ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка) КАК Организация,
        |	ЗНАЧЕНИЕ(Перечисление.ВидУсловнойПродажи.ПустаяСсылка) КАК ВидУсловнойПродажи,
        |	ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаНоменклатуры.ПустаяСсылка) КАК АналитикаУчетаНоменклатуры,
		|	ДД.Номенклатура,
		|	ДД.Характеристика,
		|	ДД.СтавкаНДС,
        |	ЗНАЧЕНИЕ(Справочник.НалоговыеНазначенияАктивовИЗатрат.ПустаяСсылка) КАК НалоговоеНазначение,
        |	ЗНАЧЕНИЕ(Справочник.НалоговыеНазначенияАктивовИЗатрат.ПустаяСсылка) КАК НалоговоеНазначениеПоФакту,
        |
		|	0 КАК Количество,
		|	0 КАК СтоимостьРегл,
		|	0 КАК НДСРегл,
		|	0 КАК НДСРеглРучныеКорректировки,
		|	0 КАК НДСУпр,
        |	0 КАК НДСУпрРучныеКорректировки
		|//ВоВременнуюТаблицу
		|ИЗ
		|	РегистрНакопления.НДСУсловныеПродажи КАК ДД
		|";
КонецФункции

// ... выборки данных

Функция ТекстНДСУсловныеПродажиИзПартийНДС()
	Возврат "
		|ВЫБРАТЬ
		|	""ТекстНДСУсловныеПродажиИзПартийНДС"" КАК ЗапросИсточник,
		|	10 КАК Приоритет,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение) КАК ТипЗаписи,
		|	ИСТИНА КАК РасчетЗавершен,
		|	ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход) КАК ВидДвижения,
		|	ДД.Период,
		|	ДД.Регистратор,
        |
		|	ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПустаяСсылка) КАК РазделУчета,
		|	ДД.Организация,
		|	ВЫБОР
		|		КОГДА ДД.НалоговоеНазначение.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ВидыДеятельностиНДС.Необлагаемая)		
		|	          И ДД.КорНалоговоеНазначение.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ВидыДеятельностиНДС.Облагаемая)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ВидУсловнойПродажи.ПредполагаемоеВосстановлениеНДС)
		|		КОГДА (ДД.НалоговоеНазначение.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ВидыДеятельностиНДС.Облагаемая) И ДД.КорНалоговоеНазначение.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ВидыДеятельностиНДС.Необлагаемая))
		|		      ИЛИ (ДД.НалоговоеНазначение.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ВидыДеятельностиНДС.ПропорциональноОблагаемая) И ДД.КорНалоговоеНазначение = ЗНАЧЕНИЕ(Справочник.НалоговыеНазначенияАктивовИЗатрат.НДС_НеоблагаемаяНеХозДеятельность))
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ВидУсловнойПродажи.ПредполагаемаяУсловнаяПродажа)
		|		ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.ВидУсловнойПродажи.ПустаяСсылка)
		|	КОНЕЦ КАК ВидУсловнойПродажи,
        |	ДД.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
		|	АналитикаНоменклатуры.Номенклатура КАК Номенклатура,
		|	АналитикаНоменклатуры.Характеристика КАК Характеристика,
        |   АналитикаПартий.СтавкаНДС КАК СтавкаНДС,
		|	ДД.НалоговоеНазначение КАК НалоговоеНазначение,
        |	ДД.КорНалоговоеНазначение КАК НалоговоеНазначениеПоФакту,
        |
		|	СУММА(ДД.Количество) КАК Количество,
        |   СУММА(
        |       ВЫБОР 
        |           КОГДА АналитикаПартий.СтавкаНДС = ЗНАЧЕНИЕ(Справочник.СтавкиНДС.ПустаяСсылка)
        |               ТОГДА ДД.СтоимостьБезНДС
        |           КОГДА АналитикаПартий.СтавкаНДС.Ставка = 0
        |               ТОГДА ДД.СтоимостьБезНДС
        |           ИНАЧЕ
        |               ВЫРАЗИТЬ(ДД.НДС/(АналитикаПартий.СтавкаНДС.Ставка/100) КАК ЧИСЛО(31,2))  
        |           КОНЕЦ
        |   ) КАК СтоимостьРегл,
		|	СУММА(ДД.НДС) КАК НДСРегл,
        |	0 КАК НДСРеглРучныеКорректировки,
		|	СУММА(ДД.НДСУпр) КАК НДСУпр,
        |	0 КАК НДСУпрРучныеКорректировки
		|ИЗ
        |	ВТКэшРасчетныеОборотыДетализацияПартийТоваровДляНДС КАК ДД
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК АналитикаНоменклатуры
		|		ПО АналитикаНоменклатуры.Ссылка = ДД.АналитикаУчетаНоменклатуры
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаПартий КАК АналитикаПартий
		|		ПО АналитикаПартий.Ссылка = ДД.АналитикаУчетаПартий
		|ГДЕ 
        |	НЕ ДД.СлужебноеВидДвиженияПриход
        |	И ДД.НДС <> 0
        |	И ДД.КорНалоговоеНазначение <> ЗНАЧЕНИЕ(Справочник.НалоговыеНазначенияАктивовИЗатрат.ПустаяСсылка)
        |	И ДД.НалоговоеНазначение <> ДД.КорНалоговоеНазначение
		|	И ((ДД.НалоговоеНазначение.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ВидыДеятельностиНДС.Необлагаемая) И ДД.КорНалоговоеНазначение.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ВидыДеятельностиНДС.Облагаемая))
		|	    ИЛИ ДД.НалоговоеНазначение.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ВидыДеятельностиНДС.Облагаемая) И ДД.КорНалоговоеНазначение.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ВидыДеятельностиНДС.Необлагаемая)
		|		ИЛИ (ДД.НалоговоеНазначение.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ВидыДеятельностиНДС.ПропорциональноОблагаемая) И ДД.КорНалоговоеНазначение = ЗНАЧЕНИЕ(Справочник.НалоговыеНазначенияАктивовИЗатрат.НДС_НеоблагаемаяНеХозДеятельность))
        |   )
		|СГРУППИРОВАТЬ ПО
		|	ДД.Период,
		|	ДД.Регистратор,
		|	ДД.Организация,
		|	ВЫБОР
		|		КОГДА ДД.НалоговоеНазначение.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ВидыДеятельностиНДС.Необлагаемая)		
		|	          И ДД.КорНалоговоеНазначение.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ВидыДеятельностиНДС.Облагаемая)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ВидУсловнойПродажи.ПредполагаемоеВосстановлениеНДС)
		|		КОГДА (ДД.НалоговоеНазначение.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ВидыДеятельностиНДС.Облагаемая) И ДД.КорНалоговоеНазначение.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ВидыДеятельностиНДС.Необлагаемая))
		|		      ИЛИ (ДД.НалоговоеНазначение.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ВидыДеятельностиНДС.ПропорциональноОблагаемая) И ДД.КорНалоговоеНазначение = ЗНАЧЕНИЕ(Справочник.НалоговыеНазначенияАктивовИЗатрат.НДС_НеоблагаемаяНеХозДеятельность))
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ВидУсловнойПродажи.ПредполагаемаяУсловнаяПродажа)
		|		ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.ВидУсловнойПродажи.ПустаяСсылка)
		|	КОНЕЦ,      
        |	ДД.АналитикаУчетаНоменклатуры,
		|	АналитикаНоменклатуры.Номенклатура,
		|	АналитикаНоменклатуры.Характеристика,
        |   АналитикаПартий.СтавкаНДС,
		|	ДД.НалоговоеНазначение,
        |	ДД.КорНалоговоеНазначение
		|";
    
КонецФункции

Функция ТекстНДСУсловныеПродажиИзПартийНДС2_4()
	Возврат "
		|ВЫБРАТЬ
		|	""ТекстНДСУсловныеПродажиИзПартийНДС2_4"" КАК ЗапросИсточник,
		|	10 КАК Приоритет,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение) КАК ТипЗаписи,
		|	ИСТИНА КАК РасчетЗавершен,
		|	ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход) КАК ВидДвижения,
		|	ДД.Период,
		|	ДД.Регистратор,
        |
		|	ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПустаяСсылка) КАК РазделУчета,
		|	ДД.Организация,
		|	ВЫБОР
		|		КОГДА ДД.НалоговоеНазначение.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ВидыДеятельностиНДС.Необлагаемая)		
		|	          И ДД.КорНалоговоеНазначение.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ВидыДеятельностиНДС.Облагаемая)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ВидУсловнойПродажи.ПредполагаемоеВосстановлениеНДС)
		|		КОГДА (ДД.НалоговоеНазначение.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ВидыДеятельностиНДС.Облагаемая) И ДД.КорНалоговоеНазначение.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ВидыДеятельностиНДС.Необлагаемая))
		|		      ИЛИ (ДД.НалоговоеНазначение.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ВидыДеятельностиНДС.ПропорциональноОблагаемая) И ДД.КорНалоговоеНазначение = ЗНАЧЕНИЕ(Справочник.НалоговыеНазначенияАктивовИЗатрат.НДС_НеоблагаемаяНеХозДеятельность))
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ВидУсловнойПродажи.ПредполагаемаяУсловнаяПродажа)
		|		ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.ВидУсловнойПродажи.ПустаяСсылка)
		|	КОНЕЦ КАК ВидУсловнойПродажи,
        |	ДД.КорАналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
		|	АналитикаНоменклатуры.Номенклатура КАК Номенклатура,
		|	АналитикаНоменклатуры.Характеристика КАК Характеристика,
        |   АналитикаПартий.СтавкаНДС КАК СтавкаНДС,
		|	ДД.НалоговоеНазначение КАК НалоговоеНазначение,
        |	ДД.КорНалоговоеНазначение КАК НалоговоеНазначениеПоФакту,
        |
		|	0 КАК Количество,
        |   СУММА(
        |       ВЫБОР 
        |           КОГДА АналитикаПартий.СтавкаНДС = ЗНАЧЕНИЕ(Справочник.СтавкиНДС.ПустаяСсылка)
        |               ТОГДА ДД.СтоимостьБезНДС
        |           КОГДА АналитикаПартий.СтавкаНДС.Ставка = 0
        |               ТОГДА ДД.СтоимостьБезНДС
        |           ИНАЧЕ
        |               ВЫРАЗИТЬ(ДД.НДС/(АналитикаПартий.СтавкаНДС.Ставка/100) КАК ЧИСЛО(31,2))  
        |           КОНЕЦ
        |   ) КАК СтоимостьРегл,
		|	СУММА(ДД.НДС) КАК НДСРегл,
        |	0 КАК НДСРеглРучныеКорректировки,
		|	СУММА(ДД.НДСУпр) КАК НДСУпр,
        |	0 КАК НДСУпрРучныеКорректировки
		|ИЗ
        |	ВТКэшРасчетныеОборотыДетализацияПартийТоваровДляНДС2_4 КАК ДД
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаПартий КАК АналитикаПартий
        |		ПО АналитикаПартий.Ссылка = ДД.АналитикаУчетаДокументаПоступления
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК АналитикаНоменклатуры
		|		ПО АналитикаНоменклатуры.Ссылка = ДД.КорАналитикаУчетаНоменклатуры
        |
		|ГДЕ 
        |	НЕ ДД.СлужебноеВидДвиженияПриход
        |	И ДД.НДС <> 0
        |	И ДД.КорНалоговоеНазначение <> ЗНАЧЕНИЕ(Справочник.НалоговыеНазначенияАктивовИЗатрат.ПустаяСсылка)
        |	И ДД.НалоговоеНазначение <> ДД.КорНалоговоеНазначение
		|	И ((ДД.НалоговоеНазначение.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ВидыДеятельностиНДС.Необлагаемая) И ДД.КорНалоговоеНазначение.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ВидыДеятельностиНДС.Облагаемая))
		|	    ИЛИ ДД.НалоговоеНазначение.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ВидыДеятельностиНДС.Облагаемая) И ДД.КорНалоговоеНазначение.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ВидыДеятельностиНДС.Необлагаемая)
		|		ИЛИ (ДД.НалоговоеНазначение.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ВидыДеятельностиНДС.ПропорциональноОблагаемая) И ДД.КорНалоговоеНазначение = ЗНАЧЕНИЕ(Справочник.НалоговыеНазначенияАктивовИЗатрат.НДС_НеоблагаемаяНеХозДеятельность))
        |   )
		|СГРУППИРОВАТЬ ПО
		|	ДД.Период,
		|	ДД.Регистратор,
		|	ДД.Организация,
		|	ВЫБОР
		|		КОГДА ДД.НалоговоеНазначение.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ВидыДеятельностиНДС.Необлагаемая)		
		|	          И ДД.КорНалоговоеНазначение.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ВидыДеятельностиНДС.Облагаемая)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ВидУсловнойПродажи.ПредполагаемоеВосстановлениеНДС)
		|		КОГДА (ДД.НалоговоеНазначение.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ВидыДеятельностиНДС.Облагаемая) И ДД.КорНалоговоеНазначение.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ВидыДеятельностиНДС.Необлагаемая))
		|		      ИЛИ (ДД.НалоговоеНазначение.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ВидыДеятельностиНДС.ПропорциональноОблагаемая) И ДД.КорНалоговоеНазначение = ЗНАЧЕНИЕ(Справочник.НалоговыеНазначенияАктивовИЗатрат.НДС_НеоблагаемаяНеХозДеятельность))
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ВидУсловнойПродажи.ПредполагаемаяУсловнаяПродажа)
		|		ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.ВидУсловнойПродажи.ПустаяСсылка)
		|	КОНЕЦ,                
        |	ДД.КорАналитикаУчетаНоменклатуры,
		|	АналитикаНоменклатуры.Номенклатура,
		|	АналитикаНоменклатуры.Характеристика,
        |   АналитикаПартий.СтавкаНДС,
		|	ДД.НалоговоеНазначение,
        |	ДД.КорНалоговоеНазначение
		|";
    
КонецФункции

Функция ТекстНДСУсловныеПродажиИзПартийПрочихРасходов()
	Возврат "
		|ВЫБРАТЬ
		|	""ТекстНДСУсловныеПродажиИзПартийПрочихРасходов"" КАК ЗапросИсточник,
		|	10 КАК Приоритет,
		|	ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение) КАК ТипЗаписи,
		|	ИСТИНА КАК РасчетЗавершен,
		|	ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход) КАК ВидДвижения,
		|	ДД.Период,
		|	ДД.Регистратор,
        |
		|	ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПустаяСсылка) КАК РазделУчета,
		|	ДД.Организация,
		|	ВЫБОР
		|		КОГДА ДД.НалоговоеНазначение.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ВидыДеятельностиНДС.Необлагаемая)		
		|	          И ДД.НалоговоеНазначениеСписания.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ВидыДеятельностиНДС.Облагаемая)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ВидУсловнойПродажи.ПредполагаемоеВосстановлениеНДС)
		|		КОГДА (ДД.НалоговоеНазначение.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ВидыДеятельностиНДС.Облагаемая) И ДД.НалоговоеНазначениеСписания.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ВидыДеятельностиНДС.Необлагаемая))
		|		      ИЛИ (ДД.НалоговоеНазначение.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ВидыДеятельностиНДС.ПропорциональноОблагаемая) И ДД.НалоговоеНазначениеСписания = ЗНАЧЕНИЕ(Справочник.НалоговыеНазначенияАктивовИЗатрат.НДС_НеоблагаемаяНеХозДеятельность))
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ВидУсловнойПродажи.ПредполагаемаяУсловнаяПродажа)
		|		ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.ВидУсловнойПродажи.ПустаяСсылка)
		|	КОНЕЦ КАК ВидУсловнойПродажи,
        |	ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаНоменклатуры.ПустаяСсылка) КАК АналитикаУчетаНоменклатуры,
		|	ДД.СтатьяРасходов КАК Номенклатура,
		|	ЗНАЧЕНИЕ(Справочник.ХарактеристикиНоменклатуры.ПустаяСсылка) КАК Характеристика,
        |   АналитикаПартий.СтавкаНДС КАК СтавкаНДС,
		|	ДД.НалоговоеНазначение КАК НалоговоеНазначение,
        |	ДД.НалоговоеНазначениеСписания КАК НалоговоеНазначениеПоФакту,
        |
		|	0 КАК Количество,
        |   СУММА(
        |       ВЫБОР 
        |           КОГДА АналитикаПартий.СтавкаНДС = ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка)
        |               ТОГДА ДД.СтоимостьРегл
        |           КОГДА АналитикаПартий.СтавкаНДС.Ставка = 0
        |               ТОГДА ДД.СтоимостьРегл
        |           ИНАЧЕ
        |               ВЫРАЗИТЬ(ДД.НДСРегл/(АналитикаПартий.СтавкаНДС.Ставка/100) КАК ЧИСЛО(31,2))  
        |           КОНЕЦ
        |   ) КАК СтоимостьРегл,
        |	СУММА(ДД.НДСРегл) КАК НДСРегл,
        |	0 КАК НДСРеглРучныеКорректировки,
		|	СУММА(ДД.НДСУпр) КАК НДСУпр,
        |	0 КАК НДСУпрРучныеКорректировки
		|ИЗ
        |	ВТКэшРасчетныеОборотыПартииПрочихРасходов КАК ДД
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаПартий КАК АналитикаПартий
		|		ПО АналитикаПартий.Ссылка = ДД.АналитикаУчетаПартий
		|ГДЕ 
        |	НЕ ДД.СлужебноеВидДвиженияПриход
        |	И ДД.НДСРегл <> 0
        |	И ДД.НалоговоеНазначениеСписания <> ЗНАЧЕНИЕ(Справочник.НалоговыеНазначенияАктивовИЗатрат.ПустаяСсылка)
        |	И ДД.НалоговоеНазначение <> ДД.НалоговоеНазначениеСписания
		|	И ((ДД.НалоговоеНазначение.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ВидыДеятельностиНДС.Необлагаемая) И ДД.НалоговоеНазначениеСписания.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ВидыДеятельностиНДС.Облагаемая))
		|	    ИЛИ ДД.НалоговоеНазначение.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ВидыДеятельностиНДС.Облагаемая) И ДД.НалоговоеНазначениеСписания.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ВидыДеятельностиНДС.Необлагаемая)
		|		ИЛИ (ДД.НалоговоеНазначение.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ВидыДеятельностиНДС.ПропорциональноОблагаемая) И ДД.НалоговоеНазначениеСписания = ЗНАЧЕНИЕ(Справочник.НалоговыеНазначенияАктивовИЗатрат.НДС_НеоблагаемаяНеХозДеятельность))
        |   )
		|СГРУППИРОВАТЬ ПО
		|	ДД.Период,
		|	ДД.Регистратор,
		|	ДД.Организация,
		|	ВЫБОР
		|		КОГДА ДД.НалоговоеНазначение.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ВидыДеятельностиНДС.Необлагаемая)		
		|	          И ДД.НалоговоеНазначениеСписания.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ВидыДеятельностиНДС.Облагаемая)
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ВидУсловнойПродажи.ПредполагаемоеВосстановлениеНДС)
		|		КОГДА (ДД.НалоговоеНазначение.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ВидыДеятельностиНДС.Облагаемая) И ДД.НалоговоеНазначениеСписания.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ВидыДеятельностиНДС.Необлагаемая))
		|		      ИЛИ (ДД.НалоговоеНазначение.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ВидыДеятельностиНДС.ПропорциональноОблагаемая) И ДД.НалоговоеНазначениеСписания = ЗНАЧЕНИЕ(Справочник.НалоговыеНазначенияАктивовИЗатрат.НДС_НеоблагаемаяНеХозДеятельность))
		|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ВидУсловнойПродажи.ПредполагаемаяУсловнаяПродажа)
		|		ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.ВидУсловнойПродажи.ПустаяСсылка)
		|	КОНЕЦ,
		|	ДД.СтатьяРасходов,
        |   АналитикаПартий.СтавкаНДС,
		|	ДД.НалоговоеНазначение,
        |	ДД.НалоговоеНазначениеСписания
		|";
    
КонецФункции

#КонецОбласти


#Область ПроцедурыЭтапов_Контекстные

// Используется для всех вызовов заполнения расчетной партии.
//
Процедура ЗаполнитьРасчетнуюПартию(ПараметрыРасчета, Контекст, РасчетнаяПартия, Расход, Приход, ПартияЗаполнена) Экспорт
	
    Если Контекст = "ПодготовкаДанныхДляУчетаНДС" Тогда
		// Этап 11
		ЗаполнитьРасчетнуюПартиюНДС(ПараметрыРасчета, РасчетнаяПартия, Расход, Приход);
		ПартияЗаполнена = Истина;
    ИначеЕсли Контекст = "ПодготовкаДанныхДляУчетаНДС2_4"
	//++ НЕ УТ
	//-- НЕ УТ
	Тогда
		// Этап 11.2 или 11.3
		ЗаполнитьРасчетнуюПартиюНДС2_4(ПараметрыРасчета, РасчетнаяПартия, Расход, Приход);
		ПартияЗаполнена = Истина;
    ИначеЕсли Контекст = "ПодготовкаДанныхДляУчетаНДС2_4ПоПартиямПрочихРасходов" Тогда
		ЗаполнитьРасчетнуюПартиюПрочихРасходовНДС2_4(ПараметрыРасчета, РасчетнаяПартия, Расход, Приход);
		ПартияЗаполнена = Истина;
	КонецЕсли;
	
КонецПроцедуры

#КонецОбласти

#Область ВключитьИсключитьНДСВСтоимость

// Этап 3.1
Процедура ВключитьИсключитьНДСВСтоимость(ПараметрыРасчета) Экспорт

	РасчетСебестоимостиПротоколРасчета.НачалоЭтапаРасчета(ПараметрыРасчета, "ВключитьИсключитьНДСВСтоимость");
	
	Запрос = Новый Запрос;
	РасчетСебестоимостиКорректировкаСтоимости.ИнициализироватьСвойстваЗапроса(Запрос, ПараметрыРасчета);
	
	Запрос.Текст =
	"ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	Партии.Регистратор,
	|	Партии.Организация,
	|	Партии.АналитикаУчетаНоменклатуры,
	|	Партии.ДокументПоступления,
	|	Партии.ВидЗапасов,
	|	Партии.СтатьяРасходовСписания,
	|	Партии.АналитикаРасходов
	|ПОМЕСТИТЬ РасходыПартий
	|ИЗ
	|	РегистрНакопления.ПартииТоваровОрганизаций КАК Партии
	|ГДЕ
	|	НЕ &ПартионныйУчетВерсии22
	|	И Партии.Период МЕЖДУ &НачалоПериода И &КонецПериода
	|	И Партии.Активность
	|	И Партии.Организация В(&МассивОрганизаций)
	|	И Партии.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	|	И Партии.ВидЗапасов.ТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.Товар)
	|ИНДЕКСИРОВАТЬ ПО
	|	Партии.Регистратор
	|;
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	УчетСебестоимости.Период,
	|	УчетСебестоимости.Регистратор,
	|	УчетСебестоимости.Организация,
	|	УчетСебестоимости.АналитикаУчетаНоменклатуры,
	|	УчетСебестоимости.Партия,
	|	УчетСебестоимости.АналитикаФинансовогоУчета,
    |	УчетСебестоимости.НалоговоеНазначение
	|ПОМЕСТИТЬ ДвиженияСебестоимости
	|ИЗ
	|	ВТКэшРасчетныеОборотыСебестоимостьТоваров КАК УчетСебестоимости
	|ГДЕ
	|	&ПартионныйУчетВерсии22
	|	И НЕ УчетСебестоимости.СлужебноеВидДвиженияПриход
	|	И УчетСебестоимости.Организация В(&ОрганизацииСУчетомПартийНДСВерсии22)
	|	И (УчетСебестоимости.КорРазделУчета <> ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПустаяСсылка)
	|		ИЛИ УчетСебестоимости.СтатьяРасходовСписания <> ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиРасходов.ПустаяСсылка)
	|			И УчетСебестоимости.СтатьяРасходовСписания <> НЕОПРЕДЕЛЕНО)
	|	И УчетСебестоимости.ХозяйственнаяОперация <> ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РеализацияТоваровВДругуюОрганизацию)
	|	И УчетСебестоимости.РазделУчета <> ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПринятыеНаКомиссию)
	|	И УчетСебестоимости.РазделУчета <> ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.МатериалыПринятыеВПереработку)
	|ИНДЕКСИРОВАТЬ ПО
	|	Период,
	|	Регистратор,
	|	Организация,
	|	АналитикаУчетаНоменклатуры,
	|	Партия,
	|	АналитикаФинансовогоУчета,
    |	НалоговоеНазначение
	|;
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	Партии.Период КАК Период,
	|	Партии.Регистратор КАК Регистратор,
	|	Партии.Организация КАК Организация,
	|	Партии.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
	|	Партии.КорАналитикаУчетаНоменклатуры КАК КорАналитикаУчетаНоменклатуры,
	|	Партии.ВидЗапасов КАК ВидЗапасов,
	|	Партии.Партия КАК Партия,
	|	Партии.АналитикаФинансовогоУчета КАК АналитикаФинансовогоУчета,
    |	Партии.КорАналитикаФинансовогоУчета КАК КорАналитикаФинансовогоУчета,
	|	Партии.СтатьяРасходовСписания КАК СтатьяРасходовСписания,
	|	Партии.АналитикаРасходов КАК АналитикаРасходов,
	|	Партии.СтатьяСписанияНДС,
	|	Партии.АналитикаСписанияНДС,
	|	СУММА(Партии.Количество) КАК Количество,
	|	СУММА(
	|		ВЫБОР КОГДА Партии.СтатьяСписанияНДС <> ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиРасходов.ПустаяСсылка)
	|			ТОГДА 0
    |		КОГДА 
	|		    (
	|				(Партии.НалоговоеНазначениеПартии.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ВидыДеятельностиНДС.Облагаемая) 
	|	   				И Партии.НалоговоеНазначение.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ВидыДеятельностиНДС.Необлагаемая))
	|				ИЛИ (Партии.НалоговоеНазначениеПартии.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ВидыДеятельностиНДС.ПропорциональноОблагаемая) 
	|	   				И Партии.НалоговоеНазначение = ЗНАЧЕНИЕ(Справочник.НалоговыеНазначенияАктивовИЗатрат.НДС_НеоблагаемаяНеХозДеятельность))
	|           )
	|		ТОГДА
	|			Партии.НДСРегл
	|
	|
	|		КОГДА Партии.НалоговоеНазначениеПартии.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ВидыДеятельностиНДС.Необлагаемая) 
	|		      И Партии.НалоговоеНазначение.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ВидыДеятельностиНДС.Облагаемая) 
	|		ТОГДА
	|			-Партии.НДСРегл
	|		ИНАЧЕ
	|			0
	|		КОНЕЦ
	|	) КАК НДСРегл,
	|	СУММА(
	|		ВЫБОР КОГДА Партии.СтатьяСписанияНДС <> ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиРасходов.ПустаяСсылка)
	|			ТОГДА 0
    |		КОГДА 
	|		    (
	|				(Партии.НалоговоеНазначениеПартии.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ВидыДеятельностиНДС.Облагаемая) 
	|	   				И Партии.НалоговоеНазначение.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ВидыДеятельностиНДС.Необлагаемая))
	|				ИЛИ (Партии.НалоговоеНазначениеПартии.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ВидыДеятельностиНДС.ПропорциональноОблагаемая) 
	|	   				И Партии.НалоговоеНазначение = ЗНАЧЕНИЕ(Справочник.НалоговыеНазначенияАктивовИЗатрат.НДС_НеоблагаемаяНеХозДеятельность))
	|           )
	|		ТОГДА
	|			Партии.НДСУпр
	|
	|
	|		КОГДА Партии.НалоговоеНазначениеПартии.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ВидыДеятельностиНДС.Необлагаемая) 
	|		      И Партии.НалоговоеНазначение.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ВидыДеятельностиНДС.Облагаемая) 
	|		ТОГДА
	|			-Партии.НДСУпр
	|		ИНАЧЕ
	|			0
	|		КОНЕЦ
	|	) КАК НДСУпр
	|
	|ПОМЕСТИТЬ ВтПартии
	|ИЗ (
	|	ВЫБРАТЬ
	|		Партии.Период КАК Период,
	|		Партии.Регистратор КАК Регистратор,
	|		Партии.Организация КАК Организация,
	|		Партии.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
	|		Партии.КорАналитикаУчетаНоменклатуры КАК КорАналитикаУчетаНоменклатуры,
	|		Партии.ВидЗапасов КАК ВидЗапасов,
	|		НЕОПРЕДЕЛЕНО КАК Партия,
	|		НЕОПРЕДЕЛЕНО КАК АналитикаФинансовогоУчета,
    |		НЕОПРЕДЕЛЕНО КАК КорАналитикаФинансовогоУчета,
	|		Партии.СтатьяРасходовСписания КАК СтатьяРасходовСписания,
	|		Партии.АналитикаРасходов КАК АналитикаРасходов,
    |		Партии.АналитикаУчетаПартий.НалоговоеНазначение КАК НалоговоеНазначениеПартии,
    |		Партии.НалоговоеНазначение,
	|		Партии.ДокументПоступления,
	|		Партии.Количество КАК Количество,
	|		Партии.НДСРегл КАК НДСРегл,
	|		0 КАК НДСУпр,
	|		Партии.СтатьяСписанияНДС,
	|		Партии.АналитикаСписанияНДС
	|	ИЗ
	|		РегистрНакопления.ПартииТоваровОрганизаций КАК Партии
	|	ГДЕ
	|		НЕ &ПартионныйУчетВерсии22
	|		И Партии.Период МЕЖДУ &НачалоПериода И &КонецПериода
	|		И Партии.Активность
	|		И Партии.Организация В(&МассивОрганизаций)
	|		И Партии.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	|		И Партии.ВидЗапасов.ТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.Товар)
	|
	|	ОБЪЕДИНИТЬ ВСЕ
	|
	|	ВЫБРАТЬ
	|		Партии.Период КАК Период,
	|		Партии.Регистратор КАК Регистратор,
	|		Партии.Организация КАК Организация,
	|		Партии.АналитикаУчетаПродукции КАК АналитикаУчетаНоменклатуры,
	|		Партии.КорАналитикаУчетаПродукции КАК КорАналитикаУчетаНоменклатуры,
	|		РасходыПартий.ВидЗапасов КАК ВидЗапасов,
	|		НЕОПРЕДЕЛЕНО КАК Партия,
	|		НЕОПРЕДЕЛЕНО КАК АналитикаФинансовогоУчета,
    |		НЕОПРЕДЕЛЕНО КАК КорАналитикаФинансовогоУчета,
	|		Партии.СтатьяРасходовСписания КАК СтатьяРасходовСписания,
	|		Партии.АналитикаРасходов КАК АналитикаРасходов,
    |		Партии.АналитикаУчетаПартий.НалоговоеНазначение КАК НалоговоеНазначениеПартии,
    |		Партии.НалоговоеНазначение,
	|		Партии.ДокументПоступления,
	|		0 КАК Количество,
	|		Партии.НДСРегл КАК НДСРегл,
	|		0 КАК НДСУпр,
	|		Партии.СтатьяСписанияНДС,
	|		Партии.АналитикаСписанияНДС
	|	ИЗ
	|		РегистрНакопления.ПартииЗатратНаВыпуск КАК Партии
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РасходыПартий КАК РасходыПартий
	|			ПО РасходыПартий.Регистратор = Партии.Регистратор
	|			И РасходыПартий.Организация = Партии.Организация
	|			И РасходыПартий.АналитикаУчетаНоменклатуры = Партии.АналитикаУчетаПродукции
	|			И РасходыПартий.ДокументПоступления = Партии.ДокументВыпуска
	|			И РасходыПартий.СтатьяРасходовСписания = Партии.СтатьяРасходовСписания
	|			И РасходыПартий.АналитикаРасходов = Партии.АналитикаРасходов 
	|	ГДЕ
	|		НЕ &ПартионныйУчетВерсии22
	|		И Партии.Период МЕЖДУ &НачалоПериода И &КонецПериода
	|		И Партии.Активность
	|		И Партии.Организация В(&МассивОрганизаций)
	|		И Партии.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	|		И Партии.НДСРегл <> 0
	|		И Партии.ВидЗапасов.ТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.Товар)
	|
	|	ОБЪЕДИНИТЬ ВСЕ
	|
	|	ВЫБРАТЬ
	|		Партии.Период КАК Период,
	|		Партии.Регистратор КАК Регистратор,
	|		Партии.Организация КАК Организация,
	|		Партии.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
	|		Партии.КорАналитикаУчетаНоменклатуры КАК КорАналитикаУчетаНоменклатуры,
	|		Партии.ВидЗапасов КАК ВидЗапасов,
	|		НЕОПРЕДЕЛЕНО КАК Партия,
	|		НЕОПРЕДЕЛЕНО КАК АналитикаФинансовогоУчета,
    |		НЕОПРЕДЕЛЕНО КАК КорАналитикаФинансовогоУчета,
	|		Партии.СтатьяРасходовСписания КАК СтатьяРасходовСписания,
	|		Партии.АналитикаРасходов КАК АналитикаРасходов,
    |		Партии.АналитикаУчетаПартий.НалоговоеНазначение КАК НалоговоеНазначениеПартии,
    |		Партии.НалоговоеНазначение,
	|		Партии.ДокументПоступления,
	|		0 КАК Количество,
	|		Партии.НДСРегл КАК НДСРегл,
	|		0 КАК НДСУпр,
	|		Партии.СтатьяСписанияНДС,
	|		Партии.АналитикаСписанияНДС
	|	ИЗ
	|		РегистрНакопления.ПартииРасходовНаСебестоимостьТоваров КАК Партии
	|	ГДЕ
	|		НЕ &ПартионныйУчетВерсии22
	|		И Партии.Период МЕЖДУ &НачалоПериода И &КонецПериода
	|		И Партии.Активность
	|		И Партии.Организация В(&МассивОрганизаций)
	|		И Партии.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	|		И Партии.НДСРегл <> 0
	|		И Партии.ВидЗапасов.ТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.Товар)
	|
	|	ОБЪЕДИНИТЬ ВСЕ
	|
	|	ВЫБРАТЬ
	|		Партии.Период КАК Период,
	|		Партии.Регистратор КАК Регистратор,
	|		Партии.Организация КАК Организация,
	|		Партии.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
	|		Партии.КорАналитикаУчетаНоменклатуры КАК КорАналитикаУчетаНоменклатуры,
	|		Партии.ВидЗапасов КАК ВидЗапасов,
	|		(ВЫБОР
	|			КОГДА ДвиженияСебестоимости.Регистратор ЕСТЬ NULL ТОГДА НЕОПРЕДЕЛЕНО
	|			ИНАЧЕ Партии.Партия КОНЕЦ) КАК Партия,
	|		Партии.АналитикаФинансовогоУчета КАК АналитикаФинансовогоУчета,
    |		Партии.КорАналитикаФинансовогоУчета КАК КорАналитикаФинансовогоУчета,
	|		Партии.СтатьяРасходовАктивов КАК СтатьяРасходовСписания,
	|		Партии.АналитикаРасходов КАК АналитикаРасходов,
    |		Партии.НалоговоеНазначение КАК НалоговоеНазначениеПартии,
    |		Партии.КорНалоговоеНазначение КАК НалоговоеНазначение,
	|		Партии.ДокументПоступления,
	|		(ВЫБОР
	|			КОГДА Партии.ТипЗаписи В (
	|					ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ОтклонениеВСтоимости),
	|					ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.РаспределениеПоВыбывшимТоварам),
	|					ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаПриобретенияПрошлогоПериода))
	|				ТОГДА (ВЫБОР
	|		            КОГДА Партии.НалоговоеНазначение.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ВидыДеятельностиНДС.Необлагаемая) 
	|						ТОГДА Партии.СтоимостьБезНДС + Партии.НДС
	|					КОГДА Партии.СтоимостьБезНДС = 0 ТОГДА Партии.НДС
	|					ИНАЧЕ Партии.СтоимостьБезНДС КОНЕЦ)
	|			ИНАЧЕ Партии.Количество КОНЕЦ) КАК Количество,
	|		Партии.НДС КАК НДСРегл,
	|		Партии.НДСУпр КАК НДСУпр,
	|		Партии.СтатьяСписанияНДС,
	|		Партии.АналитикаСписанияНДС
	|	ИЗ
    |		ВТКэшРасчетныеОборотыДетализацияПартийТоваровДляНДС КАК Партии
	|		ЛЕВОЕ СОЕДИНЕНИЕ ДвиженияСебестоимости КАК ДвиженияСебестоимости
	|		 ПО ДвиженияСебестоимости.Период = Партии.Период
	|		 И ДвиженияСебестоимости.Регистратор = Партии.Регистратор
	|		 И ДвиженияСебестоимости.Организация = Партии.Организация
	|		 И ДвиженияСебестоимости.АналитикаУчетаНоменклатуры = Партии.АналитикаУчетаНоменклатуры
	|		 И ДвиженияСебестоимости.Партия = Партии.Партия
	|		 И ДвиженияСебестоимости.АналитикаФинансовогоУчета = Партии.АналитикаФинансовогоУчета
    |		 И ДвиженияСебестоимости.НалоговоеНазначение = Партии.НалоговоеНазначение
	|	ГДЕ
	|		&ПартионныйУчетВерсии22
	|		И Партии.Организация В(&ОрганизацииСУчетомПартийНДСВерсии22)
	|		И НЕ Партии.СлужебноеВидДвиженияПриход
	|
	|	) КАК Партии
	|	
	|	ЛЕВОЕ СОЕДИНЕНИЕ 
	|		РегистрСведений.ДанныеПервичныхДокументов КАК ДанныеПервичныхДокументов
	|	ПО
	|		ДанныеПервичныхДокументов.Организация = Партии.Организация
	|		И ДанныеПервичныхДокументов.Документ = Партии.ДокументПоступления
	|	
	|ГДЕ
    |	НЕ Партии.НалоговоеНазначениеПартии ЕСТЬ NULL
    |	И Партии.НалоговоеНазначениеПартии <> Партии.НалоговоеНазначение
    |	И Партии.НалоговоеНазначение <> ЗНАЧЕНИЕ(Справочник.НалоговыеНазначенияАктивовИЗатрат.ПустаяСсылка)
	|
	|СГРУППИРОВАТЬ ПО
	|	Партии.Период,
	|	Партии.Регистратор,
	|	Партии.Организация,
	|	Партии.АналитикаУчетаНоменклатуры,
	|	Партии.КорАналитикаУчетаНоменклатуры,
	|	Партии.ВидЗапасов,
	|	Партии.Партия,
	|	Партии.АналитикаФинансовогоУчета,
    |	Партии.КорАналитикаФинансовогоУчета,
	|	Партии.СтатьяРасходовСписания,
	|	Партии.АналитикаРасходов,
	|	Партии.СтатьяСписанияНДС,
	|	Партии.АналитикаСписанияНДС
	|;
	|////////////////////////////////////////////////////////////////////////////////
	|
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	Партии.Регистратор КАК Регистратор
	|ПОМЕСТИТЬ ВтРегистраторы
	|ИЗ
	|	ВтПартии КАК Партии
	|ГДЕ
	|	Партии.НДСРегл <> 0
	|	ИЛИ Партии.НДСУпр <> 0
	|ИНДЕКСИРОВАТЬ ПО
	|	Регистратор
	|;
	|////////////////////////////////////////////////////////////////////////////////
	|
	|ВЫБРАТЬ
	|	2 КАК Порядок,
	|	УчетСебестоимости.Период КАК Период,
	|	УчетСебестоимости.Регистратор КАК Регистратор,
	|	УчетСебестоимости.Организация КАК Организация,
	|	УчетСебестоимости.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
	|	УчетСебестоимости.ВидЗапасов КАК ВидЗапасов,
	|	УчетСебестоимости.Партия КАК Партия,
	|	УчетСебестоимости.АналитикаФинансовогоУчета КАК АналитикаФинансовогоУчета,
	|	ВЫБОР КОГДА УчетСебестоимости.СтатьяРасходовСписания = ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиРасходов.ПустаяСсылка)
	|		ТОГДА НЕОПРЕДЕЛЕНО
	|		ИНАЧЕ УчетСебестоимости.СтатьяРасходовСписания
	|	КОНЕЦ КАК СтатьяРасходовСписания,
	|	УчетСебестоимости.АналитикаРасходов КАК АналитикаРасходов,
	|
	|	ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход) КАК ВидДвижения,
	|	УчетСебестоимости.РазделУчета КАК РазделУчета,
	|	УчетСебестоимости.АналитикаУчетаПоПартнерам КАК АналитикаУчетаПоПартнерам,
	|	УчетСебестоимости.ЗаказКлиента КАК ЗаказКлиента,
	|	(ВЫБОР
	|		КОГДА УчетСебестоимости.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукции)
	|			ТОГДА НЕОПРЕДЕЛЕНО
	|		ИНАЧЕ УчетСебестоимости.ХозяйственнаяОперация КОНЕЦ) КАК ХозяйственнаяОперация,
	|	УчетСебестоимости.КорАналитикаУчетаНоменклатуры КАК КорАналитикаУчетаНоменклатуры,
	|	УчетСебестоимости.КорРазделУчета КАК КорРазделУчета,
	|	УчетСебестоимости.КорВидЗапасов КАК КорВидЗапасов,
	|	УчетСебестоимости.КорОрганизация КАК КорОрганизация,
	|	УчетСебестоимости.Подразделение КАК Подразделение,
	|	УчетСебестоимости.СтатьяРасходовСписания.ВариантРаспределенияРасходовУпр КАК ВариантРаспределенияРасходовУпр,
	|	УчетСебестоимости.СтатьяРасходовСписания.ВариантРаспределенияРасходовРегл КАК ВариантРаспределенияРасходовРегл,
	|	УчетСебестоимости.ГруппаПродукции КАК ГруппаПродукции,
	|	ЕСТЬNULL(СпрНазначения.НаправлениеДеятельности,
	|		ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка)) КАК НаправлениеДеятельности,
	|	УчетСебестоимости.КорНаправлениеДеятельности КАК КорНаправлениеДеятельности,
	|	УчетСебестоимости.КорПартия,
	|	УчетСебестоимости.КорАналитикаУчетаПартий,
	|	УчетСебестоимости.КорАналитикаФинансовогоУчета,
    |	УчетСебестоимости.КорНалоговоеНазначение,
	|	УчетСебестоимости.Регистратор КАК ДокументДвижения,
	|	ЛОЖЬ КАК ЭтоПередачаМеждуОрганизациями,
	|
	|	СУММА(ВЫБОР
	|		КОГДА УчетСебестоимости.ТипЗаписи В (
	|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ОтклонениеВСтоимости),
	|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.РаспределениеПоВыбывшимТоварам),
	|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаПриобретенияПрошлогоПериода))
	|			ТОГДА (ВЫБОР
	|				КОГДА УчетСебестоимости.ДопРасходыРегл = 0 ТОГДА УчетСебестоимости.НДСРегл
	|				ИНАЧЕ УчетСебестоимости.ДопРасходыРегл КОНЕЦ)
	|		ИНАЧЕ УчетСебестоимости.Количество КОНЕЦ) КАК Количество,
	|	0 КАК Стоимость,
	|	0 КАК СтоимостьБезНДС,
	|	0 КАК ДопРасходы,
	|	0 КАК ДопРасходыБезНДС,
	|	0 КАК СтоимостьЗабалансовая,
	|	0 КАК СтоимостьЗабалансоваяРегл,
    |	0 КАК СтоимостьРегл,
    |	0 КАК СтоимостьУпр,
    |	0 КАК ДопРасходыРегл,
    |	0 КАК ДопРасходыУпр,
    |	0 КАК СтоимостьРеглБезНДС,
    |	0 КАК НДСРегл,
    |	0 КАК СтоимостьУпрБезНДС,
    |	0 КАК ДопРасходыРеглБезНДС,
    |	0 КАК ДопРасходыУпрБезНДС,
    |	0 КАК НДСРеглРеквизит,
	|	0 КАК НДСУпр,
	|	0 КАК ПостояннаяРазница,
	|	0 КАК ВременнаяРазница,
	|	СУММА(УчетСебестоимости.Количество) КАК ИсходноеКоличество
	|ИЗ
	|	ВТКэшРасчетныеОборотыСебестоимостьТоваров КАК УчетСебестоимости
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВтРегистраторы КАК Регистраторы
	|		ПО Регистраторы.Регистратор = УчетСебестоимости.Регистратор
	|	ЛЕВОЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК АналитикаНоменклатуры
	|		ПО УчетСебестоимости.АналитикаУчетаНоменклатуры = АналитикаНоменклатуры.Ссылка
	|	ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Назначения КАК СпрНазначения
	|		ПО СпрНазначения.Ссылка = АналитикаНоменклатуры.Назначение
	|	ЛЕВОЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК КорАналитикаНоменклатуры
	|		ПО УчетСебестоимости.КорАналитикаУчетаНоменклатуры = КорАналитикаНоменклатуры.Ссылка
	//++ НЕ УТ
	|		ЛЕВОЕ СОЕДИНЕНИЕ Документ.ВнутреннееПотреблениеТоваров.Товары КАК ПередачиВЭксплуатацию
	|			ПО УчетСебестоимости.ДокументДвижения = ПередачиВЭксплуатацию.Ссылка
	|				И УчетСебестоимости.ИдентификаторСтроки = ПередачиВЭксплуатацию.ИдентификаторСтроки
	|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.ПартииТМЦВЭксплуатации КАК ПартииТМЦВЭксплуатации
	|			ПО ПередачиВЭксплуатацию.ПартияТМЦВЭксплуатации = ПартииТМЦВЭксплуатации.Ссылка
	//-- НЕ УТ
	|ГДЕ
	|	НЕ УчетСебестоимости.СлужебноеВидДвиженияПриход
	|	И (УчетСебестоимости.КорРазделУчета <> ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПустаяСсылка)
	|		ИЛИ УчетСебестоимости.СтатьяРасходовСписания <> ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиРасходов.ПустаяСсылка)
	|			И УчетСебестоимости.СтатьяРасходовСписания <> НЕОПРЕДЕЛЕНО)
	|	И УчетСебестоимости.ХозяйственнаяОперация <> ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РеализацияТоваровВДругуюОрганизацию)
	|	И УчетСебестоимости.РазделУчета <> ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПринятыеНаКомиссию)
	|	И УчетСебестоимости.РазделУчета <> ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.МатериалыПринятыеВПереработку)
	|	
	|СГРУППИРОВАТЬ ПО
	|	УчетСебестоимости.Период,
	|	УчетСебестоимости.Регистратор,
	|	УчетСебестоимости.Организация,
	|	УчетСебестоимости.АналитикаУчетаНоменклатуры,
	|	УчетСебестоимости.ВидЗапасов,
	|	УчетСебестоимости.Партия,
	|	УчетСебестоимости.АналитикаФинансовогоУчета,
	|	ВЫБОР КОГДА УчетСебестоимости.СтатьяРасходовСписания = ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиРасходов.ПустаяСсылка)
	|		ТОГДА НЕОПРЕДЕЛЕНО
	|		ИНАЧЕ УчетСебестоимости.СтатьяРасходовСписания
	|	КОНЕЦ,
	|	УчетСебестоимости.СтатьяРасходовСписания.ВариантРаспределенияРасходовУпр,
	|	УчетСебестоимости.СтатьяРасходовСписания.ВариантРаспределенияРасходовРегл,
	|	УчетСебестоимости.АналитикаРасходов,
	|
	|	УчетСебестоимости.РазделУчета,
	|	УчетСебестоимости.АналитикаУчетаПоПартнерам,
	|	УчетСебестоимости.ЗаказКлиента,
	|	(ВЫБОР
	|		КОГДА УчетСебестоимости.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукции)
	|			ТОГДА НЕОПРЕДЕЛЕНО
	|		ИНАЧЕ УчетСебестоимости.ХозяйственнаяОперация КОНЕЦ),
	|	УчетСебестоимости.КорАналитикаУчетаНоменклатуры,
	|	УчетСебестоимости.КорРазделУчета,
	|	УчетСебестоимости.КорВидЗапасов,
	|	УчетСебестоимости.КорОрганизация,
	|	УчетСебестоимости.Подразделение,
	|	УчетСебестоимости.ГруппаПродукции,
	|	ЕСТЬNULL(СпрНазначения.НаправлениеДеятельности,
	|		ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка)),
	|	УчетСебестоимости.КорНаправлениеДеятельности,
	|	УчетСебестоимости.КорПартия,
	|	УчетСебестоимости.КорАналитикаУчетаПартий,
	|	УчетСебестоимости.КорАналитикаФинансовогоУчета,
    |	УчетСебестоимости.КорНалоговоеНазначение
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	1 КАК Порядок,
	|	Партии.Период КАК Период,
	|	Партии.Регистратор КАК Регистратор,
	|	Партии.Организация КАК Организация,
	|	Партии.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
	|	Партии.ВидЗапасов КАК ВидЗапасов,
	|	Партии.Партия КАК Партия,
	|	Партии.АналитикаФинансовогоУчета КАК АналитикаФинансовогоУчета,
	|	Партии.СтатьяРасходовСписания КАК СтатьяРасходовСписания,
	|	Партии.АналитикаРасходов КАК АналитикаРасходов,
	|
	|	НЕОПРЕДЕЛЕНО КАК ВидДвижения,
	|	НЕОПРЕДЕЛЕНО КАК РазделУчета,
	|	НЕОПРЕДЕЛЕНО КАК АналитикаУчетаПоПартнерам,
	|	НЕОПРЕДЕЛЕНО КАК ЗаказКлиента,
	|	НЕОПРЕДЕЛЕНО КАК ХозяйственнаяОперация,
	|	Партии.КорАналитикаУчетаНоменклатуры КАК КорАналитикаУчетаНоменклатуры,
	|	НЕОПРЕДЕЛЕНО КАК КорРазделУчета,
	|	НЕОПРЕДЕЛЕНО КАК КорВидЗапасов,
	|	НЕОПРЕДЕЛЕНО КАК КорОрганизация,
	|	НЕОПРЕДЕЛЕНО КАК Подразделение,
	|	НЕОПРЕДЕЛЕНО КАК ВариантРаспределенияРасходовУпр,
	|	НЕОПРЕДЕЛЕНО КАК ВариантРаспределенияРасходовРегл,
	|	НЕОПРЕДЕЛЕНО КАК ГруппаПродукции,
	|	НЕОПРЕДЕЛЕНО КАК НаправлениеДеятельности,
	|	НЕОПРЕДЕЛЕНО КАК КорНаправлениеДеятельности,
	|	НЕОПРЕДЕЛЕНО КАК КорПартия,
	|	НЕОПРЕДЕЛЕНО КАК КорАналитикаУчетаПартий,
	|	Партии.КорАналитикаФинансовогоУчета КАК КорАналитикаФинансовогоУчета,
    |	НЕОПРЕДЕЛЕНО КАК КорНалоговоеНазначение,
	|	НЕОПРЕДЕЛЕНО КАК ДокументДвижения,
	|	ЛОЖЬ 		 КАК ЭтоПередачаМеждуОрганизациями,
	|
	|	СУММА(Партии.Количество) КАК Количество,
	|	0 КАК Стоимость,
	|	0 КАК СтоимостьБезНДС,
	|	0 КАК ДопРасходы,
	|	0 КАК ДопРасходыБезНДС,
	|	0 КАК СтоимостьЗабалансовая,
	|	0 КАК СтоимостьЗабалансоваяРегл,
    |	СУММА(Партии.НДСРегл) КАК СтоимостьРегл,
    |	СУММА(Партии.НДСУпр) КАК СтоимостьУпр,
    |	0 КАК ДопРасходыРегл,
    |	0 КАК ДопРасходыУпр,
    |	0 КАК СтоимостьРеглБезНДС,
    |	0 КАК НДСРегл,
    |	0 КАК СтоимостьУпрБезНДС,
    |	0 КАК ДопРасходыРеглБезНДС,
    |	0 КАК ДопРасходыУпрБезНДС,
    |	0 КАК НДСРеглРеквизит,
	|	0 КАК НДСУпр,
	|	0 КАК ПостояннаяРазница,
	|	0 КАК ВременнаяРазница,
	|	0 КАК ИсходноеКоличество
	|ИЗ
	|	ВтПартии КАК Партии
	|ГДЕ
	|	Партии.Количество > 0
	|
	|СГРУППИРОВАТЬ ПО
	|	Партии.Период,
	|	Партии.Регистратор,
	|	Партии.Организация,
	|	Партии.АналитикаУчетаНоменклатуры,
	|	Партии.КорАналитикаУчетаНоменклатуры,
	|	Партии.ВидЗапасов,
	|	Партии.Партия,
	|	Партии.АналитикаФинансовогоУчета,
    |	Партии.КорАналитикаФинансовогоУчета,
	|	Партии.СтатьяРасходовСписания,
	|	Партии.АналитикаРасходов
	|
	|ИМЕЮЩИЕ
	|	СУММА(Партии.НДСРегл) <> 0
	|	ИЛИ СУММА(Партии.НДСУпр) <> 0
	|
	|УПОРЯДОЧИТЬ ПО
	|	Регистратор,
	|	Организация,
	|	АналитикаУчетаНоменклатуры,
	|	ВидЗапасов,
	|	Партия,
	|	АналитикаФинансовогоУчета,
	|	СтатьяРасходовСписания,
	|	АналитикаРасходов,
	|	КорАналитикаУчетаНоменклатуры,
    |	КорАналитикаФинансовогоУчета,
	|	Порядок
	|";
	
	ЗаписьРаспределения = Новый Структура("
	|Период, АналитикаУчетаНоменклатуры, РазделУчета, ВидЗапасов, Организация, Склад, Партия, АналитикаФинансовогоУчета,
	|ХозяйственнаяОперация, ЗаказКлиента, ТипЗапасов, АналитикаУчетаПоПартнерам, ЭтоПередачаМеждуОрганизациями,
	|КорАналитикаУчетаНоменклатуры, КорРазделУчета, КорВидЗапасов, КорТипЗапасов, КорОрганизация,
	|АналитикаУчетаНоменклатурыВО, АналитикаФинансовогоУчетаВО, АналитикаАктивовПассивов, КорСклад,
	|СтатьяАктивовПассивов, Подразделение, АналитикаРасходов, СтатьяРасходовСписания, СтатьяДоходов, АналитикаДоходов,
	|ВариантРаспределенияРасходовУпр, ВариантРаспределенияРасходовРегл,
    |ДокументДвижения, ИдентификаторСтроки, ГруппаПродукции, 
	|ИсточникГФУНоменклатуры, КорИсточникГФУНоменклатуры, НаправлениеДеятельности, КорНаправлениеДеятельности,
	|Стоимость, СтоимостьБезНДС, Количество, КорСтоимость, ПостояннаяРазница, ВременнаяРазница,
    |ДопРасходы, ДопРасходыБезНДС, СтоимостьРегл, НДСРеглРеквизит,
    |КорПартия, КорАналитикаУчетаПартий, КорАналитикаФинансовогоУчета, КорНалоговоеНазначение,
	|СтатьяКалькуляции, ТипЗаписи, ДокументИсточник,
	|СтоимостьЗабалансовая, Трудозатраты, ПостатейныеПостоянныеСНДС, ПостатейныеПостоянныеБезНДС,
    |СтоимостьЗабалансоваяРегл, ДопРасходыРегл, ТрудозатратыРегл, ПостатейныеПостоянныеРегл,
    |СтоимостьРеглБезНДС, НДСРегл, ДопРасходыРеглБезНДС, ПостатейныеПостоянныеРеглБезНДС, ПостатейныеПеременныеРеглБезНДС,
	|ПостатейныеПеременныеСНДС, ПостатейныеПеременныеБезНДС, ПостатейныеПеременныеРегл,
    |СтоимостьУпрБезНДС, ДопРасходыУпрБезНДС, ПостатейныеПостоянныеУпрБезНДС, ПостатейныеПеременныеУпрБезНДС, 
    |СтоимостьУпр, ДопРасходыУпр, ТрудозатратыУпр, ПостатейныеПостоянныеУпр, ПостатейныеПеременныеУпр, НДСУпр
	|");
	
	СуммыРаспределения = Новый Структура("
    |Количество, Стоимость, СтоимостьБезНДС, СтоимостьЗабалансовая, СтоимостьРегл, СтоимостьУпр, СтоимостьЗабалансоваяРегл, НДСРеглРеквизит, НДСУпр,
    |СтоимостьРеглБезНДС, НДСРегл, СтоимостьУпрБезНДС, ДопРасходыРеглБезНДС, ДопРасходыУпрБезНДС, 
    |ДопРасходы, ДопРасходыБезНДС, ДопРасходыРегл, ДопРасходыУпр, ПостояннаяРазница, ВременнаяРазница
	|");
	
	СтрокаОстатка = Новый Структура("
	|Регистратор, Организация, АналитикаУчетаНоменклатуры, ВидЗапасов, Партия, АналитикаФинансовогоУчета, СтатьяРасходовСписания, АналитикаРасходов,
	|КорАналитикаУчетаНоменклатуры,
    |КорАналитикаФинансовогоУчета,
    |Количество, Стоимость, СтоимостьБезНДС, СтоимостьЗабалансовая, СтоимостьРегл, СтоимостьУпр, СтоимостьЗабалансоваяРегл, НДСРеглРеквизит, НДСУпр,
    |СтоимостьРеглБезНДС, НДСРегл, СтоимостьУпрБезНДС, ДопРасходыРеглБезНДС, ДопРасходыУпрБезНДС, 
    |ДопРасходы, ДопРасходыБезНДС, ДопРасходыРегл, ДопРасходыУпр, ПостояннаяРазница, ВременнаяРазница
	|");
	
	Выборка = РасчетСебестоимостиПрикладныеАлгоритмы.ВыполнитьЗапросСЗамеромДляПротокола(ПараметрыРасчета, Запрос, Истина,,,
		Метаданные.РегистрыНакопления.СебестоимостьТоваров.Имя);
	
	// Формируются движения по регистрам:
	// - СебестоимостьТоваров
	// - ПрочиеРасходы
	Пока Выборка.Следующий() Цикл
		
		Если Выборка.Порядок = 1 Тогда
			
			ЗаполнитьЗначенияСвойств(СтрокаОстатка, Выборка);
			
		ИначеЕсли СтрокаОстатка.Регистратор = Выборка.Регистратор
			И СтрокаОстатка.Организация = Выборка.Организация
			И СтрокаОстатка.АналитикаУчетаНоменклатуры = Выборка.АналитикаУчетаНоменклатуры
			И (СтрокаОстатка.КорАналитикаУчетаНоменклатуры = Выборка.КорАналитикаУчетаНоменклатуры
				ИЛИ НЕ ЗначениеЗаполнено(Выборка.КорРазделУчета))
			И СтрокаОстатка.ВидЗапасов = Выборка.ВидЗапасов
			И СтрокаОстатка.Партия = Выборка.Партия
			И СтрокаОстатка.АналитикаФинансовогоУчета = Выборка.АналитикаФинансовогоУчета
            И (СтрокаОстатка.КорАналитикаФинансовогоУчета = Выборка.КорАналитикаФинансовогоУчета
            	ИЛИ НЕ ЗначениеЗаполнено(Выборка.КорРазделУчета))
			И СтрокаОстатка.СтатьяРасходовСписания = Выборка.СтатьяРасходовСписания
			И СтрокаОстатка.АналитикаРасходов = Выборка.АналитикаРасходов Тогда
			
			ЗаполнитьЗначенияСвойств(ЗаписьРаспределения, Выборка);
			
			РасчетСебестоимостиКорректировкаСтоимости.РаспределитьСтоимость(СуммыРаспределения, СтрокаОстатка, Выборка, Выборка.Количество);
			РасчетСебестоимостиКорректировкаСтоимости.ДополнитьСуммыРаспределения(ЗаписьРаспределения, СуммыРаспределения);
			
			Если ЗаписьРаспределения.СтоимостьРегл <> 0 ИЛИ ЗаписьРаспределения.СтоимостьУпр <> 0 Тогда
					
				// Если есть кор. раздел - необходимо скорректировать стоимость в кор. части.
				Если ЗначениеЗаполнено(ЗаписьРаспределения.КорРазделУчета) Тогда
					
					РасчетСебестоимостиКорректировкаСтоимости.СформироватьКорДвиженияСебестоимостьТоваров(ПараметрыРасчета, ЗаписьРаспределения, ПараметрыРасчета.ПредварительныйРасчет);
							
				КонецЕсли;
				
				Если ПараметрыРасчета.ПредварительныйРасчет Тогда
					Продолжить;
				КонецЕсли;
				
				// Корректировка списания товаров на затраты в регистре учет прочих расходов.
				Если Выборка.ХозяйственнаяОперация = Перечисления.ХозяйственныеОперации.СписаниеТоваров
				 Или Выборка.ХозяйственнаяОперация = Перечисления.ХозяйственныеОперации.СписаниеТоваровПоТребованию
				 Или Выборка.ХозяйственнаяОперация = Перечисления.ХозяйственныеОперации.СторноСписанияНаРасходы
				 Или Выборка.ХозяйственнаяОперация = Перечисления.ХозяйственныеОперации.ПересортицаТоваровСПереоценкой
				 Или Выборка.ХозяйственнаяОперация = Перечисления.ХозяйственныеОперации.ПорчаТоваровСПереоценкой
				 Или Выборка.ХозяйственнаяОперация = Перечисления.ХозяйственныеОперации.ВозвратТоваровПоставщику
				 //++ НЕ УТ
				 Или Выборка.ХозяйственнаяОперация = Перечисления.ХозяйственныеОперации.ПередачаВСоставОС
				 Или Выборка.ХозяйственнаяОперация = Перечисления.ХозяйственныеОперации.ПередачаВСоставНМА
				 //-- НЕ УТ
				 Или Выборка.ХозяйственнаяОперация = Перечисления.ХозяйственныеОперации.ПередачаНаПрочиеЦели
				 Или Выборка.ХозяйственнаяОперация = Перечисления.ХозяйственныеОперации.ПередачаВЭксплуатацию
				 Или Выборка.ХозяйственнаяОперация = Перечисления.ХозяйственныеОперации.ОтчетКомиссионераОСписании Тогда
				 	
				 	СуммовыеПоказатели = Новый Структура;
					СуммовыеПоказатели.Вставить("СуммаСНДС", 0);
					СуммовыеПоказатели.Вставить("СуммаБезНДС", 0);
                    СуммовыеПоказатели.Вставить("СуммаРегл", ЗаписьРаспределения.СтоимостьРегл);
                    СуммовыеПоказатели.Вставить("СуммаУпр", ЗаписьРаспределения.СтоимостьУпр);
                    СуммовыеПоказатели.Вставить("СуммаРеглБезНДС", 0);
                    СуммовыеПоказатели.Вставить("СуммаУпрБезНДС", 0);
                    СуммовыеПоказатели.Вставить("НДСРегл", 0);
					СуммовыеПоказатели.Вставить("ПостояннаяРазница", 0);
					СуммовыеПоказатели.Вставить("ВременнаяРазница", 0);
				 
				 	РасчетСебестоимостиКорректировкаСтоимости.СформироватьДвиженияПрочиеРасходы(
				 		ПараметрыРасчета,
						ЗаписьРаспределения,
						СуммовыеПоказатели);
					
				КонецЕсли;

			КонецЕсли;
			
		КонецЕсли;

	КонецЦикла;
	
	РасчетСебестоимостиПрикладныеАлгоритмы.УничтожитьВременныеТаблицы(ПараметрыРасчета, "РасходыПартий, ДвиженияСебестоимости, ВтПартии, ВтРегистраторы");
	
	РасчетСебестоимостиПрикладныеАлгоритмы.КэшироватьСформированныеДвижения(ПараметрыРасчета);
	
КонецПроцедуры

// Этап 3.1.2
Процедура ВключитьИсключитьНДСВСтоимость24(ПараметрыРасчета) Экспорт

	РасчетСебестоимостиПротоколРасчета.НачалоЭтапаРасчета(ПараметрыРасчета, "ВключитьИсключитьНДСВСтоимость24");
	
	Запрос = Новый Запрос;
	РасчетСебестоимостиКорректировкаСтоимости.ИнициализироватьСвойстваЗапроса(Запрос, ПараметрыРасчета);
	
	ВыполненРасчетПартийНДС = РасчетСебестоимостиПрикладныеАлгоритмы.ВременнаяТаблицаСуществует(ПараметрыРасчета, "ЗнаменателиРасходов");
	
	Если НЕ ВыполненРасчетПартийНДС Тогда
		
		Запрос.Текст =
		"ВЫБРАТЬ ПЕРВЫЕ 0
		|	ДД.Регистратор КАК Регистратор,
		|	ДД.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
		|	ДД.РазделУчета КАК РазделУчета,
		|	ДД.ВидЗапасов КАК ВидЗапасов,
		|	ДД.Организация КАК Организация,
		|	ДД.Партия КАК Партия,
		|	ДД.АналитикаУчетаПартий КАК АналитикаУчетаПартий,
		|	ДД.АналитикаФинансовогоУчета КАК АналитикаФинансовогоУчета,
        |	ДД.НалоговоеНазначение КАК НалоговоеНазначение,
		|	0 КАК Знаменатель
		|ПОМЕСТИТЬ ЗнаменателиРасходов
		|ИЗ
		|	ВТКэшРасчетныеОборотыСебестоимостьТоваров КАК ДД
		|;
		|////////////////////////////////////////////////////////////////////////////////
		|";
		
	КонецЕсли;
	
	Запрос.Текст = Запрос.Текст  + "
	|ВЫБРАТЬ
	|	Партии.Период КАК Период,
	|	Партии.Регистратор КАК Регистратор,
	|	Партии.Организация КАК Организация,
	|	Партии.АналитикаУчетаНоменклатуры,
	|	Партии.ВидЗапасов,
	|	Партии.Партия КАК Партия,
	|	Партии.АналитикаФинансовогоУчета КАК АналитикаФинансовогоУчета,
	|	Партии.СтатьяРасходовСписания КАК СтатьяРасходовСписания,
	|	Партии.АналитикаРасходов КАК АналитикаРасходов,
	|	Партии.АналитикаУчетаНоменклатурыДляСвязи,
	|	Партии.ВидЗапасовДляСвязи,
    |	Партии.КорНалоговоеНазначение,
    |	Партии.НалоговоеНазначение,
	|
	|	СУММА(Партии.СтоимостьБезНДС) КАК СтоимостьБезНДС,
	|	СУММА(Партии.СтоимостьБезНДСУпр) КАК СтоимостьБезНДСУпр,
	|	СУММА(
	|		ВЫБОР КОГДА Партии.СтатьяСписанияНДС <> ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиРасходов.ПустаяСсылка)
	|			ТОГДА 0
    |		КОГДА 
	|		    (
	|				(СпрНалоговоеНазначение.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ВидыДеятельностиНДС.Облагаемая) 
	|	   				И СпрКорНалоговоеНазначение.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ВидыДеятельностиНДС.Необлагаемая))
	|				ИЛИ (СпрНалоговоеНазначение.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ВидыДеятельностиНДС.ПропорциональноОблагаемая) 
	|	   				И Партии.КорНалоговоеНазначение = ЗНАЧЕНИЕ(Справочник.НалоговыеНазначенияАктивовИЗатрат.НДС_НеоблагаемаяНеХозДеятельность))
	|           )
	|		ТОГДА
	|			Партии.НДСРегл
	|
	|
	|		КОГДА СпрНалоговоеНазначение.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ВидыДеятельностиНДС.Необлагаемая) 
	|		      И СпрКорНалоговоеНазначение.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ВидыДеятельностиНДС.Облагаемая) 
	|		ТОГДА
	|			-Партии.НДСРегл
	|		ИНАЧЕ
	|			0
	|		КОНЕЦ
	|	) КАК НДСРегл,
	|	СУММА(
	|		ВЫБОР КОГДА Партии.СтатьяСписанияНДС <> ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиРасходов.ПустаяСсылка)
	|			ТОГДА 0
    |		КОГДА 
	|		    (
	|				(СпрНалоговоеНазначение.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ВидыДеятельностиНДС.Облагаемая) 
	|	   				И СпрКорНалоговоеНазначение.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ВидыДеятельностиНДС.Необлагаемая))
	|				ИЛИ (СпрНалоговоеНазначение.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ВидыДеятельностиНДС.ПропорциональноОблагаемая) 
	|	   				И Партии.КорНалоговоеНазначение = ЗНАЧЕНИЕ(Справочник.НалоговыеНазначенияАктивовИЗатрат.НДС_НеоблагаемаяНеХозДеятельность))
	|           )
	|		ТОГДА
	|			Партии.НДСУпр
	|
	|
	|		КОГДА СпрНалоговоеНазначение.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ВидыДеятельностиНДС.Необлагаемая) 
	|		      И СпрКорНалоговоеНазначение.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ВидыДеятельностиНДС.Облагаемая) 
	|		ТОГДА
	|			-Партии.НДСУпр
	|		ИНАЧЕ
	|			0
	|		КОНЕЦ
	|	) КАК НДСУпр,
	|	СУММА(ВЫБОР
    |		КОГДА СпрНалоговоеНазначение.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ВидыДеятельностиНДС.Необлагаемая) 
	|			ТОГДА Партии.СтоимостьБезНДС + Партии.НДСРегл
	|		КОГДА Партии.СтоимостьБезНДС = 0
	|			ТОГДА Партии.НДСРегл
	|		ИНАЧЕ Партии.СтоимостьБезНДС КОНЕЦ) КАК Знаменатель
	|
	|ПОМЕСТИТЬ ВтПартии
	|ИЗ (
	|	ВЫБРАТЬ
	|		Партии.Период КАК Период,
	|		Партии.Регистратор КАК Регистратор,
	|		Партии.Организация КАК Организация,
	|		ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаНоменклатуры.ПустаяСсылка) КАК АналитикаУчетаНоменклатуры,
	|		ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка) КАК ВидЗапасов,
	|		Партии.Партия КАК Партия,
	|		НЕОПРЕДЕЛЕНО КАК АналитикаФинансовогоУчета,
	|		Партии.СтатьяРасходовАктивов КАК СтатьяРасходовСписания,
	|		Партии.АналитикаРасходов КАК АналитикаРасходов,
    |		Партии.НалоговоеНазначение КАК НалоговоеНазначение,
    |		Партии.КорНалоговоеНазначение КАК КорНалоговоеНазначение,
	|		Партии.ДокументПоступления КАК ДокументПоступления,
	|		Партии.СтоимостьБезНДС КАК СтоимостьБезНДС,
	|		Партии.СтоимостьБезНДСУпр КАК СтоимостьБезНДСУпр,
	|		Партии.НДС КАК НДСРегл,
	|		Партии.НДСУпр КАК НДСУпр,
	|		Партии.СтатьяСписанияНДС,
	|		Партии.КорАналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатурыДляСвязи,
	|		Партии.КорВидЗапасов КАК ВидЗапасовДляСвязи
	|	ИЗ
    |		ВТКэшРасчетныеОборотыДетализацияПартийТоваровДляНДС2_4 КАК Партии
	|	ГДЕ
	|		&ПартионныйУчетВерсии22
	|		И Партии.Организация В(&ОрганизацииСУчетомПартийНДСВерсии24)
	|		И НЕ Партии.СлужебноеВидДвиженияПриход
	|
	|	) КАК Партии
	|	
	|	ЛЕВОЕ СОЕДИНЕНИЕ 
	|		РегистрСведений.ДанныеПервичныхДокументов КАК ДанныеПервичныхДокументов
	|	ПО
	|		ДанныеПервичныхДокументов.Организация = Партии.Организация
	|		И ДанныеПервичныхДокументов.Документ = Партии.ДокументПоступления
	|	ЛЕВОЕ СОЕДИНЕНИЕ 
	|		Справочник.НалоговыеНазначенияАктивовИЗатрат КАК СпрНалоговоеНазначение
	|	ПО
	|		СпрНалоговоеНазначение.Ссылка = Партии.НалоговоеНазначение
	|	ЛЕВОЕ СОЕДИНЕНИЕ 
	|		Справочник.НалоговыеНазначенияАктивовИЗатрат КАК СпрКорНалоговоеНазначение
	|	ПО
	|		СпрКорНалоговоеНазначение.Ссылка = Партии.КорНалоговоеНазначение
	|ГДЕ
    |	НЕ Партии.НалоговоеНазначение ЕСТЬ NULL
    |	И Партии.НалоговоеНазначение <> Партии.КорНалоговоеНазначение
    |	И Партии.КорНалоговоеНазначение <> ЗНАЧЕНИЕ(Справочник.НалоговыеНазначенияАктивовИЗатрат.ПустаяСсылка)
	|
	|СГРУППИРОВАТЬ ПО
	|	Партии.Период,
	|	Партии.Регистратор,
	|	Партии.Организация,
	|	Партии.АналитикаУчетаНоменклатуры,
	|	Партии.ВидЗапасов,
    |	Партии.КорНалоговоеНазначение,
    |	Партии.НалоговоеНазначение,
	|	Партии.Партия,
	|	Партии.АналитикаФинансовогоУчета,
	|	Партии.СтатьяРасходовСписания,
	|	Партии.АналитикаРасходов,
	|	Партии.АналитикаУчетаНоменклатурыДляСвязи,
	|	Партии.ВидЗапасовДляСвязи
	|;
	|////////////////////////////////////////////////////////////////////////////////
	|
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	Партии.Регистратор КАК Регистратор
	|ПОМЕСТИТЬ ВтРегистраторы
	|ИЗ
	|	ВтПартии КАК Партии
	|ГДЕ
	|	Партии.НДСРегл <> 0
	|	ИЛИ Партии.НДСУпр <> 0
	|ИНДЕКСИРОВАТЬ ПО
	|	Регистратор
	|;
	|////////////////////////////////////////////////////////////////////////////////
	|
	|ВЫБРАТЬ
	|	УчетСебестоимости.Период КАК Период,
	|	УчетСебестоимости.Регистратор КАК Регистратор,
	|	УчетСебестоимости.Организация КАК Организация,
	|	УчетСебестоимости.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
	|	УчетСебестоимости.ВидЗапасов КАК ВидЗапасов,
	|	УчетСебестоимости.Партия КАК Партия,
	|	УчетСебестоимости.АналитикаУчетаПартий КАК АналитикаУчетаПартий,
	|	УчетСебестоимости.АналитикаФинансовогоУчета КАК АналитикаФинансовогоУчета,
	|	ВЫБОР КОГДА УчетСебестоимости.СтатьяРасходовСписания = ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиРасходов.ПустаяСсылка)
	|		ТОГДА НЕОПРЕДЕЛЕНО
	|		ИНАЧЕ УчетСебестоимости.СтатьяРасходовСписания
	|	КОНЕЦ КАК СтатьяРасходовСписания,
	|	УчетСебестоимости.АналитикаРасходов КАК АналитикаРасходов,
	|
	|	УчетСебестоимости.РазделУчета КАК РазделУчета,
	|	УчетСебестоимости.АналитикаУчетаПоПартнерам КАК АналитикаУчетаПоПартнерам,
	|	УчетСебестоимости.ЗаказКлиента КАК ЗаказКлиента,
	|	(ВЫБОР
	|		КОГДА УчетСебестоимости.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукции)
	|			ТОГДА НЕОПРЕДЕЛЕНО
	|		ИНАЧЕ УчетСебестоимости.ХозяйственнаяОперация КОНЕЦ) КАК ХозяйственнаяОперация,
	|	УчетСебестоимости.КорАналитикаУчетаНоменклатуры КАК КорАналитикаУчетаНоменклатуры,
	|	УчетСебестоимости.КорРазделУчета КАК КорРазделУчета,
	|	УчетСебестоимости.КорВидЗапасов КАК КорВидЗапасов,
	|	УчетСебестоимости.КорОрганизация КАК КорОрганизация,
	|	УчетСебестоимости.Подразделение КАК Подразделение,
	|	УчетСебестоимости.СтатьяРасходовСписания.ВариантРаспределенияРасходовУпр КАК ВариантРаспределенияРасходовУпр,
	|	УчетСебестоимости.СтатьяРасходовСписания.ВариантРаспределенияРасходовРегл КАК ВариантРаспределенияРасходовРегл,
	|	УчетСебестоимости.ГруппаПродукции КАК ГруппаПродукции,
	|	ЕСТЬNULL(СпрНазначения.НаправлениеДеятельности,
	|		ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка)) КАК НаправлениеДеятельности,
	|	УчетСебестоимости.КорНаправлениеДеятельности КАК КорНаправлениеДеятельности,
	|	ВЫБОР КОГДА УчетСебестоимости.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.РаспределениеПоВыбывшимТоварам)
	|		ТОГДА УчетСебестоимости.Партия
	|		ИНАЧЕ УчетСебестоимости.КорПартия
	|	КОНЕЦ КАК КорПартия,
	|	ВЫБОР КОГДА УчетСебестоимости.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.РаспределениеПоВыбывшимТоварам)
	|		ТОГДА УчетСебестоимости.АналитикаУчетаПартий
	|		ИНАЧЕ УчетСебестоимости.КорАналитикаУчетаПартий
	|	КОНЕЦ КАК КорАналитикаУчетаПартий,
	|	УчетСебестоимости.КорАналитикаФинансовогоУчета,
    |	УчетСебестоимости.НалоговоеНазначение,
    |	УчетСебестоимости.КорНалоговоеНазначение,
	|	УчетСебестоимости.Регистратор КАК ДокументДвижения,
	|	ВЫБОР
	|		КОГДА УчетСебестоимости.КорАналитикаУчетаНоменклатуры = ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаНоменклатуры.ПустаяСсылка)
	|		ТОГДА УчетСебестоимости.АналитикаУчетаНоменклатуры
	|		ИНАЧЕ УчетСебестоимости.КорАналитикаУчетаНоменклатуры
	|	КОНЕЦ КАК АналитикаУчетаНоменклатурыДляСвязи,
	|	ВЫБОР
	|		КОГДА УчетСебестоимости.КорВидЗапасов = ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка)
	|		ТОГДА УчетСебестоимости.ВидЗапасов
	|		ИНАЧЕ УчетСебестоимости.КорВидЗапасов
	|	КОНЕЦ КАК ВидЗапасовДляСвязи,
	|
	|	СУММА(ВЫБОР
	|		КОГДА УчетСебестоимости.ТипЗаписи В (
	|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ОтклонениеВСтоимости),
	|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.РаспределениеПоВыбывшимТоварам),
	|				ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаПриобретенияПрошлогоПериода))
	|		 И УчетСебестоимости.ДопРасходыРегл	<> 0
	|			ТОГДА УчетСебестоимости.ДопРасходыРегл
	|		КОГДА НЕ ЗнаменателиРасходов.Знаменатель ЕСТЬ NULL
	|			ТОГДА ЗнаменателиРасходов.Знаменатель
	|		КОГДА ЕСТЬNULL(Цены.СтоимостьРегл + Цены.ДопРасходыРегл + Цены.ТрудозатратыРегл, 0) = 0
    |			ТОГДА УчетСебестоимости.НДСРеглРеквизит
	|		ИНАЧЕ ВЫРАЗИТЬ(УчетСебестоимости.Количество * ЕСТЬNULL(Цены.СтоимостьРегл + Цены.ДопРасходыРегл + Цены.ТрудозатратыРегл, 0) КАК ЧИСЛО(31,2)) КОНЕЦ) КАК Знаменатель
	|ПОМЕСТИТЬ ВТСебестоимость
	|ИЗ
	|	ВТКэшРасчетныеОборотыСебестоимостьТоваров КАК УчетСебестоимости
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВтРегистраторы КАК Регистраторы
	|		ПО Регистраторы.Регистратор = УчетСебестоимости.Регистратор
	|	ЛЕВОЕ СОЕДИНЕНИЕ ЗнаменателиРасходов КАК ЗнаменателиРасходов
	|		ПО ЗнаменателиРасходов.Регистратор = УчетСебестоимости.Регистратор
	|		И ЗнаменателиРасходов.Партия = УчетСебестоимости.Партия
	|		И ЗнаменателиРасходов.АналитикаУчетаПартий = УчетСебестоимости.АналитикаУчетаПартий
    |		И ЗнаменателиРасходов.НалоговоеНазначение = УчетСебестоимости.НалоговоеНазначение
	|		И ЗнаменателиРасходов.АналитикаФинансовогоУчета = УчетСебестоимости.АналитикаФинансовогоУчета
	|		И ЗнаменателиРасходов.АналитикаУчетаНоменклатуры = УчетСебестоимости.АналитикаУчетаНоменклатуры
	|		И ЗнаменателиРасходов.ВидЗапасов = УчетСебестоимости.ВидЗапасов
	|		И ЗнаменателиРасходов.РазделУчета = УчетСебестоимости.РазделУчета
	|		И ЗнаменателиРасходов.Организация = УчетСебестоимости.Организация
	|	ЛЕВОЕ СОЕДИНЕНИЕ ВТСтоимостьПартийТоваровПредыдущая КАК Цены
	|		ПО Цены.Организация = УчетСебестоимости.Организация
	|		И Цены.Партия = УчетСебестоимости.Партия
	|		И Цены.АналитикаУчетаПартий = УчетСебестоимости.АналитикаУчетаПартий
	|		И Цены.АналитикаФинансовогоУчета = УчетСебестоимости.АналитикаФинансовогоУчета
    |		И Цены.НалоговоеНазначение = УчетСебестоимости.НалоговоеНазначение
	|		И Цены.АналитикаУчетаНоменклатуры = УчетСебестоимости.АналитикаУчетаНоменклатуры
	|		И Цены.ВидЗапасов = УчетСебестоимости.ВидЗапасов
	|		И Цены.РазделУчета = УчетСебестоимости.РазделУчета
	|	ЛЕВОЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК АналитикаНоменклатуры
	|		ПО УчетСебестоимости.АналитикаУчетаНоменклатуры = АналитикаНоменклатуры.Ссылка
	|	ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Назначения КАК СпрНазначения
	|		ПО СпрНазначения.Ссылка = АналитикаНоменклатуры.Назначение
	|	ЛЕВОЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК КорАналитикаНоменклатуры
	|		ПО УчетСебестоимости.КорАналитикаУчетаНоменклатуры = КорАналитикаНоменклатуры.Ссылка
	|ГДЕ
	|	НЕ УчетСебестоимости.СлужебноеВидДвиженияПриход
	|	И УчетСебестоимости.Организация В(&ОрганизацииСУчетомПартийНДСВерсии24)
	|	И (УчетСебестоимости.КорРазделУчета <> ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПустаяСсылка)
	|		ИЛИ УчетСебестоимости.СтатьяРасходовСписания <> ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиРасходов.ПустаяСсылка)
	|			И УчетСебестоимости.СтатьяРасходовСписания <> НЕОПРЕДЕЛЕНО)
	|	И УчетСебестоимости.ХозяйственнаяОперация <> ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РеализацияТоваровВДругуюОрганизацию)
	|	И УчетСебестоимости.РазделУчета <> ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПринятыеНаКомиссию)
	|	И УчетСебестоимости.РазделУчета <> ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.МатериалыПринятыеВПереработку)
	|	
	|СГРУППИРОВАТЬ ПО
	|	УчетСебестоимости.Период,
	|	УчетСебестоимости.Регистратор,
	|	УчетСебестоимости.Организация,
	|	УчетСебестоимости.АналитикаУчетаНоменклатуры,
	|	УчетСебестоимости.ВидЗапасов,
	|	УчетСебестоимости.Партия,
	|	УчетСебестоимости.АналитикаУчетаПартий,
	|	УчетСебестоимости.АналитикаФинансовогоУчета,
	|	ВЫБОР КОГДА УчетСебестоимости.СтатьяРасходовСписания = ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиРасходов.ПустаяСсылка)
	|		ТОГДА НЕОПРЕДЕЛЕНО
	|		ИНАЧЕ УчетСебестоимости.СтатьяРасходовСписания
	|	КОНЕЦ,
	|	УчетСебестоимости.СтатьяРасходовСписания.ВариантРаспределенияРасходовУпр,
	|	УчетСебестоимости.СтатьяРасходовСписания.ВариантРаспределенияРасходовРегл,
	|	УчетСебестоимости.АналитикаРасходов,
	|
	|	УчетСебестоимости.РазделУчета,
	|	УчетСебестоимости.АналитикаУчетаПоПартнерам,
	|	УчетСебестоимости.ЗаказКлиента,
	|	(ВЫБОР
	|		КОГДА УчетСебестоимости.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукции)
	|			ТОГДА НЕОПРЕДЕЛЕНО
	|		ИНАЧЕ УчетСебестоимости.ХозяйственнаяОперация КОНЕЦ),
	|	УчетСебестоимости.КорАналитикаУчетаНоменклатуры,
	|	УчетСебестоимости.КорРазделУчета,
	|	УчетСебестоимости.КорВидЗапасов,
	|	УчетСебестоимости.КорОрганизация,
	|	УчетСебестоимости.Подразделение,
	|	УчетСебестоимости.ГруппаПродукции,
	|	ЕСТЬNULL(СпрНазначения.НаправлениеДеятельности,
	|		ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка)),
	|	УчетСебестоимости.КорНаправлениеДеятельности,
	|	ВЫБОР КОГДА УчетСебестоимости.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.РаспределениеПоВыбывшимТоварам)
	|		ТОГДА УчетСебестоимости.Партия
	|		ИНАЧЕ УчетСебестоимости.КорПартия
	|	КОНЕЦ,
	|	ВЫБОР КОГДА УчетСебестоимости.ТипЗаписи = ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.РаспределениеПоВыбывшимТоварам)
	|		ТОГДА УчетСебестоимости.АналитикаУчетаПартий
	|		ИНАЧЕ УчетСебестоимости.КорАналитикаУчетаПартий
	|	КОНЕЦ,
	|	УчетСебестоимости.КорАналитикаФинансовогоУчета,
    |	УчетСебестоимости.НалоговоеНазначение,
    |	УчетСебестоимости.КорНалоговоеНазначение,
	|	ВЫБОР
	|		КОГДА УчетСебестоимости.КорАналитикаУчетаНоменклатуры = ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаНоменклатуры.ПустаяСсылка)
	|		ТОГДА УчетСебестоимости.АналитикаУчетаНоменклатуры
	|		ИНАЧЕ УчетСебестоимости.КорАналитикаУчетаНоменклатуры
	|	КОНЕЦ,
	|	ВЫБОР
	|		КОГДА УчетСебестоимости.КорВидЗапасов = ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка)
	|		ТОГДА УчетСебестоимости.ВидЗапасов
	|		ИНАЧЕ УчетСебестоимости.КорВидЗапасов
	|	КОНЕЦ
	|////////////////////////////////////////////////////////////////////////////////
	|
	|;
	|ВЫБРАТЬ
	|	Т.Регистратор,
	|	Т.Организация,
	|	Т.Партия,
    |	Т.НалоговоеНазначение,
	|	Т.АналитикаУчетаНоменклатурыДляСвязи,
	|	Т.ВидЗапасовДляСвязи,
	|	СУММА(ВЫБОР КОГДА Т.Знаменатель < 0
	|		ТОГДА -Т.Знаменатель
	|		ИНАЧЕ Т.Знаменатель 
	|	КОНЕЦ) КАК Знаменатель
	|ПОМЕСТИТЬ ЗнаменателиСебестоимости
	|ИЗ
	|	ВТСебестоимость КАК Т
	|СГРУППИРОВАТЬ ПО
	|	Т.Регистратор,
	|	Т.Организация,
	|	Т.Партия,
    |	Т.НалоговоеНазначение,
	|	Т.АналитикаУчетаНоменклатурыДляСвязи,
	|	Т.ВидЗапасовДляСвязи
	|////////////////////////////////////////////////////////////////////////////////
	|
	|;
	|ВЫБРАТЬ
	|	2 КАК Порядок,
	|	УчетСебестоимости.Период КАК Период,
	|	УчетСебестоимости.Регистратор КАК Регистратор,
	|	УчетСебестоимости.Организация КАК Организация,
	|	УчетСебестоимости.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
	|	УчетСебестоимости.ВидЗапасов КАК ВидЗапасов,
	|	УчетСебестоимости.Партия КАК Партия,
	|	УчетСебестоимости.АналитикаФинансовогоУчета КАК АналитикаФинансовогоУчета,
	|	УчетСебестоимости.СтатьяРасходовСписания КАК СтатьяРасходовСписания,
	|	УчетСебестоимости.АналитикаРасходов КАК АналитикаРасходов,
	|
	|	ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход) КАК ВидДвижения,
	|	УчетСебестоимости.РазделУчета КАК РазделУчета,
	|	УчетСебестоимости.АналитикаУчетаПоПартнерам КАК АналитикаУчетаПоПартнерам,
	|	УчетСебестоимости.ЗаказКлиента КАК ЗаказКлиента,
	|	УчетСебестоимости.ХозяйственнаяОперация КАК ХозяйственнаяОперация,
	|	УчетСебестоимости.КорАналитикаУчетаНоменклатуры КАК КорАналитикаУчетаНоменклатуры,
	|	УчетСебестоимости.КорРазделУчета КАК КорРазделУчета,
	|	УчетСебестоимости.КорВидЗапасов КАК КорВидЗапасов,
	|	УчетСебестоимости.КорОрганизация КАК КорОрганизация,
	|	УчетСебестоимости.Подразделение КАК Подразделение,
	|	УчетСебестоимости.ВариантРаспределенияРасходовУпр КАК ВариантРаспределенияРасходовУпр,
	|	УчетСебестоимости.ВариантРаспределенияРасходовРегл КАК ВариантРаспределенияРасходовРегл,
	|	УчетСебестоимости.ГруппаПродукции КАК ГруппаПродукции,
	|	УчетСебестоимости.НаправлениеДеятельности КАК НаправлениеДеятельности,
	|	УчетСебестоимости.КорНаправлениеДеятельности КАК КорНаправлениеДеятельности,
	|	УчетСебестоимости.КорПартия,
	|	УчетСебестоимости.КорАналитикаУчетаПартий,
	|	УчетСебестоимости.КорАналитикаФинансовогоУчета,
    |	УчетСебестоимости.КорНалоговоеНазначение,
	|	УчетСебестоимости.ДокументДвижения КАК ДокументДвижения,
	|	ЛОЖЬ КАК ЭтоПередачаМеждуОрганизациями,
	|	УчетСебестоимости.АналитикаУчетаНоменклатурыДляСвязи КАК АналитикаУчетаНоменклатурыДляСвязи,
	|	УчетСебестоимости.ВидЗапасовДляСвязи КАК ВидЗапасовДляСвязи,
	|
	|	СУММА(ВЫБОР КОГДА УчетСебестоимости.Знаменатель < 0
	|		ТОГДА -УчетСебестоимости.Знаменатель
	|		ИНАЧЕ УчетСебестоимости.Знаменатель 
	|	КОНЕЦ) КАК Количество,
	|	0 КАК Стоимость,
	|	0 КАК СтоимостьБезНДС,
	|	0 КАК ДопРасходы,
	|	0 КАК ДопРасходыБезНДС,
	|	0 КАК СтоимостьЗабалансовая,
	|	0 КАК СтоимостьЗабалансоваяРегл,
    |	0 КАК СтоимостьРегл,
    |	0 КАК СтоимостьУпр,
    |	0 КАК ДопРасходыРегл,
    |	0 КАК ДопРасходыУпр,
    |	0 КАК СтоимостьРеглБезНДС,
    |	0 КАК НДСРегл,
    |	0 КАК СтоимостьУпрБезНДС,
    |	0 КАК ДопРасходыРеглБезНДС,
    |	0 КАК ДопРасходыУпрБезНДС,
    |	0 КАК НДСРеглРеквизит,
	|	0 КАК НДСУпр,
	|	0 КАК ПостояннаяРазница,
	|	0 КАК ВременнаяРазница,
	|	СУММА(ВЫБОР КОГДА УчетСебестоимости.Знаменатель < 0
	|		ТОГДА -УчетСебестоимости.Знаменатель
	|		ИНАЧЕ УчетСебестоимости.Знаменатель 
	|	КОНЕЦ) КАК ИсходноеКоличество
	|ИЗ
	|	ВТСебестоимость КАК УчетСебестоимости
	|
	|СГРУППИРОВАТЬ ПО
	|	УчетСебестоимости.Период,
	|	УчетСебестоимости.Регистратор,
	|	УчетСебестоимости.Организация,
	|	УчетСебестоимости.АналитикаУчетаНоменклатуры,
	|	УчетСебестоимости.ВидЗапасов,
	|	УчетСебестоимости.Партия,
	|	УчетСебестоимости.АналитикаУчетаПартий,
	|	УчетСебестоимости.КорПартия,
	|	УчетСебестоимости.КорАналитикаУчетаПартий,
	|	УчетСебестоимости.АналитикаФинансовогоУчета,
	|	УчетСебестоимости.СтатьяРасходовСписания,
	|	УчетСебестоимости.АналитикаРасходов,
	|	УчетСебестоимости.РазделУчета,
	|	УчетСебестоимости.АналитикаУчетаПоПартнерам,
	|	УчетСебестоимости.ЗаказКлиента,
	|	УчетСебестоимости.ХозяйственнаяОперация,
	|	УчетСебестоимости.КорАналитикаУчетаНоменклатуры,
	|	УчетСебестоимости.КорРазделУчета,
	|	УчетСебестоимости.КорВидЗапасов,
	|	УчетСебестоимости.КорОрганизация,
	|	УчетСебестоимости.Подразделение,
	|	УчетСебестоимости.ВариантРаспределенияРасходовУпр,
	|	УчетСебестоимости.ВариантРаспределенияРасходовРегл,
	|	УчетСебестоимости.ГруппаПродукции,
	|	УчетСебестоимости.НаправлениеДеятельности,
	|	УчетСебестоимости.КорНаправлениеДеятельности,
	|	УчетСебестоимости.КорАналитикаФинансовогоУчета,
    |	УчетСебестоимости.КорНалоговоеНазначение,
	|	УчетСебестоимости.ДокументДвижения,
	|	УчетСебестоимости.АналитикаУчетаНоменклатурыДляСвязи,
	|	УчетСебестоимости.ВидЗапасовДляСвязи
	|
	|ИМЕЮЩИЕ
	|	СУММА(ВЫБОР КОГДА УчетСебестоимости.Знаменатель < 0
	|		ТОГДА -УчетСебестоимости.Знаменатель
	|		ИНАЧЕ УчетСебестоимости.Знаменатель 
	|	КОНЕЦ) <> 0
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	1 КАК Порядок,
	|	Партии.Период КАК Период,
	|	Партии.Регистратор КАК Регистратор,
	|	Партии.Организация КАК Организация,
	|	Партии.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
	|	Партии.ВидЗапасов КАК ВидЗапасов,
	|	Партии.Партия КАК Партия,
	|	Партии.АналитикаФинансовогоУчета КАК АналитикаФинансовогоУчета,
	|	Партии.СтатьяРасходовСписания КАК СтатьяРасходовСписания,
	|	Партии.АналитикаРасходов КАК АналитикаРасходов,
	|
	|	НЕОПРЕДЕЛЕНО КАК ВидДвижения,
	|	НЕОПРЕДЕЛЕНО КАК РазделУчета,
	|	НЕОПРЕДЕЛЕНО КАК АналитикаУчетаПоПартнерам,
	|	НЕОПРЕДЕЛЕНО КАК ЗаказКлиента,
	|	НЕОПРЕДЕЛЕНО КАК ХозяйственнаяОперация,
	|	НЕОПРЕДЕЛЕНО КАК КорАналитикаУчетаНоменклатуры,
	|	НЕОПРЕДЕЛЕНО КАК КорРазделУчета,
	|	НЕОПРЕДЕЛЕНО КАК КорВидЗапасов,
	|	НЕОПРЕДЕЛЕНО КАК КорОрганизация,
	|	НЕОПРЕДЕЛЕНО КАК Подразделение,
	|	НЕОПРЕДЕЛЕНО КАК ВариантРаспределенияРасходовУпр,
	|	НЕОПРЕДЕЛЕНО КАК ВариантРаспределенияРасходовРегл,
	|	НЕОПРЕДЕЛЕНО КАК ГруппаПродукции,
	|	НЕОПРЕДЕЛЕНО КАК НаправлениеДеятельности,
	|	НЕОПРЕДЕЛЕНО КАК КорНаправлениеДеятельности,
	|	НЕОПРЕДЕЛЕНО КАК КорПартия,
	|	НЕОПРЕДЕЛЕНО КАК КорАналитикаУчетаПартий,
	|	НЕОПРЕДЕЛЕНО КАК КорАналитикаФинансовогоУчета,
    |	НЕОПРЕДЕЛЕНО КАК КорНалоговоеНазначение,
	|	НЕОПРЕДЕЛЕНО КАК ДокументДвижения,
	|	ЛОЖЬ 		 КАК ЭтоПередачаМеждуОрганизациями,
	|	Партии.АналитикаУчетаНоменклатурыДляСвязи КАК АналитикаУчетаНоменклатурыДляСвязи,
	|	Партии.ВидЗапасовДляСвязи КАК ВидЗапасовДляСвязи,
	|	СУММА(ВЫБОР
	|		КОГДА НЕ ЗнаменателиСебестоимости.Знаменатель ЕСТЬ NULL
	|			ТОГДА ЗнаменателиСебестоимости.Знаменатель
	|		КОГДА Партии.Знаменатель < 0 ТОГДА
	|			-Партии.Знаменатель
	|		ИНАЧЕ Партии.Знаменатель
	|	КОНЕЦ) КАК Количество,
	|	0 КАК Стоимость,
	|	0 КАК СтоимостьБезНДС,
	|	0 КАК ДопРасходы,
	|	0 КАК ДопРасходыБезНДС,
	|	0 КАК СтоимостьЗабалансовая,
	|	0 КАК СтоимостьЗабалансоваяРегл,
    |	СУММА(Партии.НДСРегл) КАК СтоимостьРегл,
    |	СУММА(Партии.НДСУпр) КАК СтоимостьУпр,
    |	0 КАК ДопРасходыРегл,
    |	0 КАК ДопРасходыУпр,
    |	0 КАК СтоимостьРеглБезНДС,
    |	0 КАК НДСРегл,
    |	0 КАК СтоимостьУпрБезНДС,
    |	0 КАК ДопРасходыРеглБезНДС,
    |	0 КАК ДопРасходыУпрБезНДС,
    |	0 КАК НДСРеглРеквизит,
	|	0 КАК НДСУпр,
	|	0 КАК ПостояннаяРазница,
	|	0 КАК ВременнаяРазница,
	|	0 КАК ИсходноеКоличество
	|ИЗ
	|	ВтПартии КАК Партии
	|	ЛЕВОЕ СОЕДИНЕНИЕ ЗнаменателиСебестоимости КАК ЗнаменателиСебестоимости
	|		ПО ЗнаменателиСебестоимости.Регистратор = Партии.Регистратор
	|		И ЗнаменателиСебестоимости.Организация = Партии.Организация
	|		И ЗнаменателиСебестоимости.Партия = Партии.Партия
    |		И ЗнаменателиСебестоимости.НалоговоеНазначение = Партии.НалоговоеНазначение
	|		И ЗнаменателиСебестоимости.АналитикаУчетаНоменклатурыДляСвязи = Партии.АналитикаУчетаНоменклатурыДляСвязи
	|		И ЗнаменателиСебестоимости.ВидЗапасовДляСвязи = Партии.ВидЗапасовДляСвязи
	|ГДЕ
	|	Партии.Знаменатель > 0
	|
	|СГРУППИРОВАТЬ ПО
	|	Партии.Период,
	|	Партии.Регистратор,
	|	Партии.Организация,
	|	Партии.АналитикаУчетаНоменклатуры,
	|	Партии.ВидЗапасов,
	|	Партии.Партия,
	|	Партии.АналитикаФинансовогоУчета,
	|	Партии.СтатьяРасходовСписания,
	|	Партии.АналитикаРасходов,
	|	Партии.АналитикаУчетаНоменклатурыДляСвязи,
	|	Партии.ВидЗапасовДляСвязи
	|
	|ИМЕЮЩИЕ
	|	СУММА(ВЫБОР
	|		КОГДА НЕ ЗнаменателиСебестоимости.Знаменатель ЕСТЬ NULL
	|			ТОГДА ЗнаменателиСебестоимости.Знаменатель
	|		КОГДА Партии.Знаменатель < 0 ТОГДА
	|			-Партии.Знаменатель
	|		ИНАЧЕ Партии.Знаменатель
	|	КОНЕЦ) <> 0
	|	И (СУММА(Партии.НДСРегл) <> 0 ИЛИ СУММА(Партии.НДСУпр) <> 0)
	|
	|УПОРЯДОЧИТЬ ПО
	|	Регистратор,
	|	Организация,
	|	Партия,
	|	СтатьяРасходовСписания,
	|	АналитикаРасходов,
	|	АналитикаУчетаНоменклатурыДляСвязи,
	|	ВидЗапасовДляСвязи,
	|	АналитикаУчетаНоменклатуры,
	|	ВидЗапасов,
	|	АналитикаФинансовогоУчета,
	|	Порядок
	|";
	
	ЗаписьРаспределения = Новый Структура("
	|Период, АналитикаУчетаНоменклатуры, РазделУчета, ВидЗапасов, Организация, Склад, Партия, АналитикаФинансовогоУчета,
	|АналитикаУчетаНоменклатурыДляСвязи, ВидЗапасовДляСвязи,
	|ХозяйственнаяОперация, ЗаказКлиента, ТипЗапасов, АналитикаУчетаПоПартнерам, ЭтоПередачаМеждуОрганизациями,
	|КорАналитикаУчетаНоменклатуры, КорРазделУчета, КорВидЗапасов, КорТипЗапасов, КорОрганизация,
	|АналитикаУчетаНоменклатурыВО, АналитикаФинансовогоУчетаВО, АналитикаАктивовПассивов, КорСклад,
	|СтатьяАктивовПассивов, Подразделение, АналитикаРасходов, СтатьяРасходовСписания, СтатьяДоходов, АналитикаДоходов,
	|ВариантРаспределенияРасходовУпр, ВариантРаспределенияРасходовРегл,
    |ДокументДвижения, ИдентификаторСтроки, ГруппаПродукции, 
	|ИсточникГФУНоменклатуры, КорИсточникГФУНоменклатуры, НаправлениеДеятельности, КорНаправлениеДеятельности,
	|Стоимость, СтоимостьБезНДС, Количество, КорСтоимость, ПостояннаяРазница, ВременнаяРазница,
    |ДопРасходы, ДопРасходыБезНДС, СтоимостьРегл, НДСРеглРеквизит,
    |КорПартия, КорАналитикаУчетаПартий, КорАналитикаФинансовогоУчета, КорНалоговоеНазначение,
	|СтатьяКалькуляции, ТипЗаписи, ДокументИсточник,
	|СтоимостьЗабалансовая, Трудозатраты, ПостатейныеПостоянныеСНДС, ПостатейныеПостоянныеБезНДС,
    |СтоимостьЗабалансоваяРегл, ДопРасходыРегл, ТрудозатратыРегл, ПостатейныеПостоянныеРегл,
    |СтоимостьРеглБезНДС, НДСРегл, ДопРасходыРеглБезНДС, ПостатейныеПостоянныеРеглБезНДС, ПостатейныеПеременныеРеглБезНДС,
	|ПостатейныеПеременныеСНДС, ПостатейныеПеременныеБезНДС, ПостатейныеПеременныеРегл,
    |СтоимостьУпрБезНДС, ДопРасходыУпрБезНДС, ПостатейныеПостоянныеУпрБезНДС, ПостатейныеПеременныеУпрБезНДС, 
    |СтоимостьУпр, ДопРасходыУпр, ТрудозатратыУпр, ПостатейныеПостоянныеУпр, ПостатейныеПеременныеУпр, НДСУпр
	|");
	
	СуммыРаспределения = Новый Структура("
    |Количество, Стоимость, СтоимостьБезНДС, СтоимостьЗабалансовая, СтоимостьРегл, СтоимостьУпр, СтоимостьЗабалансоваяРегл, НДСРеглРеквизит, НДСУпр,
    |СтоимостьРеглБезНДС, НДСРегл, СтоимостьУпрБезНДС, ДопРасходыРеглБезНДС, ДопРасходыУпрБезНДС, 
    |ДопРасходы, ДопРасходыБезНДС, ДопРасходыРегл, ДопРасходыУпр, ПостояннаяРазница, ВременнаяРазница
	|");
	
	СтрокаОстатка = Новый Структура("
	|Регистратор, Организация, АналитикаУчетаНоменклатуры, ВидЗапасов, Партия, АналитикаФинансовогоУчета, СтатьяРасходовСписания, АналитикаРасходов,
	|АналитикаУчетаНоменклатурыДляСвязи, ВидЗапасовДляСвязи,
    |Количество, Стоимость, СтоимостьБезНДС, СтоимостьЗабалансовая, СтоимостьРегл, СтоимостьУпр, СтоимостьЗабалансоваяРегл, НДСРеглРеквизит, НДСУпр,
    |СтоимостьРеглБезНДС, НДСРегл, СтоимостьУпрБезНДС, ДопРасходыРеглБезНДС, ДопРасходыУпрБезНДС, 
	|ДопРасходы, ДопРасходыБезНДС, ДопРасходыРегл, ДопРасходыУпр, ПостояннаяРазница, ВременнаяРазница
	|");
	
	Выборка = РасчетСебестоимостиПрикладныеАлгоритмы.ВыполнитьЗапросСЗамеромДляПротокола(ПараметрыРасчета, Запрос, Истина,,,
		Метаданные.РегистрыНакопления.СебестоимостьТоваров.Имя);
	
	// Формируются движения по регистрам:
	// - СебестоимостьТоваров
	// - ПрочиеРасходы
	Пока Выборка.Следующий() Цикл
		
		Если Выборка.Порядок = 1 Тогда
			
			ЗаполнитьЗначенияСвойств(СтрокаОстатка, Выборка);
			
		ИначеЕсли СтрокаОстатка.Регистратор = Выборка.Регистратор
			И СтрокаОстатка.Организация = Выборка.Организация
			И СтрокаОстатка.Партия = Выборка.Партия
			И СтрокаОстатка.СтатьяРасходовСписания = Выборка.СтатьяРасходовСписания
			И СтрокаОстатка.АналитикаРасходов = Выборка.АналитикаРасходов
			И СтрокаОстатка.АналитикаУчетаНоменклатурыДляСвязи = Выборка.АналитикаУчетаНоменклатурыДляСвязи
			И СтрокаОстатка.ВидЗапасовДляСвязи = Выборка.ВидЗапасовДляСвязи Тогда
			
			ЗаполнитьЗначенияСвойств(ЗаписьРаспределения, Выборка);
			
			РасчетСебестоимостиКорректировкаСтоимости.РаспределитьСтоимость(СуммыРаспределения, СтрокаОстатка, Выборка, Выборка.Количество);
			РасчетСебестоимостиКорректировкаСтоимости.ДополнитьСуммыРаспределения(ЗаписьРаспределения, СуммыРаспределения);
			
			Если ЗаписьРаспределения.СтоимостьРегл <> 0 ИЛИ ЗаписьРаспределения.СтоимостьУпр <> 0 Тогда
					
				// Если есть кор. раздел - необходимо скорректировать стоимость в кор. части.
				Если ЗначениеЗаполнено(ЗаписьРаспределения.КорРазделУчета) Тогда
					
					РасчетСебестоимостиКорректировкаСтоимости.СформироватьКорДвиженияСебестоимостьТоваров(ПараметрыРасчета, ЗаписьРаспределения, ПараметрыРасчета.ПредварительныйРасчет);
							
				КонецЕсли;
				
				Если ПараметрыРасчета.ПредварительныйРасчет Тогда
					Продолжить;
				КонецЕсли;
				
				// Корректировка списания товаров на затраты в регистре учет прочих расходов.
				Если Выборка.ХозяйственнаяОперация = Перечисления.ХозяйственныеОперации.СписаниеТоваров
				 Или Выборка.ХозяйственнаяОперация = Перечисления.ХозяйственныеОперации.СписаниеТоваровПоТребованию
				 Или Выборка.ХозяйственнаяОперация = Перечисления.ХозяйственныеОперации.СторноСписанияНаРасходы
				 Или Выборка.ХозяйственнаяОперация = Перечисления.ХозяйственныеОперации.ПересортицаТоваровСПереоценкой
				 Или Выборка.ХозяйственнаяОперация = Перечисления.ХозяйственныеОперации.ПорчаТоваровСПереоценкой
				 Или Выборка.ХозяйственнаяОперация = Перечисления.ХозяйственныеОперации.ВозвратТоваровПоставщику
				 //++ НЕ УТ
				 Или Выборка.ХозяйственнаяОперация = Перечисления.ХозяйственныеОперации.ПередачаВСоставОС
				 Или Выборка.ХозяйственнаяОперация = Перечисления.ХозяйственныеОперации.ПередачаВСоставНМА
				 //-- НЕ УТ
				 Или Выборка.ХозяйственнаяОперация = Перечисления.ХозяйственныеОперации.ПередачаНаПрочиеЦели
				 Или Выборка.ХозяйственнаяОперация = Перечисления.ХозяйственныеОперации.ПередачаВЭксплуатацию
				 Или Выборка.ХозяйственнаяОперация = Перечисления.ХозяйственныеОперации.ОтчетКомиссионераОСписании Тогда
				 	
				 	СуммовыеПоказатели = Новый Структура;
					СуммовыеПоказатели.Вставить("СуммаСНДС", 0);
					СуммовыеПоказатели.Вставить("СуммаБезНДС", 0);
                    СуммовыеПоказатели.Вставить("СуммаРегл", ЗаписьРаспределения.СтоимостьРегл);
                    СуммовыеПоказатели.Вставить("СуммаУпр", ЗаписьРаспределения.СтоимостьУпр);
                    СуммовыеПоказатели.Вставить("СуммаРеглБезНДС", 0);
                    СуммовыеПоказатели.Вставить("СуммаУпрБезНДС", 0);
                    СуммовыеПоказатели.Вставить("НДСРегл", 0);
					СуммовыеПоказатели.Вставить("ПостояннаяРазница", 0);
					СуммовыеПоказатели.Вставить("ВременнаяРазница", 0);
				 
				 	РасчетСебестоимостиКорректировкаСтоимости.СформироватьДвиженияПрочиеРасходы(
				 		ПараметрыРасчета,
						ЗаписьРаспределения,
						СуммовыеПоказатели);
					
				КонецЕсли;

			КонецЕсли;
			
		КонецЕсли;

	КонецЦикла;
	
	РасчетСебестоимостиПрикладныеАлгоритмы.УничтожитьВременныеТаблицы(ПараметрыРасчета,
		"ВтПартии, ВтРегистраторы, ВТСебестоимость, ЗнаменателиСебестоимости"
		+ ?(НЕ ВыполненРасчетПартийНДС, ", ЗнаменателиРасходов", ""));
	
	РасчетСебестоимостиПрикладныеАлгоритмы.КэшироватьСформированныеДвижения(ПараметрыРасчета);
	
КонецПроцедуры

// Этап 3.18
Процедура ВключитьИсключитьНДСВСтоимостьПродаж(ПараметрыРасчета) Экспорт

	РасчетСебестоимостиПротоколРасчета.НачалоЭтапаРасчета(ПараметрыРасчета, "ВключитьИсключитьНДСВСтоимостьПродаж");
	
	Запрос = Новый Запрос;
	РасчетСебестоимостиКорректировкаСтоимости.ИнициализироватьСвойстваЗапроса(Запрос, ПараметрыРасчета);
	
	Запрос.Текст = "
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	Продажи.Период,
	|	Продажи.Регистратор,
	|	АналитикаПартнеров.Организация,
	|	Продажи.АналитикаУчетаНоменклатуры,
	|	Продажи.Партия,
	|	Продажи.АналитикаФинансовогоУчета,
    |	Продажи.НалоговоеНазначение
	|ПОМЕСТИТЬ ДвиженияПродаж
	|ИЗ
	|	ВТКэшРасчетныеОборотыВыручкаИСебестоимостьПродаж КАК Продажи
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТОтборАналитикаПоПартнерам КАК АналитикаПартнеров
	|		ПО Продажи.АналитикаУчетаПоПартнерам = АналитикаПартнеров.КлючАналитики
	|ГДЕ
	|	&ПартионныйУчетВерсии22
	|	И АналитикаПартнеров.Организация В(&ОрганизацииСУчетомПартийНДСВерсии22)
	|	И Продажи.ТипЗапасов <> ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.КомиссионныйТовар)
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	Период,
	|	Регистратор,
	|	Организация,
	|	АналитикаУчетаНоменклатуры,
	|	Партия,
	|	АналитикаФинансовогоУчета,
    |	НалоговоеНазначение
	|;
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	Партии.Период КАК Период,
	|	Партии.Регистратор КАК Регистратор,
	|	Партии.Организация КАК Организация,
	|	Партии.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
	|	Партии.ВидЗапасов КАК ВидЗапасов,
	|	Партии.СтатьяСписанияНДС,
	|	Партии.АналитикаСписанияНДС,
	|	Партии.РазделУчета,
	|	Партии.Партия,
	|	Партии.АналитикаУчетаПартий,
	|	Партии.АналитикаФинансовогоУчета,
    |	Партии.НалоговоеНазначениеПродаж КАК НалоговоеНазначение,
	|	Партии.РаспределениеПоВыбывшимТоварам,
	|	СУММА(Партии.Количество) КАК Количество,
	|	СУММА(ВЫБОР
	|		КОГДА Партии.СтатьяСписанияНДС <> ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиРасходов.ПустаяСсылка)
	|			ТОГДА 0
    |		КОГДА 
	|		    (
	|				(Партии.НалоговоеНазначениеПартии.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ВидыДеятельностиНДС.Облагаемая) 
	|	   				И Партии.НалоговоеНазначение.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ВидыДеятельностиНДС.Необлагаемая))
	|				ИЛИ (Партии.НалоговоеНазначениеПартии.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ВидыДеятельностиНДС.ПропорциональноОблагаемая) 
	|	   				И Партии.НалоговоеНазначение = ЗНАЧЕНИЕ(Справочник.НалоговыеНазначенияАктивовИЗатрат.НДС_НеоблагаемаяНеХозДеятельность))
	|           )
	|		ТОГДА
	|			Партии.НДСРегл
	|
	|
	|		КОГДА Партии.НалоговоеНазначениеПартии.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ВидыДеятельностиНДС.Необлагаемая) 
	|		      И Партии.НалоговоеНазначение.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ВидыДеятельностиНДС.Облагаемая) 
	|		ТОГДА
	|			-Партии.НДСРегл
	|		ИНАЧЕ
	|			0
	|		КОНЕЦ
	|	) КАК НДСРегл,
	|	СУММА(
	|		ВЫБОР КОГДА Партии.СтатьяСписанияНДС <> ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиРасходов.ПустаяСсылка)
	|			ТОГДА 0
    |		КОГДА 
	|		    (
	|				(Партии.НалоговоеНазначениеПартии.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ВидыДеятельностиНДС.Облагаемая) 
	|	   				И Партии.НалоговоеНазначение.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ВидыДеятельностиНДС.Необлагаемая))
	|				ИЛИ (Партии.НалоговоеНазначениеПартии.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ВидыДеятельностиНДС.ПропорциональноОблагаемая) 
	|	   				И Партии.НалоговоеНазначение = ЗНАЧЕНИЕ(Справочник.НалоговыеНазначенияАктивовИЗатрат.НДС_НеоблагаемаяНеХозДеятельность))
	|           )
	|		ТОГДА
	|			Партии.НДСУпр
	|
	|
	|		КОГДА Партии.НалоговоеНазначениеПартии.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ВидыДеятельностиНДС.Необлагаемая) 
	|		      И Партии.НалоговоеНазначение.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ВидыДеятельностиНДС.Облагаемая) 
	|		ТОГДА
	|			-Партии.НДСУпр
	|		ИНАЧЕ
	|			0
	|		КОНЕЦ
	|	) КАК НДСУпр,
	|	СУММА(
	|		ВЫБОР КОГДА Партии.СтатьяСписанияНДС <> ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиРасходов.ПустаяСсылка)
	|			ТОГДА Партии.НДСРегл
	|		ИНАЧЕ
	|			0
	|		КОНЕЦ
	|	) КАК СписаниеНДС,
	|	СУММА(
	|		ВЫБОР КОГДА Партии.СтатьяСписанияНДС <> ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиРасходов.ПустаяСсылка)
	|			ТОГДА Партии.НДСУпр
	|		ИНАЧЕ
	|			0
	|		КОНЕЦ
	|	) КАК СписаниеНДСУпр
	|ПОМЕСТИТЬ ВтПартии
	|ИЗ (
	|	ВЫБРАТЬ
	|		Партии.Период КАК Период,
	|		Партии.Регистратор КАК Регистратор,
	|		Партии.Организация КАК Организация,
	|		Партии.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
	|		Партии.ВидЗапасов КАК ВидЗапасов,
    |		Партии.АналитикаУчетаПартий.НалоговоеНазначение КАК НалоговоеНазначениеПартии,
    |		Партии.НалоговоеНазначение,
	|		Партии.ДокументПоступления,
	|		Партии.Количество КАК Количество,
	|		Партии.НДСРегл КАК НДСРегл,
	|		0 КАК НДСУпр,
	|		Партии.СтатьяСписанияНДС,
	|		Партии.АналитикаСписанияНДС,
	|		ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПустаяСсылка) КАК РазделУчета,
	|		НЕОПРЕДЕЛЕНО КАК Партия,
	|		ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка) КАК АналитикаУчетаПартий,
	|		НЕОПРЕДЕЛЕНО КАК АналитикаФинансовогоУчета,
    |		ЗНАЧЕНИЕ(Справочник.НалоговыеНазначенияАктивовИЗатрат.ПустаяСсылка) КАК НалоговоеНазначениеПродаж,
	|		ЛОЖЬ КАК РаспределениеПоВыбывшимТоварам
	|	ИЗ
	|		РегистрНакопления.ПартииТоваровОрганизаций КАК Партии
	|	ГДЕ
	|		НЕ &ПартионныйУчетВерсии22
	|		И Партии.Период МЕЖДУ &НачалоПериода И &КонецПериода
	|		И Партии.Активность
	|		И Партии.Организация В(&МассивОрганизаций)
	|		И Партии.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	|		И Партии.ВидЗапасов.ТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.Товар)
	|
	|	ОБЪЕДИНИТЬ ВСЕ
	|
	|	ВЫБРАТЬ
	|		Партии.Период КАК Период,
	|		Партии.Регистратор КАК Регистратор,
	|		Партии.Организация КАК Организация,
	|		Партии.АналитикаУчетаПродукции КАК АналитикаУчетаНоменклатуры,
	|		ВЫБОР КОГДА Партии.КорВидЗапасов <> ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка)
	|			ТОГДА Партии.КорВидЗапасов
	|			ИНАЧЕ Партии.ВидЗапасов
	|		КОНЕЦ КАК ВидЗапасов,
    |		Партии.АналитикаУчетаПартий.НалоговоеНазначение КАК НалоговоеНазначениеПартии,
    |		Партии.НалоговоеНазначение,
	|		Партии.ДокументПоступления,
	|		0 КАК Количество,
	|		Партии.НДСРегл КАК НДСРегл,
	|		0 КАК НДСУпр,
	|		Партии.СтатьяСписанияНДС,
	|		Партии.АналитикаСписанияНДС,
	|		ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПустаяСсылка) КАК РазделУчета,
	|		НЕОПРЕДЕЛЕНО КАК Партия,
	|		ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка) КАК АналитикаУчетаПартий,
	|		НЕОПРЕДЕЛЕНО КАК АналитикаФинансовогоУчета,
    |		ЗНАЧЕНИЕ(Справочник.НалоговыеНазначенияАктивовИЗатрат.ПустаяСсылка) КАК НалоговоеНазначениеПродаж,
	|		ЛОЖЬ КАК РаспределениеПоВыбывшимТоварам
	|	ИЗ
	|		РегистрНакопления.ПартииЗатратНаВыпуск КАК Партии
	|	ГДЕ
	|		НЕ &ПартионныйУчетВерсии22
	|		И Партии.Период МЕЖДУ &НачалоПериода И &КонецПериода
	|		И Партии.Активность
	|		И Партии.Организация В(&МассивОрганизаций)
	|		И Партии.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	|		И Партии.НДСРегл <> 0
	|
	|	ОБЪЕДИНИТЬ ВСЕ
	|
	|	ВЫБРАТЬ
	|		Партии.Период КАК Период,
	|		Партии.Регистратор КАК Регистратор,
	|		Партии.Организация КАК Организация,
	|		Партии.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
	|		Партии.ВидЗапасов КАК ВидЗапасов,
    |		Партии.АналитикаУчетаПартий.НалоговоеНазначение КАК НалоговоеНазначениеПартии,
    |		Партии.НалоговоеНазначение,
	|		Партии.ДокументПоступления,
	|		0 КАК Количество,
	|		Партии.НДСРегл КАК НДСРегл,
	|		0 КАК НДСУпр,
	|		Партии.СтатьяСписанияНДС,
	|		Партии.АналитикаСписанияНДС,
	|		ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПустаяСсылка) КАК РазделУчета,
	|		НЕОПРЕДЕЛЕНО КАК Партия,
	|		ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка) КАК АналитикаУчетаПартий,
	|		НЕОПРЕДЕЛЕНО КАК АналитикаФинансовогоУчета,
    |		ЗНАЧЕНИЕ(Справочник.НалоговыеНазначенияАктивовИЗатрат.ПустаяСсылка) КАК НалоговоеНазначениеПродаж,
	|		ЛОЖЬ КАК РаспределениеПоВыбывшимТоварам
	|	ИЗ
	|		РегистрНакопления.ПартииРасходовНаСебестоимостьТоваров КАК Партии
	|	ГДЕ
	|		НЕ &ПартионныйУчетВерсии22
	|		И Партии.Период МЕЖДУ &НачалоПериода И &КонецПериода
	|		И Партии.Активность
	|		И Партии.Организация В(&МассивОрганизаций)
	|		И Партии.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	|		И Партии.НДСРегл <> 0
	|
	|	ОБЪЕДИНИТЬ ВСЕ
	|
	|	ВЫБРАТЬ
	|		Партии.Период КАК Период,
	|		Партии.Регистратор КАК Регистратор,
	|		Партии.Организация КАК Организация,
	|		Партии.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
	|		Партии.ВидЗапасов КАК ВидЗапасов,
    |		Партии.АналитикаУчетаПартий.НалоговоеНазначение КАК НалоговоеНазначениеПартии,
    |		Партии.НалоговоеНазначение,
	|		Партии.ДокументПоступления,
	|		Партии.Количество КАК Количество,
	|		Партии.НДСРегл КАК НДСРегл,
	|		0 КАК НДСУпр,
	|		Партии.СтатьяСписанияНДС,
	|		Партии.АналитикаСписанияНДС,
	|		ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПустаяСсылка) КАК РазделУчета,
	|		НЕОПРЕДЕЛЕНО КАК Партия,
	|		ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка) КАК АналитикаУчетаПартий,
	|		НЕОПРЕДЕЛЕНО КАК АналитикаФинансовогоУчета,
    |		ЗНАЧЕНИЕ(Справочник.НалоговыеНазначенияАктивовИЗатрат.ПустаяСсылка) КАК НалоговоеНазначениеПродаж,
	|		ЛОЖЬ КАК РаспределениеПоВыбывшимТоварам
	|	ИЗ
	|		РегистрНакопления.ПартииПроизводственныхЗатрат КАК Партии
	|	ГДЕ
	|		НЕ &ПартионныйУчетВерсии22
	|		И Партии.Период МЕЖДУ &НачалоПериода И &КонецПериода
	|		И Партии.Активность
	|		И Партии.Организация В(&МассивОрганизаций)
	|		И Партии.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	|		И Партии.НДСРегл <> 0
	|
	|	ОБЪЕДИНИТЬ ВСЕ
	|
	|	ВЫБРАТЬ
	|		Партии.Период КАК Период,
	|		Партии.Регистратор КАК Регистратор,
	|		Партии.Организация КАК Организация,
	|		Партии.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
	|		Партии.ВидЗапасов КАК ВидЗапасов,
    |		Партии.АналитикаУчетаПартий.НалоговоеНазначение КАК НалоговоеНазначениеПартии,
    |		Партии.НалоговоеНазначение,
	|		Партии.ДокументПоступления,
	|		Партии.Количество КАК Количество,
	|		Партии.НДСРегл КАК НДСРегл,
	|		0 КАК НДСУпр,
	|		ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиРасходов.ПустаяСсылка) КАК СтатьяСписанияНДС,
	|		НЕОПРЕДЕЛЕНО КАК АналитикаСписанияНДС,
	|		ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПустаяСсылка) КАК РазделУчета,
	|		НЕОПРЕДЕЛЕНО КАК Партия,
	|		ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка) КАК АналитикаУчетаПартий,
	|		НЕОПРЕДЕЛЕНО КАК АналитикаФинансовогоУчета,
    |		ЗНАЧЕНИЕ(Справочник.НалоговыеНазначенияАктивовИЗатрат.ПустаяСсылка) КАК НалоговоеНазначениеПродаж,
	|		ЛОЖЬ КАК РаспределениеПоВыбывшимТоварам
	|	ИЗ
	|		РегистрНакопления.ПартииТоваровПереданныеНаКомиссию КАК Партии
	|	ГДЕ
	|		НЕ &ПартионныйУчетВерсии22
	|		И Партии.Период МЕЖДУ &НачалоПериода И &КонецПериода
	|		И Партии.Активность
	|		И Партии.Организация В(&МассивОрганизаций)
	|		И Партии.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	|
	|	ОБЪЕДИНИТЬ ВСЕ
	|
	|	ВЫБРАТЬ
	|		Партии.Период КАК Период,
	|		Партии.Регистратор КАК Регистратор,
	|		Партии.Организация КАК Организация,
	|		Партии.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
	|		Партии.ВидЗапасов КАК ВидЗапасов,
    |		Партии.НалоговоеНазначение КАК НалоговоеНазначениеПартии,
    |		Партии.КорНалоговоеНазначение КАК НалоговоеНазначение,
	|		Партии.ДокументПоступления,
	|		(ВЫБОР
	|			КОГДА Партии.ТипЗаписи В (
	|					ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ОтклонениеВСтоимости),
	|					ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.РаспределениеПоВыбывшимТоварам),
	|					ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаПриобретенияПрошлогоПериода))
	|				ТОГДА (ВЫБОР
	|		            КОГДА Партии.НалоговоеНазначение.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ВидыДеятельностиНДС.Необлагаемая) 
	|						ТОГДА Партии.СтоимостьБезНДС + Партии.НДС
	|					КОГДА Партии.СтоимостьБезНДС = 0 ТОГДА Партии.НДС
	|					ИНАЧЕ Партии.СтоимостьБезНДС КОНЕЦ)
	|			ИНАЧЕ Партии.Количество КОНЕЦ) КАК Количество,
	|		Партии.НДС КАК НДСРегл,
	|		Партии.НДСУпр КАК НДСУпр,
	|		Партии.СтатьяСписанияНДС,
	|		Партии.АналитикаСписанияНДС,
	|		Партии.РазделУчета,
	|		(ВЫБОР
	|			КОГДА ДвиженияПродаж.Регистратор ЕСТЬ NULL ТОГДА НЕОПРЕДЕЛЕНО
	|			ИНАЧЕ Партии.Партия КОНЕЦ) КАК Партия,
	|		ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка) КАК АналитикаУчетаПартий,
	|		Партии.АналитикаФинансовогоУчета,
    |		Партии.НалоговоеНазначение КАК НалоговоеНазначениеПродаж,
	|		(ВЫБОР
	|			КОГДА Партии.ТипЗаписи В (
	|					ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ОтклонениеВСтоимости),
	|					ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.РаспределениеПоВыбывшимТоварам),
	|					ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаПриобретенияПрошлогоПериода))
	|				ТОГДА ИСТИНА
	|			ИНАЧЕ ЛОЖЬ КОНЕЦ) КАК РаспределениеПоВыбывшимТоварам
	|	ИЗ
    |		ВТКэшРасчетныеОборотыДетализацияПартийТоваровДляНДС КАК Партии
	|		ЛЕВОЕ СОЕДИНЕНИЕ ДвиженияПродаж КАК ДвиженияПродаж
	|		 ПО ДвиженияПродаж.Период = Партии.Период
	|		 И ДвиженияПродаж.Регистратор = Партии.Регистратор
	|		 И ДвиженияПродаж.Организация = Партии.Организация
	|		 И ДвиженияПродаж.АналитикаУчетаНоменклатуры = Партии.АналитикаУчетаНоменклатуры
	|		 И ДвиженияПродаж.Партия = Партии.Партия
	|		 И ДвиженияПродаж.АналитикаФинансовогоУчета = Партии.АналитикаФинансовогоУчета
    |		 И ДвиженияПродаж.НалоговоеНазначение = Партии.НалоговоеНазначение
	|	ГДЕ
	|		&ПартионныйУчетВерсии22
	|		И Партии.Организация В(&ОрганизацииСУчетомПартийНДСВерсии22)
	|		И НЕ Партии.СлужебноеВидДвиженияПриход
	|	
	|	) КАК Партии
	|	
	|	ЛЕВОЕ СОЕДИНЕНИЕ 
	|		РегистрСведений.ДанныеПервичныхДокументов КАК ДанныеПервичныхДокументов
	|	ПО
	|		ДанныеПервичныхДокументов.Организация = Партии.Организация
	|		И ДанныеПервичныхДокументов.Документ = Партии.ДокументПоступления
	|ГДЕ
    |	Партии.НалоговоеНазначение <> ЗНАЧЕНИЕ(Справочник.НалоговыеНазначенияАктивовИЗатрат.ПустаяСсылка)
	|
	|СГРУППИРОВАТЬ ПО
	|	Партии.Период,
	|	Партии.Регистратор,
	|	Партии.Организация,
	|	Партии.АналитикаУчетаНоменклатуры,
	|	Партии.ВидЗапасов,
	|	Партии.СтатьяСписанияНДС,
	|	Партии.АналитикаСписанияНДС,
	|	Партии.РазделУчета,
	|	Партии.Партия,
	|	Партии.АналитикаУчетаПартий,
	|	Партии.АналитикаФинансовогоУчета,
    |	Партии.НалоговоеНазначениеПродаж,
	|	Партии.РаспределениеПоВыбывшимТоварам
	|;
	|////////////////////////////////////////////////////////////////////////////////
	|
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	Партии.Регистратор КАК Регистратор
	|ПОМЕСТИТЬ ВтРегистраторы
	|ИЗ
	|	ВтПартии КАК Партии
	|ГДЕ
	|	Партии.НДСРегл <> 0
	|	ИЛИ Партии.НДСУпр <> 0
	|ИНДЕКСИРОВАТЬ ПО
	|	Регистратор
	|;
	|////////////////////////////////////////////////////////////////////////////////
	|
	|ВЫБРАТЬ
	|	2 КАК Порядок,
	|	Продажи.Период                     КАК Период,
	|	Продажи.Регистратор                КАК Регистратор,
	|	Продажи.Регистратор                КАК ДокументДвижения,
	|	АналитикаПартнеров.Организация     КАК Организация,
	|	Продажи.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
	|	Продажи.ВидЗапасов                 КАК ВидЗапасов,
	|	Продажи.РазделУчета				   КАК РазделУчета,
	|	Продажи.Партия				   	   КАК Партия,
	|	Продажи.АналитикаУчетаПартий	   КАК АналитикаУчетаПартий,
	|	Продажи.АналитикаФинансовогоУчета  КАК АналитикаФинансовогоУчета,
    |	Продажи.НалоговоеНазначение		   КАК НалоговоеНазначение,
	|
	|	Продажи.ЗаказКлиента               КАК ЗаказКлиента,
	|	Продажи.АналитикаУчетаПоПартнерам  КАК АналитикаУчетаПоПартнерам,
	|	Продажи.Подразделение              КАК Подразделение,
	|	Продажи.ТипЗапасов                 КАК ТипЗапасов,
	|	Продажи.Менеджер                   КАК Менеджер,
	|	Продажи.Склад                      КАК Склад,
	|	Продажи.Соглашение                 КАК Соглашение,
	|	Продажи.Договор                    КАК Договор,
	|	Продажи.ХозяйственнаяОперация      КАК ХозяйственнаяОперация,
    |	Продажи.НалоговоеНазначениеСписания КАК НалоговоеНазначениеСписания,
	|	Продажи.ВалютаВзаиморасчетов       КАК ВалютаВзаиморасчетов,
	|	Продажи.ВалютаДокумента            КАК ВалютаДокумента,
	|	Продажи.ИсточникГФУНоменклатуры    КАК ИсточникГФУНоменклатуры,
	|	Продажи.ИсточникГФУРасчетов        КАК ИсточникГФУРасчетов,
	|	Продажи.НаправлениеДеятельностиКонтрагента КАК НаправлениеДеятельностиКонтрагента,
	|	Продажи.НаправлениеДеятельностиНоменклатуры КАК НаправлениеДеятельностиНоменклатуры,
	|	СУММА(ВЫБОР
	|		КОГДА Продажи.РасчетПартий И Продажи.Количество = 0
	|			ТОГДА (ВЫБОР
	|				КОГДА Продажи.ДопРасходыРегл = 0 ТОГДА Продажи.НДСРегл
	|				ИНАЧЕ Продажи.ДопРасходыРегл КОНЕЦ)
	|		КОГДА Продажи.Количество < 0 ТОГДА
	|			0 - Продажи.Количество
	|		ИНАЧЕ
	|			Продажи.Количество
	|		КОНЕЦ
	|	) КАК Количество,
	|	0 КАК Стоимость,
	|	0 КАК СтоимостьБезНДС,
	|	0 КАК ДопРасходы,
	|	0 КАК ДопРасходыБезНДС,
	|	0 КАК СтоимостьЗабалансовая,
	|	0 КАК СтоимостьЗабалансоваяРегл,
	|	0 КАК СтоимостьРегл,
    |	0 КАК СтоимостьРеглБезНДС,
    |	0 КАК НДСРегл,
    |	0 КАК НДСРеглРеквизит,
	|	0 КАК НДСУпр,
	|	0 КАК ПостояннаяРазница,
	|	0 КАК ВременнаяРазница,
	|	0 КАК Трудозатраты,
	|	0 КАК ПостатейныеПостоянныеСНДС,
	|	0 КАК ПостатейныеПеременныеСНДС,
	|	0 КАК ПостатейныеПостоянныеБезНДС,
	|	0 КАК ПостатейныеПеременныеБезНДС,
	|	0 КАК ДопРасходыРегл,
	|	0 КАК ТрудозатратыРегл,
	|	0 КАК ПостатейныеПостоянныеРегл,
	|	0 КАК ПостатейныеПеременныеРегл,
    |	0 КАК ДопРасходыРеглБезНДС,
    |	0 КАК ПостатейныеПостоянныеРеглБезНДС,
    |	0 КАК ПостатейныеПеременныеРеглБезНДС,
	|	0 КАК СтоимостьУпр,
	|	0 КАК ДопРасходыУпр,
	|	0 КАК ТрудозатратыУпр,
	|	0 КАК ПостатейныеПостоянныеУпр,
	|	0 КАК ПостатейныеПеременныеУпр,
    |	0 СтоимостьУпрБезНДС,
    |	0 КАК ДопРасходыУпрБезНДС,
    |	0 КАК ПостатейныеПостоянныеУпрБезНДС,
    |	0 КАК ПостатейныеПеременныеУпрБезНДС,
	|
	|	СУММА(Продажи.Количество)          КАК ИсходноеКоличество,
	|	0                                  КАК КорСтоимость
	|ИЗ
	|	ВТКэшРасчетныеОборотыВыручкаИСебестоимостьПродаж КАК Продажи
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВтРегистраторы КАК Регистраторы
	|			ПО Регистраторы.Регистратор = Продажи.Регистратор
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТОтборАналитикаПоПартнерам КАК АналитикаПартнеров
	|			ПО Продажи.АналитикаУчетаПоПартнерам = АналитикаПартнеров.КлючАналитики
	|
	|ГДЕ
	|	Продажи.ТипЗапасов <> ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.КомиссионныйТовар)
	|	
	|СГРУППИРОВАТЬ ПО
	|	Продажи.Период,
	|	Продажи.Регистратор,
	|	Продажи.АналитикаУчетаНоменклатуры,
	|	Продажи.ЗаказКлиента,
	|	Продажи.АналитикаУчетаПоПартнерам,
	|	Продажи.Подразделение,
	|	Продажи.ТипЗапасов,
	|	Продажи.ВидЗапасов,
	|	Продажи.Менеджер,
	|	Продажи.Склад,
	|	Продажи.Соглашение,
	|	Продажи.Договор,
	|	Продажи.ХозяйственнаяОперация,
    |	Продажи.НалоговоеНазначениеСписания,
	|	Продажи.ВалютаВзаиморасчетов,
	|	Продажи.ВалютаДокумента,
	|	Продажи.ИсточникГФУНоменклатуры,
	|	Продажи.ИсточникГФУРасчетов,
	|	Продажи.НаправлениеДеятельностиКонтрагента,
	|	Продажи.НаправлениеДеятельностиНоменклатуры,
	|	АналитикаПартнеров.Организация,
	|	Продажи.РазделУчета,
	|	Продажи.Партия,
	|	Продажи.АналитикаУчетаПартий,
	|	Продажи.АналитикаФинансовогоУчета,
    |	Продажи.НалоговоеНазначение
	|
	|ИМЕЮЩИЕ
	|	СУММА(ВЫБОР
	|		КОГДА Продажи.РасчетПартий И Продажи.Количество = 0
	|			ТОГДА (ВЫБОР
	|				КОГДА Продажи.ДопРасходыРегл = 0 ТОГДА Продажи.НДСРегл
	|				ИНАЧЕ Продажи.ДопРасходыРегл КОНЕЦ)
	|		КОГДА Продажи.Количество < 0 ТОГДА
	|			0 - Продажи.Количество
	|		ИНАЧЕ
	|			Продажи.Количество
	|		КОНЕЦ
	|	) <> 0
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	1 								   КАК Порядок,
	|	Партии.Период 					   КАК Период,
	|	Партии.Регистратор 				   КАК Регистратор,
	|	Партии.Регистратор 				   КАК ДокументДвижения,
	|	Партии.Организация 				   КАК Организация,
	|	Партии.АналитикаУчетаНоменклатуры  КАК АналитикаУчетаНоменклатуры,
	|	Партии.ВидЗапасов 				   КАК ВидЗапасов,
	|	Партии.РазделУчета				   КАК РазделУчета,
	|	Партии.Партия				   	   КАК Партия,
	|	Партии.АналитикаУчетаПартий	       КАК АналитикаУчетаПартий,
	|	Партии.АналитикаФинансовогоУчета   КАК АналитикаФинансовогоУчета,
    |	Партии.НалоговоеНазначение		   КАК НалоговоеНазначение,
	|
	|	НЕОПРЕДЕЛЕНО КАК ЗаказКлиента,
	|	НЕОПРЕДЕЛЕНО КАК АналитикаУчетаПоПартнерам,
	|	НЕОПРЕДЕЛЕНО КАК Подразделение,
	|	НЕОПРЕДЕЛЕНО КАК ТипЗапасов,
	|	НЕОПРЕДЕЛЕНО КАК Менеджер,
	|	НЕОПРЕДЕЛЕНО КАК Склад,
	|	НЕОПРЕДЕЛЕНО КАК Соглашение,
	|	НЕОПРЕДЕЛЕНО КАК Договор,
	|	НЕОПРЕДЕЛЕНО КАК ХозяйственнаяОперация,
    |	НЕОПРЕДЕЛЕНО КАК НалоговоеНазначениеСписания,
	|	НЕОПРЕДЕЛЕНО КАК ВалютаВзаиморасчетов,
	|	НЕОПРЕДЕЛЕНО КАК ВалютаДокумента,
	|	НЕОПРЕДЕЛЕНО КАК ИсточникГФУНоменклатуры,
	|	НЕОПРЕДЕЛЕНО КАК ИсточникГФУРасчетов,
	|	НЕОПРЕДЕЛЕНО КАК НаправлениеДеятельностиКонтрагента,
	|	НЕОПРЕДЕЛЕНО КАК НаправлениеДеятельностиНоменклатуры,
	|
	|	СУММА(Партии.Количество) КАК Количество,
	|	0 КАК Стоимость,
	|	0 КАК СтоимостьБезНДС,
	|	0 КАК ДопРасходы,
	|	0 КАК ДопРасходыБезНДС,
	|	0 КАК СтоимостьЗабалансовая,
	|	0 КАК СтоимостьЗабалансоваяРегл,
    |	СУММА(ВЫБОР
    |		КОГДА Партии.РаспределениеПоВыбывшимТоварам ТОГДА 0
    |		ИНАЧЕ Партии.НДСРегл КОНЕЦ) КАК СтоимостьРегл,
    |	0 КАК СтоимостьРеглБезНДС,
    |	0 КАК НДСРегл,
    |	0 КАК НДСРеглРеквизит,
	|	0 КАК НДСУпр,
	|	0 КАК ПостояннаяРазница,
	|	0 КАК ВременнаяРазница,
	|	0 КАК Трудозатраты,
	|	0 КАК ПостатейныеПостоянныеСНДС,
	|	0 КАК ПостатейныеПеременныеСНДС,
	|	0 КАК ПостатейныеПостоянныеБезНДС,
	|	0 КАК ПостатейныеПеременныеБезНДС,
    |	СУММА(ВЫБОР
    |		КОГДА Партии.РаспределениеПоВыбывшимТоварам ТОГДА Партии.НДСРегл
    |		ИНАЧЕ 0 КОНЕЦ) КАК ДопРасходыРегл,
    |	0 КАК ТрудозатратыРегл,
    |	0 КАК ПостатейныеПостоянныеРегл,
    |	0 КАК ПостатейныеПеременныеРегл,
    |	0 КАК ДопРасходыРеглБезНДС,
    |	0 КАК ПостатейныеПостоянныеРеглБезНДС,
    |	0 КАК ПостатейныеПеременныеРеглБезНДС,
    |	СУММА(ВЫБОР
    |		КОГДА Партии.РаспределениеПоВыбывшимТоварам ТОГДА 0
    |		ИНАЧЕ Партии.НДСРегл КОНЕЦ) КАК СтоимостьУпр,
    |	СУММА(ВЫБОР
    |		КОГДА Партии.РаспределениеПоВыбывшимТоварам ТОГДА Партии.НДСУпр
    |		ИНАЧЕ 0 КОНЕЦ) КАК ДопРасходыУпр,
    |	0 КАК ТрудозатратыУпр,
    |	0 КАК ПостатейныеПостоянныеУпр,
    |	0 КАК ПостатейныеПеременныеУпр,
    |	0 СтоимостьУпрБезНДС,
    |	0 КАК ДопРасходыУпрБезНДС,
    |	0 КАК ПостатейныеПостоянныеУпрБезНДС,
    |	0 КАК ПостатейныеПеременныеУпрБезНДС,
	|
	|	0 КАК ИсходноеКоличество,
	|	0 КАК КорСтоимость
	|ИЗ
	|	ВтПартии КАК Партии
	|ГДЕ
	|	Партии.Количество > 0
	|
	|СГРУППИРОВАТЬ ПО
	|	Партии.Период,
	|	Партии.Регистратор,
	|	Партии.Организация,
	|	Партии.АналитикаУчетаНоменклатуры,
	|	Партии.ВидЗапасов,
	|	Партии.РазделУчета,
	|	Партии.Партия,
	|	Партии.АналитикаУчетаПартий,
	|	Партии.АналитикаФинансовогоУчета,
    |	Партии.НалоговоеНазначение
	|
	|ИМЕЮЩИЕ
	|	СУММА(Партии.НДСРегл) <> 0
	|	ИЛИ СУММА(Партии.НДСУпр) <> 0
	|
	|УПОРЯДОЧИТЬ ПО
	|	Регистратор,
	|	Организация,
	|	АналитикаУчетаНоменклатуры,
	|	ВидЗапасов,
	|	РазделУчета,
	|	Партия,
	|	АналитикаФинансовогоУчета,
    |	НалоговоеНазначение,
	|	Порядок
	|";
	
	ЗаписьРаспределения = Новый Структура("
	|Период, АналитикаУчетаНоменклатуры, ВидЗапасов, Организация, Менеджер,
	|ХозяйственнаяОперация, ЗаказКлиента, ТипЗапасов,
	|Подразделение, АналитикаУчетаПоПартнерам,
	|Склад, Соглашение, Договор, ВалютаВзаиморасчетов, ВалютаДокумента,
	|ИсточникГФУНоменклатуры, ИсточникГФУРасчетов,
	|НаправлениеДеятельностиКонтрагента, НаправлениеДеятельностиНоменклатуры,
    |НалоговоеНазначениеСписания, ДокументДвижения,
    |РазделУчета, Партия, АналитикаУчетаПартий, АналитикаФинансовогоУчета, НалоговоеНазначение,
	|Стоимость, СтоимостьБезНДС, Количество,
	|ДопРасходы, ДопРасходыБезНДС,
    |СтоимостьРегл, НДСРеглРеквизит, НДСУпр, ПостояннаяРазница, ВременнаяРазница,
	|СтоимостьЗабалансовая, Трудозатраты, ПостатейныеПостоянныеСНДС, ПостатейныеПеременныеСНДС,
	|ПостатейныеПостоянныеБезНДС, ПостатейныеПеременныеБезНДС,
    |СтоимостьЗабалансоваяРегл, ДопРасходыРегл, ТрудозатратыРегл, ПостатейныеПостоянныеРегл, ПостатейныеПеременныеРегл,
    |СтоимостьРеглБезНДС, НДСРегл, ДопРасходыРеглБезНДС, ПостатейныеПостоянныеРеглБезНДС, ПостатейныеПеременныеРеглБезНДС,
    |СтоимостьУпрБезНДС, ДопРасходыУпрБезНДС, ПостатейныеПостоянныеУпрБезНДС, ПостатейныеПеременныеУпрБезНДС, 
    |СтоимостьУпр, ДопРасходыУпр, ТрудозатратыУпр, ПостатейныеПостоянныеУпр, ПостатейныеПеременныеУпр");
	
	СтрокаОстатка = Новый Структура("
	|Регистратор, Организация, АналитикаУчетаНоменклатуры, ВидЗапасов,
    |РазделУчета, Партия, АналитикаУчетаПартий, АналитикаФинансовогоУчета, НалоговоеНазначение,
    |Количество, Стоимость, СтоимостьБезНДС, СтоимостьРегл, НДСРеглРеквизит, НДСУпр,
	|ДопРасходы, ДопРасходыБезНДС, ПостояннаяРазница, ВременнаяРазница,
	|СтоимостьЗабалансовая, Трудозатраты, ПостатейныеПостоянныеСНДС, ПостатейныеПеременныеСНДС,
	|ПостатейныеПостоянныеБезНДС, ПостатейныеПеременныеБезНДС,
    |СтоимостьЗабалансоваяРегл, ДопРасходыРегл, ТрудозатратыРегл, ПостатейныеПостоянныеРегл, ПостатейныеПеременныеРегл,
    |СтоимостьРеглБезНДС, НДСРегл, ДопРасходыРеглБезНДС, ПостатейныеПостоянныеРеглБезНДС, ПостатейныеПеременныеРеглБезНДС,
    |СтоимостьУпрБезНДС, ДопРасходыУпрБезНДС, ПостатейныеПостоянныеУпрБезНДС, ПостатейныеПеременныеУпрБезНДС, 
    |СтоимостьУпр, ДопРасходыУпр, ТрудозатратыУпр, ПостатейныеПостоянныеУпр, ПостатейныеПеременныеУпр");
	
	Выборка = РасчетСебестоимостиПрикладныеАлгоритмы.ВыполнитьЗапросСЗамеромДляПротокола(ПараметрыРасчета, Запрос, Истина,,,
		Метаданные.РегистрыНакопления.ВыручкаИСебестоимостьПродаж.Имя);
	
	// Формируются движения по регистрам:
	// - ВыручкаИСебестоимостьПродаж
	Пока Выборка.Следующий() Цикл
		
		Если Выборка.Порядок = 1 Тогда
			
			ЗаполнитьЗначенияСвойств(СтрокаОстатка, Выборка);
			
		ИначеЕсли СтрокаОстатка.Регистратор = Выборка.Регистратор
		 И СтрокаОстатка.Организация = Выборка.Организация
		 И СтрокаОстатка.АналитикаУчетаНоменклатуры = Выборка.АналитикаУчетаНоменклатуры
		 И СтрокаОстатка.ВидЗапасов = Выборка.ВидЗапасов
		 И СтрокаОстатка.РазделУчета = Выборка.РазделУчета
		 И СтрокаОстатка.Партия = Выборка.Партия
		 И СтрокаОстатка.АналитикаФинансовогоУчета = Выборка.АналитикаФинансовогоУчета
         И СтрокаОстатка.НалоговоеНазначение = Выборка.НалоговоеНазначение
		 И СтрокаОстатка.Количество > 0 Тогда
		
			ЗаполнитьЗначенияСвойств(ЗаписьРаспределения, Выборка);
			
			РасчетСебестоимостиКорректировкаСтоимости.РаспределитьСтоимость(ЗаписьРаспределения, СтрокаОстатка, Выборка, Выборка.Количество);
			
			РасчетСебестоимостиКорректировкаСтоимости.СформироватьДвиженияВыручкаИСебестоимостьПродаж(ПараметрыРасчета, ЗаписьРаспределения);

		КонецЕсли;
		
	КонецЦикла;
	
 	// Формируются движения по регистрам:
	// - ПрочиеРасходы
	РасчетСебестоимостиКорректировкаСтоимости.СформироватьДвиженияПрочиеРасходыСписаниеНДС(ПараметрыРасчета);
	
	// Формируются движения по регистрам:
	// - ДвиженияНоменклатураДоходыРасходы
	РасчетСебестоимостиКорректировкаСтоимости.СформироватьДвиженияНоменклатураДоходыРасходыСписаниеНДС(ПараметрыРасчета);
	
	РасчетСебестоимостиПрикладныеАлгоритмы.УничтожитьВременныеТаблицы(ПараметрыРасчета, "ВтПартии, ДвиженияПродаж, ВтРегистраторы");
	
	РасчетСебестоимостиПрикладныеАлгоритмы.КэшироватьСформированныеДвижения(ПараметрыРасчета);
	
КонецПроцедуры

// Этап 3.18.2
Процедура ВключитьИсключитьНДСВСтоимостьПродаж24(ПараметрыРасчета) Экспорт

	РасчетСебестоимостиПротоколРасчета.НачалоЭтапаРасчета(ПараметрыРасчета, "ВключитьИсключитьНДСВСтоимостьПродаж24");
	
	Запрос = Новый Запрос;
	РасчетСебестоимостиКорректировкаСтоимости.ИнициализироватьСвойстваЗапроса(Запрос, ПараметрыРасчета);
	
	Запрос.Текст = "
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	Продажи.Период,
	|	Продажи.Регистратор,
	|	АналитикаПартнеров.Организация,
	|	Продажи.Партия,
    |	Продажи.НалоговоеНазначение,
	|	Продажи.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатурыДляСвязи,
	|	Продажи.ВидЗапасов КАК ВидЗапасовДляСвязи
	|ПОМЕСТИТЬ ДвиженияПродаж
	|ИЗ
	|	ВТКэшРасчетныеОборотыВыручкаИСебестоимостьПродаж КАК Продажи
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТОтборАналитикаПоПартнерам КАК АналитикаПартнеров
	|		ПО Продажи.АналитикаУчетаПоПартнерам = АналитикаПартнеров.КлючАналитики
	|ГДЕ
	|	&ПартионныйУчетВерсии22
	|	И АналитикаПартнеров.Организация В(&ОрганизацииСУчетомПартийНДСВерсии24)
	|	И Продажи.ТипЗапасов <> ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.КомиссионныйТовар)
	|ИНДЕКСИРОВАТЬ ПО
	|	Период,
	|	Регистратор,
	|	Организация,
	|	Партия,
    |	НалоговоеНазначение,
	|	АналитикаУчетаНоменклатурыДляСвязи,
	|	ВидЗапасовДляСвязи
	|;
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	Партии.Период КАК Период,
	|	Партии.Регистратор КАК Регистратор,
	|	Партии.Организация КАК Организация,
	|	Партии.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
	|	Партии.ВидЗапасов,
	|	Партии.СтатьяСписанияНДС,
	|	Партии.АналитикаСписанияНДС,
	|	Партии.РазделУчета,
	|	Партии.Партия,
	|	Партии.АналитикаФинансовогоУчета,
    |	Партии.НалоговоеНазначениеПродаж КАК НалоговоеНазначение,
	|	Партии.АналитикаУчетаНоменклатурыДляСвязи,
	|	Партии.ВидЗапасовДляСвязи,
	|	Партии.РаспределениеПоВыбывшимТоварам,
	|
	|	СУММА(Партии.СтоимостьБезНДС) КАК СтоимостьБезНДС,
	|	СУММА(Партии.СтоимостьБезНДСУпр) КАК СтоимостьБезНДСУпр,
	|	СУММА(
	|		ВЫБОР КОГДА Партии.СтатьяСписанияНДС <> ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиРасходов.ПустаяСсылка)
	|			ТОГДА 0
    |		КОГДА 
	|		    (
	|				(СпрНалоговоеНазначениеПартии.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ВидыДеятельностиНДС.Облагаемая) 
	|	   				И СпрНалоговоеНазначение.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ВидыДеятельностиНДС.Необлагаемая))
	|				ИЛИ (СпрНалоговоеНазначениеПартии.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ВидыДеятельностиНДС.ПропорциональноОблагаемая) 
	|	   				И Партии.НалоговоеНазначение = ЗНАЧЕНИЕ(Справочник.НалоговыеНазначенияАктивовИЗатрат.НДС_НеоблагаемаяНеХозДеятельность))
	|           )
	|		ТОГДА
	|			Партии.НДСРегл
	|
	|
	|		КОГДА СпрНалоговоеНазначениеПартии.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ВидыДеятельностиНДС.Необлагаемая) 
	|		      И СпрНалоговоеНазначение.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ВидыДеятельностиНДС.Облагаемая) 
	|		ТОГДА
	|			-Партии.НДСРегл
	|		ИНАЧЕ
	|			0
	|		КОНЕЦ
	|	) КАК НДСРегл,
	|	СУММА(
	|		ВЫБОР КОГДА Партии.СтатьяСписанияНДС <> ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиРасходов.ПустаяСсылка)
	|			ТОГДА 0
    |		КОГДА 
	|		    (
	|				(СпрНалоговоеНазначениеПартии.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ВидыДеятельностиНДС.Облагаемая) 
	|	   				И СпрНалоговоеНазначение.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ВидыДеятельностиНДС.Необлагаемая))
	|				ИЛИ (СпрНалоговоеНазначениеПартии.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ВидыДеятельностиНДС.ПропорциональноОблагаемая) 
	|	   				И Партии.НалоговоеНазначение = ЗНАЧЕНИЕ(Справочник.НалоговыеНазначенияАктивовИЗатрат.НДС_НеоблагаемаяНеХозДеятельность))
	|           )
	|		ТОГДА
	|			Партии.НДСУпр
	|
	|
	|		КОГДА СпрНалоговоеНазначениеПартии.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ВидыДеятельностиНДС.Необлагаемая) 
	|		      И СпрНалоговоеНазначение.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ВидыДеятельностиНДС.Облагаемая) 
	|		ТОГДА
	|			-Партии.НДСУпр
	|		ИНАЧЕ
	|			0
	|		КОНЕЦ
	|	) КАК НДСУпр,
	|	СУММА(
	|		ВЫБОР КОГДА Партии.СтатьяСписанияНДС <> ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиРасходов.ПустаяСсылка)
	|			ТОГДА Партии.НДСРегл
	|		ИНАЧЕ
	|			0
	|		КОНЕЦ
	|	) КАК СписаниеНДС,
	|	СУММА(
	|		ВЫБОР КОГДА Партии.СтатьяСписанияНДС <> ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиРасходов.ПустаяСсылка)
	|			ТОГДА Партии.НДСУпр
	|		ИНАЧЕ
	|			0
	|		КОНЕЦ
	|	) КАК СписаниеНДСУпр,
	|	СУММА(ВЫБОР
	|		КОГДА СпрНалоговоеНазначениеПартии.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ВидыДеятельностиНДС.Необлагаемая) 
	|			ТОГДА Партии.СтоимостьБезНДС + Партии.НДСРегл
	|		КОГДА Партии.СтоимостьБезНДС = 0
	|			ТОГДА Партии.НДСРегл
	|		ИНАЧЕ Партии.СтоимостьБезНДС КОНЕЦ) КАК Стоимость
	|ПОМЕСТИТЬ ВтПартии
	|ИЗ (
	|	ВЫБРАТЬ
	|		Партии.Период КАК Период,
	|		Партии.Регистратор КАК Регистратор,
	|		Партии.Организация КАК Организация,
	|		ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаНоменклатуры.ПустаяСсылка) КАК АналитикаУчетаНоменклатуры,
	|		ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка) КАК ВидЗапасов,
    |		Партии.НалоговоеНазначение КАК НалоговоеНазначениеПартии,
    |		Партии.КорНалоговоеНазначение КАК НалоговоеНазначение,
	|		Партии.ДокументПоступления КАК ДокументПоступления,
	|		Партии.СтоимостьБезНДС КАК СтоимостьБезНДС,
	|		Партии.СтоимостьБезНДСУпр КАК СтоимостьБезНДСУпр,
	|		Партии.НДС КАК НДСРегл,
	|		Партии.НДСУпр КАК НДСУпр,
	|		Партии.СтатьяСписанияНДС,
	|		Партии.АналитикаСписанияНДС,
	|		ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПустаяСсылка) КАК РазделУчета,
	|		(ВЫБОР
	|			КОГДА ДвиженияПродаж.Регистратор ЕСТЬ NULL ТОГДА НЕОПРЕДЕЛЕНО
	|			ИНАЧЕ Партии.Партия КОНЕЦ) КАК Партия,
	|		НЕОПРЕДЕЛЕНО КАК АналитикаФинансовогоУчета,
    |		Партии.НалоговоеНазначение КАК НалоговоеНазначениеПродаж,
	|		Партии.КорАналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатурыДляСвязи,
	|		Партии.КорВидЗапасов КАК ВидЗапасовДляСвязи,
	|		(ВЫБОР
	|			КОГДА Партии.ТипЗаписи В (
	|					ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ОтклонениеВСтоимости),
	|					ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.РаспределениеПоВыбывшимТоварам),
	|					ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаПриобретенияПрошлогоПериода))
	|				ТОГДА ИСТИНА
	|			ИНАЧЕ ЛОЖЬ КОНЕЦ) КАК РаспределениеПоВыбывшимТоварам
	|	ИЗ
    |		ВТКэшРасчетныеОборотыДетализацияПартийТоваровДляНДС2_4 КАК Партии
	|		ЛЕВОЕ СОЕДИНЕНИЕ ДвиженияПродаж КАК ДвиженияПродаж
	|		 ПО ДвиженияПродаж.Период = Партии.Период
	|		 И ДвиженияПродаж.Регистратор = Партии.Регистратор
	|		 И ДвиженияПродаж.Организация = Партии.Организация
	|		 И ДвиженияПродаж.Партия = Партии.Партия
    |		 И ДвиженияПродаж.НалоговоеНазначение = Партии.НалоговоеНазначение
	|		 И ДвиженияПродаж.АналитикаУчетаНоменклатурыДляСвязи = Партии.КорАналитикаУчетаНоменклатуры
	|		 И ДвиженияПродаж.ВидЗапасовДляСвязи = Партии.КорВидЗапасов
	|	ГДЕ
	|		&ПартионныйУчетВерсии22
	|		И Партии.Организация В(&ОрганизацииСУчетомПартийНДСВерсии24)
	|		И НЕ Партии.СлужебноеВидДвиженияПриход
	|	
	|	) КАК Партии
	|	
	|	ЛЕВОЕ СОЕДИНЕНИЕ 
	|		РегистрСведений.ДанныеПервичныхДокументов КАК ДанныеПервичныхДокументов
	|	ПО
	|		ДанныеПервичныхДокументов.Организация = Партии.Организация
	|		И ДанныеПервичныхДокументов.Документ = Партии.ДокументПоступления
	|	ЛЕВОЕ СОЕДИНЕНИЕ 
	|		Справочник.НалоговыеНазначенияАктивовИЗатрат КАК СпрНалоговоеНазначениеПартии
	|	ПО
	|		СпрНалоговоеНазначениеПартии.Ссылка = Партии.НалоговоеНазначениеПартии
	|	ЛЕВОЕ СОЕДИНЕНИЕ 
	|		Справочник.НалоговыеНазначенияАктивовИЗатрат КАК СпрНалоговоеНазначение
	|	ПО
	|		СпрНалоговоеНазначение.Ссылка = Партии.НалоговоеНазначение
	|ГДЕ
    |	Партии.НалоговоеНазначение <> ЗНАЧЕНИЕ(Справочник.НалоговыеНазначенияАктивовИЗатрат.ПустаяСсылка)
	|
	|СГРУППИРОВАТЬ ПО
	|	Партии.Период,
	|	Партии.Регистратор,
	|	Партии.Организация,
	|	Партии.АналитикаУчетаНоменклатуры,
	|	Партии.ВидЗапасов,
	|	Партии.СтатьяСписанияНДС,
	|	Партии.АналитикаСписанияНДС,
	|	Партии.РазделУчета,
	|	Партии.Партия,
	|	Партии.АналитикаФинансовогоУчета,
    |	Партии.НалоговоеНазначениеПродаж,
	|	Партии.АналитикаУчетаНоменклатурыДляСвязи,
	|	Партии.ВидЗапасовДляСвязи,
	|	Партии.РаспределениеПоВыбывшимТоварам
	|;
	|////////////////////////////////////////////////////////////////////////////////
	|
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	Партии.Регистратор КАК Регистратор
	|ПОМЕСТИТЬ ВтРегистраторы
	|ИЗ
	|	ВтПартии КАК Партии
	|ГДЕ
	|	Партии.НДСРегл <> 0
	|	ИЛИ Партии.НДСУпр <> 0
	|ИНДЕКСИРОВАТЬ ПО
	|	Регистратор
	|;
	|////////////////////////////////////////////////////////////////////////////////
	|
	|ВЫБРАТЬ
	|	2 КАК Порядок,
	|	Продажи.Период                     КАК Период,
	|	Продажи.Регистратор                КАК Регистратор,
	|	Продажи.Регистратор                КАК ДокументДвижения,
	|	АналитикаПартнеров.Организация     КАК Организация,
	|	Продажи.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
	|	Продажи.ВидЗапасов                 КАК ВидЗапасов,
	|	Продажи.РазделУчета				   КАК РазделУчета,
	|	Продажи.Партия				   	   КАК Партия,
	|	Продажи.АналитикаУчетаПартий	   КАК АналитикаУчетаПартий,
	|	Продажи.АналитикаФинансовогоУчета  КАК АналитикаФинансовогоУчета,
    |	Продажи.НалоговоеНазначение		   КАК НалоговоеНазначение,
	|
	|	Продажи.ЗаказКлиента               КАК ЗаказКлиента,
	|	Продажи.АналитикаУчетаПоПартнерам  КАК АналитикаУчетаПоПартнерам,
	|	Продажи.Подразделение              КАК Подразделение,
	|	Продажи.ТипЗапасов                 КАК ТипЗапасов,
	|	Продажи.Менеджер                   КАК Менеджер,
	|	Продажи.Склад                      КАК Склад,
	|	Продажи.Соглашение                 КАК Соглашение,
	|	Продажи.Договор                    КАК Договор,
	|	Продажи.ХозяйственнаяОперация      КАК ХозяйственнаяОперация,
    |	Продажи.НалоговоеНазначениеСписания КАК НалоговоеНазначениеСписания,
	|	Продажи.ВалютаВзаиморасчетов       КАК ВалютаВзаиморасчетов,
	|	Продажи.ВалютаДокумента            КАК ВалютаДокумента,
	|	Продажи.ИсточникГФУНоменклатуры    КАК ИсточникГФУНоменклатуры,
	|	Продажи.ИсточникГФУРасчетов        КАК ИсточникГФУРасчетов,
	|	Продажи.НаправлениеДеятельностиКонтрагента КАК НаправлениеДеятельностиКонтрагента,
	|	Продажи.НаправлениеДеятельностиНоменклатуры КАК НаправлениеДеятельностиНоменклатуры,
	|	Продажи.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатурыДляСвязи,
	|	Продажи.ВидЗапасов КАК ВидЗапасовДляСвязи,
	|
	|	СУММА(ВЫБОР // полностью аналогичное условие должно быть в конструкции ИМЕЮЩИЕ
	|		КОГДА Продажи.РасчетПартий И Продажи.Количество = 0 И Продажи.ДопРасходыРегл <> 0
	|			ТОГДА Продажи.ДопРасходыРегл
	|		КОГДА ЕСТЬNULL(Цены.СтоимостьРегл + Цены.ДопРасходыРегл + Цены.ТрудозатратыРегл, 0) = 0
	|			ТОГДА Продажи.НДСРегл
	|		ИНАЧЕ
	|			ВЫРАЗИТЬ(Продажи.Количество * ЕСТЬNULL(Цены.СтоимостьРегл + Цены.ДопРасходыРегл + Цены.ТрудозатратыРегл, 0) КАК ЧИСЛО(31,2))
	|		КОНЕЦ
	|	) КАК Количество,
	|	0 КАК Стоимость,
	|	0 КАК СтоимостьБезНДС,
	|	0 КАК ДопРасходы,
	|	0 КАК ДопРасходыБезНДС,
	|	0 КАК СтоимостьЗабалансовая,
	|	0 КАК СтоимостьЗабалансоваяРегл,
    |	0 КАК СтоимостьРегл,
    |	0 КАК СтоимостьРеглБезНДС,
    |	0 КАК НДСРегл,
    |	0 КАК НДСРеглРеквизит,
	|	0 КАК НДСУпр,
	|	0 КАК ПостояннаяРазница,
	|	0 КАК ВременнаяРазница,
	|	0 КАК Трудозатраты,
	|	0 КАК ПостатейныеПостоянныеСНДС,
	|	0 КАК ПостатейныеПеременныеСНДС,
	|	0 КАК ПостатейныеПостоянныеБезНДС,
	|	0 КАК ПостатейныеПеременныеБезНДС,
    |	0 КАК ДопРасходыРегл,
    |	0 КАК ТрудозатратыРегл,
    |	0 КАК ПостатейныеПостоянныеРегл,
    |	0 КАК ПостатейныеПеременныеРегл,
    |	0 КАК ДопРасходыРеглБезНДС,
    |	0 КАК ПостатейныеПостоянныеРеглБезНДС,
    |	0 КАК ПостатейныеПеременныеРеглБезНДС,
    |	0 КАК СтоимостьУпр,
    |	0 КАК ДопРасходыУпр,
    |	0 КАК ТрудозатратыУпр,
    |	0 КАК ПостатейныеПостоянныеУпр,
    |	0 КАК ПостатейныеПеременныеУпр,
    |	0 КАК СтоимостьУпрБезНДС,
    |	0 КАК ДопРасходыУпрБезНДС,
    |	0 КАК ПостатейныеПостоянныеУпрБезНДС,
    |	0 КАК ПостатейныеПеременныеУпрБезНДС,
	|
	|	СУММА(ВЫРАЗИТЬ(Продажи.Количество * ЕСТЬNULL(Цены.СтоимостьРегл + Цены.ДопРасходыРегл + Цены.ТрудозатратыРегл, 0) КАК ЧИСЛО(31,2))) КАК ИсходноеКоличество,
	|	0 КАК КорСтоимость
	|ИЗ
	|	ВТКэшРасчетныеОборотыВыручкаИСебестоимостьПродаж КАК Продажи
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВтРегистраторы КАК Регистраторы
	|			ПО Регистраторы.Регистратор = Продажи.Регистратор
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТОтборАналитикаПоПартнерам КАК АналитикаПартнеров
	|			ПО Продажи.АналитикаУчетаПоПартнерам = АналитикаПартнеров.КлючАналитики
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСтоимостьПартийТоваровПредыдущая КАК Цены
	|			ПО Цены.Организация = АналитикаПартнеров.Организация
	|			И Цены.Партия = Продажи.Партия
	|			И Цены.АналитикаУчетаПартий = Продажи.АналитикаУчетаПартий
	|			И Цены.АналитикаФинансовогоУчета = Продажи.АналитикаФинансовогоУчета
    |			И Цены.НалоговоеНазначение = Продажи.НалоговоеНазначение
	|			И Цены.АналитикаУчетаНоменклатуры = Продажи.АналитикаУчетаНоменклатуры
	|			И Цены.ВидЗапасов = Продажи.ВидЗапасов
	|			И Цены.РазделУчета = Продажи.РазделУчета
	|
	|ГДЕ
	|	АналитикаПартнеров.Организация В(&ОрганизацииСУчетомПартийНДСВерсии24)
	|	И Продажи.ТипЗапасов <> ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.КомиссионныйТовар)
	|	
	|СГРУППИРОВАТЬ ПО
	|	Продажи.Период,
	|	Продажи.Регистратор,
	|	Продажи.АналитикаУчетаНоменклатуры,
	|	Продажи.ЗаказКлиента,
	|	Продажи.АналитикаУчетаПоПартнерам,
	|	Продажи.Подразделение,
	|	Продажи.ТипЗапасов,
	|	Продажи.ВидЗапасов,
	|	Продажи.Менеджер,
	|	Продажи.Склад,
	|	Продажи.Соглашение,
	|	Продажи.Договор,
	|	Продажи.ХозяйственнаяОперация,
    |	Продажи.НалоговоеНазначениеСписания,
	|	Продажи.ВалютаВзаиморасчетов,
	|	Продажи.ВалютаДокумента,
	|	Продажи.ИсточникГФУНоменклатуры,
	|	Продажи.ИсточникГФУРасчетов,
	|	Продажи.НаправлениеДеятельностиКонтрагента,
	|	Продажи.НаправлениеДеятельностиНоменклатуры,
	|	АналитикаПартнеров.Организация,
	|	Продажи.РазделУчета,
	|	Продажи.Партия,
	|	Продажи.АналитикаУчетаПартий,
	|	Продажи.АналитикаФинансовогоУчета,
    |	Продажи.НалоговоеНазначение,
	|	Продажи.АналитикаУчетаНоменклатуры,
	|	Продажи.ВидЗапасов
	|
	|ИМЕЮЩИЕ
	|	СУММА(ВЫБОР
	|		КОГДА Продажи.РасчетПартий И Продажи.Количество = 0 И Продажи.ДопРасходыРегл <> 0
	|			ТОГДА Продажи.ДопРасходыРегл
	|		КОГДА ЕСТЬNULL(Цены.СтоимостьРегл + Цены.ДопРасходыРегл + Цены.ТрудозатратыРегл, 0) = 0
	|			ТОГДА Продажи.НДСРегл
	|		ИНАЧЕ
	|			ВЫРАЗИТЬ(Продажи.Количество * ЕСТЬNULL(Цены.СтоимостьРегл + Цены.ДопРасходыРегл + Цены.ТрудозатратыРегл, 0) КАК ЧИСЛО(31,2))
	|		КОНЕЦ
	|	) <> 0
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	1 								   КАК Порядок,
	|	Партии.Период 					   КАК Период,
	|	Партии.Регистратор 				   КАК Регистратор,
	|	Партии.Регистратор 				   КАК ДокументДвижения,
	|	Партии.Организация 				   КАК Организация,
	|	Партии.АналитикаУчетаНоменклатуры  КАК АналитикаУчетаНоменклатуры,
	|	Партии.ВидЗапасов 				   КАК ВидЗапасов,
	|	Партии.РазделУчета				   КАК РазделУчета,
	|	Партии.Партия				   	   КАК Партия,
	|	НЕОПРЕДЕЛЕНО	       			   КАК АналитикаУчетаПартий,
	|	Партии.АналитикаФинансовогоУчета   КАК АналитикаФинансовогоУчета,
    |	Партии.НалоговоеНазначение		   КАК НалоговоеНазначение,
	|
	|	НЕОПРЕДЕЛЕНО КАК ЗаказКлиента,
	|	НЕОПРЕДЕЛЕНО КАК АналитикаУчетаПоПартнерам,
	|	НЕОПРЕДЕЛЕНО КАК Подразделение,
	|	НЕОПРЕДЕЛЕНО КАК ТипЗапасов,
	|	НЕОПРЕДЕЛЕНО КАК Менеджер,
	|	НЕОПРЕДЕЛЕНО КАК Склад,
	|	НЕОПРЕДЕЛЕНО КАК Соглашение,
	|	НЕОПРЕДЕЛЕНО КАК Договор,
	|	НЕОПРЕДЕЛЕНО КАК ХозяйственнаяОперация,
    |	НЕОПРЕДЕЛЕНО КАК НалоговоеНазначениеСписания,
	|	НЕОПРЕДЕЛЕНО КАК ВалютаВзаиморасчетов,
	|	НЕОПРЕДЕЛЕНО КАК ВалютаДокумента,
	|	НЕОПРЕДЕЛЕНО КАК ИсточникГФУНоменклатуры,
	|	НЕОПРЕДЕЛЕНО КАК ИсточникГФУРасчетов,
	|	НЕОПРЕДЕЛЕНО КАК НаправлениеДеятельностиКонтрагента,
	|	НЕОПРЕДЕЛЕНО КАК НаправлениеДеятельностиНоменклатуры,
	|	Партии.АналитикаУчетаНоменклатурыДляСвязи КАК АналитикаУчетаНоменклатурыДляСвязи,
	|	Партии.ВидЗапасовДляСвязи КАК ВидЗапасовДляСвязи,
	|
	|	СУММА(ВЫБОР КОГДА Партии.Стоимость < 0 ТОГДА -Партии.Стоимость
	|		ИНАЧЕ Партии.Стоимость КОНЕЦ) КАК Количество,
	|	0 КАК Стоимость,
	|	0 КАК СтоимостьБезНДС,
	|	0 КАК ДопРасходы,
	|	0 КАК ДопРасходыБезНДС,
	|	0 КАК СтоимостьЗабалансовая,
	|	0 КАК СтоимостьЗабалансоваяРегл,
    |	СУММА(ВЫБОР
    |		КОГДА Партии.РаспределениеПоВыбывшимТоварам ТОГДА 0
    |		ИНАЧЕ Партии.НДСРегл КОНЕЦ) КАК СтоимостьРегл,
    |	0 КАК СтоимостьРеглБезНДС,
    |	0 КАК НДСРегл,
    |	0 КАК НДСРеглРеквизит,
	|	0 КАК НДСУпр,
	|	0 КАК ПостояннаяРазница,
	|	0 КАК ВременнаяРазница,
	|	0 КАК Трудозатраты,
	|	0 КАК ПостатейныеПостоянныеСНДС,
	|	0 КАК ПостатейныеПеременныеСНДС,
	|	0 КАК ПостатейныеПостоянныеБезНДС,
	|	0 КАК ПостатейныеПеременныеБезНДС,
	|	СУММА(ВЫБОР
	|		КОГДА Партии.РаспределениеПоВыбывшимТоварам ТОГДА Партии.НДСРегл
	|		ИНАЧЕ 0 КОНЕЦ) КАК ДопРасходыРегл,
	|	0 КАК ТрудозатратыРегл,
	|	0 КАК ПостатейныеПостоянныеРегл,
	|	0 КАК ПостатейныеПеременныеРегл,
    |	0 КАК ДопРасходыРеглБезНДС,
    |	0 КАК ПостатейныеПостоянныеРеглБезНДС,
    |	0 КАК ПостатейныеПеременныеРеглБезНДС,
	|	СУММА(ВЫБОР
	|		КОГДА Партии.РаспределениеПоВыбывшимТоварам ТОГДА 0
	|		ИНАЧЕ Партии.НДСУпр КОНЕЦ) КАК СтоимостьУпр,
	|	СУММА(ВЫБОР
	|		КОГДА Партии.РаспределениеПоВыбывшимТоварам ТОГДА Партии.НДСУпр
	|		ИНАЧЕ 0 КОНЕЦ) КАК ДопРасходыУпр,
	|	0 КАК ТрудозатратыУпр,
	|	0 КАК ПостатейныеПостоянныеУпр,
	|	0 КАК ПостатейныеПеременныеУпр,
    |	0 КАК СтоимостьУпрБезНДС,
    |	0 КАК ДопРасходыУпрБезНДС,
    |	0 КАК ПостатейныеПостоянныеУпрБезНДС,
    |	0 КАК ПостатейныеПеременныеУпрБезНДС,
	|
	|	0 КАК ИсходноеКоличество,
	|	0 КАК КорСтоимость
	|ИЗ
	|	ВтПартии КАК Партии
	|ГДЕ
	|	Партии.Стоимость <> 0
	|
	|СГРУППИРОВАТЬ ПО
	|	Партии.Период,
	|	Партии.Регистратор,
	|	Партии.Организация,
	|	Партии.АналитикаУчетаНоменклатуры,
	|	Партии.ВидЗапасов,
	|	Партии.РазделУчета,
	|	Партии.Партия,
	|	Партии.АналитикаФинансовогоУчета,
    |	Партии.НалоговоеНазначение,
	|	Партии.АналитикаУчетаНоменклатурыДляСвязи,
	|	Партии.ВидЗапасовДляСвязи
	|
	|ИМЕЮЩИЕ
	|	СУММА(Партии.НДСРегл) <> 0
	|	ИЛИ СУММА(Партии.НДСУпр) <> 0
	|
	|УПОРЯДОЧИТЬ ПО
	|	Регистратор,
	|	Организация,
	|	Партия,
    |	НалоговоеНазначение,
	|	АналитикаУчетаНоменклатурыДляСвязи,
	|	ВидЗапасовДляСвязи,
	|	Порядок
	|";
	
	ЗаписьРаспределения = Новый Структура("
	|Период, АналитикаУчетаНоменклатуры, ВидЗапасов, Организация, Менеджер,
	|АналитикаУчетаНоменклатурыДляСвязи, ВидЗапасовДляСвязи,
	|ХозяйственнаяОперация, ЗаказКлиента, ТипЗапасов,
	|Подразделение, АналитикаУчетаПоПартнерам,
	|Склад, Соглашение, Договор, ВалютаВзаиморасчетов, ВалютаДокумента,
	|ИсточникГФУНоменклатуры, ИсточникГФУРасчетов,
	|НаправлениеДеятельностиКонтрагента, НаправлениеДеятельностиНоменклатуры,
    |НалоговоеНазначениеСписания, ДокументДвижения,
    |РазделУчета, Партия, АналитикаУчетаПартий, АналитикаФинансовогоУчета, НалоговоеНазначение,
	|Стоимость, СтоимостьБезНДС, Количество,
	|ДопРасходы, ДопРасходыБезНДС,
    |СтоимостьРегл, НДСРеглРеквизит, НДСУпр, ПостояннаяРазница, ВременнаяРазница,
	|СтоимостьЗабалансовая, Трудозатраты, ПостатейныеПостоянныеСНДС, ПостатейныеПеременныеСНДС,
	|ПостатейныеПостоянныеБезНДС, ПостатейныеПеременныеБезНДС,
    |СтоимостьЗабалансоваяРегл, ДопРасходыРегл, ТрудозатратыРегл, ПостатейныеПостоянныеРегл, ПостатейныеПеременныеРегл,
    |СтоимостьРеглБезНДС, НДСРегл, ДопРасходыРеглБезНДС,  ПостатейныеПостоянныеРеглБезНДС, ПостатейныеПеременныеРеглБезНДС,
    |СтоимостьУпрБезНДС, ДопРасходыУпрБезНДС, ПостатейныеПостоянныеУпрБезНДС, ПостатейныеПеременныеУпрБезНДС, 
    |СтоимостьУпр, ДопРасходыУпр, ТрудозатратыУпр, ПостатейныеПостоянныеУпр, ПостатейныеПеременныеУпр");
	
	СтрокаОстатка = Новый Структура("
	|Регистратор, Организация, АналитикаУчетаНоменклатуры, ВидЗапасов,
    |РазделУчета, Партия, АналитикаУчетаПартий, АналитикаФинансовогоУчета, НалоговоеНазначение,
	|АналитикаУчетаНоменклатурыДляСвязи, ВидЗапасовДляСвязи,
    |Количество, Стоимость, СтоимостьБезНДС, СтоимостьРегл, НДСРеглРеквизит, НДСУпр,
	|ДопРасходы, ДопРасходыБезНДС, ПостояннаяРазница, ВременнаяРазница,
	|СтоимостьЗабалансовая, Трудозатраты, ПостатейныеПостоянныеСНДС, ПостатейныеПеременныеСНДС,
	|ПостатейныеПостоянныеБезНДС, ПостатейныеПеременныеБезНДС,
	|СтоимостьЗабалансоваяРегл, ДопРасходыРегл, ТрудозатратыРегл, ПостатейныеПостоянныеРегл, ПостатейныеПеременныеРегл,
    |СтоимостьРеглБезНДС, НДСРегл, ДопРасходыРеглБезНДС, ПостатейныеПостоянныеРеглБезНДС, ПостатейныеПеременныеРеглБезНДС,
    |СтоимостьУпрБезНДС, ДопРасходыУпрБезНДС, ПостатейныеПостоянныеУпрБезНДС, ПостатейныеПеременныеУпрБезНДС, 
	|СтоимостьУпр, ДопРасходыУпр, ТрудозатратыУпр, ПостатейныеПостоянныеУпр, ПостатейныеПеременныеУпр");
	
	Выборка = РасчетСебестоимостиПрикладныеАлгоритмы.ВыполнитьЗапросСЗамеромДляПротокола(ПараметрыРасчета, Запрос, Истина,,,
		Метаданные.РегистрыНакопления.ВыручкаИСебестоимостьПродаж.Имя);
	
	// Формируются движения по регистрам:
	// - ВыручкаИСебестоимостьПродаж
	Пока Выборка.Следующий() Цикл
		
		Если Выборка.Порядок = 1 Тогда
			
			ЗаполнитьЗначенияСвойств(СтрокаОстатка, Выборка);
			
		ИначеЕсли СтрокаОстатка.Регистратор = Выборка.Регистратор
		 И СтрокаОстатка.Организация = Выборка.Организация
		 И СтрокаОстатка.Партия = Выборка.Партия
         И СтрокаОстатка.НалоговоеНазначение = Выборка.НалоговоеНазначение
		 И СтрокаОстатка.АналитикаУчетаНоменклатурыДляСвязи = Выборка.АналитикаУчетаНоменклатурыДляСвязи
		 И СтрокаОстатка.ВидЗапасовДляСвязи = Выборка.ВидЗапасовДляСвязи
		 И СтрокаОстатка.Количество > 0 Тогда
		
			ЗаполнитьЗначенияСвойств(ЗаписьРаспределения, Выборка);
			
			РасчетСебестоимостиКорректировкаСтоимости.РаспределитьСтоимость(ЗаписьРаспределения, СтрокаОстатка, Выборка, Выборка.Количество);
			
			РасчетСебестоимостиКорректировкаСтоимости.СформироватьДвиженияВыручкаИСебестоимостьПродаж(ПараметрыРасчета, ЗаписьРаспределения);

		КонецЕсли;
		
	КонецЦикла;
	
	// Формируются движения по регистрам:
	// - ПрочиеРасходы
	РасчетСебестоимостиКорректировкаСтоимости.СформироватьДвиженияПрочиеРасходыСписаниеНДС(ПараметрыРасчета);
	
	// Формируются движения по регистрам:
	// - ДвиженияНоменклатураДоходыРасходы
	РасчетСебестоимостиКорректировкаСтоимости.СформироватьДвиженияНоменклатураДоходыРасходыСписаниеНДС(ПараметрыРасчета);
	
	РасчетСебестоимостиПрикладныеАлгоритмы.УничтожитьВременныеТаблицы(ПараметрыРасчета, "ВтПартии, ДвиженияПродаж, ВтРегистраторы");
	
	РасчетСебестоимостиПрикладныеАлгоритмы.КэшироватьСформированныеДвижения(ПараметрыРасчета);
	
КонецПроцедуры

#КонецОбласти

#Область СписаниеОшибокОкругления

Процедура СписатьОшибкиОкругленияРасчетаСебестоимости(ПараметрыРасчета) Экспорт
	
	Запрос = Новый Запрос;
	РасчетСебестоимостиКорректировкаСтоимости.ИнициализироватьСвойстваЗапроса(Запрос, ПараметрыРасчета);
	
    // Списание ошибок округления в регистре ДетализацияПартийТоваровДляНДС2_4
	Запрос.Текст =
	"ВЫБРАТЬ
	|	Т.Организация КАК Организация,
	|	Т.Партия КАК Партия,
	|	Т.АналитикаУчетаПартий КАК АналитикаУчетаПартий,
    |	Т.НалоговоеНазначение КАК НалоговоеНазначение,
	|	СУММА(Т.КоличествоСебестоимость) КАК КоличествоСебестоимость,
	|	СУММА(Т.СтоимостьБезНДС) КАК СтоимостьБезНДС,
	|	СУММА(Т.НДС) КАК НДС,
	|	СУММА(Т.СтоимостьБезНДСУпр) КАК СтоимостьБезНДСУпр,
	|	СУММА(Т.НДСУпр) КАК НДСУпр
    |ПОМЕСТИТЬ ВТОкруглениеДетализацияПартийТоваровДляНДС2_4
	|ИЗ
	|	(ВЫБРАТЬ
	|		Т.Организация КАК Организация,
	|		Т.Партия КАК Партия,
	|		ЕСТЬNULL(АналитикиУчетаПартий.Ссылка, ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка)) КАК АналитикаУчетаПартий,
    |		Т.НалоговоеНазначение КАК НалоговоеНазначение,
	|		Т.Количество КАК КоличествоСебестоимость,
	|		0 КАК СтоимостьБезНДС,
	|		0 КАК НДС,
	|		0 КАК СтоимостьБезНДСУпр,
	|		0 КАК НДСУпр
	|	ИЗ
	|		ВТКэшРасчетныеОстаткиСебестоимостьТоваров КАК Т
	|			ЛЕВОЕ СОЕДИНЕНИЕ ВТОтборАналитикиУчетаПартийНДС2_4 КАК АналитикиУчетаПартий
	|			ПО Т.АналитикаУчетаПартий = АналитикиУчетаПартий.Ссылка
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ
	|		Т.Организация,
	|		Т.Партия,
	|		Т.АналитикаУчетаПартий,
    |		Т.НалоговоеНазначение,
	|		0,
	|		Т.СтоимостьБезНДС,
	|		Т.НДС,
	|		Т.СтоимостьБезНДСУпр,
	|		Т.НДСУпр
	|	ИЗ
    |		ВТКэшРасчетныеОстаткиДетализацияПартийТоваровДляНДС2_4 КАК Т) КАК Т
	|
	|СГРУППИРОВАТЬ ПО
	|	Т.Организация,
	|	Т.Партия,
	|	Т.АналитикаУчетаПартий,
    |	Т.НалоговоеНазначение
	|
	|ИМЕЮЩИЕ
	|	СУММА(Т.КоличествоСебестоимость) = 0
	|	И СУММА(Т.СтоимостьБезНДС) МЕЖДУ -&ЗначениеПогрешностиСебестоимостьРегл И &ЗначениеПогрешностиСебестоимостьРегл
	|	И СУММА(Т.НДС) МЕЖДУ -&ЗначениеПогрешностиСебестоимостьРегл И &ЗначениеПогрешностиСебестоимостьРегл
	|	И СУММА(Т.СтоимостьБезНДСУпр) МЕЖДУ -&ЗначениеПогрешностиСебестоимостьУпр И &ЗначениеПогрешностиСебестоимостьУпр
	|	И СУММА(Т.НДСУпр) МЕЖДУ -&ЗначениеПогрешностиСебестоимостьУпр И &ЗначениеПогрешностиСебестоимостьУпр
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ДокументыРасчетаСебестоимости.Ссылка 		КАК ДокументДвижения,
	|	&КонецПериода								КАК Период,
	|	ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)		КАК ВидДвижения,
	|
	|	Т.Организация КАК Организация,
	|	Т.Партия КАК Партия,
	|	Т.АналитикаУчетаПартий КАК АналитикаУчетаПартий,
    |	Т.НалоговоеНазначение КАК НалоговоеНазначение,
	|	Т.ДокументПоступления КАК ДокументПоступления,
	|	Т.АналитикаУчетаДокументаПоступления КАК АналитикаУчетаДокументаПоступления,
	|	Т.Номенклатура КАК Номенклатура,
	|	Т.Характеристика КАК Характеристика,
	|	Т.НаправлениеДеятельности КАК НаправлениеДеятельности,
	|	ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиРасходов.ПогрешностьРасчетаСебестоимости)	КАК СтатьяРасходовАктивов,
	|
	|	Т.СтоимостьБезНДС КАК СтоимостьБезНДС,
	|	Т.НДС КАК НДС,
	|	Т.СтоимостьБезНДСУпр КАК СтоимостьБезНДСУпр,
	|	Т.НДСУпр КАК НДСУпр
	|ИЗ
    |	ВТКэшРасчетныеОстаткиДетализацияПартийТоваровДляНДС2_4 КАК Т
    |		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТОкруглениеДетализацияПартийТоваровДляНДС2_4 КАК Округление
	|		ПО Т.Организация = Округление.Организация
	|			И Т.Партия = Округление.Партия
	|			И Т.АналитикаУчетаПартий = Округление.АналитикаУчетаПартий
    |			И Т.НалоговоеНазначение = Округление.НалоговоеНазначение
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТДокументыРасчетаСебестоимости КАК ДокументыРасчетаСебестоимости
	|			ПО Т.Организация = ДокументыРасчетаСебестоимости.Организация";
	
	РасчетСебестоимостиПрикладныеАлгоритмы.СформироватьДвиженияПоРегиструПоДаннымЗапроса(
		ПараметрыРасчета,
        Метаданные.РегистрыНакопления.ДетализацияПартийТоваровДляНДС2_4.Имя,
		Запрос,
        Метаданные.РегистрыНакопления.ДетализацияПартийТоваровДляНДС2_4.Имя);
	
КонецПроцедуры

#КонецОбласти

#Область УчетНДС

// Возвращает имя регистра, используемого для учета партий НДС, при партионном учете версии 2.2.
//
// Параметры:
//	Организация - СправочникСсылка.Организации - организация
//	Период 		- Дата - период учета НДС
//
// Возвращаемое значение:
//	Строка - имя регистра учета партий НДС;
//		возможные значения:
//		- "ДетализацияПартийТоваровДляНДС"
//		- "ДетализацияПартийТоваровДляНДС2_4"
//		- ""
//
Функция ИмяРегистраУчетаПартийНДС(Организация, Период = Неопределено) Экспорт
	
	ИмяРегистра 		   = "";
	ПериодПолитики		   = НачалоМесяца(?(ЗначениеЗаполнено(Период), Период, ТекущаяДатаСеанса()));
	ПартионныйУчетВерсии22 = РасчетСебестоимостиПовтИсп.ПартионныйУчетВерсии22(ПериодПолитики);
	
	Если ПартионныйУчетВерсии22 Тогда
		
		ПараметрыУчетнойПолитикиНастройкиСистемыНалогообложения = НастройкиНалоговУчетныхПолитикПовтИсп.ДействующиеПараметрыНалоговУчетныхПолитик(
			"НастройкиСистемыНалогообложения",
			Организация,
			ПериодПолитики);
		
        Если (ПараметрыУчетнойПолитикиНастройкиСистемыНалогообложения <> Неопределено 
         	И ПараметрыУчетнойПолитикиНастройкиСистемыНалогообложения.РаздельныйУчетТоваровПоНалогообложениюНДС) Тогда
				
					ПараметрыУчетнойПолитики = НастройкиНалоговУчетныхПолитикПовтИсп.ДействующиеПараметрыНалоговУчетныхПолитик(
						"УчетнаяПолитикаФинансовогоУчета",
						Организация,
						ПериодПолитики);
						
					Если ПараметрыУчетнойПолитики <> Неопределено
						И ПараметрыУчетнойПолитики.МетодОценкиСтоимостиТоваров = Перечисления.МетодыОценкиСтоимостиТоваров.ФИФОСкользящаяОценка Тогда
                        ИмяРегистра = Метаданные.РегистрыНакопления.ДетализацияПартийТоваровДляНДС2_4.Имя;
					Иначе
                        ИмяРегистра = Метаданные.РегистрыНакопления.ДетализацияПартийТоваровДляНДС.Имя;
					КонецЕсли;
			
		КонецЕсли;
		
	КонецЕсли;
	
	Возврат ИмяРегистра;
	
КонецФункции

#КонецОбласти

#Область ПоследовательностиРасчета

// Устанавливает признак необходимости корректировки налоговых назначений капитальных инвестиций в указанном периоде.
//
Процедура СформироватьЗаданияДляМеханизмовУчетаНДСПартионныйУчет21(РассчитанныйПериод, МассивОрганизаций, ОкончаниеРасчета = Истина) Экспорт
	
	//++ НЕ УТ
	ТекстЗапроса = "";
	ШаблонТекстаЗапроса = "
	|%1
	|
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	Т.Организация КАК Организация,
	|	%2
	|	Т.%3 КАК КорНалоговоеНазначение
	|ИЗ 
	|	РегистрНакопления.%4 КАК Т
	|ГДЕ
	|	Т.Период МЕЖДУ &НачалоПериода И &КонецПериода
	|	И Т.Организация В (&МассивОрганизаций)
	|	И Т.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	|	И Т.Активность
	|	%5
	|";
	
	ПартионныеРегистры = Новый Соответствие;
	ПартионныеРегистры.Вставить(Метаданные.РегистрыНакопления.ПартииПрочихРасходов, 				"ДокументПоступленияРасходов");
	
	Для Каждого КлючИЗначение Из ПартионныеРегистры Цикл
		
		ОбслуживаемыйРегистр = КлючИЗначение.Ключ; // ОбъектМетаданныхРегистрНакопления
		ИмяПоляРегистра = КлючИЗначение.Значение; // Строка
		
		ТекстЗапроса = ТекстЗапроса
			+ СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(
				ШаблонТекстаЗапроса,
				?(ТекстЗапроса = "", "", "ОБЪЕДИНИТЬ ВСЕ"), 
				?(ОкончаниеРасчета, "ЕСТЬNULL(Т.АналитикаУчетаПартий.НалоговоеНазначение, ЗНАЧЕНИЕ(Справочник.НалоговыеНазначенияАктивовИЗатрат.ПустаяСсылка)) КАК НалоговоеНазначение,", ""), 
 				?(ОбслуживаемыйРегистр = Метаданные.РегистрыНакопления.ПартииПрочихРасходов, "НалоговоеНазначениеСписания", "НалоговоеНазначение"), 
				ОбслуживаемыйРегистр.Имя, 
				?(ОбслуживаемыйРегистр = Метаданные.РегистрыНакопления.ПартииПрочихРасходов, "И НЕ Т.Регистратор ССЫЛКА Документ.КорректировкаНалоговогоНазначенияКапитальныхИнвестиций", "") 
			  ); 
		
	КонецЦикла;
	
	Запрос = Новый Запрос;
	Запрос.МенеджерВременныхТаблиц = Новый МенеджерВременныхТаблиц;
	
	Запрос.УстановитьПараметр("НачалоПериода",     НачалоМесяца(РассчитанныйПериод));
	Запрос.УстановитьПараметр("КонецПериода",      КонецМесяца(РассчитанныйПериод));
	Запрос.УстановитьПараметр("МассивОрганизаций", МассивОрганизаций);
	
	Запрос.Текст =
	"ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	&НачалоПериода КАК Период,
	|	Т.Организация,
	|	%1
	|	Т.КорНалоговоеНазначение
	|ПОМЕСТИТЬ ВтИзменениеПартий
	|ИЗ
	|(%2) КАК Т";
	
	Запрос.Текст = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(
		Запрос.Текст,
		?(ОкончаниеРасчета, "Т.НалоговоеНазначение,", ""),
		СокрЛП(ТекстЗапроса));
	
	Запрос.Выполнить();
	
	Если РасчетСебестоимостиПрикладныеАлгоритмы.РазмерВременнойТаблицы(Запрос, "ВтИзменениеПартий") = 0 Тогда
		Возврат;
	КонецЕсли;
	
	УчетНДСЛокализация.СформироватьЗаданияДляКорректировкиНалоговогоНазначенияКапитальныхИнвестиций(Запрос.МенеджерВременныхТаблиц);
	
	
	//-- НЕ УТ
	Возврат;
	
КонецПроцедуры

// Подготавливает данные для формирования заданий по корректировке налоговых назначений капитальных инвестиций в указанном периоде.
// Для этого необходимо собрать данные регистров из ИБ до начала записи сформированных при расчете движений.
//
Процедура ПодготовитьДанныеДляФормированияЗаданийДляМеханизмовУчетаНДСПартионныйУчет22(ПараметрыРасчета) Экспорт
	
	//++ НЕ УТ
	Если ПараметрыРасчета.ВариантРасчета <> Перечисления.ВариантыРасчетаПартийИСебестоимости.ПартииИСебестоимость Тогда
		Возврат;
	КонецЕсли;
	
	Запрос = Новый Запрос;
	РасчетСебестоимостиПрикладныеАлгоритмы.ИнициализироватьСвойстваЗапроса(Запрос, ПараметрыРасчета);
	
	Запрос.Текст =
	"ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	Т.Организация КАК Организация,
	|	Т.НалоговоеНазначение КАК НалоговоеНазначение,
	|	Т.КорНалоговоеНазначение КАК КорНалоговоеНазначение
	|ПОМЕСТИТЬ ВтСтарыеДанныеДляМеханизмовУчетаНДС
	|ИЗ
	|	(ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		Т.Организация КАК Организация,
	|		ЕСТЬNULL(Т.АналитикаУчетаПартий.НалоговоеНазначение, ЗНАЧЕНИЕ(Справочник.НалоговыеНазначенияАктивовИЗатрат.ПустаяСсылка)) КАК НалоговоеНазначение,
	|		Т.НалоговоеНазначениеСписания КАК КорНалоговоеНазначение
	|	ИЗ
	|		РегистрНакопления.ПартииПрочихРасходов КАК Т
	|	ГДЕ
	|		Т.Период МЕЖДУ &НачалоПериода И &КонецПериода
	|		И Т.Организация В(&МассивОрганизаций)
	|		И НЕ Т.Регистратор ССЫЛКА Документ.КорректировкаНалоговогоНазначенияКапитальныхИнвестиций
	|		И (Т.СтоимостьРегл <> 0 ИЛИ Т.НДСРегл <> 0 ИЛИ Т.НДСУпр <> 0)
	|		И Т.Активность
	|	) КАК Т";
	
	РасчетСебестоимостиПрикладныеАлгоритмы.ВыполнитьЗапросСЗамеромДляПротокола(ПараметрыРасчета, Запрос);
	//-- НЕ УТ
	Возврат;
	
КонецПроцедуры

// Устанавливает признак необходимости корректировки налоговых назначений капитальных инвестиций в указанном периоде.
//
Процедура СформироватьЗаданияДляМеханизмовУчетаНДСПартионныйУчет22(ПараметрыРасчета) Экспорт
	
	//++ НЕ УТ
	Если ПараметрыРасчета.ВариантРасчета <> Перечисления.ВариантыРасчетаПартийИСебестоимости.ПартииИСебестоимость Тогда
		Возврат;
	КонецЕсли;
	
	Запрос = Новый Запрос;
	РасчетСебестоимостиПрикладныеАлгоритмы.ИнициализироватьСвойстваЗапроса(Запрос, ПараметрыРасчета);
	
	Запрос.Текст =
	"ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	&НачалоПериода КАК Период,
	|	Т.Организация КАК Организация,
	|	Т.НалоговоеНазначение КАК НалоговоеНазначение,
	|	Т.КорНалоговоеНазначение КАК КорНалоговоеНазначение
	|ПОМЕСТИТЬ ВтИзменениеПартий
	|ИЗ
	|	(ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		Т.Организация КАК Организация,
	|		ЕСТЬNULL(Т.АналитикаУчетаПартий.НалоговоеНазначение, ЗНАЧЕНИЕ(Справочник.НалоговыеНазначенияАктивовИЗатрат.ПустаяСсылка)) КАК НалоговоеНазначение,
	|		Т.НалоговоеНазначениеСписания КАК КорНалоговоеНазначение
	|	ИЗ
	|		ВТКэшПартииПрочихРасходов КАК Т
	|	ГДЕ
	|		Т.СтоимостьРегл <> 0 ИЛИ Т.НДСРегл <> 0 ИЛИ Т.НДСУпр <> 0
	|
	|	ОБЪЕДИНИТЬ ВСЕ
	|
	|	ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		Т.Организация,
	|		Т.НалоговоеНазначение,
	|		Т.КорНалоговоеНазначение
	|	ИЗ
	|		ВтСтарыеДанныеДляМеханизмовУчетаНДС КАК Т
	|	) КАК Т";
	
	РасчетСебестоимостиПрикладныеАлгоритмы.ВыполнитьЗапросСЗамеромДляПротокола(ПараметрыРасчета, Запрос);
	
	Если РасчетСебестоимостиПрикладныеАлгоритмы.РазмерВременнойТаблицы(Запрос, "ВтИзменениеПартий") > 0 Тогда
		УчетНДСЛокализация.СформироватьЗаданияДляКорректировкиНалоговогоНазначенияКапитальныхИнвестиций(Запрос.МенеджерВременныхТаблиц);
	КонецЕсли;
	
	РасчетСебестоимостиПрикладныеАлгоритмы.УничтожитьВременныеТаблицы(
		ПараметрыРасчета,
		"ВтСтарыеДанныеДляМеханизмовУчетаНДС, ВтИзменениеПартий");
		
	//-- НЕ УТ
	Возврат;
	
КонецПроцедуры

#КонецОбласти

#Область СостояниеОперацииЗакрытияМесяца

Процедура Использование_РасчетПартийИСебестоимости(ПараметрыОбработчика) Экспорт
	
	ПараметрыРасчета = ПараметрыОбработчика.ПараметрыРасчета;
	ПериодРасчета    = ПараметрыРасчета.ПериодРегистрации;
	МассивОрганизаций = ПараметрыОбработчика.ДанныеЭтапа.МассивОрганизаций;
	
	ПериодПересчетаПартийНДС = ПроверкаНеобходимостьПересчетаРегистраПартийНДС(ПараметрыРасчета);
	
	Если ЗначениеЗаполнено(ПериодПересчетаПартийНДС) Тогда
		
		ТекстОшибки = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(
			НСтр("ru='Обнаружены некорректные движения по регистру ""%1"" за период %2.
|Необходимо выполнить закрытие месяца начиная с данного периода.'
|;uk='Виявлено некоректні руху по регістру ""%1"" за період %2.
|Необхідно виконати закриття місяця починаючи з даного періоду.'",ОбщегоНазначения.КодОсновногоЯзыка()),
            Метаданные.РегистрыНакопления.ДетализацияПартийТоваровДляНДС2_4.Синоним,
			РасчетСебестоимостиПротоколРасчета.ПредставлениеПериодаРасчета(ПериодПересчетаПартийНДС));
		
		ЗакрытиеМесяцаСервер.ДобавитьПоясняющуюИнформациюКЭтапу(
			ПараметрыОбработчика,
			ТекстОшибки,
			,
			,
			Перечисления.ВариантыВажностиПроблемыСостоянияСистемы.Ошибка);
		
	КонецЕсли;
	
	ОрганизацииСДвижениямиПоСебестоимости = РасчетСебестоимостиПрикладныеАлгоритмы.ОрганизацииСДвижениямиПоСебестоимости(
		ПериодРасчета,
		МассивОрганизаций);
	
	СостояниеКорректировкиНДС = СостояниеКорректировкиНДС(ПериодРасчета, МассивОрганизаций);
	
	ЗакрытиеМесяцаСервер.УвеличитьКоличествоОбработанныхДанныхДляЗамера(ПараметрыОбработчика, 1);
	
	Если СостояниеКорректировкиНДС = Перечисления.СостоянияОперацийЗакрытияМесяца.НеВыполнено Тогда
		
		ЗакрытиеМесяцаСервер.УстановитьСостояниеНеВыполнен(
			ПараметрыОбработчика,
			НСтр("ru='Требуется выполнить корректировку налогообложения НДС.';uk='Потрібно виконати коригування оподаткування ПДВ.'",ОбщегоНазначения.КодОсновногоЯзыка()));
		Возврат;
		
	КонецЕсли;
	
	Если НЕ ЗначениеЗаполнено(ОрганизацииСДвижениямиПоСебестоимости)
 	 И СостояниеКорректировкиНДС = Перечисления.СостоянияОперацийЗакрытияМесяца.НеТребуется Тогда
		
		ЗакрытиеМесяцаСервер.УстановитьСостояниеНеТребуется(
			ПараметрыОбработчика,
			НСтр("ru='Нет движений по регистрам себестоимости и прочих расходов.';uk='Немає рухів по регістрах собівартості та інших витрат.'",ОбщегоНазначения.КодОсновногоЯзыка()));
		Возврат;
		
	КонецЕсли;
	
КонецПроцедуры

// Возвращает текущее состояние корректировки налогообложения НДС.
//
Функция СостояниеКорректировкиНДС(ПериодРасчета, МассивОрганизаций) Экспорт
    
    Возврат Перечисления.СостоянияОперацийЗакрытияМесяца.НеТребуется;
    
    
	НеТребуетсяКорректировкаНДС = Истина;
	ВыполненаКорректировкаНДС	= Истина;
	
	Если РасчетСебестоимостиПовтИсп.ПартионныйУчетВерсии21(НачалоМесяца(ПериодРасчета))
	 И КонецКвартала(ПериодРасчета) = КонецМесяца(ПериодРасчета) Тогда
		
		НачалоСледНалПериода = КонецМесяца(ПериодРасчета) + 1;
		
		Запрос = Новый Запрос;
		Запрос.УстановитьПараметр("НачалоПериода", 	   		 НачалоМесяца(ПериодРасчета));
		Запрос.УстановитьПараметр("КонецПериода",  	   		 КонецМесяца(ПериодРасчета));
		Запрос.УстановитьПараметр("МассивОрганизаций", 		 МассивОрганизаций);
		Запрос.УстановитьПараметр("ГраницаКонецПериода", 	 Новый Граница(КонецМесяца(ПериодРасчета), ВидГраницы.Исключая));
		Запрос.УстановитьПараметр("НачалоПериодаМинус3Года", ДобавитьМесяц(НачалоСледНалПериода, -36));
		Запрос.УстановитьПараметр("КонецПериодаМинус3Года",  ДобавитьМесяц(КонецКвартала(НачалоСледНалПериода), -36));
		
		// Необходимость корректировки НДС проверяем по наборам аналитик
		Запрос.Текст =
		"ВЫБРАТЬ
		|	Партии.Организация,
		|	Партии.АналитикаУчетаНоменклатуры,
		|	Партии.ДокументПоступления,
		|	Партии.ВидЗапасов,
		|	Партии.АналитикаУчетаПартий,
		|	СУММА(Партии.КоличествоОстаток) КАК КоличествоОстаток,
		|	СУММА(Партии.Количество) КАК Количество
		|ПОМЕСТИТЬ ВТПартии
		|ИЗ
		// Регистры, используемые только в партионном учете версии 2.1
		|	(ВЫБРАТЬ
		|		Остатки.Организация						КАК Организация,
		|		Остатки.АналитикаУчетаНоменклатуры		КАК АналитикаУчетаНоменклатуры,
		|		Остатки.ДокументПоступления				КАК ДокументПоступления,
		|		Остатки.ВидЗапасов						КАК ВидЗапасов,
		|		Остатки.АналитикаУчетаПартий			КАК АналитикаУчетаПартий,
		|		Остатки.КоличествоОстаток				КАК КоличествоОстаток,
		|		Остатки.КоличествоОстаток				КАК Количество
		|	ИЗ
		|		РегистрНакопления.ПартииТоваровОрганизаций.Остатки(
		|				&ГраницаКонецПериода,
		|				АналитикаУчетаПартий.НалогообложениеНДС = ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПоФактическомуИспользованию)
		|				И Организация В(&МассивОрганизаций)
		|		) КАК Остатки
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.ДанныеПервичныхДокументов КАК ДанныеПервичныхДокументов
		|			ПО Остатки.ДокументПоступления = ДанныеПервичныхДокументов.Документ
		|	ГДЕ
		|		ДанныеПервичныхДокументов.ДатаРегистратора МЕЖДУ &НачалоПериодаМинус3Года И &КонецПериодаМинус3Года
		|		И Остатки.КоличествоОстаток > 0
		|	
		|	ОБЪЕДИНИТЬ ВСЕ
		|	
		|	ВЫБРАТЬ
		|		Остатки.Организация						КАК Организация,
		|		Остатки.АналитикаУчетаНоменклатуры		КАК АналитикаУчетаНоменклатуры,
		|		Остатки.ДокументПоступления				КАК ДокументПоступления,
		|		Остатки.ВидЗапасов						КАК ВидЗапасов,
		|		Остатки.АналитикаУчетаПартий			КАК АналитикаУчетаПартий,
		|		0										КАК КоличествоОстаток,
		|		Остатки.Количество						КАК Количество
		|	ИЗ
		|		РегистрНакопления.ПартииТоваровОрганизаций КАК Остатки
		|	ГДЕ
		|		Остатки.Период МЕЖДУ &НачалоПериода И &КонецПериода
		|		И Остатки.Организация В(&МассивОрганизаций)
		|		И Остатки.Активность
		|		И Остатки.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
		|		И Остатки.Регистратор ССЫЛКА Документ.КорректировкаНалогообложенияНДСПартийТоваров
		|		И Остатки.ДокументПоступления.Дата МЕЖДУ &НачалоПериодаМинус3Года И &КонецПериодаМинус3Года
		|	) КАК Партии
		|
		|СГРУППИРОВАТЬ ПО
		|	Партии.Организация,
		|	Партии.АналитикаУчетаНоменклатуры,
		|	Партии.ДокументПоступления,
		|	Партии.ВидЗапасов,
		|	Партии.АналитикаУчетаПартий
		|;
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	МИНИМУМ(Партии.КоличествоОстаток) КАК КоличествоОстаток,
		|	МАКСИМУМ(Партии.Количество) КАК Количество
		|ИЗ
		|	ВТПартии КАК Партии";
		
		Выборка = Запрос.Выполнить().Выбрать();
		Выборка.Следующий();
		
		НеТребуетсяКорректировкаНДС = (Выборка.Количество = NULL ИЛИ Выборка.Количество <= 0);
		ВыполненаКорректировкаНДС   = НеТребуетсяКорректировкаНДС ИЛИ (Выборка.КоличествоОстаток <> NULL И Выборка.КоличествоОстаток > 0);
		
	КонецЕсли;
	
	Если НеТребуетсяКорректировкаНДС Тогда
		Состояние = Перечисления.СостоянияОперацийЗакрытияМесяца.НеТребуется;
	ИначеЕсли ВыполненаКорректировкаНДС Тогда
		Состояние = Перечисления.СостоянияОперацийЗакрытияМесяца.ВыполненоУспешно;
	Иначе
		Состояние = Перечисления.СостоянияОперацийЗакрытияМесяца.НеВыполнено;
	КонецЕсли;
	
	Возврат Состояние;
	
КонецФункции

#КонецОбласти

#Область АнализСостоянияСистемы

// Заполняет проверки, выполняемые в рамках расчета партий и себестоимости.
//
// Параметры:
//	ТаблицаПроверок - Таблица значений - см. АудитСостоянияСистемыПереопределяемый.ЗаполнитьПроверкиДляРегистрации().
//
Процедура ЗаполнитьПроверкиДляРегистрации(ТаблицаПроверок) Экспорт
	
    // Соответствие остатков в регистрах СебестоимостьТоваров и ДетализацияПартийТоваровДляНДС.
	// Технологическая проверка для автотестов, см. технологический параметр "ПроверятьСоответствиеСебестоимостиИПартийНДС".
	ОписаниеПроверки = ЗакрытиеМесяцаСервер.ДобавитьОписаниеНовойПроверки(ТаблицаПроверок,
		"СоответствиеРегистровСебестоимостиИПартийНДС",
		Перечисления.ОперацииЗакрытияМесяца.РасчетПартийИСебестоимости,
		Перечисления.МоментЗапускаПроверкиОперацииЗакрытияМесяца.ПослеРасчета,
		"РасчетСебестоимостиНДС.ПроверкаСоответствияРегистровСебестоимостиИПартийНДС",
		Перечисления.ВариантыВажностиПроблемыСостоянияСистемы.Ошибка);
	
	ОписаниеПроверки.ВозможноИзменениеВажности = Истина;
	
	ЗакрытиеМесяцаСервер.ЗаполнитьПредставлениеНовойПроверки(ОписаниеПроверки,
		НСтр("ru='Соответствие остатков в регистрах себестоимости и партий НДС.';uk='Відповідність залишків в регістрах собівартості і партій ПДВ.'",ОбщегоНазначения.КодОсновногоЯзыка()),
        НСтр("ru='Остатки по регистру ""Детализация партий товаров для НДС"" должны соответствовать остаткам по регистру ""Себестоимость товаров"":
|- остатки по количеству в регистре партий НДС не должны превышать остатки по количеству в регистре себестоимости
|- не должно быть остатков по суммам регл. (СтоимостьБезНДС + НДС) в регистре партий НДС при отсутствии остатков по суммам регл. в регистре себестоимости (СтоимостьРегл + ДопРасходыРегл)
|- не должно быть остатков по суммам упр. в регистре партий НДС (НДСУпр) при отсутствии остатков по суммам упр. в регистре себестоимости (СтоимостьУпр + ДопРасходыУпр)'
|;uk='Залишки по регістру ""Деталізація партій товарів для ПДВ"" повинні відповідати залишкам по регістру ""Собівартість товарів"":
|- залишки за кількістю в регістрі партій ПДВ не повинні перевищувати залишки за кількістю в регістрі собівартості 
|- не повинно бути залишків за сумами регл. (СтоимостьБезНДС + НДС) в регістрі партій ПДВ при відсутності залишків за сумами регл. в регістрі собівартості (СтоимостьРегл + ДопРасходыРегл)
|- не повинно бути залишків за сумами упр. в регістрі партій ПДВ (НДСУпр) при відсутності залишків за сумами упр. в регістрі собівартості (СтоимостьУпр + ДопРасходыУпр)'",ОбщегоНазначения.КодОсновногоЯзыка()));
	
КонецПроцедуры

// Процедура-обработчик проверки состояния системы "СоответствиеРегистровСебестоимостиИПартийНДС".
//
Процедура ПроверкаСоответствияРегистровСебестоимостиИПартийНДС(ПараметрыПроверки) Экспорт
	
	ЗначенияПараметров = РасчетСебестоимостиПовтИсп.ЗначенияТехнологическихПараметров();
	
	// Проверка выполняется если явно включен соответствующий технологический параметр.
	Если НЕ ЗначенияПараметров.ПроверятьСоответствиеСебестоимостиИПартийНДС Тогда
		Возврат;
	КонецЕсли;
	
	ТекстЗапроса =
	ТекстЗапросаТаблицыДляОтбораАналитикУчетаПартийНДС2_4() + "
	|;
	|////////////////////////////////////////////////////////////////////////////////
	|" + "
	|
	|ВЫБРАТЬ
	|	Т.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
	|	Т.РазделУчета КАК РазделУчета,
	|	Т.ВидЗапасов КАК ВидЗапасов,
	|	Т.Организация КАК Организация,
	|	Т.АналитикаФинансовогоУчета КАК АналитикаФинансовогоУчета,
    |	Т.НалоговоеНазначение КАК НалоговоеНазначение,
	|	Т.Партия КАК Партия,
	|	Т.АналитикаУчетаПартий КАК АналитикаУчетаПартий,
	|	Т.КоличествоОстаток КАК Количество,
	|	Т.СтоимостьРеглОстаток + Т.ДопРасходыРеглОстаток + Т.ПостатейныеПостоянныеРеглОстаток КАК СтоимостьРегл,
	|	Т.СтоимостьУпрОстаток + Т.ДопРасходыУпрОстаток + Т.ПостатейныеПостоянныеУпрОстаток КАК СтоимостьУпр
	|ПОМЕСТИТЬ ВТСебестоимость
	|ИЗ
	|	РегистрНакопления.СебестоимостьТоваров.Остатки(
	|		&ГраницаКонецПериода,
	|		Организация В (&МассивОрганизаций)
	|		И &ПартионныйУчетВерсии22
	|		И НЕ РазделУчета В (
	|			ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПринятыеНаКомиссию),
	|			ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.МатериалыПринятыеВПереработку),
	|			ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НеотфактурованныеПоставки))
	|	) КАК Т
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	Т.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
	|	Т.РазделУчета КАК РазделУчета,
	|	Т.ВидЗапасов КАК ВидЗапасов,
	|	Т.Организация КАК Организация,
	|	Т.АналитикаФинансовогоУчета КАК АналитикаФинансовогоУчета,
    |	Т.НалоговоеНазначение КАК НалоговоеНазначение,
	|	Т.КоличествоОстаток КАК Количество,
	|	Т.СтоимостьБезНДСОстаток КАК СтоимостьБезНДС
	|ПОМЕСТИТЬ ВТПартииНДС
	|ИЗ
    |	РегистрНакопления.ДетализацияПартийТоваровДляНДС.Остатки(
	|		&ГраницаКонецПериода,
	|		Организация В (&МассивОрганизаций)
	|		И &ПартионныйУчетВерсии22
	|		И НЕ РазделУчета В (
	|			ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПринятыеНаКомиссию),
	|			ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.МатериалыПринятыеВПереработку),
	|			ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НеотфактурованныеПоставки))
	|	) КАК Т
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	Т.Организация КАК Организация,
	|	Т.Партия КАК Партия,
	|	Т.АналитикаУчетаПартий КАК АналитикаУчетаПартий,
    |	Т.НалоговоеНазначение КАК НалоговоеНазначение,
	|	Т.СтоимостьБезНДСОстаток
	|		+ ВЫБОР
	|		    КОГДА Т.НалоговоеНазначение.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ВидыДеятельностиНДС.Необлагаемая) 
	|				ТОГДА Т.НДСОстаток
	|			ИНАЧЕ 0
	|		КОНЕЦ КАК СтоимостьРегл,
	|	Т.СтоимостьБезНДСУпрОстаток
	|		+ ВЫБОР
	|		    КОГДА Т.НалоговоеНазначение.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ВидыДеятельностиНДС.Необлагаемая) 
	|				ТОГДА Т.НДСУпрОстаток
	|			ИНАЧЕ 0
	|		КОНЕЦ КАК СтоимостьУпр
	|ПОМЕСТИТЬ ВТПартииНДС2_4
	|ИЗ
    |	РегистрНакопления.ДетализацияПартийТоваровДляНДС2_4.Остатки(
	|		&ГраницаКонецПериода,
	|		Организация В (&МассивОрганизаций)
	|		И &ПартионныйУчетВерсии22
	|	) КАК Т
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	Т.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
	|	Т.РазделУчета КАК РазделУчета,
	|	Т.ВидЗапасов КАК ВидЗапасов,
	|	Т.Организация КАК Организация,
	|	Т.АналитикаФинансовогоУчета КАК АналитикаФинансовогоУчета,
    |	Т.НалоговоеНазначение КАК НалоговоеНазначение,
	|	СУММА(Т.КоличествоСебестоимость) КАК КоличествоСебестоимость,
	|	СУММА(Т.КоличествоПартииНДС) КАК КоличествоПартииНДС
	|ПОМЕСТИТЬ ВТРасхожденияСебестоимостиИПартийНДС
	|ИЗ
	|	(ВЫБРАТЬ
	|		Т.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
	|		Т.РазделУчета КАК РазделУчета,
	|		Т.ВидЗапасов КАК ВидЗапасов,
	|		Т.Организация КАК Организация,
	|		Т.АналитикаФинансовогоУчета КАК АналитикаФинансовогоУчета,
    |		Т.НалоговоеНазначение КАК НалоговоеНазначение,
	|		Т.Количество КАК КоличествоСебестоимость,
	|		0 КАК КоличествоПартииНДС
	|	ИЗ
	|		ВТСебестоимость КАК Т
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ
	|		Т.АналитикаУчетаНоменклатуры,
	|		Т.РазделУчета,
	|		Т.ВидЗапасов,
	|		Т.Организация,
	|		Т.АналитикаФинансовогоУчета,
    |		Т.НалоговоеНазначение,
	|		0,
	|		Т.Количество
	|	ИЗ
	|		ВТПартииНДС КАК Т) КАК Т
	|
	|СГРУППИРОВАТЬ ПО
	|	Т.АналитикаУчетаНоменклатуры,
	|	Т.РазделУчета,
	|	Т.ВидЗапасов,
	|	Т.Организация,
	|	Т.АналитикаФинансовогоУчета,
    |	Т.НалоговоеНазначение
	|
	|ИМЕЮЩИЕ
	|	СУММА(Т.КоличествоСебестоимость) >= 0
	|	И СУММА(Т.КоличествоСебестоимость) < СУММА(Т.КоличествоПартииНДС)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	Т.Организация,
	|	Т.Партия,
	|	Т.АналитикаУчетаПартий,
    |	Т.НалоговоеНазначение,
	|	СУММА(Т.КоличествоСебестоимость) КАК КоличествоСебестоимость,
	|	СУММА(Т.СтоимостьРеглСебестоимость) КАК СтоимостьРеглСебестоимость,
	|	СУММА(Т.СтоимостьУпрСебестоимость) КАК СтоимостьУпрСебестоимость,
	|	СУММА(Т.СтоимостьРеглПартииНДС) КАК СтоимостьРеглПартииНДС,
	|	СУММА(Т.СтоимостьУпрПартииНДС) КАК СтоимостьУпрПартииНДС
	|ПОМЕСТИТЬ ВТРасхожденияСебестоимостиИПартийНДС2_4
	|ИЗ
	|	(ВЫБРАТЬ
	|		Т.Организация,
	|		Т.Партия,
	|		ЕСТЬNULL(АналитикиУчетаПартий.Ссылка, ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка)) КАК АналитикаУчетаПартий,
    |		Т.НалоговоеНазначение,
	|		Т.Количество КАК КоличествоСебестоимость,
	|		Т.СтоимостьРегл КАК СтоимостьРеглСебестоимость,
	|		Т.СтоимостьУпр КАК СтоимостьУпрСебестоимость,
	|		0 КАК СтоимостьРеглПартииНДС,
	|		0 КАК СтоимостьУпрПартииНДС
	|	ИЗ
	|		ВТСебестоимость КАК Т
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТОтборАналитикиУчетаПартийНДС2_4 КАК АналитикиУчетаПартий
	|			ПО Т.АналитикаУчетаПартий = АналитикиУчетаПартий.Ссылка
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ
	|		Т.Организация,
	|		Т.Партия,
	|		Т.АналитикаУчетаПартий,
    |		Т.НалоговоеНазначение,
	|		0 КАК КоличествоСебестоимость,
	|		0 КАК СтоимостьРеглСебестоимость,
	|		0 КАК СтоимостьУпрСебестоимость,
	|		Т.СтоимостьРегл КАК СтоимостьРеглПартииНДС,
	|		Т.СтоимостьУпр КАК СтоимостьУпрПартииНДС
	|	ИЗ
	|		ВТПартииНДС2_4 КАК Т) КАК Т
	|
	|СГРУППИРОВАТЬ ПО
	|	Т.Организация,
	|	Т.Партия,
	|	Т.АналитикаУчетаПартий,
    |	Т.НалоговоеНазначение
	|
	|ИМЕЮЩИЕ
	|	(СУММА(Т.КоличествоСебестоимость) > 0
	|		И СУММА(Т.СтоимостьРеглСебестоимость) + &ЗначениеПогрешностиСебестоимостьРегл < СУММА(Т.СтоимостьРеглПартииНДС))
	|	ИЛИ
	|	(СУММА(Т.КоличествоСебестоимость) > 0
	|		И СУММА(Т.СтоимостьУпрСебестоимость) + &ЗначениеПогрешностиСебестоимостьУпр < СУММА(Т.СтоимостьУпрПартииНДС))
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	Т.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
	|	Т.РазделУчета КАК РазделУчета,
	|	Т.ВидЗапасов КАК ВидЗапасов,
	|	Т.Организация КАК Организация,
	|	Т.АналитикаФинансовогоУчета КАК АналитикаФинансовогоУчета,
    |	Т.НалоговоеНазначение КАК НалоговоеНазначение,
	|	СУММА(Т.КоличествоСебестоимость) КАК КоличествоСебестоимость,
	|	СУММА(Т.КоличествоПартииНДС) КАК КоличествоПартииНДС,
	|	СУММА(Т.СтоимостьПартииНДС) КАК СтоимостьПартииНДС
	|ПОМЕСТИТЬ ВТСуммовыеОстаткиПартийНДС
	|ИЗ
	|	(ВЫБРАТЬ
	|		Т.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
	|		Т.РазделУчета КАК РазделУчета,
	|		Т.ВидЗапасов КАК ВидЗапасов,
	|		Т.Организация КАК Организация,
	|		Т.АналитикаФинансовогоУчета КАК АналитикаФинансовогоУчета,
    |		Т.НалоговоеНазначение КАК НалоговоеНазначение,
	|		Т.Количество КАК КоличествоСебестоимость,
	|		0 КАК КоличествоПартииНДС,
	|		0 КАК СтоимостьПартииНДС
	|	ИЗ
	|		ВТСебестоимость КАК Т
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ
	|		Т.АналитикаУчетаНоменклатуры,
	|		Т.РазделУчета,
	|		Т.ВидЗапасов,
	|		Т.Организация,
	|		Т.АналитикаФинансовогоУчета,
	|		Т.ВидДеятельностиНДС,
	|		0 КАК КоличествоСебестоимость,
	|		Т.Количество КАК КоличествоПартииНДС,
	|		Т.СтоимостьБезНДС КАК СтоимостьПартииНДС
	|	ИЗ
	|		ВТПартииНДС КАК Т) КАК Т
	|
	|СГРУППИРОВАТЬ ПО
	|	Т.АналитикаУчетаНоменклатуры,
	|	Т.РазделУчета,
	|	Т.ВидЗапасов,
	|	Т.Организация,
	|	Т.АналитикаФинансовогоУчета,
    |	Т.НалоговоеНазначение
	|
	|ИМЕЮЩИЕ
	|	СУММА(Т.КоличествоСебестоимость) = 0
	|	И СУММА(Т.КоличествоПартииНДС) = 0
	|	И СУММА(Т.СтоимостьПартииНДС) <> 0
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	Т.Организация,
	|	Т.Партия,
	|	Т.АналитикаУчетаПартий,
    |	Т.НалоговоеНазначение,
	|	СУММА(Т.КоличествоСебестоимость) КАК КоличествоСебестоимость,
	|	СУММА(Т.СтоимостьРеглПартииНДС) КАК СтоимостьРеглПартииНДС,
	|	СУММА(Т.СтоимостьУпрПартииНДС) КАК СтоимостьУпрПартииНДС
	|ПОМЕСТИТЬ ВТСуммовыеОстаткиПартийНДС2_4
	|ИЗ
	|	(ВЫБРАТЬ
	|		Т.Организация,
	|		Т.Партия,
	|		ЕСТЬNULL(АналитикиУчетаПартий.Ссылка, ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка)) КАК АналитикаУчетаПартий,
    |		Т.НалоговоеНазначение,
	|		Т.Количество КАК КоличествоСебестоимость,
	|		0 КАК СтоимостьРеглПартииНДС,
	|		0 КАК СтоимостьУпрПартииНДС
	|	ИЗ
	|		ВТСебестоимость КАК Т
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТОтборАналитикиУчетаПартийНДС2_4 КАК АналитикиУчетаПартий
	|			ПО Т.АналитикаУчетаПартий = АналитикиУчетаПартий.Ссылка
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ
	|		Т.Организация,
	|		Т.Партия,
	|		Т.АналитикаУчетаПартий,
    |		Т.НалоговоеНазначение,
	|		0 КАК КоличествоСебестоимость,
	|		Т.СтоимостьРегл КАК СтоимостьРеглПартииНДС,
	|		Т.СтоимостьУпр КАК СтоимостьУпрПартииНДС
	|	ИЗ
	|		ВТПартииНДС2_4 КАК Т) КАК Т
	|
	|СГРУППИРОВАТЬ ПО
	|	Т.Организация,
	|	Т.Партия,
	|	Т.АналитикаУчетаПартий,
    |	Т.НалоговоеНазначение
	|
	|ИМЕЮЩИЕ
	|	СУММА(Т.КоличествоСебестоимость) = 0
	|	И (СУММА(Т.СтоимостьРеглПартииНДС) <> 0
	|		ИЛИ СУММА(Т.СтоимостьУпрПартииНДС) <> 0)
	|";
	
	// Регистрация расхождений по количеству между регистрами себестоимости и партиями НДС 2.2.
	СписокПолей = Новый СписокЗначений;
	СписокПолей.Добавить("Организация", 				НСтр("ru='Организация';uk='Організація'",ОбщегоНазначения.КодОсновногоЯзыка()));
	СписокПолей.Добавить("РазделУчета",					НСтр("ru='Раздел учета';uk='Розділ обліку'",ОбщегоНазначения.КодОсновногоЯзыка()));
	СписокПолей.Добавить("АналитикаУчетаНоменклатуры",	НСтр("ru='Аналитика номенклатуры';uk='Аналітика номенклатури'",ОбщегоНазначения.КодОсновногоЯзыка()));
	СписокПолей.Добавить("ВидЗапасов",					НСтр("ru='Вид запасов';uk='Вид запасів'",ОбщегоНазначения.КодОсновногоЯзыка()));
	СписокПолей.Добавить("АналитикаФинансовогоУчета",	НСтр("ru='Аналитика финансового учета';uk='Аналітика фінансового обліку'",ОбщегоНазначения.КодОсновногоЯзыка()));
    СписокПолей.Добавить("НалоговоеНазначение",			НСтр("ru='Налоговое назначение';uk='Податкове призначення'",ОбщегоНазначения.КодОсновногоЯзыка()));
	СписокПолей.Добавить("КоличествоСебестоимость",		НСтр("ru='Количество (себестоимость)';uk='Кількість (собівартість)'",ОбщегоНазначения.КодОсновногоЯзыка()));
	СписокПолей.Добавить("КоличествоПартииНДС",			НСтр("ru='Количество (партии НДС)';uk='Кількість (партії ПДВ)'",ОбщегоНазначения.КодОсновногоЯзыка()));
	
	ПараметрыРегистрации = ЗакрытиеМесяцаСервер.ИнициализироватьПараметрыРегистрацииПроблемПроверки(
		"ВТРасхожденияСебестоимостиИПартийНДС",
		НСтр("ru='Обнаружены расхождения по количеству между регистрами себестоимости и партий НДС (средняя за месяц) по организации ""%1"" на конец периода %2';uk='Виявлено розбіжності за кількістю між регістрами собівартості і партій ПДВ (середня за місяць) по організації ""%1"" на кінець періоду %2'",ОбщегоНазначения.КодОсновногоЯзыка()),
		СписокПолей,
		,
        Метаданные.РегистрыНакопления.ДетализацияПартийТоваровДляНДС.ПолноеИмя());
		
    // Регистрация наличия суммовых остатков в регистре "Детализация партий товаров для НДС (средняя за месяц)".
	СписокПолей = Новый СписокЗначений;
	СписокПолей.Добавить("Организация", 				НСтр("ru='Организация';uk='Організація'",ОбщегоНазначения.КодОсновногоЯзыка()));
	СписокПолей.Добавить("РазделУчета",					НСтр("ru='Раздел учета';uk='Розділ обліку'",ОбщегоНазначения.КодОсновногоЯзыка()));
	СписокПолей.Добавить("АналитикаУчетаНоменклатуры",	НСтр("ru='Аналитика номенклатуры';uk='Аналітика номенклатури'",ОбщегоНазначения.КодОсновногоЯзыка()));
	СписокПолей.Добавить("ВидЗапасов",					НСтр("ru='Вид запасов';uk='Вид запасів'",ОбщегоНазначения.КодОсновногоЯзыка()));
	СписокПолей.Добавить("АналитикаФинансовогоУчета",	НСтр("ru='Аналитика финансового учета';uk='Аналітика фінансового обліку'",ОбщегоНазначения.КодОсновногоЯзыка()));
    СписокПолей.Добавить("НалоговоеНазначение",			НСтр("ru='Налоговое назначение';uk='Податкове призначення'",ОбщегоНазначения.КодОсновногоЯзыка()));
	СписокПолей.Добавить("СтоимостьПартииНДС",			НСтр("ru='Стоимость без НДС';uk='Вартість без ПДВ'",ОбщегоНазначения.КодОсновногоЯзыка()));
	
	ЗакрытиеМесяцаСервер.ДополнитьПараметрыРегистрацииПроблемПроверки(ПараметрыРегистрации,
		"ВТСуммовыеОстаткиПартийНДС",
        НСтр("ru='Обнаружены суммовые остатки без количества в регистре ""Детализация партий товаров для НДС (средняя за месяц)"" по организации ""%1"" на конец периода %2';uk='Виявлено сумові залишки без кількості в регістрі ""Деталізація партій товарів для ПДВ (середня за місяць)"" по організації ""%1"" на кінець періоду %2'",ОбщегоНазначения.КодОсновногоЯзыка()),
		СписокПолей,
		,
        Метаданные.РегистрыНакопления.ДетализацияПартийТоваровДляНДС.ПолноеИмя());
		
	// Регистрация расхождений по количеству между регистрами себестоимости и партиями НДС 2.4.
	СписокПолей = Новый СписокЗначений;
	СписокПолей.Добавить("Организация", 				НСтр("ru='Организация';uk='Організація'",ОбщегоНазначения.КодОсновногоЯзыка()));
	СписокПолей.Добавить("Партия",						НСтр("ru='Партия';uk='Партія'",ОбщегоНазначения.КодОсновногоЯзыка()));
	СписокПолей.Добавить("АналитикаУчетаПартий",		НСтр("ru='Аналитика партий';uk='Аналітика партій'",ОбщегоНазначения.КодОсновногоЯзыка()));
    СписокПолей.Добавить("НалоговоеНазначение",			НСтр("ru='Налоговое назначение';uk='Податкове призначення'",ОбщегоНазначения.КодОсновногоЯзыка()));
	СписокПолей.Добавить("СтоимостьРеглСебестоимость",	НСтр("ru='Стоимость регл. (себестоимость)';uk='Вартість регл. (собівартість)'",ОбщегоНазначения.КодОсновногоЯзыка()));
	СписокПолей.Добавить("СтоимостьУпрСебестоимость",	НСтр("ru='Стоимость упр. (себестоимость)';uk='Вартість упр. (собівартість)'",ОбщегоНазначения.КодОсновногоЯзыка()));
	СписокПолей.Добавить("СтоимостьРеглПартииНДС",		НСтр("ru='Стоимость регл. (партии НДС)';uk='Вартість регл. (партії ПДВ)'",ОбщегоНазначения.КодОсновногоЯзыка()));
	СписокПолей.Добавить("СтоимостьУпрПартииНДС",		НСтр("ru='Стоимость упр. (партии НДС)';uk='Вартість упр. (партії ПДВ)'",ОбщегоНазначения.КодОсновногоЯзыка()));
	
	ЗакрытиеМесяцаСервер.ДополнитьПараметрыРегистрацииПроблемПроверки(ПараметрыРегистрации,
		"ВТРасхожденияСебестоимостиИПартийНДС2_4",
		НСтр("ru='Обнаружены расхождения в суммах между регистрами себестоимости и партий НДС (ФИФО скользящая оценка) по организации ""%1"" на конец периода %2';uk='Виявлено розбіжності в сумах між регістрами собівартості і партій ПДВ (ФІФО змінна оцінка) по організації ""%1"" на кінець періоду %2'",ОбщегоНазначения.КодОсновногоЯзыка()),
		СписокПолей,
		,
        Метаданные.РегистрыНакопления.ДетализацияПартийТоваровДляНДС2_4.ПолноеИмя());
		
    // Регистрация наличия суммовых остатков в регистре "Детализация партий товаров для НДС (ФИФО скользящая оценка)".
	СписокПолей = Новый СписокЗначений;
	СписокПолей.Добавить("Организация", 				НСтр("ru='Организация';uk='Організація'",ОбщегоНазначения.КодОсновногоЯзыка()));
	СписокПолей.Добавить("Партия",						НСтр("ru='Партия';uk='Партія'",ОбщегоНазначения.КодОсновногоЯзыка()));
	СписокПолей.Добавить("АналитикаУчетаПартий",		НСтр("ru='Аналитика партий';uk='Аналітика партій'",ОбщегоНазначения.КодОсновногоЯзыка()));
    СписокПолей.Добавить("НалоговоеНазначение",			НСтр("ru='Налоговое назначение';uk='Податкове призначення'",ОбщегоНазначения.КодОсновногоЯзыка()));
	СписокПолей.Добавить("СтоимостьРеглПартииНДС",		НСтр("ru='Стоимость регл. (партии НДС)';uk='Вартість регл. (партії ПДВ)'",ОбщегоНазначения.КодОсновногоЯзыка()));
	СписокПолей.Добавить("СтоимостьУпрПартииНДС",		НСтр("ru='Стоимость упр. (партии НДС)';uk='Вартість упр. (партії ПДВ)'",ОбщегоНазначения.КодОсновногоЯзыка()));
	
	ЗакрытиеМесяцаСервер.ДополнитьПараметрыРегистрацииПроблемПроверки(ПараметрыРегистрации,
		"ВТСуммовыеОстаткиПартийНДС2_4",
        НСтр("ru='Обнаружены суммовые остатки в регистре ""Детализация партий товаров для НДС (ФИФО скользящая оценка)"" без остатков в регистре себестоимости по организации ""%1"" на конец периода %2';uk='Виявлено сумові залишки в регістрі ""Деталізація партій товарів для ПДВ (ФІФО змінна оцінка)"" без залишків в регістрі собівартості по організації ""%1"" на кінець періоду %2'",ОбщегоНазначения.КодОсновногоЯзыка()),
		СписокПолей,
		,
        Метаданные.РегистрыНакопления.ДетализацияПартийТоваровДляНДС2_4.ПолноеИмя());
		
	// Регистрация проблем.
	ДопПараметры = Новый Структура;
	ДопПараметры.Вставить("ЗначениеПогрешностиСебестоимостьРегл", 		 ЗначенияПараметров.ЗначениеПогрешностиСебестоимостьРегл);
	ДопПараметры.Вставить("ЗначениеПогрешностиСебестоимостьУпр", 		 ЗначенияПараметров.ЗначениеПогрешностиСебестоимостьУпр);
	
	ЗакрытиеМесяцаСервер.ЗарегистрироватьПроблемыВыполненияПроверки(
		ПараметрыПроверки,
		ПараметрыРегистрации,
		ТекстЗапроса,
		ДопПараметры);
	
КонецПроцедуры

// Проверка необходимости пересчета себестоимости из-за незаполненного измерения АналитикаУчетаПартий регистра ДетализацияПартийТоваровДляНДС2_4.
// Вызывается в процедуре определения состояния этапа расчета партий и себестоимости.
//
Функция ПроверкаНеобходимостьПересчетаРегистраПартийНДС(ПараметрыРасчета) Экспорт
	
	Если НЕ РасчетСебестоимостиПовтИсп.ПартионныйУчетВерсии22(НачалоМесяца(ПараметрыРасчета.ПериодРегистрации)) Тогда
		Возврат Неопределено; // проверка нужна только при ПУ22
	КонецЕсли;
	
	Запрос = Новый Запрос;
	Запрос.МенеджерВременныхТаблиц = Новый МенеджерВременныхТаблиц;
	
	Запрос.УстановитьПараметр("КонецПериода", 				  КонецМесяца(ПараметрыРасчета.ПериодРегистрации));
	Запрос.УстановитьПараметр("МассивОрганизаций",  		  ПараметрыРасчета.МассивОрганизаций);
	Запрос.УстановитьПараметр("ТипыЗаписейКонвертацииДанных", РасчетСебестоимостиПрикладныеАлгоритмы.ТипыЗаписейКонвертацииДанных());
	
	Запрос.Текст =
	"ВЫБРАТЬ
	|	МИНИМУМ(ВЫБОР
	|			КОГДА Т.ТипЗаписи В (&ТипыЗаписейКонвертацииДанных)
	|				ТОГДА ДОБАВИТЬКДАТЕ(Т.Период, МЕСЯЦ, 1)
	|			ИНАЧЕ Т.Период
	|		КОНЕЦ) КАК Период
	|ИЗ
    |	РегистрНакопления.ДетализацияПартийТоваровДляНДС2_4 КАК Т
	|ГДЕ
	|	Т.Организация В(&МассивОрганизаций)
	|	И Т.ДокументПоступления = Т.Партия
	|	И Т.АналитикаУчетаПартий = ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка)
	|	И Т.АналитикаУчетаДокументаПоступления <> ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка)
	|	И НЕ Т.АналитикаУчетаДокументаПоступления.Контрагент В (ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка), ЗНАЧЕНИЕ(Справочник.Контрагенты.ПустаяСсылка), НЕОПРЕДЕЛЕНО)
	|	И ВЫБОР
	|			КОГДА Т.ТипЗаписи В (&ТипыЗаписейКонвертацииДанных)
	|				ТОГДА ДОБАВИТЬКДАТЕ(Т.Период, МЕСЯЦ, 1)
	|			ИНАЧЕ Т.Период
	|		КОНЕЦ <= &КонецПериода
	|	И Т.Активность";
	
	Выборка = Запрос.Выполнить().Выбрать();
	
	Если Выборка.Следующий() И ЗначениеЗаполнено(Выборка.Период) Тогда
		Возврат Выборка.Период;
	КонецЕсли;
	
	Возврат Неопределено;
	
КонецФункции

#КонецОбласти

#Область Тестирование

// Дополняет список этапов расчета.
// 
// Параметры:
// 	СписокЭтапов - СписокЗначений - 
//
Процедура ДополнитьЭтапыСРаспределениемПартий(СписокЭтапов) Экспорт
	
    СписокЭтапов.Добавить("ПодготовкаДанныхДляУчетаНДС");
    СписокЭтапов.Добавить("ПодготовкаДанныхДляУчетаНДС2_4");
	//++ НЕ УТ
    СписокЭтапов.Добавить("ПодготовкаДанныхДляУчетаНДС2_4ПоПартиямПрочихРасходов");
	//-- НЕ УТ
	
КонецПроцедуры

// Дополняет список этапов расчета.
// 
// Параметры:
// 	СписокЭтапов - СписокЗначений - 
//
Процедура ДополнитьЭтапыСТрансляциейПартий(СписокЭтапов) Экспорт
	
	СписокЭтапов.Добавить("ПодготовкаДанныхДляПартийПрочихРасходов");
	
КонецПроцедуры

Процедура ТекстЗапросаДляРасчетаЭтапа(ИмяЭтапа, ПараметрыРасчета, ТекстЗапроса) Экспорт
	
    Если ИмяЭтапа = "ПодготовкаДанныхДляУчетаНДС" Тогда
		ТекстЗапроса = ТекстЗапросаДляПартийНДС(ПараметрыРасчета);
		
    ИначеЕсли ИмяЭтапа = "ПодготовкаДанныхДляУчетаНДС2_4" Тогда
		ТекстЗапроса = ТекстЗапросаДляПартийНДС2_4(ПараметрыРасчета);
		
	//++ НЕ УТ
    ИначеЕсли ИмяЭтапа = "ПодготовкаДанныхДляУчетаНДС2_4ПоПартиямПрочихРасходов" Тогда
		ТекстЗапроса = ТекстЗапросаДляПартийНДС2_4ПоПартиямПрочихРасходов(ПараметрыРасчета);
		
	//-- НЕ УТ
	ИначеЕсли ИмяЭтапа = "ПодготовкаДанныхДляПартийПрочихРасходов" Тогда
		ТекстЗапроса = ТекстЗапросаДляПартийПрочихРасходов(ПараметрыРасчета);
		
	КонецЕсли;
	
КонецПроцедуры


#КонецОбласти

#КонецОбласти